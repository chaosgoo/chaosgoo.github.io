{"posts":[{"title":"DWM3001CDKç‚¹äº®WS2812 RGB LED","text":"èƒŒæ™¯å»å¹´å‚åŠ äº†FastBondçš„ç¬¬å››æœŸæ´»åŠ¨, ä¸ºäº†èƒ½å¤Ÿç™½å«–åˆ°è¿™å—å¼€å‘æ¿å­, ä¸å¾—ä¸æå‡ºè¿™å—æ¿å­åœ¨Deadlineä¹‹å‰å®Œæˆä¸€ä¸ªé¡¹ç›®.çœ‹äº†ä¸‹æ´»åŠ¨è¦æ±‚, æ„Ÿè§‰ç‚¹ç¯æ˜¯æœ€ç®€å•çš„. ä¸è¿‡æ—¢ç„¶ç‚¹ç¯äº†, å°±ç‚¹ä¸ªç¨å¾®æœ‰ç‚¹éš¾åº¦çš„å§.æ¯”å¦‚ç‚¹äº®èƒ½è®©æ€§èƒ½å¢åŠ 200%çš„WS2812 RGB LED. å¼€å‘æ¿ä»‹ç» æ¿å­ä¸Šå¸¦æœ‰DWM3001Cæ¨¡å— å¯ä»¥å’ŒApple U1 chip &amp; U2 äº’æ“ä½œ æ”¯æŒUWB channels 5 (6.5 GHz) and 9 (8 GHz) æ¿è½½J-Linkç”¨äºè°ƒè¯•å’Œçƒ§å½• USBæ¥å£ç”¨äºç›´æ¥è¿æ¥DWM3001C USBæ¥å£ 26 pin æ ‘è“æ´¾å…¼å®¹æ¥å£ å¸¦æœ‰resetå’Œä¸€ä¸ªç”¨æˆ·æŒ‰é’®,æ¿è½½LED æ‰€æœ‰çš„DWM3001C GPIOså’Œæ¥å£éƒ½å¼•å‡º DWM3001Cå†…éƒ¨å…·æœ‰ä¸€ä¸ªnRF52833èŠ¯ç‰‡,å®é™…çš„ä»£ç å…¶å®å°±æ˜¯è¿è¡Œåœ¨è¿™é¢—èŠ¯ç‰‡ä¸Š.å¼€å‘å·¥å…·ä¹Ÿéƒ½æ˜¯åŸºäºnRF52833çš„SDK. æ§åˆ¶æ™®é€šLEDnRFçš„æ–‡æ¡£å’Œèµ„æ–™éƒ½å¾ˆé½å…¨, ä¸ä»…æœ‰ç‚¹ç¯çš„ä¾‹å­, è¿æ¿å­çš„LEDå’ŒButtonçš„å¼•è„šå®šä¹‰ä¹Ÿéƒ½é¢„å®šä¹‰å¥½äº†. è¯ä¸å¤šè¯´ , ç›´æ¥æ‰“å¼€å®˜æ–¹çš„ä¾‹å­çœ‹çœ‹.è™½ç„¶ä¹‹å‰å®Œå…¨æ²¡æ¥è§¦è¿‡nRFçš„SDK, ä½†æ˜¯åŸºäºä»¥å‰ESPå¼€å‘ç»éªŒ, ç†è§£ç¤ºä¾‹ä»£ç å¹¶ä¸å›°éš¾. ç¤ºä¾‹å·¥ç¨‹å¯åŠ¨æ—¶å€™ä¼šçœ‹åˆ°æ¿è½½çš„4é¢—LEDä¼šé—ªçƒ, å¯¹ç€å¯åŠ¨ä»£ç æŸ¥æŠ„åˆ°å®é™…ä»£ç æ˜¯ 1234567891011121314void BoardInit(void){ bsp_board_init(BSP_INIT_LEDS | BSP_INIT_BUTTONS); peripherals_init(); for (int i = 0; i &lt; 6; i++) { bsp_board_led_invert(BSP_BOARD_LED_0); bsp_board_led_invert(BSP_BOARD_LED_1); bsp_board_led_invert(BSP_BOARD_LED_2); bsp_board_led_invert(BSP_BOARD_LED_3); nrf_delay_ms(250); }} ç”šè‡³è¿LEDæ§åˆ¶ä¹Ÿè´´å¿ƒçš„å°è£…å¥½äº†,bsp_board_led_onå’Œbsp_board_led_off, åŒæ—¶è¿˜çœ‹åˆ°äº†åœ¨ä¸²å£åˆ·æ–°æ—¶å€™é—ªçƒLEDçš„ä»£ç  123456789101112static void logger_thread(void *arg) { UNUSED_PARAMETER(arg); while (1) { NRF_LOG_FLUSH(); bsp_board_led_on(BSP_BOARD_LED_1); nrf_delay_ms(1); bsp_board_led_off(BSP_BOARD_LED_1); nrf_delay_ms(1); vTaskSuspend(NULL); // Suspend myself }} ç¼–å†™WS2812çš„é©±åŠ¨é©±åŠ¨WS2812çš„åŠæ³•æœ‰å¾ˆå¤š, è§†æƒ…å†µé€‰æ‹©æœ€åˆé€‚çš„é©±åŠ¨æ–¹å¼. IOæ¨¡æ‹Ÿ(Bit-Banging)è¿™æ˜¯æœ€ç»å…¸çš„æ–¹å¼, å¦‚æœèŠ¯ç‰‡æ¯”è¾ƒç®€å•, æ²¡æœ‰SPIæ¥å£, æˆ–è€…SPIæ¥å£è¢«å ç”¨äº†, å¯ä»¥è€ƒè™‘ä½¿ç”¨IOæ¨¡æ‹Ÿ. ç¼ºç‚¹æ˜¯æ¶ˆè€—CPUèµ„æº. Arduino Unoå°±æ˜¯ç”¨è¿™ç§æ–¹å¼é©±åŠ¨WS2812çš„^1. PWM + DMAæ¨¡æ‹Ÿè¿™ä¸ªæ–¹å¼ç›¸å½“äºIOæ¨¡æ‹Ÿçš„ä¼˜åŒ–ç‰ˆæœ¬, å¼•å…¥DMAä¹‹å, é‡Šæ”¾äº†CPUèµ„æºå‹åŠ›. SPIæ¨¡æ‹Ÿè¿™æ˜¯ä¸€ç§æ›²çº¿æ•‘å›½åŠæ³•, åˆ©ç”¨SPIçš„å‘é€æœºåˆ¶æ¥æ¨¡æ‹ŸWS2812çš„åè®®, é€‚åˆSPIæ¥å£ç©ºé—²çš„åœºæ™¯.é…åˆSPI DMAçš„æƒ…å†µä¸‹, å‡ ä¹ä¸æ¶ˆè€—CPUèµ„æº. RMTæ¨¡æ‹Ÿè¿™æ˜¯ESP32èŠ¯ç‰‡çš„é©±åŠ¨æ–¹å¼, åˆ©ç”¨RMTå¤–è®¾æ¥æ¨¡æ‹ŸWS2812çš„åè®®.æœ€ä¸ºä¼˜é›…, æ¨¡æ‹Ÿçš„æ—¶åºéå¸¸ç²¾å‡†, ä¸”ä¸éœ€è¦CPUå¹²é¢„.^2. æœ€ç»ˆé€‰æ‹©è€ƒè™‘åˆ°å®ç°éš¾åº¦å’Œå®é™…æ•ˆæœ, æˆ‘å†³å®šé‡‡ç”¨SPIæ¨¡æ‹Ÿçš„åŠæ³•åœ¨DWM3001CDKä¸Šå®ç°WS2812çš„é©±åŠ¨æ¨¡æ‹Ÿ. é©±åŠ¨ç¼–å†™å‚ç…§https://www.cnblogs.com/milton/p/17892606.html, å°†å…¶ä¸­çš„spié©±åŠ¨ä¿®æ”¹ä¸ºnrf52833ç‰ˆæœ¬.ç¼–å†™åˆå§‹åŒ–SPIä»£ç  123456789101112131415void ws2812_init(void) { nrf_gpio_cfg_output(30); nrf_gpio_cfg_output(27); nrf_gpio_cfg_output(31); memset(ws2812_buffer, 0, WS2812_BUFFER_SIZE); nrf_drv_spi_config_t spi_config = NRF_DRV_SPI_DEFAULT_CONFIG; spi_config.ss_pin = NRF_GPIO_PIN_MAP(0, 30); spi_config.miso_pin = NRF_DRV_SPI_PIN_NOT_USED; spi_config.mosi_pin = NRF_GPIO_PIN_MAP(0, 27); spi_config.sck_pin = NRF_GPIO_PIN_MAP(0, 31); spi_config.frequency = NRF_DRV_SPI_FREQ_4M; spi_config.mode = NRF_DRV_SPI_MODE_0; // SPI æ¨¡å¼ 0 int spi_ret = nrf_drv_spi_init(&amp;spi, &amp;spi_config, spi_event_handler, NULL); NRF_LOG_ERROR(&quot;ws2812_init() = %d&quot;, spi_ret);} ç¼–å†™å‘é€å‡½æ•°ä»£ç  123456789NRF_LOG_INFO(&quot;ws2812_send_spi()&quot;);APP_ERROR_CHECK(nrf_drv_spi_transfer(&amp;spi, ws2812_buffer, WS2812_BUFFER_SIZE, NULL, 0));while (!spi_xfer_done) { __WFE();}// å‘é€å¤ä½ä¿¡å·ï¼ˆä¿æŒ MOSI ä½ç”µå¹³è‡³å°‘ 50Âµsï¼‰nrf_gpio_pin_clear(NRF_GPIO_PIN_MAP(0, 27));nrf_delay_us(50); éœ€è¦ä¿®æ”¹nrf_drv_spi_transferå£°æ˜å’Œå®šä¹‰,å°†ç¬¬ä¸‰ä¸ªå‚æ•°ä¿®æ”¹ä¸ºsize_tç±»å‹, ä¸ç„¶æ— æ³•ä¸€æ¬¡æ€§ä¼ è¾“WS2812_BUFFER_SIZEå¤§å°çš„æ•°æ®å¯¼è‡´é¢œè‰²å¼‚å¸¸. ç¼–å†™é¢œè‰²è®¾ç½®å‡½æ•°, å¢åŠ é¢œè‰²è½¬æ¢å‡½æ•°. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566void ws2812_pixel(uint16_t led_no, uint8_t r, uint8_t g, uint8_t b) { uint8_t *ptr = &amp;ws2812_buffer[led_no * 24]; WS2812_FILL_BUFFER(g); WS2812_FILL_BUFFER(r); WS2812_FILL_BUFFER(b);}void ws2812_pixel_all(uint8_t r, uint8_t g, uint8_t b) { uint8_t *ptr = ws2812_buffer; for (uint16_t i = 0; i &lt; WS2812_NUM_LEDS; ++i) { WS2812_FILL_BUFFER(g); WS2812_FILL_BUFFER(r); WS2812_FILL_BUFFER(b); }}void hsv_to_rgb(uint8_t h, uint8_t s, uint8_t v, uint8_t *r, uint8_t *g, uint8_t *b) { uint8_t region, remainder, p, q, t; if (s == 0) { *r = v; *g = v; *b = v; return; } region = h / 43; remainder = (h - (region * 43)) * 6; p = (v * (255 - s)) &gt;&gt; 8; q = (v * (255 - ((s * remainder) &gt;&gt; 8))) &gt;&gt; 8; t = (v * (255 - ((s * (255 - remainder)) &gt;&gt; 8))) &gt;&gt; 8; switch (region) { case 0: *r = v; *g = t; *b = p; break; case 1: *r = q; *g = v; *b = p; break; case 2: *r = p; *g = v; *b = t; break; case 3: *r = p; *g = q; *b = v; break; case 4: *r = t; *g = p; *b = v; break; default: *r = v; *g = p; *b = q; break; }} æœ€ååŠ ä¸Šç»å…¸çš„æ¸å˜å‡½æ•° 12345678910111213141516171819202122232425262728293031323334353637void ws2812_row_gradient(uint16_t i) { for (uint8_t row = 0; row &lt; WS2812_ROWS; row++) { for (uint8_t col = 0; col &lt; WS2812_COLS; col++) { // è®¡ç®—å½“å‰ LED çš„è‰²ç›¸å€¼ uint8_t hue = (i + row * 256 / WS2812_ROWS) % 256; uint8_t r, g, b; // å°† HSV è½¬æ¢ä¸º RGBï¼Œäº®åº¦è®¾ç½®ä¸º 50 hsv_to_rgb(hue, 255, 16, &amp;r, &amp;g, &amp;b); // è®¡ç®— LED ç´¢å¼• uint16_t led = row * WS2812_COLS + col; // è®¾ç½® LED é¢œè‰² ws2812_pixel(led, r, g, b); } }}void ws2812_col_gradient(uint16_t i) { for (uint8_t col = 0; col &lt; WS2812_COLS; col++) { for (uint8_t row = 0; row &lt; WS2812_ROWS; row++) { // è®¡ç®—å½“å‰ LED çš„è‰²ç›¸å€¼ uint8_t hue = (i + col * 256 / WS2812_COLS) % 256; uint8_t r, g, b; // å°† HSV è½¬æ¢ä¸º RGBï¼Œäº®åº¦è®¾ç½®ä¸º 50 hsv_to_rgb(hue, 255, 50, &amp;r, &amp;g, &amp;b); // è®¡ç®— LED ç´¢å¼• uint16_t led = row * WS2812_COLS + col; // è®¾ç½® LED é¢œè‰² ws2812_pixel(led, r, g, b); } }} ç¬¬ä¸€é¢—ç¯ç é¢œè‰²å¼‚å¸¸ä¿®å¤ä¸Šé¢çš„ä»£ç ç¼–å†™å®Œæˆçƒ§å½•è¿è¡Œå, å‘ç°ç¬¬ä¸€ä¸ªç¯ç æ€»æ˜¯ç»¿è‰²,ä¸€ç•ªæœç´¢åæ‰¾åˆ°äº†ä¿®å¤åŠæ³•, æ ¸å¿ƒæ€æƒ³æ˜¯å°±æ˜¯åœ¨å‘é€æ•°æ®å‰, å…ˆå‘é€å‡ ä¸ªé›¶å­—èŠ‚.^3 æ‰€ä»¥æˆ‘ä»¬ä¸ºbufferå¢åŠ å¤´éƒ¨é›¶å­—èŠ‚ 1234#define WS2812_NUM_LEDS 60 // 6x10 ç¯æ¿ï¼Œå…± 60 ä¸ª LED#define WS2812_RESET_PULSE 60#define WS2812_EXTRA_ZEROS 4 // æ·»åŠ  4 ä¸ªé›¶å­—èŠ‚#define WS2812_BUFFER_SIZE (WS2812_NUM_LEDS * 24 + WS2812_RESET_PULSE + WS2812_EXTRA_ZEROS) åŒæ—¶æ›´æ–°åˆå§‹åŒ–ä»£ç , é¢œè‰²è®¾ç½®å’Œå‘é€å‡½æ•° 123456789101112131415161718void ws2812_send_spi(void) { NRF_LOG_INFO(&quot;ws2812_send_spi()&quot;); memset(ws2812_buffer, 0, WS2812_EXTRA_ZEROS); APP_ERROR_CHECK(nrf_drv_spi_transfer(&amp;spi, ws2812_buffer, WS2812_BUFFER_SIZE, NULL, 0)); while (!spi_xfer_done) { __WFE(); } // å‘é€å¤ä½ä¿¡å·ï¼ˆä¿æŒ MOSI ä½ç”µå¹³è‡³å°‘ 50Âµsï¼‰ nrf_gpio_pin_clear(NRF_GPIO_PIN_MAP(0, 27)); nrf_delay_us(50);}void ws2812_pixel(uint16_t led_no, uint8_t r, uint8_t g, uint8_t b) { uint8_t *ptr = &amp;ws2812_buffer[WS2812_EXTRA_ZEROS + led_no * 24]; WS2812_FILL_BUFFER(g); WS2812_FILL_BUFFER(r); WS2812_FILL_BUFFER(b);} å†æ¬¡ç¼–å†™æµ‹è¯•ä»£ç ,æ£€æŸ¥æœ€ç»ˆæ•ˆæœæ˜¯å¦æ­£å¸¸ 1234567891011ws2812_init();uint16_t i = 0;while (1) { // åˆ—æ¸å˜æ•ˆæœ ws2812_col_gradient(i); ws2812_send_spi(); nrf_delay_ms(5); // æ›´æ–°è‰²ç›¸å€¼ i = (i + 1) % 256;} è¿™ä¸€æ¬¡ç¬¬ä¸€ä¸ªLEDç»ˆäºå¬è¯äº†. æ•°å­—æ˜¾ç¤ºæ‰‹åŠ¨ç¼–å†™ä¸€ä¸ªå­—åº“, å¹¶ä¸”æŒ‰ç…§å¯¹åº”çš„ä½ç½®å¡«å……åˆ°bufferä¸­.å®é™…è¿è¡Œå¦‚ä¸‹.è¿™é‡Œæˆ‘æ¥äº†ä¸€ä¸ªæ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨, å±å¹•ä¼šç”¨ä¸åŒé¢œè‰²å±•ç¤ºæ¸©åº¦å’Œæ¹¿åº¦æ•°å€¼.ä¸Šå›¾ä¸­å±•ç¤ºçš„æ˜¯å½“å‰æ¹¿åº¦53%. æ€»ç»“é€šè¿‡ SPI æ¨¡æ‹Ÿæ—¶åºé©±åŠ¨ WS2812 æ˜¯ä¸€ç§åœ¨ç¡¬ä»¶èµ„æºå—é™ä¸”æ—  RMT å¤–è®¾çš„æƒ…å†µä¸‹çš„ç»ä½³é€‰æ‹©ã€‚åœ¨ DWM3001CDK ä¸Šå®ç°è¿™ä¸€åŠŸèƒ½ï¼Œä¸ä»…è¾¾åˆ°äº† FastBond é¡¹ç›®çš„è¦æ±‚ï¼Œä¹Ÿä¸ºåç»­å¼€å‘æ›´å¤æ‚çš„ UWB å®šä½å¯è§†åŒ–ç•Œé¢æ‰“ä¸‹äº†åŸºç¡€ã€‚","link":"/2025/01/12/DWM3001CDK-spi-ws2812-driver/"},{"title":"å±å¹•ä¸å¤Ÿï¼Œç®—æ³•æ¥å‡‘(äºŒ)ï¼šESP32 å•è‰²å±ä¸Šçš„ Ditherpunk å®æˆ˜","text":"0x00 åºåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­é€šè¿‡ JavaScript æ¨¡æ‹Ÿäº†å„ç§æŠ–åŠ¨ç®—æ³•çš„è§†è§‰æ•ˆæœã€‚è™½ç„¶åŸç†é€šé€äº†ï¼Œä½†çœŸæ­£çš„æŒ‘æˆ˜åœ¨äºç¡¬ä»¶ç«¯ï¼šå¦‚ä½•åœ¨èµ„æºå—é™çš„åµŒå…¥å¼è®¾å¤‡ä¸Šå¤ç°è¿™äº›æ•ˆæœï¼Ÿ æœ¬æ–‡å°†è®°å½•æˆ‘åŸºäº ESP32-S3 å’Œä¸€å— 1.54 å¯¸ ST7305 å•è‰²å±çš„å®æˆ˜è¿‡ç¨‹ï¼Œæ¢è®¨å¦‚ä½•åœ¨å•ç‰‡æœºä¸Šå®ç°ä»åŸºç¡€çš„é˜ˆå€¼æ³•åˆ°å¤æ‚çš„è¯¯å·®æ‰©æ•£ç­‰å¤šç§å›¾åƒå¤„ç†ç®—æ³•ã€‚ 0x01 ç¡¬ä»¶ç¯å¢ƒ MCU: ESP32-S3 (å½“ç„¶ï¼Œæ™®é€šçš„ ESP32 ç”šè‡³ ESP8266 ä¹Ÿå®Œå…¨è¶³ä»¥èƒœä»») å±å¹•: 1.54 inch Monochrome Display é±¼é¹°å…‰ç”µå•è‰²å±å¹• é©±åŠ¨: ST7305 (è¿™ç§æ§åˆ¶å™¨ä¹Ÿå¸¸è§äºä¸€äº›é»‘ç™½åŒè‰²æˆ–é»‘ç™½çº¢ä¸‰è‰²çš„å°å°ºå¯¸å¢¨æ°´å±) åˆ†è¾¨ç‡: 200 x 200 (1-bit Monza, çº¯é»‘ç™½) é€‰æ‹© ESP32-S3 ä¸»è¦æ˜¯å› ä¸ºå…¶å†…ç½®çš„å¤§å®¹é‡ SRAMï¼ˆ512KB+ï¼‰å’Œå¯¹ PSRAM çš„æ”¯æŒï¼Œè®©æˆ‘ä»¬åœ¨å¤„ç† 200x200ï¼ˆåªè¦ 5KBï¼‰ç”šè‡³æ›´é«˜åˆ†è¾¨ç‡çš„å›¾åƒç¼“å†²åŒºæ—¶æ¸¸åˆƒæœ‰ä½™ã€‚è€Œ ST7305 æ˜¯ä¸€æ¬¾ä¸»è¦ç”¨äºç‚¹é˜µç”µå­çº¸æ˜¾ç¤ºå™¨çš„é©±åŠ¨èŠ¯ç‰‡ï¼Œé€šè¿‡ SPI æ¥å£é€šä¿¡ã€‚ 0x02 æ ¸å¿ƒæŒ‘æˆ˜åœ¨ PC ç½‘é¡µç«¯ï¼Œæˆ‘ä»¬æœ‰ Float32Array å’Œè¿‘ä¹æ— é™çš„å†…å­˜ã€‚ä½†åœ¨ ESP32-S3 ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨ï¼š å†…å­˜ç®¡ç†ï¼šå°½é‡å¤ç”¨ Bufferï¼Œé¿å…é¢‘ç¹ malloc/free äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚ Gamma æ ¡æ­£ï¼šå¿…é¡»åœ¨ C è¯­è¨€ä¸­æ‰‹åŠ¨å®ç° Gamma Tableï¼Œå¦åˆ™ç”»é¢ä¼šä¸¥é‡åæš—ã€‚ é©±åŠ¨é€‚é…ï¼šå±å¹•é€šå¸¸éœ€è¦è¾ƒä¸ºå¤æ‚çš„ SPI åˆå§‹åŒ–åºåˆ—ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ä¸åŒçš„å±å¹•ç»ç’ƒé¢æ¿ï¼Œéœ€è¦é…ç½®æ­£ç¡®çš„ç”µå‹å’Œé©±å±æ³¢å½¢ã€‚ 0x03 ä»£ç å®ç°è¯¦è§£é¡¹ç›®å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š 12345main/â”œâ”€â”€ blue_noise.h // é¢„è®¡ç®—çš„è“å™ªå£°çº¹ç†æ•°ç»„â”œâ”€â”€ esp_lcd_st7305.c // å±å¹•é©±åŠ¨å®ç°â”œâ”€â”€ hello_world_main.c// æ ¸å¿ƒé€»è¾‘ä¸ç®—æ³•å®ç°â””â”€â”€ sample_img.h // æµ‹è¯•ç”¨ç°åº¦å›¾ç‰‡æ•°ç»„ å»ºç«‹ Gamma æŸ¥æ‰¾è¡¨ (LUT)æ­£å¦‚ç¬¬ä¸€ç¯‡æ‰€è¿°ï¼Œè¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚å¦‚æœä¸åš Gamma æ ¡æ­£ï¼Œçº¿æ€§ç©ºé—´çš„æŠ–åŠ¨ç®—æ³•å¤„ç† sRGB å›¾ç‰‡æ—¶ï¼Œä¸­é—´è°ƒä¼šåæš—ã€‚ç”±äº powf å‡½æ•°åœ¨åµŒå…¥å¼ä¸Šè®¡ç®—éå¸¸æ˜‚è´µï¼Œæˆ‘ä»¬ç»å¯¹ä¸èƒ½å¯¹æ¯ä¸ªåƒç´ å®æ—¶è®¡ç®—ã€‚ä¸ºäº†æ€§èƒ½ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨æ—¶é¢„è®¡ç®—ä¸€ä¸ª 256 é•¿åº¦çš„æŸ¥æ‰¾è¡¨ã€‚ 123456789// Gamma correction LUT (0-255 -&gt; 0.0-1.0 linear)static float s_gamma_lut[256];void init_gamma_lut() { for (int i = 0; i &lt; 256; i++) { // sRGB to Linear: ((val / 255.0) ^ 2.2) s_gamma_lut[i] = powf(i / 255.0f, 2.2f); }} ä»»ä½•åç»­çš„åƒç´ è¯»å–ï¼Œéƒ½é€šè¿‡ s_gamma_lut[pixel] æ¥è·å–å…¶çº¿æ€§äº®åº¦å€¼ã€‚è¿™æ˜¯ä¸€ç§ç»å…¸çš„ç©ºé—´æ¢æ—¶é—´ç­–ç•¥ã€‚ åŸºç¡€ç®—æ³•ï¼šThreshold &amp; Randomæœ€ç®€å•çš„ç®—æ³•å¾€å¾€æ˜¯å¾ˆå¥½çš„åŸºå‡†çº¿ã€‚ Threshold (é˜ˆå€¼æ³•) ï¼šä¹Ÿå°±æ˜¯äºŒå€¼åŒ–ã€‚è¿™æ˜¯æœ€å¿«çš„æ–¹æ³•ï¼Œä½†ä¹Ÿæ˜¯æ•ˆæœæœ€å·®çš„æ–¹æ³•ã€‚ 12345678void dither_threshold(const uint8_t *src, uint8_t *dst) { memset(dst, 0, ST7305_FRAMEBUFFER_SIZE); for (int i = 0; i &lt; ST7305_WIDTH * ST7305_HEIGHT; i++) { float val = s_gamma_lut[src[i]]; bool white = val &gt; 0.5f; set_pixel_1bit(dst, i % ST7305_WIDTH, i / ST7305_WIDTH, white); }} å®æ‹æ•ˆæœï¼šç»†èŠ‚å¤§é‡ä¸¢å¤±ï¼Œä¿—ç§°â€œä¸¤è‰²å›¾â€ã€‚å®ƒåªèƒ½ä¿ç•™æœ€ç¡¬çš„è¾¹ç¼˜ï¼Œå‡ ä¹å®Œå…¨ä¸¢å¤±äº†æ‰€æœ‰çš„ç°åº¦ä¿¡æ¯ã€‚ Random (éšæœºæŠ–åŠ¨)ä¸ºäº†æ‰¾å›ä¸¢å¤±çš„ç°åº¦ï¼Œæˆ‘ä»¬å¼•å…¥ rand() æ¥æ‰“ç ´é‡åŒ–é˜¶æ¢¯ã€‚é€šè¿‡ç»™æ¯ä¸ªåƒç´ å€¼å¢åŠ ä¸€ä¸ªéšæœºå™ªå£°ï¼Œä½¿å¾—åŸæœ¬åœ¨é˜ˆå€¼é™„è¿‘çš„åƒç´ æœ‰ä¸€åŠæ¦‚ç‡ç¿»è½¬ï¼Œä»è€Œå®è§‚ä¸Šè¡¨ç°å‡ºç°åº¦ã€‚ 12float noise = ((float)rand() / RAND_MAX) - 0.5f; // -0.5 to 0.5bool white = (val + noise) &gt; 0.5f; å®æ‹æ•ˆæœï¼šè™½ç„¶æœ‰ç°åº¦æ„Ÿäº†ï¼Œä½†ç”»é¢éå¸¸è„ï¼Œå……æ»¡äº†ç™½å™ªå£°ã€‚è¿™ç§é«˜é¢‘å™ªå£°åœ¨äººçœ¼çœ‹æ¥å°±æ˜¯â€œé›ªèŠ±ç‚¹â€ï¼Œå¹¶ä¸è®¨å–œã€‚ æœ‰åºæŠ–åŠ¨ï¼šBayer Matrixæœ‰åºæŠ–åŠ¨éå¸¸é€‚åˆæ²¡æœ‰ Framebuffer çš„è¶…ä½ç«¯å•ç‰‡æœºï¼ˆå¦‚ Arduino Uno, ATtiny85ï¼‰ï¼Œå› ä¸ºå®ƒæ˜¯ Point-Operationï¼ˆç‚¹æ“ä½œï¼‰ï¼Œä¸éœ€è¦çŸ¥é“é‚»å±…åƒç´ çš„ä¿¡æ¯ï¼Œä¹Ÿä¸éœ€è¦å­˜å‚¨ä¸Šä¸€è¡Œçš„è¯¯å·®ã€‚æˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªåƒç´ ç‹¬ç«‹è®¡ç®—ã€‚ 123456789static const float s_bayer_matrix[4][4] = { {0.0f / 16.0f, 8.0f / 16.0f, 2.0f / 16.0f, 10.0f / 16.0f}, {12.0f / 16.0f, 4.0f / 16.0f, 14.0f / 16.0f, 6.0f / 16.0f}, // ... complete matrix};// Inside loopfloat threshold = s_bayer_matrix[y % 4][x % 4];bool white = (val &gt; threshold); å®æ‹æ•ˆæœï¼šç»å…¸çš„åå­—äº¤å‰ç½‘çº¹ã€‚è¿™ç§é£æ ¼åœ¨å¤å¤ GameBoy æ¸¸æˆå’Œæ—©æœŸçš„ Macintosh ç³»ç»Ÿä¸­éå¸¸å¸¸è§ã€‚å®ƒé€šè¿‡è§„åˆ™çš„çº¹ç†æ¥æ¨¡æ‹Ÿç°åº¦ï¼Œè™½ç„¶çœ‹èµ·æ¥æœ‰ç‚¹â€œäººå·¥â€ï¼Œä½†æ¯”éšæœºæŠ–åŠ¨å¹²å‡€å¾—å¤šã€‚ è¯¯å·®æ‰©æ•£ï¼šFloyd-Steinberg &amp; Atkinsonå¯¹äºæ”¯æŒ Framebuffer çš„è®¾å¤‡ï¼ˆESP32 æœ‰è¶³å¤Ÿ RAMï¼‰ï¼Œè¯¯å·®æ‰©æ•£æ˜¯æœ€ä½³é€‰æ‹©ã€‚ä½ éœ€è¦ä¸€ä¸ªæµ®ç‚¹æ•° Buffer æ¥å­˜å‚¨æ‰©æ•£è¿‡ç¨‹ä¸­çš„è¯¯å·®ã€‚ Floyd-Steinberg æ˜¯æ•™ç§‘ä¹¦èˆ¬çš„æ ‡å‡†ï¼Œæ‰©æ•£ç³»æ•°ä¸º 7, 3, 5, 1 (/16)ã€‚å®ƒè¯•å›¾å°†é‡åŒ–äº§ç”Ÿçš„æ¯ä¸€ä¸ªè¯¯å·®éƒ½å®Œç¾åœ°åˆ†é…ç»™é‚»å±…ï¼Œä»æ•°å­¦ä¸Šè®²æ˜¯æœ€ç²¾ç¡®çš„ã€‚å®æ‹æ•ˆæœï¼š Atkinson åˆ™æ›´é€‚åˆè¿™ç§é«˜è§£æåº¦ä½†ä½è‰²æ·±çš„å±å¹•ã€‚å®ƒç”± Bill Atkinson è®¾è®¡ï¼Œä¸åƒ Floyd-Steinberg é‚£æ ·ä¿ç•™ 100% çš„è¯¯å·®ï¼Œè€Œæ˜¯åªä¿ç•™ 75% çš„è¯¯å·®ç”¨äºæ‰©æ•£ï¼Œè¿™å°±äººä¸ºåˆ¶é€ äº†ä¸€äº›â€œæ­»é»‘â€å’Œâ€œæ­»ç™½â€åŒºåŸŸã€‚è¿™å¬èµ·æ¥åƒæ˜¯ç¼ºç‚¹ï¼Œä½†åœ¨ä½å¯¹æ¯”åº¦çš„å•è‰²å±ä¸Šï¼Œä½†è¿™åè€Œå¢åŠ äº†å±€éƒ¨å¯¹æ¯”åº¦ï¼Œè®©å›¾åƒçœ‹èµ·æ¥æ›´æ¸…æ™°é”åˆ©ï¼Œå‡å°‘äº†â€œè •è™«â€ä¼ªå½±ã€‚ 12345678// Distribute 1/8 to neighbors (Atkinson)float err_part = quant_error / 8.0f;if (x + 1 &lt; ST7305_WIDTH) work_buf[y * ST7305_WIDTH + x + 1] += err_part;if (x + 2 &lt; ST7305_WIDTH) work_buf[y * ST7305_WIDTH + x + 2] += err_part;// ... bottom neighbors å®æ‹æ•ˆæœï¼šè¿™æ˜¯æˆ‘åœ¨è¿™å—å±ä¸Šæœ€å–œæ¬¢çš„ç®—æ³•ã€‚çº¿æ¡ç¡¬æœ—ï¼Œè´¨æ„Ÿæä½³ï¼Œç‰¹åˆ«é€‚åˆæ˜¾ç¤ºæ–‡å­—å’Œ icon æ··åˆçš„ UI ç•Œé¢ã€‚ åˆ«æœ‰é£å‘³ï¼šBlue Noise (è“å™ªå£°)å¦‚æœåœ¨åµŒå…¥å¼è®¾å¤‡ä¸Šæƒ³è¦æ¨¡æ‹Ÿèƒ¶ç‰‡æ„Ÿï¼Œè“å™ªå£°æ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚å®ƒçš„è®¡ç®—æˆæœ¬å’Œ Bayer ä¸€æ ·ä½ï¼ˆåªéœ€è¦æŸ¥è¡¨ï¼‰ï¼Œä½†æ•ˆæœå´èƒ½é€šè¿‡â€œæ’åˆ—æ— åºä½†åˆ†å¸ƒå‡åŒ€â€çš„å™ªç‚¹æ¥æ¬ºéª—äººçœ¼ã€‚ æˆ‘ä»¬éœ€è¦å°†ä¸€å¼ é¢„è®¡ç®—å¥½çš„è“å™ªå£°çº¹ç†è½¬æ¢æˆ C æ•°ç»„ (blue_noise.h) å­˜å‚¨åœ¨ Flash ä¸­ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦ç‰ºç‰²å‡ å KB çš„ Flash ç©ºé—´æ¥æ¢å–è¿™ç§æ•ˆæœã€‚ 123// Map 0-255 texture to 0.0-1.0float threshold = blue_noise_map[(y % BN_H) * BN_W + (x % BN_W)] / 255.0f;bool white = (val &gt; threshold); å®æ‹æ•ˆæœï¼šéå¸¸è‡ªç„¶çš„é¢—ç²’æ„Ÿï¼Œæ²¡æœ‰ä»»ä½•è§„å¾‹æ€§æ¡çº¹ï¼Œå°±åƒä¸€å¼ è€ç…§ç‰‡ã€‚è¿™ç§ç®—æ³•ç‰¹åˆ«é€‚åˆæ˜¾ç¤ºäººåƒå’Œé£æ™¯æ‘„å½±ã€‚ 0x04 æ€»ç»“åœ¨ ESP32 è¿™ç§çº§åˆ«çš„ MCU ä¸Šï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å®ç°é«˜è´¨é‡çš„å³æ—¶å›¾åƒæŠ–åŠ¨ã€‚ä¸åŒçš„ç®—æ³•é€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼š Bayer æœ‰åºæŠ–åŠ¨ï¼šè®¡ç®—å¼€é”€æœ€å°ï¼Œé€‚åˆèµ„æºæç«¯å—é™ï¼ˆå¦‚ä¸å¸¦ RAM çš„ä½ç«¯å•ç‰‡æœºï¼‰æˆ–å¤å¤é£æ ¼æ¸¸æˆã€‚ Atkinsonï¼šå¯¹æ¯”åº¦æœ€é«˜ï¼Œè¾¹ç¼˜æ¸…æ™°ï¼Œé€‚åˆ UI ç•Œé¢ã€æ–‡å­—æ··æ’åœºæ™¯ã€‚ Blue Noiseï¼šé¢—ç²’æ„Ÿè‡ªç„¶ï¼Œé€‚åˆæ˜¾ç¤ºæ‘„å½±å›¾ç‰‡ï¼Œä½†éœ€è¦é¢å¤–çš„ Flash ç©ºé—´å­˜å‚¨çº¹ç†ã€‚ å¸Œæœ›æœ¬æ–‡èƒ½ä¸ºä½ åœ¨å•è‰²å±å¹•å¼€å‘ä¸­æä¾›ä¸€äº›æ€è·¯ã€‚ 0x05 å‚è€ƒèµ„æ–™ Kevincoooool/esp_lcd_st7305 - æœ¬æ–‡ ST7305 é©±åŠ¨ç§»æ¤å‚è€ƒ DuRuofu/esp-idf-st7305-Ink-screen - å¦ä¸€ä¸ªä¼˜ç§€çš„ ST7305 é©±åŠ¨å®ç°","link":"/2025/12/30/Ditherpunk-The-Art-of-Dithering-2-ESP32/"},{"title":"ESP-IDF æ’ä»¶ï¼šç”¨ embed_txtfiles ä¼˜é›…åœ°åœ¨å›ºä»¶é‡Œâ€œå¡â€æ–‡ä»¶","text":"0x00 èƒŒæ™¯æœ€è¿‘åœ¨ç¿»çœ‹ GSC (Google Search Console) çš„æœç´¢å…³é”®è¯æ—¶ï¼Œå‘ç° esp-idf embed-txtfiles è¿™ä¸ªè¯çš„å‡ºç°é¢‘ç‡é«˜å¾—æƒŠäººã€‚çœ‹æ¥å¤§å®¶åœ¨æ ESP32 å¼€å‘çš„æ—¶å€™ï¼Œéƒ½è¢«â€œå¦‚ä½•åœ¨å›ºä»¶é‡Œä¼˜é›…åœ°æ”¾ä¸€ä¸ªæ–‡ä»¶â€è¿™ä¸ªé—®é¢˜å›°æ‰°è¿‡ã€‚ åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä¸ºäº†å®ç°ä¸€äº›åŠŸèƒ½ï¼ˆæ¯”å¦‚ä¹‹å‰çš„é‚£ä¸ªæ¡Œé¢åƒç´ å°å±å¹•ï¼‰ï¼Œæ›¾å‚»ä¹ä¹åœ°æŠŠå›¾ç‰‡å…¨è½¬æˆäº†å·¨å¤§çš„ C æ•°ç»„ï¼ˆ.h æ–‡ä»¶ï¼‰ã€‚ç»“æœå¯æƒ³è€ŒçŸ¥ï¼šä»£ç æ–‡ä»¶è†¨èƒ€åˆ°å‡ ä¸‡è¡Œï¼ŒIDE ç´¢å¼•å¡æ­»ï¼Œæ¯æ¬¡å¾®è°ƒä¸€ä¸ªåƒç´ éƒ½è¦é‡æ–°ç¼–è¯‘åŠå¤©ï¼Œç®€ç›´æ˜¯ç¾éš¾ã€‚ ä¸ç®¡æ˜¯ HTTPS çš„æ ¹è¯ä¹¦ã€å‰ç«¯ HTML é¡µé¢ï¼Œè¿˜æ˜¯ç®€å•çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœå…¨éƒ½å†™æˆå·¨å¤§çš„ const char[] ç¡¬ç¼–ç åˆ°ä»£ç é‡Œï¼Œé‚£å·¥ç¨‹ç»´æŠ¤ç®€ç›´æ˜¯è‡ªæˆ‘æŠ˜ç£¨ã€‚ä»Šå¤©å°±æ‹¿ç€æˆ‘é‚£å—æ–¥ 9.9 å…ƒå·¨èµ„ä¹°å›æ¥çš„ ESP32-C3 æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•ç”¨ ESP-IDF é‡Œçš„è¿™ä¸ªé»‘ç§‘æŠ€ä¼˜é›…åœ°å¡«å‘ã€‚ 0x01 æ–¹æ¡ˆå¯¹æ¯”ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ embed_txtfilesï¼Ÿæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€å¼ ç›´è§‚çš„å¯¹æ¯”è¡¨ï¼š æ–¹æ¡ˆ ä¼˜ç‚¹ ç¼ºç‚¹ é€‚ç”¨åœºæ™¯ C æ•°ç»„ (.h) é›¶ç¯å¢ƒè¦æ±‚ï¼Œå“ªé‡Œéƒ½èƒ½ç¼– ç ´åä»£ç æ•´æ´ï¼Œç¼–è¯‘ææ…¢ æå°çš„èµ„æºï¼ˆå¦‚ 8x8 å­—ä½“ï¼‰ æ–‡ä»¶ç³»ç»Ÿ (SPIFFS) åŠ¨æ€è¯»å†™ï¼Œç©ºé—´å¤§ éœ€æ‰‹å·¥é…ç½®åˆ†åŒºè¡¨ï¼Œè®¿é—®ç¹ç å¤§é‡å›¾ç‰‡ã€ç”¨æˆ·æ—¥å¿— embed_txtfiles åŸç”Ÿæ ¼å¼ï¼Œè®¿é—®æå¿«ï¼Œé›¶é…ç½® å›ºä»¶åªè¯»ï¼Œå¢åŠ  Bin ä½“ç§¯ CAè¯ä¹¦ã€ç½‘é¡µæ¨¡æ¿ã€é»˜è®¤é…ç½® 0x02 å¿«é€Ÿä¸Šæ‰‹ESP-IDF æ„å»ºç³»ç»Ÿï¼ˆåŸºäº CMakeï¼‰å…è®¸ä½ ç›´æ¥æŠŠç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–æ–‡æœ¬æ–‡ä»¶ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µè‡ªåŠ¨è½¬æ¢å¹¶â€œç¼åˆâ€è¿›ä½ çš„ .bin å›ºä»¶ä¸­ã€‚ 0x00 å‡†å¤‡èµ„æºæ–‡ä»¶åœ¨ä½ çš„é¡¹ç›®æˆ–ç»„ä»¶ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ assetsï¼‰ï¼ŒæŠŠä½ çš„æ–‡æœ¬æ–‡ä»¶ï¼ˆæ¯”å¦‚ hello.txtï¼‰æ”¾è¿›å»ã€‚ 0x01 ä¿®æ”¹ CMakeLists.txtåœ¨ç»„ä»¶ç›®å½•ä¸‹çš„ CMakeLists.txt é‡Œï¼Œåªéœ€è¦åœ¨ idf_component_register å‡½æ•°é‡Œé€šè¿‡ EMBED_TXTFILES å‚æ•°æŒ‡å®šè·¯å¾„ï¼š 1234## main/CMakeLists.txtidf_component_register(SRCS &quot;main.c&quot; INCLUDE_DIRS &quot;.&quot; EMBED_TXTFILES &quot;assets/hello.txt&quot;) 0x02 åœ¨ C/C++ ä»£ç ä¸­è°ƒç”¨ç¼–è¯‘ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆäº†ä¸‰ä¸ªå…¨å±€ç¬¦å·ã€‚å®ƒä»¬çš„å‘½åè§„åˆ™æ˜¯ï¼š_binary_[æ–‡ä»¶å]_[æ‰©å±•å]_start å’Œ _binary_[æ–‡ä»¶å]_[æ‰©å±•å]_endã€‚ 12345678910111213141516##include &lt;stdio.h&gt;##include &quot;esp_log.h&quot;// 0x01. å£°æ˜å¤–éƒ¨èµ„æºå˜é‡extern const uint8_t hello_txt_start[] asm(&quot;_binary_hello_txt_start&quot;);extern const uint8_t hello_txt_end[] asm(&quot;_binary_hello_txt_end&quot;);void app_main(void){ // 0x02. è·å–èµ„æºé•¿åº¦ size_t size = hello_txt_end - hello_txt_start; // å› ä¸ºæ˜¯ txtfilesï¼Œæ‰€ä»¥æœ«å°¾è‡ªå¸¦ \\0ï¼Œå¯ä»¥ç›´æ¥ä½œä¸ºå­—ç¬¦ä¸²å¤„ç† ESP_LOGI(&quot;APP&quot;, &quot;Embedded file content: %s&quot;, (char *)hello_txt_start); ESP_LOGI(&quot;APP&quot;, &quot;File Size: %d bytes&quot;, size);} Tipsï¼š å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ .cpp æ–‡ä»¶ï¼Œè¯·åŠ¡å¿…ç»™å£°æ˜åŠ ä¸Š extern &quot;C&quot;ï¼Œå¦åˆ™ä¼šå› ä¸º Name Mangling å¯¼è‡´é“¾æ¥æ‰¾ä¸åˆ°ç¬¦å·ã€‚ 0x03 å¡«å‘ï¼šé‚£äº›è®©æˆ‘å´©æºƒçš„â€œç¿»è½¦â€æ—¶åˆ»è™½ç„¶è¿™æ‹›ç”¨èµ·æ¥å¾ˆçˆ½ï¼Œä½†ç¬¬ä¸€æ¬¡ä¸Šæ‰‹çš„å…„å¼Ÿå¤§æ¦‚ç‡ä¼šåƒæˆ‘å½“å¹´ä¸€æ ·ï¼Œåœ¨å‡ ä¸ªè«åçš„å‘é‡Œåå¤æ¨ªè·³ã€‚è¿™é‡Œåˆ†äº«å‡ ä¸ªæˆ‘äº²èº«ç»å†çš„â€œç¿»è½¦â€ç°åœºï¼š 0x00 ç¿»è½¦ç°åœºï¼šSymbol not foundè¿™æ˜¯æœ€æå¿ƒæ€çš„æŠ¥é”™ã€‚é€šå¸¸æ˜¯å› ä¸ºæˆ‘å‚»ä¹ä¹åœ°å†™äº†ä¸ªç»å¯¹è·¯å¾„ï¼Œæˆ–è€…è·¯å¾„ç®—é”™äº†ã€‚ è¡€æ³ªæ•™è®­ï¼š EMBED_TXTFILES é‡Œçš„è·¯å¾„å¿…é¡»æ˜¯ç›¸å¯¹äºå½“å‰ CMakeLists.txt çš„ã€‚å¦‚æœä½ åœ¨ main ç›®å½•ä¸‹åµŒå…¥æ–‡ä»¶ï¼Œå´æƒ³åœ¨å…¶ä»–è‡ªå®šä¹‰ç»„ä»¶é‡Œè°ƒç”¨ï¼Œé“¾æ¥å™¨åˆ†åˆ†é’Ÿæ•™ä½ åšäººã€‚æˆ‘å½“æ—¶çš„è§£å†³åŠæ³•æ˜¯ï¼šå“ªä¸ªç»„ä»¶è¦ç”¨ï¼Œå°±æŠŠèµ„æºè€è€å®å®å¡åˆ°å“ªä¸ªç»„ä»¶çš„æ–‡ä»¶å¤¹é‡Œã€‚ 0x01 ä¿®æ”¹åªè¯»å†…å­˜ï¼Œç›´æ¥ç‚¸äº†ç”±äº EMBED_TXTFILES è´´å¿ƒåœ°å¸®æˆ‘ä»¬åŠ äº† \\0ï¼Œæˆ‘ç¬¬ä¸€æ¬¡ç”¨çš„æ—¶å€™ï¼Œå±…ç„¶æƒ³ç”¨ strtok å»åˆ‡å‰²è¿™æ®µæ–‡æœ¬ã€‚ç»“æœå‘¢ï¼ŸESP32 ç›´æ¥ç‚¸äº†ï¼ˆLoadProhibitedï¼‰ï¼Œä¸åœåœ°å¾ªç¯é‡å¯ã€‚ å¡«å‘æ€»ç»“ï¼š åˆ«å¿˜äº†è¿™ä¸œè¥¿æ˜¯å­˜åœ¨ Flash é‡Œçš„ï¼Œå®ƒæ˜¯åªè¯»çš„ï¼ä½ è¦æ˜¯æƒ³ä¿®æ”¹ï¼Œå¾—å…ˆç”¨ malloc å¼€è¾Ÿä¸€å—æˆ˜åœºï¼Œå†ç”¨ memcpy æŠŠæ•°æ®å¯¼è¿‡å»ã€‚ 0x02 å˜é‡å‘½åçš„â€œç„å­¦â€æ–‡ä»¶åé‡Œçš„å‡å·ã€ç‚¹å·å…¨å˜ä¸‹åˆ’çº¿ï¼Œæœ‰æ—¶å€™è§„åˆ™å¤æ‚åˆ°æˆ‘æ€€ç–‘äººç”Ÿã€‚æ¯”å¦‚æˆ‘çš„æ–‡ä»¶åå« my-config.v1.jsonï¼Œç”Ÿæˆçš„ç¬¦å·åä¼šå˜æˆ _binary_my_config_v1_json_startã€‚ éªŒè¯å¤§æ³•ï¼š åˆ«åœ¨é‚£ççŒœäº†ï¼Œè¿™å¤ªè¦å‘½äº†ã€‚ç›´æ¥å» build ç›®å½•ä¸‹ï¼Œç¥­å‡º nm å¤§æ³•æŸ¥çœ‹ç”Ÿæˆçš„ç¬¦å·ã€‚ 0x04 è¿›é˜¶ï¼šæˆ‘æ˜¯æ€ä¹ˆéªŒè¯è¿™äº›â€œé¬¼ç¬¦å·â€çš„0x00 åˆ«çŒœï¼Œç›´æ¥çœ‹äº§ç‰©ä½œä¸ºä¸€ä¸ªç¡¬æ ¸ï¼ˆæŠ˜è…¾å‹ï¼‰å¼€å‘è€…ï¼Œå®åœ¨æ²¡åº•çš„æ—¶å€™ï¼Œæˆ‘ä¼šç›´æ¥ç¿»çœ‹ç”Ÿæˆçš„ .elf æ–‡ä»¶ã€‚åœ¨ä½ çš„å·¥ç¨‹ç›®å½•ä¸‹è¿è¡Œè¿™è¡Œå‘½ä»¤ï¼Œæ¯”æœåŠå¤©æ–‡æ¡£ç®¡ç”¨å¾—å¤šï¼š 1nm -gC build/*.elf | grep _binary å¦‚æœåˆ—è¡¨é‡Œèƒ½çœ‹åˆ°é¢„æœŸçš„ start/end åœ°å€ï¼Œé‚£å¿ƒæ€å°±ç¨³äº†ã€‚ 0x01 å®æˆ˜ï¼šè¯ä¹¦å¤„ç†çš„â€œæç®€ä¸»ä¹‰â€åœ¨æŠ˜è…¾ HTTPS æˆ–è€… MQTTS çš„æ—¶å€™ï¼Œè¯ä¹¦å¤„ç†ç®€ç›´æ˜¯ç¾éš¾ã€‚æˆ‘ä»¥å‰ä¹Ÿæ˜¯è€è€å®å®å†™æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ï¼Œç°åœ¨ç›´æ¥åœ¨ä»£ç é‡Œè¿™ä¹ˆæï¼š 12345678// main.c// è¿™é‡Œçš„ asm åç§°å°±æ˜¯é€šè¿‡ä¸Šé¢ nm å‘½ä»¤ç¡®å®šçš„extern const uint8_t mqtt_ca_pem_start[] asm(&quot;_binary_mqtt_ca_pem_start&quot;);esp_mqtt_client_config_t mqtt_cfg = { .broker.address.uri = &quot;mqtts://your-iot-server.com&quot;, .broker.verification.certificate = (const char *)mqtt_ca_pem_start,}; ç›´æ¥æŠŠèµ·å§‹æŒ‡é’ˆä¸¢è¿›å»ï¼Œè¿é•¿åº¦éƒ½ä¸ç”¨å†™ï¼ˆå› ä¸º TXTFILES è‡ªå¸¦ç»ˆæ­¢ç¬¦ï¼‰ï¼Œè¿™ç§æ„Ÿè§‰åªèƒ½ç”¨â€œä¸æ»‘â€æ¥å½¢å®¹ã€‚ 0x02 EMBED_FILES vs EMBED_TXTFILESï¼šæˆ‘å½“å¹´å°±æ ½åœ¨è¿™å„¿è¿™æ˜¯å¾ˆå¤šæ–°æ‰‹æœ€å®¹æ˜“â€œè¸©å‘â€çš„åœ°æ–¹ï¼Œæˆ‘å½“å¹´å°±æ ½åœ¨è¿™å„¿ã€‚ESP-IDF æä¾›äº†ä¸¤ä¸ªç±»ä¼¼çš„å‚æ•°ï¼ŒåŒºåˆ«å¾ˆå…³é”®ï¼š EMBED_FILES: çº¯äºŒè¿›åˆ¶åµŒå…¥ã€‚å®ƒåŸå°ä¸åŠ¨åœ°æŠŠæ–‡ä»¶å¡è¿›å›ºä»¶ã€‚é€‚ç”¨äºå›¾ç‰‡ã€å­—ä½“ã€å‹ç¼©åŒ…ç­‰éæ–‡æœ¬èµ„æºã€‚ EMBED_TXTFILES: ä¸“é—¨é’ˆå¯¹æ–‡æœ¬ã€‚å®ƒä¼šåœ¨åµŒå…¥èµ„æºçš„æœ«å°¾**è‡ªåŠ¨è¿½åŠ ä¸€ä¸ªç©ºç»ˆæ­¢ç¬¦ \\0**ã€‚ å¦‚æœä½ é”™ç”¨äº† EMBED_FILES æ¥åµŒå…¥è¯ä¹¦ï¼Œä½ ä¼šå‘ç°ä»£ç è¿è¡Œåˆ°æœ€åä¼šè«åå…¶å¦™åœ°è¯»å–åˆ°å†…å­˜åé¢çš„åƒåœ¾æ•°æ®ï¼Œå¯¼è‡´ TLS æ ¡éªŒå¤±è´¥ã€‚å®æˆ˜å»ºè®®ï¼šHTTPS è¯ä¹¦ (PEM æ ¼å¼) æˆ– HTML è¯·åŠ¡å¿…ä½¿ç”¨ EMBED_TXTFILESã€‚ 0x03 å‘½åè§„åˆ™çš„â€œé­”æ³•â€åå­—æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Ÿè§„åˆ™å¾ˆç®€å•ï¼šæ–‡ä»¶åä¸­çš„æ‰€æœ‰éå­—æ¯æ•°å­—å­—ç¬¦ï¼ˆå¦‚ .ã€-ï¼‰éƒ½ä¼šè¢«æ›¿æ¢æˆä¸‹åˆ’çº¿ _ã€‚ ä¾‹å¦‚ï¼š æ–‡ä»¶è·¯å¾„ï¼šcerts/ca.pem -&gt; å˜é‡åï¼š_binary_ca_pem_start C è¯­è¨€å£°æ˜æ—¶ï¼šasm(&quot;_binary_ca_pem_start&quot;) æç¤ºï¼šå»ºè®®å§‹ç»ˆä½¿ç”¨ç›¸å¯¹äº CMakeLists.txt çš„ç›¸å¯¹è·¯å¾„ï¼Œå¦åˆ™å˜é‡åå¯èƒ½ä¼šå˜å¾—éå¸¸é•¿ä¸”éš¾ä»¥é¢„æ–™ã€‚ ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨æ–‡ä»¶ç³»ç»Ÿï¼Ÿè™½ç„¶ SPIFFS æˆ– LittleFS ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä½†åœ¨ä»¥ä¸‹åœºæ™¯ embed_txtfiles æ˜¯æœ€ä¼˜è§£ï¼š å®‰å…¨æ€§ï¼šè¯ä¹¦æ”¾åœ¨å›ºä»¶é‡Œä¸æ˜“å› æ–‡ä»¶ç³»ç»ŸæŸåè€Œä¸¢å¤±ï¼ŒOTA æ›´æ–°å›ºä»¶ä¹Ÿå°±æ˜¯æ›´æ–°äº†è¯ä¹¦ã€‚ æç®€æ–¹æ¡ˆï¼šé¿å…ä¸“é—¨ä¸ºäº†å‡ ç™¾å­—èŠ‚å»æŠ˜è…¾åˆ†åŒºè¡¨é•œåƒã€‚ è¯»å–é€Ÿåº¦ï¼šæ•°æ®é€šè¿‡ MMU ç›´æ¥æ˜ å°„åˆ°æŒ‡ä»¤æ€»çº¿ï¼Œè¯»å–é€Ÿåº¦å’Œè¯»ä»£ç ä¸€æ ·å¿«ï¼Œæ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿçš„å¯»å€å¼€é”€ã€‚ 0x05 æœ€åä»ç¬¨é‡çš„ C æ•°ç»„è½¬æ¢åˆ°ä¼˜é›…çš„ embed_txtfilesï¼Œæœ¬è´¨ä¸Šæ˜¯è®©èµ„æºå›å½’å…¶åŸæœ¬çš„æ ¼å¼ï¼ŒæŠŠç”Ÿæˆçš„è‹¦æ´»äº¤ç»™æ„å»ºç³»ç»Ÿã€‚æ­£å¦‚æˆ‘ä¹‹å‰åœ¨Claude Codeåˆä½“éªŒä¸­æ„Ÿå—åˆ°çš„ï¼Œç°ä»£å¼€å‘çš„é­…åŠ›å°±åœ¨äºä¸æ–­åˆ©ç”¨å·¥å…·å»è§£å¼€é‚£äº›é‡å¤è€Œä½æ•ˆçš„æ­»ç»“ã€‚ è¿™æ¬¡å¡«å‘å¿ƒå¾—å°±åˆ†äº«åˆ°è¿™ï¼Œå¸Œæœ›èƒ½å¸®åˆ°åœ¨è¢«èµ„æºè·¯å¾„æŠ˜ç£¨çš„ä½ ã€‚ä¸‹ä¸ªå‘è§ï¼Œæ”¶å·¥ï¼ ç¯å¢ƒ1234Framework: ESP-IDF v5.xTarget: ESP32 / S2 / S3 / C3 (RISC-V)Language: C / C++Build System: CMake å‚è€ƒ ESP-IDF ç¼–ç¨‹æŒ‡å— - æŒ‡å—æ–‡æ¡£ï¼šåµŒå…¥äºŒè¿›åˆ¶æ•°æ®","link":"/2026/01/04/ESP-IDF-embed-txtfiles-tricks/"},{"title":"å±å¹•ä¸å¤Ÿï¼Œç®—æ³•æ¥å‡‘(ä¸€)ï¼šDitherpunk æŠ–åŠ¨ç®—æ³•åŸç†ä¸ JS å®æ—¶æ¼”ç¤º","text":"èƒŒæ™¯åœ¨åµŒå…¥å¼å¼€å‘é¢†åŸŸï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è‰²å½©ä½æ•°æä½çš„æ˜¾ç¤ºè®¾å¤‡ï¼š ç»å…¸çš„ SSD1306 (0.96å¯¸ OLED)ï¼Œä»…æ”¯æŒé»‘ç™½ä¸¤è‰²ã€‚ ç”µå­å¢¨æ°´å± (E-Ink)ï¼Œé€šå¸¸åªæœ‰é»‘ç™½ï¼Œä¸”åˆ·æ–°ç‡æä½ã€‚ å¦‚æœç›´æ¥å°† 24 ä½çœŸå½©å›¾ç‰‡è¿›è¡Œé‡åŒ–å¤„ç†ï¼Œå…¶ç»“æœå¾€å¾€å¦‚åŒçƒ§ç„¦çš„æœ¨ç‚­ï¼Œç»†èŠ‚ä¸¢å¤±æ®†å°½ã€‚ä½†è‹¥å¼•å…¥ æŠ–åŠ¨ç®—æ³•(Dithering)ï¼Œè¿™äº› 1-Bit å±å¹•ä¾¿èƒ½æ¨¡æ‹Ÿå‡ºç»†è…»çš„ç°åº¦æ„Ÿã€‚ æ­¤å‰æˆ‘æ›¾å°è¯•ç”¨ Rust å®ç°è¿‡ä¸€ä¸ªç‰ˆæœ¬ï¼Œä½†ä½œä¸ºåšå®¢æ¼”ç¤ºï¼Œä½¿ç”¨ JavaScript ä¸ Canvas åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è¿›è¡Œä»¿çœŸæœ€ä¸ºç›´è§‚ã€‚æœ¬æ–‡å°†ä»‹ç»å‡ ç§ä¸»æµæŠ–åŠ¨ç®—æ³•çš„åŸç†åŠå…¶ JS å®ç°ã€‚ å®éªŒå®¤æ§åˆ¶å°åœ¨æ­¤ä¸Šä¼ å›¾ç‰‡ï¼Œä¸‹æ–‡çš„æ‰€æœ‰ç®—æ³•æ¼”ç¤ºå°†åŒæ­¥ç”Ÿæ•ˆã€‚å»ºè®®å¼€å¯ Gamma æ ¡æ­£è§‚æ‘©å›¾åƒæš—éƒ¨ç»†èŠ‚çš„å·®å¼‚ã€‚ ğŸ“‚ ä¸Šä¼ å›¾ç‰‡ / Upload Image * å›¾ç‰‡å°†ä»…åœ¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¼šä¸Šä¼ æœåŠ¡å™¨ (function() { const Algos = { threshold: (val) => val > 0.5 ? 1 : 0, random: (val) => (val + Math.random() - 0.5) > 0.5 ? 1 : 0, bayer: (val, x, y) => { const m = [[0,8,2,10],[12,4,14,6],[3,11,1,9],[15,7,13,5]]; return val > (m[y%4][x%4] + 0.5) / 16 ? 1 : 0; }, blue: (val, x, y) => { const g = 1.32471795724474602596; const a1 = 1.0 / g; const a2 = 1.0 / (g * g); const threshold = (0.5 + a1 * x + a2 * y) % 1.0; return val > threshold ? 1 : 0; }, floyd: (pixels, w, h) => { const d = new Float32Array(pixels); for (let y = 0; y < h; y++) { for (let x = 0; x < w; x++) { let i = y * w + x; let oldV = d[i]; let newVal = oldV > 0.5 ? 1 : 0; d[i] = newVal; let err = oldV - newVal; if (x+1 < w) d[i+1] += err * 7/16; if (y+1 < h) { if (x > 0) d[i+w-1] += err * 3/16; d[i+w] += err * 5/16; if (x+1 < w) d[i+w+1] += err * 1/16; } } } return d; }, atkinson: (pixels, w, h) => { const d = new Float32Array(pixels); for (let y = 0; y < h; y++) { for (let x = 0; x < w; x++) { let i = y * w + x; let oldV = d[i]; let newVal = oldV > 0.5 ? 1 : 0; d[i] = newVal; let err = (oldV - newVal) / 8; if (x+1 < w) d[i+1] += err; if (x+2 < w) d[i+2] += err; if (y+1 < h) { if (x > 0) d[i+w-1] += err; d[i+w] += err; if (x+1 < w) d[i+w+1] += err; if (y+2 < h) d[i+w*2] += err; } } } return d; } }; const srgbToLinear = v => v { const algo = container.dataset.algo; const checkbox = container.querySelector('.local-gamma'); const canvas = container.querySelector('canvas'); // Generate unique ID if missing if (!canvas.id) canvas.id = 'canvas-' + algo + '-' + Math.random().toString(36).substr(2, 9); // Interaction: Lens Effect let isHovering = false; let mouseX = 0, mouseY = 0; const draw = () => { if (!canvasStates.has(canvas.id)) return; const ditheredData = canvasStates.get(canvas.id); const ctx = canvas.getContext('2d'); // Draw base dithered image ctx.putImageData(ditheredData, 0, 0); // Draw Lens if hovering if (isHovering && originalImageData) { const radius = 50; const diameter = radius * 2; ctx.save(); ctx.beginPath(); ctx.arc(mouseX, mouseY, radius, 0, Math.PI * 2); ctx.clip(); // Draw original grayscale image inside the circle // We need to draw the originalImageData at the correct position // create temp canvas/imagedata is slow, drawImage is better if we had an ImageBitmap/Canvas // Optimization: We can keep a global offscreen canvas for original image if (offscreenOriginalCanvas) { ctx.drawImage(offscreenOriginalCanvas, 0, 0); } // Draw border ring ctx.strokeStyle = 'rgba(255, 100, 100, 0.8)'; ctx.lineWidth = 2; ctx.stroke(); ctx.restore(); } }; canvas.addEventListener('mousemove', e => { const rect = canvas.getBoundingClientRect(); mouseX = e.clientX - rect.left; mouseY = e.clientY - rect.top; // Scale mouse coords if canvas display size differs from internal size const scaleX = canvas.width / rect.width; const scaleY = canvas.height / rect.height; mouseX *= scaleX; mouseY *= scaleY; if (!isHovering) { isHovering = true; } requestAnimationFrame(draw); }); canvas.addEventListener('mouseleave', () => { isHovering = false; requestAnimationFrame(draw); }); // Interaction: Gamma Toggle if (checkbox) { checkbox.addEventListener('change', () => { processCanvas(container); }); } // Attach draw function to container for external calls container._redraw = draw; }); // Load default image const defaultSample = '/images/archives/ditherpunk/sample.jpg'; const initialImg = new Image(); initialImg.onload = () => { processImage(initialImg); }; initialImg.src = defaultSample; upload.addEventListener('change', e => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = evt => { const img = new Image(); img.onload = () => { processImage(img); }; img.src = evt.target.result; }; reader.readAsDataURL(file); }); } let offscreenOriginalCanvas = null; function processImage(img) { const displayMaxWidth = 600; let w = img.width, h = img.height; const scale = Math.min(1, displayMaxWidth / w); if (w > displayMaxWidth) { h *= scale; w = displayMaxWidth; } w = Math.floor(w); h = Math.floor(h); imgW = w; imgH = h; // Prepare Offscreen Canvas for Original Image (Lens Source) offscreenOriginalCanvas = document.createElement('canvas'); offscreenOriginalCanvas.width = w; offscreenOriginalCanvas.height = h; const ctx = offscreenOriginalCanvas.getContext('2d'); ctx.drawImage(img, 0, 0, w, h); // Extract Grayscale Data (sRGB 0-255) const rawData = ctx.getImageData(0, 0, w, h); originalImageData = ctx.createImageData(w, h); // Pre-calculate Linear and sRGB Normalized arrays linearPixels = new Float32Array(w * h); srgbPixels = new Float32Array(w * h); for (let i = 0; i < rawData.data.length; i += 4) { let r = rawData.data[i], g = rawData.data[i+1], b = rawData.data[i+2]; // Standard Luminance let grayScale = (0.2126 * r + 0.7152 * g + 0.0722 * b) / 255; srgbPixels[i/4] = grayScale; linearPixels[i/4] = srgbToLinear(grayScale); // For display (Lens), store grayscale sRGB let v = grayScale * 255; originalImageData.data[i] = originalImageData.data[i+1] = originalImageData.data[i+2] = v; originalImageData.data[i+3] = 255; } // Update the offscreen canvas with true grayscale for the lens to use ctx.putImageData(originalImageData, 0, 0); // Update all canvases document.querySelectorAll('.dither-demo-container').forEach(container => { processCanvas(container); }); } function processCanvas(container) { if (!linearPixels) return; const algo = container.dataset.algo; const checkbox = container.querySelector('.local-gamma'); const useGamma = checkbox ? checkbox.checked : true; // Default to true if no checkbox const canvas = container.querySelector('canvas'); canvas.width = imgW; canvas.height = imgH; canvas.style.imageRendering = 'pixelated'; // Select input source // Clone the array because Error Diffusion modifies it in-place const inputSource = useGamma ? linearPixels : srgbPixels; const input = new Float32Array(inputSource); // Clone let result; if (algo === 'floyd' || algo === 'atkinson') { result = Algos[algo](input, imgW, imgH); } else { result = new Float32Array(imgW * imgH); for(let y=0; y","link":"/2025/12/22/Ditherpunk-The-Art-of-Dithering/"},{"title":"ESP32-C3 PlatformIO &#39;embed_txtfiles&#39; ä¿®å¤","text":"å‰è¨€9.9å…ƒå…¥æ‰‹äº†ä¸€å—ESP32-C3æ¿å­, ç”¨æ¥å–ä»£æ‰‹ä¸Šå¼•è„šä¸è¶³çš„ESP8266.ä½†æ˜¯ç¼–è¯‘æ—¶å€™æ€»æ˜¯å¤±è´¥,ä»Logä¸Šçœ‹æ˜¯è¿™ä¸€æ­¥å‡ºäº†é”™è¯¯. 12345prepare_file([&quot;.pio\\build\\esp32c3\\lite.ttf.txt.o&quot;], [&quot;src\\lite.ttf&quot;])Converting .pio\\build\\esp32c3\\lite.ttf.txt.o'xtensa-esp32-elf-objcopy' \\xb2\\xbb\\xca\\xc7\\xc4Ú²\\xbf\\xbb\\xf2\\xcdâ²¿\\xc3\\xfc\\xc1î£¬Ò²\\xb2\\xbb\\xcaÇ¿\\xc9\\xd4\\xcb\\xd0ĞµÄ³\\xcc\\xd0\\xf2\\xbb\\xf2\\xc5\\xfa\\xb4\\xa6\\xc0\\xed\\xceÄ¼\\xfe\\xa1\\xa3*** [.pio\\build\\esp32c3\\lite.ttf.txt.o] Error 1 æ­¤å¤–å¹¶æ²¡æœ‰ä»»ä½•æç¤ºäº†. é”™è¯¯åˆ†ælite.ttfæ˜¯æˆ‘çš„ä¸€ä¸ªæ”¾åœ¨srcç›®å½•ä¸‹çš„æ–‡ä»¶, ä¸ºå…¶åœ¨platformio.inié…ç½®â€board_build.embed_txtfiles = src/lite.ttfâ€,å°±å¯ä»¥è®©è¿™ä¸ªæ–‡ä»¶åµŒå…¥å›ºä»¶ä¸­.ä»æ—¥å¿—é‡Œçœ‹åˆ°æ˜¯è½¬åŒ–çš„æ—¶å€™å‡ºäº†é—®é¢˜, xtensa-esp32-elf-objcopy xtensaæ˜¯ESP32,ESP32-S2,ESP32-S3çš„å¤„ç†å™¨ç»“æ„,è€ŒESP32-C3æ˜¯RISC-Vçš„,æ‰€ä»¥è¿™é‡Œå‡ºé”™åº”è¯¥æ˜¯ç»“æ„ä¸åŒ¹é….å»ESP-IDFçš„æ–‡ä»¶å¤¹æœç´¢â€elf-objcopyâ€åå‘ç°çš„ç¡®æœ‰ä¸åŒå¾ˆå¤šç±»ä¼¼å…³é”®å­—. 12345678910111213141516171819for dir in esp32 esp32s2 esp32c3 esp32s3; do if [ $dir = esp32 ]; then TOOLCHAIN=&quot;xtensa-esp32-elf&quot; elif [ $dir = esp32s2 ]; then TOOLCHAIN=&quot;xtensa-esp32s2-elf&quot; elif [ $dir = esp32c3 ]; then TOOLCHAIN=&quot;riscv32-esp-elf&quot; elif [ $dir = esp32s3 ]; then TOOLCHAIN=&quot;xtensa-esp32s3-elf&quot; else echo &quot;$dir does not exist&quot; fi if [ -d &quot;$dir&quot; ]; then cd $dir git status libphy.a | grep &quot;modified&quot; &gt;/dev/null 2&gt;&amp;1 if [ $? -eq 0 ]; then echo $dir/libphy.a fixed $TOOLCHAIN-objcopy --redefine-sym ets_printf=phy_printf libphy.a fi æ‰€ä»¥åº”è¯¥æ˜¯PlatformIOåœ¨è½¬åŒ–çš„æ—¶å€™è°ƒç”¨äº†é”™è¯¯çš„ç¨‹åºå¯¼è‡´çš„. è§£å†³é—®é¢˜å»PlatformIOçš„å·¥ä½œç›®å½•(.platformio)ä¸‹æœç´¢xtensa-esp32-elf-objcopy 12345678910111213[ &quot;xtensa-esp32-elf-objcopy&quot;, &quot;--input-target&quot;, &quot;binary&quot;, &quot;--output-target&quot;, &quot;elf32-xtensa-le&quot;, &quot;--binary-architecture&quot;, &quot;xtensa&quot;, &quot;--rename-section&quot;, &quot;.data=.rodata.embedded&quot;, &quot;$SOURCE&quot;, &quot;$TARGET&quot;,] ç¡®å®æœç´¢åˆ°äº†å¤šä¸ªåŒ…å«è¿™ä¸ªå…³é”®å­—çš„æ–‡ä»¶_embed_files.py(platforms\\espressif32\\builder\\frameworks_embed_files.py)å…¶ä¸­platformsä¸‹æœ‰å¥½å‡ ä¸ªæ–‡ä»¶å¤¹ 1234567â”œâ”€â”€ .platformioâ”‚ â””â”€â”€ platformsâ”‚ â””â”€â”€ espressif32â”‚ â””â”€â”€ espressif32@src-ba2d3999402da5eaf2c9d5863ef113c7â”‚ â””â”€â”€ espressif32@src-ebefb4289db63a9f0ca5ee29fa328eefâ”‚ â””â”€â”€ espressif8266â”‚ â””â”€â”€ raspberrypi è¿™åº”è¯¥æ˜¯ä¸åŒé¡¹ç›®æ‰€éœ€çš„platform,å‡‘å·§è¿™æ¬¡C3é¡¹ç›®çš„platformæ˜¯ä¸“é—¨ä¸‹è½½çš„,æ‰€ä»¥ä»æ–‡ä»¶å¤¹ä¿®æ”¹æ—¥æœŸä¸Šæ¥çœ‹,æˆ‘è¿™æ¬¡C3ä½¿ç”¨çš„åº”è¯¥æ˜¯espressif32@src-ebefb4289db63a9f0ca5ee29fa328eefæ‰“å¼€espressif32@src-ebefb4289db63a9f0ca5ee29fa328eefä¸‹çš„_embed_files.pyé‡Œé¢æœç„¶è¿˜åœ¨ä½¿ç”¨xtensa-esp32-elf-objcopyæŒ‰ç…§ESP-IDFé‡Œé¢çš„æè¿°,åº”è¯¥ä½¿ç”¨riscv32-esp-elf-objcopy,å¹¶ä¸”è¦æŠŠxtensaç›¸å…³çš„éƒ½ä¿®æ”¹ä¸ºriscv. æ‰€ä»¥æœ€åä¿®æ”¹æˆäº† 12345678910111213[ &quot;riscv32-esp-elf-objcopy&quot;, &quot;--input-target&quot;, &quot;binary&quot;, &quot;--output-target&quot;, &quot;elf32-littleriscv&quot;, &quot;--binary-architecture&quot;, &quot;riscv&quot;, &quot;--rename-section&quot;, &quot;.data=.rodata.embedded&quot;, &quot;$SOURCE&quot;, &quot;$TARGET&quot;,] é‡æ–°æ‰§è¡Œç¼–è¯‘,è¿™ä¸€æ¬¡ç»ˆäºé€šè¿‡äº†. 12345678910111213Building in release modeprepare_file([&quot;.pio\\build\\esp32c3\\lite.ttf.txt.o&quot;], [&quot;src\\lite.ttf&quot;])Converting .pio\\build\\esp32c3\\lite.ttf.txt.orevert_original_file([&quot;.pio\\build\\esp32c3\\lite.ttf.txt.o&quot;], [&quot;src\\lite.ttf&quot;])Linking .pio\\build\\esp32c3\\firmware.elfRetrieving maximum program size .pio\\build\\esp32c3\\firmware.elfChecking size .pio\\build\\esp32c3\\firmware.elfAdvanced Memory Usage is available via &quot;PlatformIO Home &gt; Project Inspect&quot;RAM: [ ] 4.7% (used 15480 bytes from 327680 bytes)Flash: [= ] 14.1% (used 443870 bytes from 3145728 bytes)Building .pio\\build\\esp32c3\\firmware.binesptool.py v3.1Merged 2 ELF sections é™„_embed_files.py123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177## Copyright 2014-present PlatformIO &lt;contact@platformio.org&gt;#### Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);## you may not use this file except in compliance with the License.## You may obtain a copy of the License at#### http://www.apache.org/licenses/LICENSE-2.0#### Unless required by applicable law or agreed to in writing, software## distributed under the License is distributed on an &quot;AS IS&quot; BASIS,## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.## See the License for the specific language governing permissions and## limitations under the License.import shutilfrom os import SEEK_CUR, SEEK_ENDfrom os.path import basename, isfile, joinfrom SCons.Script import BuilderImport(&quot;env&quot;)board = env.BoardConfig()#### Embedded files helpers##def extract_files(cppdefines, files_type): files = [] if &quot;build.&quot; + files_type in board: files.extend( [ join(&quot;$PROJECT_DIR&quot;, f) for f in board.get(&quot;build.&quot; + files_type, &quot;&quot;).split() if f ] ) else: files_define = &quot;COMPONENT_&quot; + files_type.upper() for define in cppdefines: if files_define not in define: continue value = define[1] if not isinstance(define, tuple): print(&quot;Warning! %s macro cannot be empty!&quot; % files_define) return [] if not isinstance(value, str): print( &quot;Warning! %s macro must contain &quot; &quot;a list of files separated by ':'&quot; % files_define ) return [] for f in value.split(&quot;:&quot;): if not f: continue files.append(join(&quot;$PROJECT_DIR&quot;, f)) for f in files: if not isfile(env.subst(f)): print('Warning! Could not find file &quot;%s&quot;' % basename(f)) return filesdef remove_config_define(cppdefines, files_type): for define in cppdefines: if files_type in define: env.ProcessUnFlags(&quot;-D%s&quot; % &quot;=&quot;.join(str(d) for d in define)) returndef prepare_file(source, target, env): filepath = source[0].get_abspath() shutil.copy(filepath, filepath + &quot;.piobkp&quot;) with open(filepath, &quot;rb+&quot;) as fp: fp.seek(-1, SEEK_END) if fp.read(1) != &quot;\\0&quot;: fp.seek(0, SEEK_CUR) fp.write(b&quot;\\0&quot;)def revert_original_file(source, target, env): filepath = source[0].get_abspath() if isfile(filepath + &quot;.piobkp&quot;): shutil.move(filepath + &quot;.piobkp&quot;, filepath)def embed_files(files, files_type): for f in files: filename = basename(f) + &quot;.txt.o&quot; file_target = env.TxtToBin(join(&quot;$BUILD_DIR&quot;, filename), f) env.Depends(&quot;$PIOMAINPROG&quot;, file_target) if files_type == &quot;embed_txtfiles&quot;: env.AddPreAction(file_target, prepare_file) env.AddPostAction(file_target, revert_original_file) env.AppendUnique(PIOBUILDFILES=[env.File(join(&quot;$BUILD_DIR&quot;, filename))])def transform_to_asm(target, source, env): files = [join(&quot;$BUILD_DIR&quot;, s.name + &quot;.S&quot;) for s in source] return files, sourceenv.Append( BUILDERS=dict( TxtToBin=Builder( action=env.VerboseAction( &quot; &quot;.join( [ &quot;riscv32-esp-elf-objcopy&quot;, &quot;--input-target&quot;, &quot;binary&quot;, &quot;--output-target&quot;, &quot;elf32-littleriscv&quot;, &quot;--binary-architecture&quot;, &quot;riscv&quot;, &quot;--rename-section&quot;, &quot;.data=.rodata.embedded&quot;, &quot;$SOURCE&quot;, &quot;$TARGET&quot;, ] ), &quot;Converting $TARGET&quot;, ), suffix=&quot;.txt.o&quot;, ), TxtToAsm=Builder( action=env.VerboseAction( &quot; &quot;.join( [ join( env.PioPlatform().get_package_dir(&quot;tool-cmake&quot;) or &quot;&quot;, &quot;bin&quot;, &quot;cmake&quot;, ), &quot;-DDATA_FILE=$SOURCE&quot;, &quot;-DSOURCE_FILE=$TARGET&quot;, &quot;-DFILE_TYPE=TEXT&quot;, &quot;-P&quot;, join( env.PioPlatform().get_package_dir(&quot;framework-espidf&quot;) or &quot;&quot;, &quot;tools&quot;, &quot;cmake&quot;, &quot;scripts&quot;, &quot;data_file_embed_asm.cmake&quot;, ), ] ), &quot;Generating assembly for $TARGET&quot;, ), emitter=transform_to_asm, single_source=True, ), ))flags = env.get(&quot;CPPDEFINES&quot;)for files_type in (&quot;embed_txtfiles&quot;, &quot;embed_files&quot;): if ( &quot;COMPONENT_&quot; + files_type.upper() not in env.Flatten(flags) and &quot;build.&quot; + files_type not in board ): continue files = extract_files(flags, files_type) if &quot;espidf&quot; in env.subst(&quot;$PIOFRAMEWORK&quot;): env.Requires(join(&quot;$BUILD_DIR&quot;, &quot;${PROGNAME}.elf&quot;), env.TxtToAsm(files)) else: embed_files(files, files_type) remove_config_define(flags, files_type) ç¯å¢ƒ:12345PLATFORM: Espressif 32 (3.3.0+sha.3b5de56) &gt; Espressif ESP32 Dev Module - framework-arduinoespressif32 0.0.0+sha.68daea4 - tool-esptoolpy 1.30100.210531 (3.1.0) - toolchain-riscv-esp 1.80400.0 (8.4.0) - toolchain-riscv32-esp 8.4.0+2021r1","link":"/2022/03/13/ESP32-C3-PlatformIO-embed-txtfiles-fix/"},{"title":"ESP32-ä¸²æµæ˜¾ç¤º","text":"è®©ä½ çš„ESP32è¯•è¯•ä¸²æµå§ ï¼ˆ2025 å¹´ 11 æœˆæ›´æ–°ï¼‰è¿™ç¯‡æ–‡ç« å†™äº 5 å¹´å‰ï¼Œä½†å®ƒè‡³ä»Šä»æ˜¯æˆ‘æµé‡æœ€é«˜çš„æ–‡ç« ä¹‹ä¸€ã€‚å®ƒæ‰€å±•ç¤ºçš„â€˜PC åˆ° ESP32 å®æ—¶ä¸²æµâ€™çš„æ ¸å¿ƒåŸç†â€”â€”å³â€˜Python æŠ“å¸§/ç¼–ç â€™ + â€˜è‡ªå®šä¹‰ TCP åè®®â€™ + â€˜ESP32 è§£ç /DMA æ¸²æŸ“â€™â€”â€”è¿™ä¸ªæ¶æ„åœ¨ä»Šå¤©ä¾ç„¶æå…·å‚è€ƒä»·å€¼ã€‚ æ—¢ç„¶æœ‰äº†å±å¹•ï¼Œåˆæœ‰äº†ç½‘ç»œï¼Œé‚£å²‚ä¸æ˜¯å¯ä»¥ä¸²æµäº†ï¼ åºä¸Šç¯‡æ–‡ç« å·²ç»å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ESP32ç‚¹äº®ä¸€å—å±å¹•ï¼Œé‚£ä¹ˆè¿™æ¬¡æˆ‘ä»¬æ¥æ•´ä¸ªæ´»ã€‚åˆ©ç”¨ESP32æ¥æ˜¾ç¤ºç”µè„‘çš„ç”»é¢ï¼å¦‚æœä½ ç”¨çš„æ˜¯å…¶ä»–å±å¹•ä¹Ÿæ²¡å…³ç³»ï¼Œåªè¦æ˜¯ESP32é…åˆTFT_eSPIå°±å¯ä»¥å®ç°ï¼Œåªæ˜¯åœ¨å¸§ç‡ä¸Šä¼šæœ‰æ‰€åŒºåˆ«ã€‚è¿™ä¸ªè§†é¢‘ä¸ºä½ å±•ç¤ºäº†åœ¨M5StickCä¸Šçš„è¿è¡Œæ•ˆæœç°åœ¨æ˜¯é™¤äº†æ¸¸æˆæ€§ä»¥å¤–ï¼Œä¸€æ— æ‰€æœ‰çš„åŸç¥@bilibili å®ç°æ–¹å¼ç”µè„‘ä½œä¸ºå‘é€ç«¯ï¼Œè´Ÿè´£å‘é€å›¾åƒæ•°æ®-&gt;EPS32ä½œä¸ºæ¥æ”¶ç«¯ï¼Œè´Ÿè´£æ¥æ”¶å¹¶ç»˜åˆ¶å›¾åƒæ•°æ®å‘é€ç«¯ä½¿ç”¨pythonç¼–å†™ï¼Œä½¿ç”¨mssæ¨¡å—æ•è·å±å¹•ç”»é¢ï¼Œå†ä½¿ç”¨python opencv ç¼–ç ä¸ºJPG æ¥æ”¶ç«¯ä½¿ç”¨C++ç¼–å†™ï¼ŒTJpg_Decoderè§£ç ï¼ŒTFT_eSPIç»˜åˆ¶ å‘é€çš„æ•°æ®ä»¥å¸§ä¸ºå•ä½ï¼Œä¸ºäº†å‡å°å¸§çš„ä½“ç§¯ï¼Œå°†ä¼šå¯¹æ¯ä¸€å¸§åŸå§‹ä½å›¾æ•°æ®ä½¿ç”¨JPGç¼–ç ï¼ŒESP32æ¥æ”¶åˆ°æ•°æ®ä»¥åï¼Œå…ˆå¯¹JPGè¿›è¡Œè§£ç ï¼Œå†è¿›è¡Œç»˜åˆ¶ã€‚ ä¸€æ¬¡å®Œæ•´é€šä¿¡æµç¨‹ä¸º: ç²¾ç®€çš„ä»£ç è¦è®© Pythonä¸Šä½æœº å’Œ ä¸‹ä½æœºC++ æ²Ÿé€šï¼Œç¬¬ä¸€æ­¥æ˜¯å®šä¹‰ä¸€ä¸ªâ€˜åè®®â€™ã€‚æˆ‘æ²¡æœ‰ç”¨å¤æ‚çš„ HTTPï¼Œè€Œæ˜¯è®¾è®¡äº†ä¸€ä¸ªæç®€çš„ 3 æ­¥æ¡æ‰‹åè®®ï¼ˆPREPAREOK, HEADEROK, FRAMEOKï¼‰ï¼Œç”¨å®ƒæ¥ç¡®ä¿å¸§æ•°æ®ä¸ä¼šä¸¢å¤±æˆ–é”™ä½ common_macro.h12345678910111213141516171819202122232425262728293031323334##ifndef COMMON_MACRO_H_##define COMMON_MACRO_H_// Debugæƒ…å†µä¸‹ï¼Œæš‚æ—¶ä¸å»æµ‹è¯•ä¸²æµï¼Œä¹Ÿæ— éœ€è¿æ¥wifi##define DEBUG/*======================ä¸²æµç›¸å…³======================*/// å¸§æ•°æ®æ¥æ”¶å®Œæ¯•##define FRAMEOK 0x01// å¤´éƒ¨æ¥æ”¶å®Œæ¯•ï¼Œæ¥æ”¶å¸§##define HEADEROK 0x02// å‡†å¤‡å®Œæ¯•ï¼Œæ¥æ”¶å¤´éƒ¨ æ³¨:0x03æ— æ³•æ­£å¸¸å‘é€// https://www.cnblogs.com/young525/p/5873795.html##define PREPAREOK 0x41/*======================å±å¹•ç›¸å…³======================*/##define SCREEN_WIDTH 240##define SCREEN_HEIGHT 135/*======================WiFiç›¸å…³======================*/##define ssid &quot;CloseWrt_2.5G&quot;// WiFi å¯†ç ##define password &quot;have5seeds&quot;##endif åœ¨ ESP32ï¼ˆæ¥æ”¶ç«¯ï¼‰ï¼Œæˆ‘æŠŠæ‰€æœ‰é€»è¾‘å°è£…æˆä¸€ä¸ª StreamingComponent ç±»ã€‚å®ƒçš„æ ¸å¿ƒæ˜¯çŠ¶æ€æœºï¼ˆIDLES, RUNNINGï¼‰å’Œä¸¤ä¸ªå…³é”®çš„ç¼“å†²åŒºï¼šä¸€ä¸ª headerBufferï¼ˆç”¨æ¥æ¥æ”¶å¸§å¤§å°ï¼‰å’Œä¸€ä¸ª wifiBufferï¼ˆç”¨æ¥æ¥æ”¶ JPG æ•°æ®ï¼‰ StreamingComponent.h123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899##ifndef STREAMINGCOMPONENT_H_##define STREAMINGCOMPONENT_H_##define IDLES 0##define RUNNING 1##define EXITING 2##include &lt;TFT_eSPI.h&gt;##include &lt;TJpg_Decoder.h&gt;##include &lt;WiFi.h&gt;##include &quot;utils.h&quot;##include &quot;common_macro.h&quot;class StreamingComponent {public: StreamingComponent(WiFiClient &amp;clt, TFT_eSPI &amp;tft); uint8_t status = IDLES; void enter(); void exit(); void loop(); bool drawCallBack(int16_t x, int16_t y, uint16_t w, uint16_t h, uint16_t *bitmap);// ~StreamingComponent() {// Serial.printf(&quot;~StreamingComponent\\n&quot;);// free(wifiBuffer);// free(headerBuffer);// free(frameSizeBuffer);// };private: // WiFiClientæŒ‡é’ˆ WiFiClient *client; // TFT_eSPIæŒ‡é’ˆ TFT_eSPI *Tft; // å¸§ç‡ç›¸å…³ double fps_avg = 0.0; uint32_t sec{}, psec{}; uint16_t fps = 0, frame_count = 0; // å¸§ç‡ç›¸å…³ // æ‰§è¡Œæ—¶é—´ç›¸å…³ // å‡½æ•°æ‰§è¡Œæ—¶é—´ uint32_t cost{}; // ä¸€æ¬¡loopæ‰§è¡Œæ—¶é—´ uint32_t loopCost{}; // ç¼“å†²éƒ¨åˆ† // å¸§æ•°æ®å¤§å° uint16_t size{}; // å·²ç»ä¸‹è½½å¸§æ•°æ®å¤§å° uint16_t bSize{}; // DMAç¼“å†²ç›¸å…³ // 2020.12.04è‹¥å‡ºç°å‘é€ç«¯å‘é€è¶…è¿‡wifiFrameSizeå¤§å°(32kb)ï¼Œ // åˆ™ä¼šå¯¼è‡´å‡ºé”™ï¼Œè€Œæ­¤å¤„æ— æ³•åˆ†é…æ›´å¤§å†…å­˜ã€‚ // æš‚æ—¶æœªæ‰¾åˆ°æ­£ç¡®å¼€å¯SPIRAMæ–¹æ³• // 2020.12.04å°†å›¾ç‰‡å‹ç¼©æ–¹å¼ä»LZOæ”¹ä¸ºjpg const int wifiFrameSize = 1024 * 32; // å¤´æ•°æ®å¤§å° const int headerFrameSize = 10; // å¾…ä¸‹è½½çš„jpgå›¾ç‰‡ç¼“å†² uint8_t *wifiBuffer = (uint8_t *) heap_caps_malloc(wifiFrameSize, MALLOC_CAP_8BIT); // å¤´æ•°æ®ç¼“å†² uint8_t *headerBuffer = (uint8_t *) heap_caps_malloc(headerFrameSize, MALLOC_CAP_8BIT); // å¸§æ•°æ®å¤§å°ç¼“å†²ï¼Œç”¨äºè§£æå­—ç¬¦ä¸²ä¸ºint uint8_t *frameSizeBuffer = (uint8_t *) heap_caps_malloc(headerFrameSize - 1, MALLOC_CAP_8BIT); // DMA åŒç¼“å†²æ¨¡å¼ uint16_t dmaBuffer1[16 * 16]{}; // Toggle buffer for 16*16 MCU block, 512bytes uint16_t dmaBuffer2[16 * 16]{}; // Toggle buffer for 16*16 MCU block, 512bytes uint16_t *dmaBufferPtr = dmaBuffer1; // å½“å‰ä½¿ç”¨çš„DMAç¼“å†² bool dmaBufferSel = 0; /** * æ˜¾ç¤ºå›è°ƒï¼Œç”¨äºTjpeg * 2020-12-06 */ /** * æ¥æ”¶æ•°æ® * 2020-12-01 * size: 5222 bytes * cost: 16 ms */ void onReceiveData();};##endif å®ç°çš„æ ¸å¿ƒåœ¨ onReceiveData()ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­,å®ƒé¦–å…ˆç­‰å¾… PREPAREOKï¼Œç„¶åè¯»å– 10 å­—èŠ‚çš„â€˜å¤´éƒ¨â€™ï¼Œè§£æå‡ºå¸§å¤§å°ï¼ˆsizeï¼‰ï¼Œå†å‘é€ HEADEROKï¼›ç„¶åå®ƒæ‰å¼€å§‹æ¥æ”¶é‚£ size å­—èŠ‚çš„ JPG å›¾åƒï¼Œå­˜å…¥ wifiBuffer. StreamingComponent.cpp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123##include &quot;StreamingComponent.h&quot;StreamingComponent::StreamingComponent(WiFiClient &amp;clt, TFT_eSPI &amp;tft) { this-&gt;client = &amp;clt; this-&gt;Tft = &amp;tft; Serial.println(&quot;StreamingComponent Constuctor&quot;);};void StreamingComponent::enter() { status = RUNNING; };void StreamingComponent::exit() { status = EXITING; };void StreamingComponent::loop() { if (status == RUNNING) { Serial.println(&quot;StreamingComponent loop&quot;); loopCost = millis(); onReceiveData(); Serial.printf(&quot;fps_avg:%f,loop cost:%d ms\\n&quot;, fps_avg, millis() - loopCost); Tft-&gt;drawString(String(fps_avg), 0, 0, 2); } else if (status == EXITING) { // å•¥ä¹Ÿä¸åš }};bool StreamingComponent::drawCallBack(int16_t x, int16_t y, uint16_t w, uint16_t h, uint16_t *bitmap) { if (status == RUNNING) { if (y &gt;= SCREEN_HEIGHT) return 0; if (dmaBufferSel) { dmaBufferPtr = dmaBuffer2; } else { dmaBufferPtr = dmaBuffer1; } dmaBufferSel = !dmaBufferSel; Tft-&gt;pushImageDMA(x, y, w, h, bitmap, dmaBufferPtr); } return true;}// ~StreamingComponent() {// Serial.printf(&quot;~StreamingComponent\\n&quot;);// free(wifiBuffer);// free(headerBuffer);// free(frameSizeBuffer);// };void StreamingComponent::onReceiveData() { Serial.println(&quot;StreamingComponent onReceiveData&quot;); StreamingComponent::client-&gt;write(PREPAREOK); Serial.println(&quot;StreamingComponent client.write(PREPAREOK);&quot;); cost = millis(); if (headerBuffer == nullptr) { Serial.printf(&quot;headerBuffer is null.\\n&quot;); } else { client-&gt;readBytes(headerBuffer, headerFrameSize); Serial.printf(&quot;receive header cost:%d ms\\n&quot;, millis() - cost); } int sum = checkSum((const char *)headerBuffer, 8); // Serial.printf(&quot;headerBuffer checkSum: %d\\n&quot;, sum); if ((sum &amp; 0xf) == c2i(headerBuffer[9]) &amp;&amp; (sum &gt;&gt; 4) == c2i(headerBuffer[8])) { // æœ‰æ•ˆå¤´æ•°æ®ï¼Œå‡†å¤‡æ¥æ”¶å¸§æ•°æ® strncpy((char *)frameSizeBuffer, (char *)headerBuffer, 8); frameSizeBuffer[9] = '\\0'; size = atoi((char *)frameSizeBuffer); // Serial.printf(&quot;valid header frame size: %d bytes\\n&quot;, size); } else { // æ— æ•ˆå¤´æ•°æ®ï¼Œä¸¢å¼ƒ // Serial.printf(&quot;invalid header\\n&quot;); return; } client-&gt;write(HEADEROK); // // Serial.printf(&quot;send HEADEROK\\n&quot;); cost = millis(); bSize = 0; if (wifiBuffer == NULL) { Serial.printf(&quot;wifiBuffer is null.\\n&quot;); Serial.printf(&quot;MALLOC_CAP_8BIT heap_caps_get_largest_free_block: %d.\\n&quot;, heap_caps_get_largest_free_block(MALLOC_CAP_8BIT)); Serial.printf(&quot;MALLOC_CAP_32BIT heap_caps_get_largest_free_block: %d.\\n&quot;, heap_caps_get_largest_free_block(MALLOC_CAP_32BIT)); Serial.printf(&quot;MALLOC_CAP_SPIRAM heap_caps_get_largest_free_block: %d.\\n&quot;, heap_caps_get_largest_free_block(MALLOC_CAP_SPIRAM)); Serial.printf(&quot;MALLOC_CAP_8BIT: %d.\\n&quot;, heap_caps_get_free_size(MALLOC_CAP_8BIT)); Serial.printf(&quot;MALLOC_CAP_32BIT: %d.\\n&quot;, heap_caps_get_free_size(MALLOC_CAP_32BIT)); Serial.printf(&quot;MALLOC_CAP_SPIRAM: %d.\\n&quot;, heap_caps_get_free_size(MALLOC_CAP_SPIRAM)); } else { bSize = client-&gt;readBytes(wifiBuffer, size); Serial.printf(&quot;frame size: %d bytes, receive frame cost:%d ms\\n&quot;, bSize, millis() - cost); } if (bSize &gt; 64 &amp;&amp; bSize == size) { cost = millis(); Tft-&gt;startWrite(); TJpgDec.drawJpg(0, 0, wifiBuffer, bSize); Tft-&gt;endWrite(); frame_count++; sec = millis() / 1000; if (psec != sec) { psec = sec; fps = frame_count; fps_avg = (fps_avg + fps) / 2.0; frame_count = 0; } // 31ms Serial.printf(&quot;draw cost:%d ms\\n&quot;, millis() - cost); } else { // æ— æ•ˆå¸§ï¼Œä¸¢å¼ƒ // return; } client-&gt;write(FRAMEOK); // // Serial.printf(&quot;send FRAMEOK\\n&quot;);} utils.h1234567891011121314##ifndef LIB_UTILS_H_##define LIB_UTILS_H_##include &lt;stdint.h&gt;##include &quot;TFT_eSPI.h&quot;int checkSum(const char* src, int length);int c2i(char ch);int getTextWidth(const char* text, TFT_eSprite &amp;sprite);int getTextWidth(const char* text, TFT_eSprite *sprite);##endif utils.cpp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647##include &quot;utils.h&quot;/** * @brief è®¡ç®—16æ ¡éªŒå’Œè®¡ç®— * @param src å¾…æ ¡éªŒå†…å®¹ * @param length å¾…æ ¡éªŒå†…å®¹é•¿åº¦ * @retval æ ¡éªŒå’Œ * */int checkSum(const char *src, int length) { int16_t sum = 0; for (int i = 0; i &lt; length; i++) { sum += src[i]; } sum = (sum &amp; 0xff) + (sum &gt;&gt; 16); return ~sum &amp; 0xff;}/** * @brief 16è¿›åˆ¶å­—ç¬¦è½¬int * @param ch å¾…è½¬æ¢å†…å®¹ * @retval æ ¡éªŒå’Œ * */// https://www.cnblogs.com/lidabo/p/3995055.htmlint c2i(char ch) { // å¦‚æœæ˜¯æ•°å­—ï¼Œåˆ™ç”¨æ•°å­—çš„ASCIIç å‡å»48, å¦‚æœch = '2' ,åˆ™ '2' - 48 = 2 if (isdigit(ch)) return ch - 48; // å¦‚æœæ˜¯å­—æ¯ï¼Œä½†ä¸æ˜¯A~F,a~fåˆ™è¿”å› if (ch &lt; 'A' || (ch &gt; 'F' &amp;&amp; ch &lt; 'a') || ch &gt; 'z') return -1; // å¦‚æœæ˜¯å¤§å†™å­—æ¯ï¼Œåˆ™ç”¨æ•°å­—çš„ASCIIç å‡å»55, å¦‚æœch = 'A' ,åˆ™ 'A' - 55 = 10 // å¦‚æœæ˜¯å°å†™å­—æ¯ï¼Œåˆ™ç”¨æ•°å­—çš„ASCIIç å‡å»87, å¦‚æœch = 'a' ,åˆ™ 'a' - 87 = 10 if (isalpha(ch)) return isupper(ch) ? ch - 55 : ch - 87; return -1;}int getTextWidth(const char* text, TFT_eSprite &amp;sprite){ return sprite.textWidth(text);}int getTextWidth(const char* text, TFT_eSprite *sprite){ return sprite-&gt;textWidth(text);} åœ¨ PCï¼ˆå‘é€ç«¯ï¼‰ï¼ŒPython è„šæœ¬æ­£å¥½æ˜¯ C++ é€»è¾‘çš„â€˜åé¢â€™ã€‚å®ƒä½¿ç”¨ mss æŠ“å±ï¼Œç”¨ cv2.imencode å°†å…¶å‹ç¼©æˆ JPGï¼ˆè¿™æ˜¯é™ä½å¸¦å®½çš„å…³é”®ï¼‰ï¼Œç„¶åç­‰å¾… ESP32 çš„â€˜æ¡æ‰‹ä¿¡å·â€™ï¼Œå¹¶ç›¸åº”åœ°å‘é€â€˜å¤´éƒ¨â€™å’Œâ€˜å¸§æ•°æ®â€™. tiny_monitor.cpp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960##pragma GCC optimize(&quot;O3&quot;)##include &lt;stdint.h&gt;##include &lt;TFT_eSPI.h&gt;##include &lt;TJpg_Decoder.h&gt;##include &lt;WiFi.h&gt;##include &lt;Wire.h&gt;##include &quot;StreamingComponent.h&quot;// ç¬¬ä¸‰æ–¹åŸºç¡€ç»„ä»¶// WiFiå®¢æˆ·ç«¯å®ä¾‹WiFiClient client;// æ˜¾ç¤ºå±é©±åŠ¨å®ä¾‹TFT_eSPI Tft = TFT_eSPI();// è‡ªå®šä¹‰å¯¹è±¡StreamingComponent *streaming;bool drawCallback(int16_t x, int16_t y, uint16_t w, uint16_t h, uint16_t *bitmap) { streaming-&gt;drawCallBack(x, y, w, h, bitmap); return true;}void main_setup() { // é…ç½®ä¸²å£ Serial.begin(115200); // é…ç½®æ˜¾ç¤º Tft.init(); Tft.setRotation(1); Tft.fillScreen(TFT_BLACK); Tft.initDMA(); // é…ç½®TJpeg TJpgDec.setJpgScale(1); TJpgDec.setSwapBytes(true); // è®¾ç½®TJpgè§£ç å™¨å›è°ƒå‡½æ•° TJpgDec.setCallback(drawCallback); // é…ç½®WiFi client.setTimeout(1); WiFi.begin(ssid, password); delay(1000); if (WiFi.status() == WL_CONNECTED) { const int httpPort = 715; client.connect(&quot;192.168.10.207&quot;, httpPort); Serial.println(&quot;Socket Connected&quot;); } // ç”¨æˆ·è‡ªå®šä¹‰å¯¹è±¡åˆå§‹åŒ–åŒº streaming = new StreamingComponent(client, Tft); streaming-&gt;status = RUNNING;}void setup() { main_setup();}void loop() { streaming-&gt;loop();} tiny_monitor.py123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110import socketimport timefrom multiprocessing import Process, Queue,Value,Managerfrom multiprocessing.sharedctypes import Arrayimport ctypesfrom mss.tools import to_pngimport cv2import lzoimport mssimport numpy as npip = &quot;0.0.0.0&quot;port = 715fps = 0def main(): global fps # 1. åˆ›å»ºå¥—æ¥å­— socket if True: tcp_server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # 2. ç»‘å®šæœ¬åœ°ä¿¡æ¯ bind tcp_server_socket.bind((ip, port)) # 3. è®©é»˜è®¤çš„å¥—æ¥å­—ç”±ä¸»åŠ¨å˜ä¸ºè¢«åŠ¨ listen tcp_server_socket.listen(128) print(&quot;å¯åŠ¨TCPæœåŠ¡å™¨\\r\\n&quot; + f'å¯åŠ¨åœ¨{ip}:{port}ä¸Š') # 4. ç­‰å¾…å®¢æˆ·ç«¯çš„é“¾æ¥ accept print(&quot;ç­‰å¾…å®¢æˆ·ç«¯çš„é“¾æ¥\\r\\n&quot;) new_client_socket, client_addr = tcp_server_socket.accept() print(f'å½“å‰é“¾æ¥ï¼š{client_addr}') frame_buffer = grab_screen_to_buffer(0, 0, 1920, 1080) start_time = time.time() while True: s = time.time() recv = new_client_socket.recv(1) if recv == b'\\x41': # å®¢æˆ·ç«¯å°±ç»ªï¼Œå‘é€å¤´æ•°æ® start_time = time.time() header = len(frame_buffer.tobytes()) header = package_header(header) new_client_socket.sendall(header) end_time = time.time() cost = end_time - start_time # print(&quot;å®¢æˆ·ç«¯å°±ç»ªï¼Œå‘é€å¤´æ•°æ®&quot;) elif recv == b'\\x02': # å®¢æˆ·ç«¯å‡†å¤‡å¤´éƒ¨æ¥æ”¶å®Œæˆï¼Œå‘é€å¸§æ•°æ® new_client_socket.sendall(frame_buffer.tobytes()) frame_buffer = grab_screen_to_buffer(0, 0, 1920, 1080) # print(&quot;å®¢æˆ·ç«¯å‡†å¤‡å¤´éƒ¨æ¥æ”¶å®Œæˆï¼Œå‘é€å¸§æ•°æ®&quot;) elif recv == b'\\x01': # pass # å®¢æˆ·ç«¯å‡†å¤‡å¸§æ•°æ®æ¥æ”¶å®Œæˆï¼Œç­‰å¾…å®¢æˆ·ç«¯å°±ç»ª # print(&quot;å®¢æˆ·ç«¯å‡†å¤‡å¸§æ•°æ®æ¥æ”¶å®Œæˆï¼Œç­‰å¾…å®¢æˆ·ç«¯å°±ç»ª&quot;) end_time = time.time() cost = end_time - start_time print(&quot;Backend FPS:{:.2f}&quot;.format(1.0 / cost))### grab screen by left top width heightdef grab_screen_to_buffer(l, t, w, h): monitor = {&quot;top&quot;: t, &quot;left&quot;: l, &quot;width&quot;: w, &quot;height&quot;: h} with mss.mss() as sct: sct_frame = sct.grab(monitor) img = np.array(sct_frame) img = cv2.resize(img, dsize=(240, 135)) # img = cv2.cvtColor(img, cv2.COLOR_BGR2BGR565) # print(&quot;bmp no comporess size:{}&quot;,len(img.tobytes())) # print(&quot;bmp lzo comporess size:{}&quot;,len(lzo.compress(img.tobytes(), 9, False))) quality = 60 encode_params = [cv2.IMWRITE_JPEG_QUALITY,quality,cv2.IMWRITE_JPEG_PROGRESSIVE,0] retval, img = cv2.imencode(&quot;.jpg&quot;, img, encode_params) # with open(&quot;write.jpg&quot;, &quot;wb&quot;) as f: # f.write(img.tobytes()) # img = img[..., ::-1] # print(&quot;jpg no comporess size:{}&quot;,len(img.tobytes())) # print(&quot;jpg lzo comporess size:{}&quot;,len(lzo.compress(img.tobytes(), 9, False))) return imgdef package_header(size): data = num_package(size) header = ''.join(data).encode() + hex(check_sum(data)).encode()[2:] return header## æ ¡éªŒå’Œdef check_sum(value): s = 0 for d in value: s += ord(d) s = (s &amp; 0xff) + (s &gt;&gt; 16) return ~s &amp; 0xff## æ‰“åŒ…æ•°å­—def num_package(num): if num &lt; 100000000: li_str = list(str(num)) result = ['0' for _ in range(8)] for index, item in zip(range(len(li_str)), li_str): result[-index + len(li_str) - 1] = item return result[::-1] else: return ['9' for _ in range(6)]if __name__ == '__main__': time.sleep(1) main() é¢„è§ˆ å‚è€ƒèµ„æ–™ä»¥ä¸‹å†…å®¹ä¸ºå®é™…å¼€å‘ä¸­å‚è€ƒè¿‡çš„èµ„æ–™ï¼Œæœ‰äº›èµ„æ–™ä¸­çš„æ–¹æ¡ˆå·²ç»èˆå¼ƒï¼Œå¹¶æœªä½“ç°åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œç‰¹æ­¤åˆ—å‡ºï¼Œä½†ä¿ºä»è¦å‘ä»–ä»¬è¡¨ç¤ºç”±è¡·çš„æ„Ÿè°¢ã€‚ windowsç¯å¢ƒå®‰è£…lzoå’Œpython-lzo https://raw.githubusercontent.com/lzfcc/LearnArduino ESP32 å®˜æ–¹æ–‡æ¡£ï¼ˆäº”ï¼‰ä¸¥é‡é”™è¯¯ ESP32-CAM: é€£æ¥ILI9341æ¶²æ™¶è¢å¹•","link":"/2020/12/14/ESP32-Streaming/"},{"title":"è®©ä½ çš„ESP32æ˜¾ç¤ºä¸€å¼ å…¬ç½‘å›¾ç‰‡å§","text":"è®©ä½ çš„ESP32æ˜¾ç¤ºä¸€å¼ å…¬ç½‘å›¾ç‰‡å§è¿™ç¯‡æ–‡ç« å†™äº 4 å¹´å‰ï¼Œä½†å…¶æ ¸å¿ƒåŸç†ï¼ˆæ‰‹åŠ¨è§£æ HTTP æŠ¥æ–‡ï¼‰åœ¨ä»Šå¤©ä¾ç„¶å®Œå…¨æœ‰æ•ˆã€‚è¯·æ³¨æ„ï¼ŒAsyncTCP-esphome åº“ç°åœ¨å¯èƒ½å·²æœ‰æ›´æ–°ç‰ˆæœ¬ï¼Œä½†æœ¬æ•™ç¨‹ä¸­å…³äºâ€˜onDataâ€™åˆ†å—å¤„ç†å’Œâ€˜Content-Lengthâ€™è§£æçš„é€»è¾‘ï¼Œæ˜¯æ‚¨ç†è§£åµŒå…¥å¼ç½‘ç»œç¼–ç¨‹çš„åŸºç¡€ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼ŒESP32å®ƒæ˜¯èƒ½è”ç½‘çš„ï¼Œè€Œé…ä¸Šå±å¹•ï¼Œå®ƒå°±å¯ä»¥æ˜¾ç¤ºä¸€å¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æ˜¾ç¤ºä¸€å¼ äº’è”ç½‘ä¸Šçš„å›¾ç‰‡å—ï¼Ÿå½“ç„¶å¯ä»¥ï¼è™½ç„¶ä¹‹å‰å·²ç»åšè¿‡äº†è§†é¢‘çš„ä¼ è¾“ï¼Œè€Œè§†é¢‘ä¸è¿‡æ˜¯å¾ˆå¤šå›¾ç‰‡çš„é›†åˆï¼Œä½†æ˜¯é‚£ç¯‡æ–‡ç« ä¸­çš„ä¼ è¾“éƒ½æ˜¯å»ºç«‹åœ¨å±€åŸŸç½‘ä¹‹ä¸­ï¼Œé€šä¿¡å»ºç«‹åœ¨Socketä¸Šã€‚è€Œè¿™æ¬¡è¦çªç ´å±€åŸŸç½‘ï¼Œä½¿ç”¨HTTPåè®®æ¥ä¼ è¾“æ•°æ®ï¼Œæ‰€ä»¥ä¼šæ¯”ä¹‹å‰å¤æ‚ä¸€äº›ã€‚ åºä½¿ç”¨çš„ç½‘ç»œè¯·æ±‚åº“ä¸ºAsyncTCP-esphomeï¼Œæ‰€ä»¥å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„platformio.iniä¸­ 123lib_deps = ottowinter/AsyncTCP-esphome@^1.1.1 ottowinter/ESPAsyncWebServer-esphome@^1.2.7 è¿™é‡Œå…ˆä»‹ç»ä¸€ä¸‹HTTPåè®®å§ï¼Œå¼•ç”¨ç™¾åº¦ç™¾ç§‘çš„åŸæ–‡è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHypertext Transfer Protocolï¼ŒHTTPï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚å®ƒæŒ‡å®šäº†å®¢æˆ·ç«¯å¯èƒ½å‘é€ç»™æœåŠ¡å™¨ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä»¥åŠå¾—åˆ°ä»€ä¹ˆæ ·çš„å“åº”ã€‚åœ¨è¿™ä¸ªé€šä¿¡è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»¥æŠ¥æ–‡çš„å½¢å¼é€šä¿¡ï¼Œå®¢æˆ·ç«¯å‘é€çš„æŠ¥æ–‡å«åšè¯·æ±‚æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯å‘é€çš„æŠ¥æ–‡å«åšåº”ç­”æŠ¥æ–‡ã€‚å…¶ä¸­è¯·æ±‚æŠ¥æ–‡çš„æ ¼å¼ç»“æ„å¦‚ä¸‹è¯·æ±‚è¡Œ ï¼ é€šç”¨ä¿¡æ¯å¤´ ï¼ è¯·æ±‚å¤´ ï¼ å®ä½“å¤´ ï¼ æŠ¥æ–‡ä¸»ä½“åº”ç­”æŠ¥æ–‡ç»“æ„å¦‚ä¸‹çŠ¶æ€è¡Œ ï¼ é€šç”¨ä¿¡æ¯å¤´ ï¼ å“åº”å¤´ ï¼ å®ä½“å¤´ ï¼ æŠ¥æ–‡ä¸»ä½“çŸ¥é“æŠ¥æ–‡æ ¼å¼åï¼Œè§£ææŠ¥æ–‡ï¼Œå°±èƒ½è·å–æˆ‘ä»¬æƒ³è¦çš„å†…å®¹ã€‚ä¸‹é¢é€šè¿‡ä¸€æ¬¡æ¼”ä¹ æ¥ç ”ç©¶ä¸‹æŠ¥æ–‡æœ‰ä»€ä¹ˆå†…å®¹ï¼Œç„¶åå†åšåç»­å¼€å‘ã€‚ æ¼”ä¹ ä¸ºäº†æ­¤æ¬¡æ¼”ä¹ ï¼Œæˆ‘åœ¨é˜¿é‡Œäº‘OSSä¸­ä¸Šä¼ äº†ä¸€å¼ å¾ˆå°çš„JPGå›¾ç‰‡ï¼Œå€ŸåŠ©é˜¿é‡Œäº‘OSSï¼Œè¿™å¼ å›¾ç‰‡å°±æœ‰äº†ä¸€ä¸ªå›ºå®šçš„å…¬ç½‘åœ°å€ï¼Œ ä¸‹é¢æ‰“å¼€Postmanï¼ŒæŠŠå›¾ç‰‡åœ°å€å¡«è¿›å»ï¼Œè¯·æ±‚å¤´å‚æ•°ä¿æŒé»˜è®¤ï¼Œç„¶åå‘é€è¯·æ±‚ï¼Œç›´æ¥æŸ¥çœ‹Postmançš„æ§åˆ¶å°ï¼Œç‚¹å‡»Show raw logæŸ¥çœ‹åŸå§‹è¯·æ±‚æ—¥å¿—ã€‚ è¯·æ±‚æŠ¥æ–‡å¦‚ä¸‹ 1234567GET /response.jpg HTTP/1.1User-Agent: PostmanRuntime/7.26.10Accept: */*Postman-Token: 8f142c2a-1547-40df-a07e-637450e576c4Host: chaosgoo-pic.oss-cn-shanghai.aliyuncs.comAccept-Encoding: gzip, deflate, brConnection: keep-alive è¯·æ±‚æŠ¥æ–‡çš„ç»“æ„å¦‚å›¾æ‰€ç¤ºè¯·æ±‚æŠ¥æ–‡ä¸­éœ€è¦å…³æ³¨çš„å†…å®¹æœ‰ å†…å®¹ å¤‡æ³¨ GET /response.jpg HTTP/1.1 è¯·æ±‚è¡Œï¼Œç”±æ–¹æ³•å­—æ®µã€URLå­—æ®µå’ŒHTTPåè®®ç‰ˆæœ¬å­—æ®µç»„æˆ â€¦ â€¦ Host: chaosgoo-pic.oss-cn-shanghai.aliyuncs.com è¯·æ±‚çš„ä¸»æœºåå’Œç«¯å£å· â€¦ â€¦ å¯ä»¥å‘ç°ï¼Œè¡¨ä¸­å†…å®¹å°±æ˜¯ç”±å›¾ç‰‡çš„é“¾æ¥æ„é€ å‡ºæ¥çš„ã€‚ å†çœ‹ä¸€çœ¼åº”ç­”æŠ¥æ–‡ï¼Œåº”ç­”æŠ¥æ–‡çš„ç»“æ„å¦‚å›¾æ‰€ç¤º åº”ç­”æŠ¥æ–‡å¦‚ä¸‹ 123456789101112131415161718HTTP/1.1 200 OKServer: AliyunOSSDate: Thu, 04 Mar 2021 08:52:28 GMTContent-Type: image/jpegContent-Length: 2544Connection: keep-alivex-oss-request-id: 60409FCC0EF7D03534F4A1F5Accept-Ranges: bytesETag: &quot;C6C67E44834D62DC1FC9729C94E74CCB&quot;Last-Modified: Wed, 03 Mar 2021 18:04:44 GMTx-oss-object-type: Normalx-oss-hash-crc64ecma: 18170594484795111235x-oss-storage-class: StandardContent-Disposition: attachmentx-oss-force-download: trueContent-MD5: xsZ+RINNYtwfyXKclOdMyw==x-oss-server-time: 27##The console does not support viewing response bodies with media files. æœ‰å¾ˆå¤šç°åœ¨ä¸éœ€è¦å…³æ³¨çš„å†…å®¹ï¼Œåªéœ€è¦å…³å¿ƒä¸‹è¡¨ä¸­çš„å†…å®¹ å†…å®¹ å¤‡æ³¨ HTTP/1.1 200 OK çŠ¶æ€è¡Œ,ç”±åè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ä¸åŸå› çŸ­è¯­ç»„æˆ â€¦ â€¦ Content-Type: image/jpeg å®ä½“çš„åª’ä½“ç±»å‹ Content-Length: 2544 å®ä½“çš„é•¿åº¦ï¼Œæ­¤å¤„å³ä¸ºJPGå›¾ç‰‡çš„å¤§å° â€¦ â€¦ æœ‰äº†çŠ¶æ€è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æ­¤æ¬¡è¯·æ±‚æ˜¯å¦æˆåŠŸï¼›æœ‰äº†Content-Lengthï¼Œæˆ‘ä»¬å°±çŸ¥é“ç›®æ ‡å›¾ç‰‡çš„å°ºå¯¸ã€‚åç»­æ“ä½œå°±æ˜¯å…ˆè§£ææŠ¥æ–‡ï¼Œç„¶åæ ¹æ®è¯·æ±‚è¡Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œå¦‚æœæˆåŠŸï¼Œå°±ç»§ç»­è§£æåº”ç­”é¦–éƒ¨ï¼Œè·å–å›¾ç‰‡çš„å°ºå¯¸ï¼Œå¦‚æœä¸æˆåŠŸï¼Œé‚£å°±æ…¢æ…¢Debugå§ã€‚ä¸€åˆ‡å°±ç»ªåï¼Œé‚£å¯ä»¥å¼€å§‹è¯»å–å‰©ä¸‹çš„å†…å®¹å§ã€‚ç”±äºä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½æ— æ³•ä¸€æ¬¡æ€§å°†å®ä½“ä¼ è¾“è¿‡æ¥ï¼Œæ‰€ä»¥å®ä½“ä¼šè¢«åˆ†å‰²æˆå¾ˆå¤šå°å—å‘é€ï¼Œä½¿ç”¨extractBodyChunkFromResponseRawæå–å®ä½“å¹¶è¿”å›æå–åˆ°çš„é•¿åº¦ã€‚å‰é¢*client-&gt;onData([&amp;] (void *arg, AsyncClient *c, void *data, size_t len)ä¼šè¢«è°ƒç”¨å¾ˆå¤šæ¬¡ã€‚åœ¨onDataä¸­çš„data*å°±æ˜¯æ¯ä¸€æ•°æ®å¸§å»æ‰å¸§å¤´å’Œå¸§å°¾çš„éƒ¨åˆ†ï¼Œå³ä¸ºå®ä½“è¢«åˆ†æˆçš„å°å—ã€‚ç”±äºæ˜¯é€šè¿‡TCPä¼ è¾“çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå¤§å°å­˜åœ¨ä¸Šé™,é‡‡ç”¨Arduinoæ–¹å¼å¼€å‘ESP32çš„è¯ï¼ŒMSSçš„å€¼ä¼šè¢«è®¾ç½®æˆ1436ã€‚å¾ˆè£å¹¸çš„èƒ½å¤Ÿè§‚å¯Ÿåˆ°è¿™ä¸ªç°è±¡ï¼Œæ„Ÿè§‰æ‘¸åˆ°MTUäº† ä»£ç æ—¶é—´è¯·æ±‚éƒ¨åˆ†ä»£ç å…³äºç½‘ç»œè¯·æ±‚æ“ä½œçš„ä»£ç ï¼Œå‚é˜…ESP32å¼‚æ­¥ç½‘ç»œè¯·æ±‚ï¼Œæœ¬æ–‡åªå…³æ³¨åº”ç­”æŠ¥æ–‡å¤„ç†å‡½æ•° main.cpp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235##include &lt;Arduino.h&gt;##include &lt;AsyncTCP.h&gt;##include &lt;TFT_eSPI.h&gt;##include &lt;TJpg_Decoder.h&gt;##include &lt;WiFi.h&gt;##include &lt;Wire.h&gt;##define ssid &quot;XXXX&quot;##define password &quot;XXXX&quot;// æ˜¾ç¤ºspriteçš„å†…å®¹TFT_eSPI tft;// å›¾ç‰‡ç»˜åˆ¶çš„SpriteTFT_eSprite imageSprite = TFT_eSprite(&amp;tft);// åº”ç­”æŠ¥æ–‡çš„SpriteTFT_eSprite headerSprite = TFT_eSprite(&amp;tft);WiFiClient client;// å¾…æ˜¾ç¤ºå›¾ç‰‡å°ºå¯¸uint16_t imageSize;// å·²ç»ä¸‹è½½çš„å®ä½“å°ºå¯¸uint16_t readBytesSize = -1;// å›¾ç‰‡ç¼“å­˜, é™åˆ¶å¤§å°ä¸º16KBï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®æˆå…¶ä»–å°ºå¯¸ã€‚uint8_t *imageBuffer = (uint8_t *)heap_caps_malloc(16 * 1024, MALLOC_CAP_8BIT);// ä¸¤å¼ spriteçš„åç§»int16_t headerSpriteOffset = 0;String header;enum ParseState { PARSE_REQ_START, PARSE_REQ_HEADERS, PARSE_REQ_BODY, PARSE_REQ_END, PARSE_REQ_FAIL, PARSE_REQ_PENDING};ParseState _parseState;/** * @brief ä»åˆæ¬¡åŸå§‹æŠ¥æ–‡ä¸­æå–Content-Length * @param responseBody åŸå§‹æŠ¥æ–‡ * @param bodyBeginIndex bodyèµ·å§‹ç´¢å¼• * @return æ—  **/uint16_t extractContentLengthFromResponseRaw(String &amp;responseBody, uint16_t &amp;bodyBeginIndex) { int index = responseBody.indexOf(&quot;Content-Length:&quot;); int eIndex = responseBody.indexOf('\\n', index); String value = responseBody.substring(index + 16, eIndex); bodyBeginIndex = responseBody.indexOf(&quot;\\r\\n\\r\\n&quot;) + 4; return atoi(value.c_str());}/** * @brief æ·±åº¦å¤åˆ¶bytes * @param buffer ç›®æ ‡çš„å®¹å™¨ * @param source åŸå§‹å†…å®¹ * @param length æ•°æ®é•¿åº¦ * @param SrcOffset åŸå§‹å†…å®¹çš„è¯»å–åç§» * @param bufferOffset ç›®æ ‡çš„å®¹å™¨çš„å†™å…¥åç§» * @return å¤„ç†çš„æ•°æ®é•¿åº¦ **/size_t copyBytes(uint8_t *source, uint8_t *buffer, size_t length, size_t SrcOffset, size_t bufferOffset) { size_t count = 0; while (count + SrcOffset &lt; length) { *(buffer + count + bufferOffset) = source[count + SrcOffset]; count++; } return count;}/** * @brief ä»åˆæ¬¡åŸå§‹æŠ¥æ–‡ä¸­æå–Content-Length * @param frameData åŸå§‹æŠ¥æ–‡ * @param bodyData bodyæ•°æ®å®¹å™¨ * @param length bodyæ•°æ®é•¿åº¦ * @param offset bodyæ•°æ®èµ·å§‹ç´¢å¼• * @return å¤„ç†çš„bodyé•¿åº¦ **/uint16_t extractBodyChunkFromResponseRaw(uint8_t *frameData, uint8_t *bodyData, uint16_t length, uint16_t srcOffset, size_t bufferOffset) { copyBytes(frameData, bodyData, length, srcOffset, bufferOffset); return length - srcOffset;}void asyncReqeust() { static AsyncClient *aClient; if (aClient) { // aClient already exists // aClient ç¹å¿™ return; } aClient = new AsyncClient(); if (!aClient) { // could not allocate aClient // aClient æ— æ³•åˆ›å»º return; } aClient-&gt;onError( [&amp;](void *arg, AsyncClient *client, int error) { Serial.println(&quot;getImageAsync:Connect Error&quot;); aClient = NULL; delete client; }, NULL); // è¯·æ±‚çš„å›è°ƒ aClient-&gt;onConnect( [&amp;](void *arg, AsyncClient *client) { Serial.println(&quot;getImageAsync:Connected&quot;); aClient-&gt;onError(NULL, NULL); // è¿æ¥æ–­å¼€çš„åŠ¨ä½œ client-&gt;onDisconnect( [&amp;](void *arg, AsyncClient *c) { // status = 3; aClient = NULL; delete c; Serial.printf(&quot;getImageAsync:Disconnected\\n&quot;); _parseState = PARSE_REQ_START; }, NULL); // æ¥æ”¶åˆ°æœåŠ¡å™¨æ•°æ®æ—¶å€™çš„åŠ¨ä½œ client-&gt;onData( [&amp;](void *arg, AsyncClient *c, void *data, size_t len) { uint8_t *d = (uint8_t *)data; // _parseStateä¸ºè§£æçŠ¶æ€æšä¸¾ç±»å‹ if (_parseState == PARSE_REQ_START) { String content = String((char *)data); _parseState = PARSE_REQ_HEADERS; uint16_t bodyBeginIndex = 0; // ä»å“åº”å¤´ä¸­è·å–é•¿åº¦ imageSize = extractContentLengthFromResponseRaw(content, bodyBeginIndex); Serial.printf(&quot;Content-Length:%d\\n&quot;, imageSize); header = content.substring(0, bodyBeginIndex); if (imageSize &gt; 0) { _parseState = PARSE_REQ_BODY; readBytesSize = extractBodyChunkFromResponseRaw( d, imageBuffer, len, bodyBeginIndex, 0); } } else if (_parseState == PARSE_REQ_BODY) { readBytesSize += extractBodyChunkFromResponseRaw( d, imageBuffer, len, 0, readBytesSize); Serial.printf(&quot;extract size:%d\\n&quot;, readBytesSize); } if (readBytesSize == imageSize) { // æ¥æ”¶å®Œæˆ Serial.printf(&quot;Body Received Done.received %d bytes\\n&quot;, readBytesSize); // for (int i = 0; i &lt; imageSize; i++) { // Serial.write(*buffer + i); // } // Serial.println(); _parseState = PARSE_REQ_END; } }, NULL); // å‘é€è¯·æ±‚ client-&gt;write( &quot;GET /response.jpg HTTP/1.1\\r\\n&quot; &quot;Host: chaosgoo-pic.oss-cn-shanghai.aliyuncs.com\\r\\n&quot; &quot;Accept: */*\\r\\n&quot; &quot;Accept-Encoding: gzip, deflate, br&quot; &quot;Connection: keep-alive&quot; &quot;User-Agent: PostmanRuntime/7.26.10\\r\\n\\r\\n&quot;); }, NULL); if (!aClient-&gt;connect(&quot;chaosgoo-pic.oss-cn-shanghai.aliyuncs.com&quot;, 80)) { Serial.println(&quot;Connect Fail&quot;); AsyncClient *client = aClient; aClient = NULL; delete client; }}// JPGè§£ç ç»˜åˆ¶å›è°ƒbool drawCallback(int16_t x, int16_t y, uint16_t w, uint16_t h, uint16_t *bitmap) { if (imageSize == readBytesSize) { if (y &gt;= 135) { return true; } imageSprite.pushImage(x, y, w, h, bitmap); } return true;}// æ¨é€åˆ°å±å¹•void pushToTFT(int offset) { headerSprite.pushSprite(0, offset); imageSprite.pushSprite(0, offset + 135);}void setup() { Serial.begin(115200); client.setTimeout(1); WiFi.begin(ssid, password); WiFi.setAutoReconnect(true); // åˆå§‹åŒ–å±å¹• tft.init(); // æ—‹è½¬å±å¹•æ–¹å‘ï¼Œä»ç«–å˜ä¸ºæ¨ªå‘ tft.setRotation(1); // æ¸…ç©ºå±å¹•å†…å®¹ tft.fillScreen(TFT_BLACK); // åˆ›å»ºSprite imageSprite.createSprite(240, 32); headerSprite.createSprite(240, 135); // é…ç½®TJpeg TJpgDec.setJpgScale(1); TJpgDec.setSwapBytes(true); // è®¾ç½®TJpgè§£ç å™¨å›è°ƒå‡½æ•° TJpgDec.setCallback(drawCallback); delay(3000); asyncReqeust();}void loop() { if (_parseState == PARSE_REQ_END) { TJpgDec.drawJpg(0, 0, imageBuffer, imageSize); _parseState = PARSE_REQ_PENDING; headerSprite.setTextFont(1); headerSprite.setTextColor(TFT_WHITE); for (int i = 0; i &lt; header.length(); i++) { headerSprite.print(header[i]); Serial.print(header[i]); headerSprite.pushSprite(0, 0); } } pushToTFT(headerSpriteOffset); delay(100); if (headerSpriteOffset &gt; -32) { headerSpriteOffset -= headerSprite.fontHeight(1); }} platformio.ini123456789101112[env:pico32]platform = espressif32board = pico32framework = arduinomonitor_speed = 115200lib_deps = adafruit/Adafruit BusIO@^1.6.0 adafruit/Adafruit GFX Library@1.10.3 bodmer/TFT_eSPI@^2.3.41 ottowinter/AsyncTCP-esphome@^1.1.1 ottowinter/ESPAsyncWebServer-esphome@^1.2.7 bodmer/TJpg_Decoder@^0.1.0 å‚è€ƒèµ„æ–™ HTTP WebæœåŠ¡å…¶äºŒHTTPæŠ¥æ–‡æ ¼å¼è¯´æ˜ MTU å’Œ MSS åŒºåˆ« arduino-esp32/tools/sdk/include/config/sdkconfig.h","link":"/2021/03/04/ESP32-display-remote-JPG/"},{"title":"Code FFmpeg on Android","text":"ç§»æ¤FFmpegåˆ°Androidä¸Š å› ä¸ºMix Musicè§£ç çš„éœ€æ±‚,æ‰€ä»¥å¾—é€‰æ‹©åˆé€‚çš„è§£ç å·¥å…·.å°è¯•äº†4ç§è§£ç æ–¹å¼,æœ€åè¿˜æ˜¯FFmpegçš„æ•ˆæœæœ€å¥½ MediaCodecé…åˆMediaExtractorè¿›è¡Œè§£ç æ“ä½œ è¿™æ ·çš„è¯,é»˜è®¤æƒ…å†µä¸‹MediaExtractoræ¯æ¬¡åªä¼ è¾“1KBå·¦å³çš„æ•°æ®ç»™MediaCodec,é€Ÿåº¦å®åœ¨æ˜¯å¤ªæ…¢ MediaCodecä¸ç”¨MediaExtractorè¿›è¡Œè§£ç æ“ä½œ åœ¨ç»™Bytebufferå¡«å……æ•°æ®å,MediaCodecå¤„ç†æ•°æ®çš„æ—¶å€™æ€»å‡ºé”™,å¤§æ¦‚æ˜¯å› ä¸ºæ²¡æœ‰è·³è¿‡éå¸§æ•°æ®çš„éƒ¨åˆ† ä½¿ç”¨LAMEè¿›è¡Œè§£ç æ“ä½œ ä¸å¹¸çš„æ˜¯LAMEä¸­çš„hip_decode()ä¹Ÿæ˜¯åªèƒ½å¤„ç†å¸§æ•°æ®,éœ€è¦æ‰‹åŠ¨è·³è¿‡éå¸§æ•°æ®.å½“æ‰‹åŠ¨è·³è¿‡éå¸§æ•°æ®å,æœ€ç»ˆå‘ç°é€Ÿåº¦å¹¶æ²¡æœ‰æå‡å¤šå°‘(å°½ç®¡å·²ç»è®¾ç½®äº†ä¸åŒå¤§å°çš„buffer) ä½¿ç”¨FFmpegè¿›è¡Œè§£ç æ“ä½œ ç¼–è¯‘çš„æ—¶å€™çœŸçš„æ˜¯å„ç§é”™è¯¯,å¤´æ–‡ä»¶æ˜æ˜å°±åœ¨é‚£é‡Œå‘†çš„å¥½å¥½çš„,ç¼–è¯‘å™¨è¿˜æ˜¯æŠ¥æ‰¾ä¸åˆ°å‡½æ•°çš„é”™è¯¯.å¥½åœ¨æœ€ç»ˆæ•ˆæœä»¤äººéå¸¸æ»¡æ„,3ç§’é’Ÿè§£ç ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶. è¿™æ˜¯é¡¹ç›®çš„GitHubåœ°å€,å¦‚æœä½ çš„ffmpegå®åœ¨æ˜¯ç¼–è¯‘ä¸è¿‡å»,å¯ä»¥å»è¿™é‡Œä¸‹è½½,ç„¶åå†è¿›è¡Œç¼–è¯‘. ç¼–è¯‘å‡ºffmpegçš„soæ–‡ä»¶è¦ç¼–è¯‘FFmpeg,ç¬¬ä¸€æ­¥å°±æ˜¯å…ˆè·å–æºç .ç›´æ¥å»å®˜ç½‘å°±å¯ä»¥ä¸‹è½½.è§£å‹åå¾—åˆ° 123456789101112131415161718â””â”€â”€â”€ffmpeg â”œâ”€â”€â”€compat â”œâ”€â”€â”€doc â”œâ”€â”€â”€ffbuild â”œâ”€â”€â”€ffmpeg â”œâ”€â”€â”€fftools â”œâ”€â”€â”€libavcodec â”œâ”€â”€â”€libavdevice â”œâ”€â”€â”€libavfilter â”œâ”€â”€â”€libavformat â”œâ”€â”€â”€libavresample â”œâ”€â”€â”€libavutil â”œâ”€â”€â”€libpostproc â”œâ”€â”€â”€libswresample â”œâ”€â”€â”€libswscale â”œâ”€â”€â”€presets â”œâ”€â”€â”€tests â””â”€â”€â”€tools æ‰“å¼€configureæ–‡ä»¶æ‰¾åˆ° 1234SLIBNAME_WITH_MAJOR='$(SLIBNAME).$(LIBMAJOR)' LIB_INSTALL_EXTRA_CMD='$$(RANLIB) &quot;$(LIBDIR)/$(LIBNAME)&quot;' SLIB_INSTALL_NAME='$(SLIBNAME_WITH_VERSION)' SLIB_INSTALL_LINKS='$(SLIBNAME_WITH_MAJOR) $(SLIBNAME)' å°†å†…å®¹ä¿®æ”¹ä¸º 1234SLIBNAME_WITH_MAJOR='$(SLIBPREF)$(FULLNAME)-$(LIBMAJOR)$(SLIBSUF)' LIB_INSTALL_EXTRA_CMD='$$(RANLIB) &quot;$(LIBDIR)/$(LIBNAME)&quot;' SLIB_INSTALL_NAME='$(SLIBNAME_WITH_MAJOR)' SLIB_INSTALL_LINKS='$(SLIBNAME)' è¿™æ˜¯å› ä¸ºé»˜è®¤ç”Ÿæˆçš„æ–‡ä»¶åç§°ä¸­ç‰ˆæœ¬å·ä½äºæœ€å,ä¸ç¬¦åˆAndroidå‘½åè§„èŒƒ. åœ¨ffmpegç›®å½•ä¸‹åˆ›å»ºbuild.shæ–‡ä»¶å†…å®¹ä¸º 12345678910111213141516171819202122232425262728293031323334353637383940414243444546NDK=F:/android-ndk-r14b## æŒ‡å‘ä½ NDKçš„è·¯å¾„SYSROOT=$NDK/platforms/android-21/arch-arm/## æŒ‡å®šé€»è¾‘ç›®å½•,æŒ‰ç…§è‡ªèº«éœ€è¦è¿›è¡Œä¿®æ”¹TOOLCHAIN=$NDK/toolchains/arm-linux-androideabi-4.9/prebuilt/windows-x86_64## windowså¹³å°ä¸ºwindows-x86_64,linuxä¸ºlinux-x86_64CPU=armPREFIX=$(pwd)/android/$CPU ADDI_CFLAGS=&quot;-marm&quot;## build_oneä¸­,å› ä¸ºæˆ‘åªéœ€è¦ä½¿ç”¨mp3çš„decodeå’Œpcm_s16leçš„encode,æ‰€ä»¥å…³é—­äº†å…¶ä»–çš„decodeå’Œencodeæ¥å®ç°å‹ç¼©ä½“ç§¯,é›†ä½“é…ç½®å‚æ•°å¯å‚è€ƒ## https://www.cnblogs.com/azraelly/archive/2012/12/31/2840541.htmlfunction build_one{./configure \\--prefix=$PREFIX \\--enable-shared \\--disable-static \\--enable-asm \\--disable-doc \\--disable-gpl \\--enable-small \\--disable-encoders \\--disable-decoders \\--disable-ffmpeg \\--enable-encoder=pcm_s16le \\--enable-decoder=mp3 \\--disable-ffplay \\--disable-ffprobe \\--disable-ffserver \\--disable-doc \\--disable-symver \\--enable-jni \\--cross-prefix=$TOOLCHAIN/bin/arm-linux-androideabi- \\--target-os=android \\--arch=arm \\--enable-cross-compile \\--sysroot=$SYSROOT \\--extra-cflags=&quot;-Os -fpic $ADDI_CFLAGS&quot; \\--extra-ldflags=&quot;$ADDI_LDFLAGS&quot; \\$ADDITIONAL_CONFIGURE_FLAGmake cleanmakemake install}build_one æ›´åŠ ä¸å¹¸çš„æ˜¯.shæ–‡ä»¶ç°åœ¨è¿˜ä¸èƒ½è¿è¡Œ,å¾—å…ˆä¸‹è½½MinGW,è®°å¾—build.shæ–‡ä»¶ä¸ç¼–è¾‘çš„æ—¶å€™,ä¸è¦æŒ‚åœ¨åå°å¤„åœ¨æ‰“å¼€çŠ¶æ€ä¸‹è½½å¥½å,ç›´æ¥æ‰“å¼€å‹¾é€‰ä¸Šå¦‚å›¾æ‰€ç¤ºçš„é€‰é¡¹ åœ¨å·¦ä¸Šè§’Installationèœå•ä¸­ç‚¹å‡»Apply Changes,ç„¶åç­‰å¾…ä¸‹è½½å¹¶è‡ªåŠ¨å®‰è£…(å¯èƒ½éœ€è¦é…¸é…¸ä¹³,å› ä¸ºç½‘ç»œè´¨é‡ä¸æ˜¯å¾ˆé«˜) ä¸‹è½½å®Œæ¯•å,ç›´æ¥è¿›åº¦ä½ çš„MinGWæ–‡ä»¶å¤¹,æ‰¾åˆ°msysæ–‡ä»¶å¤¹å¹¶è¿›å…¥.åŒå‡»msys.batå°±ä¼šå¯åŠ¨ä¸€ä¸ªé•¿çš„å¾ˆåƒCMDçš„ç¨‹åº,è‡³å°‘åœ¨æ‰“å¼€è·¯å¾„ä¸Šéƒ½æ˜¯ä½¿ç”¨cdå‘½ä»¤ cdè¿›å…¥åˆ°ä¹‹å‰build.shçš„æ–‡ä»¶å¤¹,è¾“å…¥./build.shè¿è¡Œbuild.sh,å®ƒå°±ä¼šè‡ªåŠ¨è¿›è¡Œç¼–è¯‘æ“ä½œ.å¦‚æœé‡åˆ°äº†å„ç§å¥‡æ€ªé—®é¢˜,ä¸è¦æ”¾å¼ƒ,å› ä¸ºä½ çš„é—®é¢˜å‰äººå·²ç»çŠ¯è¿‡,ä½ åªéœ€è¦å–„ç”¨æœç´¢å¼•æ“,è¸©ç€ä»–ä»¬çš„è„šå°å³å¯. å› ä¸ºæˆ‘åœ¨ç¼–è¯‘çš„æ—¶å€™ä¹Ÿé‡åˆ°äº†å„ç§å„æ ·çš„é—®é¢˜,æœ€åé€šè¿‡æ›´æ¢NDKç‰ˆæœ¬è§£å†³äº†é—®é¢˜.ç­‰å¾…ä¸€æ®µæ—¶é—´å,åœ¨ffmpegç›®å½•ä¸‹å°±ä¼šå¤šå‡ºandroidæ–‡ä»¶å¤¹,æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„soæ–‡ä»¶å°±åœ¨è¿™ä¸ªffmpeg/android/arm/libæ–‡ä»¶å¤¹å†… ç¼–è¯‘å®Œæˆåæˆ‘ä»¬å¾—åˆ°äº† 12345678910includelib libavcodec.so libavdevice.so libavfilter.so libavformat.so libavutil.so libpostproc.so libswresample.so libswscale.so ç¼–è¯‘å®‰å“å¯ä»¥è°ƒç”¨çš„soæ–‡ä»¶ç»ˆäºåˆ°äº†è¦è°ƒç”¨FFmpegçš„é˜¶æ®µäº†.å’Œå¸¸è§„NDKç¼–è¯‘çš„éœ€æ±‚ä¸€æ ·,éœ€è¦åˆ›å»ºä¸€ä¸ªjniæ–‡ä»¶å¤¹.æŠŠä¸Šä¸€æ­¥å¾—åˆ°çš„includeæ–‡ä»¶å¤¹å’Œé‚£äº›soæ–‡ä»¶å¤åˆ¶è¿›æ¥. è¿˜éœ€è¦æŠŠä½äºffmpegæ ¹ç›®å½•ä¸­çš„ cmdutils.cå’Œcmdutils.h ffmpeg.hå’Œffmpeg.c ffmpeg_opt.c ffmpeg_hw.c ffmpeg_filter.c va_copy.h config.h è¿™ä¸ªæ–‡ä»¶åªæœ‰ä½ ä¹‹å‰æ‰‹åŠ¨ç¼–è¯‘äº†ffmpegæ‰ä¼šå¾—åˆ°ä¹Ÿå¤åˆ¶åˆ°jniæ–‡ä»¶å¤¹å†… åˆ›å»ºApplication.mk 1234APP_ABI := armeabi-v7a armeabiAPP_MODULES := libffmpegjniAPP_CFLAGS += -DSTDC_HEADERS ä»¥åŠAndroid.mk 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE:= avcodec-prebuilt-armeabiLOCAL_SRC_FILES:= prebuilt/armeabi/libavcodec.soinclude $(PREBUILT_SHARED_LIBRARY)include $(CLEAR_VARS)LOCAL_MODULE:= avdevice-prebuilt-armeabiLOCAL_SRC_FILES:= prebuilt/armeabi/libavdevice.soinclude $(PREBUILT_SHARED_LIBRARY)include $(CLEAR_VARS)LOCAL_MODULE:= avfilter-prebuilt-armeabiLOCAL_SRC_FILES:= prebuilt/armeabi/libavfilter.soinclude $(PREBUILT_SHARED_LIBRARY)include $(CLEAR_VARS)LOCAL_MODULE:= avformat-prebuilt-armeabiLOCAL_SRC_FILES:= prebuilt/armeabi/libavformat.soinclude $(PREBUILT_SHARED_LIBRARY)include $(CLEAR_VARS)LOCAL_MODULE := avutil-prebuilt-armeabiLOCAL_SRC_FILES := prebuilt/armeabi/libavutil.soinclude $(PREBUILT_SHARED_LIBRARY)include $(CLEAR_VARS)LOCAL_MODULE := swresample-prebuilt-armeabiLOCAL_SRC_FILES := prebuilt/armeabi/libswresample.soinclude $(PREBUILT_SHARED_LIBRARY)include $(CLEAR_VARS)LOCAL_MODULE := swscale-prebuilt-armeabiLOCAL_SRC_FILES := prebuilt/armeabi/libswscale.soinclude $(PREBUILT_SHARED_LIBRARY)include $(CLEAR_VARS)LOCAL_MODULE := libffmpegjniLOCAL_ARM_MODE := armLOCAL_SRC_FILES := ffmpegJni.c \\ ffmpeg.c \\ cmdutils.c \\ ffmpeg_opt.c \\ ffmpeg_filter.c \\ ffmpeg_hw.cLOCAL_LDLIBS := -L$(SYSROOT)/usr/lib -llog -lzLOCAL_SHARED_LIBRARIES:= avcodec-prebuilt-armeabi \\ avdevice-prebuilt-armeabi \\ avfilter-prebuilt-armeabi \\ avformat-prebuilt-armeabi \\ avutil-prebuilt-armeabi \\ swresample-prebuilt-armeabi \\ swscale-prebuilt-armeabiLOCAL_C_INCLUDES += -L$(SYSROOT)/usr/includeLOCAL_C_INCLUDES += $(LOCAL_PATH)/includeLOCAL_CFLAGS := -DUSE_ARM_CONFIGinclude $(BUILD_SHARED_LIBRARY) åœ¨ffmpeg.cä¸­æœ‰äº›ä¸œè¥¿éœ€è¦æˆ‘ä»¬ä¿®æ”¹ä¸‹,å› ä¸ºæ­£å¸¸æƒ…å†µä¸‹ffmpegæ‰§è¡Œä¸€æ¡å‘½ä»¤,å®ƒå°±ä¼šè‡ªåŠ¨é€€å‡º,æˆ‘ä»¬å½“ç„¶ä¸å¸Œæœ›è¿™æ ·.æ‰€ä»¥éœ€è¦å¯¹ä»–çš„æ¨å‡ºæ“ä½œè¿›è¡Œå¤„ç†.æ‰“å¼€ffmpeg.c,æ‰¾åˆ°å¦‚ä¸‹å†…å®¹å¹¶ä¿®æ”¹ 1234567891011121314151617181920212223242526/* parse options and open all input/output files */ ret = ffmpeg_parse_options(argc, argv); if (ret &lt; 0){ // exit_program(1); return 1; } if (nb_output_files &lt;= 0 &amp;&amp; nb_input_files == 0) { show_usage(); av_log(NULL, AV_LOG_WARNING, &quot;Use -h to get full help or, even better, run 'man %s'\\n&quot;, program_name); // exit_program(1); return 1; } /* file converter / grab */ if (nb_output_files &lt;= 0) { av_log(NULL, AV_LOG_FATAL, &quot;At least one output file must be specified\\n&quot;); //exit_program(1); return 1; } if (nb_input_files == 0) { av_log(NULL, AV_LOG_FATAL, &quot;At least one input file must be specified\\n&quot;); //exit_program(1); return 1; } æŠŠä¸‹é¢çš„å†…å®¹,æ·»åŠ åˆ°static void ffmpeg_cleanup(int ret)å‡½æ•°æœ«å°¾ 123456ffmpeg_exited = 1;nb_filtergraphs = 0;nb_output_files = 0;nb_output_streams = 0;nb_input_files = 0;nb_input_streams = 0; ä¸ºäº†è·å–åˆ°ffmpegçš„å¤„ç†è¿›åº¦ä¿®æ”¹log_callback_nullå‡½æ•°å†…å®¹ä¸º 12345678910111213141516static void log_callback_null(void *ptr, int level, const char *fmt, va_list vl){ static int print_prefix = 1; static int count; static char prev[1024]; char line[1024]; static int is_atty; av_log_format_line(ptr, level, fmt, vl, line, sizeof(line), &amp;print_prefix); strcpy(prev, line); if (level &lt;= AV_LOG_WARNING){ XLOGE(&quot;%s&quot;, line); }else{ XLOGD(&quot;%s&quot;, line); callJavaMethod(line);// è°ƒç”¨javaæ–¹æ³•,åé¦ˆè¿›åº¦ }} å¹¶å†mainå‡½æ•°çš„å¼€å§‹å¤„æ·»åŠ  1av_log_set_callback(log_callback_null); å†æ‰“å¼€cmdutils.c,å¯¹exit_programè¿›è¡Œä¿®æ”¹,åˆ«å¿˜è®°ä¿®æ”¹å¤´æ–‡ä»¶ä¸­çš„exit_program 1234int exit_program(int ret){ return ret;} ç„¶ååˆ›å»ºä¸€ä¸ªåä¸ºffmpegJni.cçš„æ–‡ä»¶å’Œå®ƒçš„å¤´æ–‡ä»¶ffmpegJni.h 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374##include &quot;logjni.h&quot;##include &quot;ffmpegJni.h&quot;##include &lt;stdlib.h&gt;##include &lt;stdbool.h&gt;int main(int argc, char **argv);static JavaVM *jvm = NULL;static jclass m_clazz = NULL;static jclass m_jobj = NULL;static JNIEnv *m_env = NULL;// æ³¨æ„è¿™é‡Œçš„Java_com_chaosgoo_ffmpegproject_ffmpegJni_main,è¯·æŒ‰ç…§ä½ çš„é¡¹ç›®åç§°è¿›è¡Œä¿®æ”¹JNIEXPORT jint JNICALL Java_com_chaosgoo_ffmpegproject_ffmpegJni_main(JNIEnv *env, jclass obj, jobjectArray commands){ (*env)-&gt;GetJavaVM(env, &amp;jvm); //è·å–JVMè™šæ‹Ÿæœº jclass clazz = (*env)-&gt;GetObjectClass(env,obj); //è·å–è°ƒç”¨æ­¤æ–¹æ³•çš„javaç±» m_jobj = obj; m_clazz = (*env)-&gt;NewGlobalRef(env, clazz); //å°†è¿™ä¸ªç±»èµ‹å€¼ç»™m_clazz m_env = env; //å¤åˆ¶åˆ°å…¨å±€å˜é‡m_env int argc = (*env)-&gt;GetArrayLength(env, commands); char *argv[argc]; int i; int result = 0; for (i = 0; i &lt; argc; i++) { jstring js = (jstring)(*env)-&gt;GetObjectArrayElement(env, commands, i); argv[i] = (char *)(*env)-&gt;GetStringUTFChars(env, js, 0); } LOGD(&quot;----------begin---------&quot;); int ret = main(argc, argv); ffmpegJniDone(1); return ret;}void callJavaMethod(char *ret){ int ss = 0; char *q = strstr(ret, &quot;time=&quot;); if (q != NULL) { //LOGE(&quot;é‡åˆ°time=&quot;); char str[14] = {0}; strncpy(str, q, 13); int h = (str[5] - '0') * 10 + (str[6] - '0'); int m = (str[8] - '0') * 10 + (str[9] - '0'); int s = (str[11] - '0') * 10 + (str[12] - '0'); ss = s + m * 60 + h * 60 * 60; } else { return; } if (m_clazz == NULL) { LOGE(&quot;---------------m_clazz isNULL---------------&quot;); return; } //è·å–æ–¹æ³•ID (I)VæŒ‡çš„æ˜¯æ–¹æ³•ç­¾å é€šè¿‡javap -s -public FFmpegCmd å‘½ä»¤ç”Ÿæˆ jmethodID methodID = (*m_env)-&gt;GetMethodID(m_env, m_clazz, &quot;onProgress&quot;, &quot;(I)V&quot;); if (methodID == NULL) { LOGE(&quot;---------------methodID isNULL---------------&quot;); return; } LOGE(&quot;---------------Call Method---------------&quot;); //è°ƒç”¨è¯¥javaæ–¹æ³• (*m_env)-&gt;CallVoidMethod(m_env,m_jobj, methodID, ss);}void ffmpegJniDone(int i){ jmethodID methodID = (*m_env)-&gt;GetMethodID(m_env, m_clazz, &quot;onFinish&quot;, &quot;(I)V&quot;); (*m_env)-&gt;CallVoidMethod(m_env,m_jobj, methodID, i); // å®Œæˆä»»åŠ¡åçš„è°ƒç”¨javaæ–¹æ³•,å‘ŠçŸ¥å…¶å·²ç»å®Œæˆ} logjni.hæ˜¯ä¸ºäº†å°†ffmpegè‡ªèº«çš„è¾“å‡ºå˜ä¸ºAndroid Logè¾“å‡ºçš„ä¸€ä¸ªå¤´æ–‡ä»¶,å†…å®¹ä¸º 12345678910111213141516##ifdef ANDROID##include &lt;android/log.h&gt;##ifndef LOG_TAG##define MY_TAG &quot;MYTAG&quot;##define AV_TAG &quot;AVLOG&quot;##endif##define LOGE(format, ...) __android_log_print(ANDROID_LOG_ERROR, MY_TAG, format, ##__VA_ARGS__)##define LOGD(format, ...) __android_log_print(ANDROID_LOG_DEBUG, MY_TAG, format, ##__VA_ARGS__)##define XLOGD(...) __android_log_print(ANDROID_LOG_INFO,AV_TAG,__VA_ARGS__)##define XLOGE(...) __android_log_print(ANDROID_LOG_ERROR,AV_TAG,__VA_ARGS__)##else##define LOGE(format, ...) printf(MY_TAG format &quot;\\n&quot;, ##__VA_ARGS__)##define LOGD(format, ...) printf(MY_TAG format &quot;\\n&quot;, ##__VA_ARGS__)##define XLOGE(format, ...) fprintf(stdout, AV_TAG &quot;: &quot; format &quot;\\n&quot;, ##__VA_ARGS__)##define XLOGI(format, ...) fprintf(stderr, AV_TAG &quot;: &quot; format &quot;\\n&quot;, ##__VA_ARGS__)##endif åˆ°è¿™ä¸€æ­¥å°±å¯ä»¥æ‰§è¡Œndk-buildå‘½ä»¤è¿›è¡Œç¼–è¯‘äº†.cmd è¿›å…¥ä¹‹å‰åˆ›å»ºçš„jniæ–‡ä»¶å¤¹,è¾“å…¥ndk-build (åˆ«å¿˜è®°é…ç½®å¥½ndkçš„ç¯å¢ƒå˜é‡)å,å°±ä¼šè‡ªåŠ¨çš„è¿›è¡Œç¼–è¯‘æ“ä½œ, å¦‚ä¾ç„¶æç¤ºå„ç§ç¼ºå°‘æ–‡ä»¶,å¯ä»¥åˆ°ä¹‹å‰è§£å‹å‡ºçš„ffmpegæ–‡ä»¶å¤¹é‡Œé¢å»å¯»æ‰¾åˆ°ä»–ä»¬,ç„¶åå¤åˆ¶åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸­æœ€å,ç¼–è¯‘å®Œæˆå,å°±ä¼šå¤šå‡ºä¸€ä¸ªlibffmpegjni.soæ–‡ä»¶æ¥ä¸‹æ¥å°±æ˜¯Androidç«¯è¿›è¡Œè°ƒç”¨äº†åˆ›å»ºä¸€ä¸ªFFmpegJniç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657public class FFmpegJni { private float totalDecodeTime = 0f; private ProgressBar progressBar; private String fileInPath; private String fileOutPath; MediaPlayer mediaPlayer = new MediaPlayer(); public FFmpegJni(String inPath, String outPath, ProgressBar progressBar){ fileInPath = inPath; fileOutPath = outPath; this.progressBar = progressBar; } // åˆå§‹åŒ–ç›¸å…³è®¾å®š public void init(){ try{ mediaPlayer.setDataSource(fileInPath); mediaPlayer.prepare(); totalDecodeTime = mediaPlayer.getDuration()/1000; Log.d(&quot;ffmpeg&quot;, &quot;init: &quot;+totalDecodeTime); }catch (Exception e){ e.printStackTrace(); } } //æ‰§è¡Œè§£ç æ“ä½œ public void decode(){ new Thread(new Runnable() { @Override public void run() { String[] cmd = {&quot;ffmpeg&quot;, &quot;-i&quot;,fileInPath, &quot;-f&quot;, &quot;s16be&quot; ,&quot;-ar&quot; ,&quot;44100&quot; ,&quot;-acodec&quot;,&quot;pcm_s16le&quot;, fileOutPath}; main(cmd); } }).start(); } // æ›´æ–°è¿›åº¦æ¡ public void onProgress(int second) { Log.d(&quot;ffmpeg&quot;, &quot;onProgress: &quot;+ ((second/this.totalDecodeTime) * 100)); progressBar.setProgress((int)((second/this.totalDecodeTime) * 100)); } // NDK å‡½æ•° public native int main(String[] commands); // å¯¼å…¥soæ–‡ä»¶ static { System.loadLibrary(&quot;avutil&quot;); System.loadLibrary(&quot;swresample&quot;); System.loadLibrary(&quot;avcodec&quot;); System.loadLibrary(&quot;avformat&quot;); System.loadLibrary(&quot;swscale&quot;); System.loadLibrary(&quot;avfilter&quot;); System.loadLibrary(&quot;avdevice&quot;); System.loadLibrary(&quot;ffmpegjni&quot;); }} ç„¶åå†mainacitivityä¸­è°ƒç”¨å³å¯,FFmpegJniçš„mainå‡½æ•°æ¥æ”¶å‘½ä»¤. å‚è€ƒèµ„æ–™ FFmpeg å®˜æ–¹æ–‡æ¡£ Android NDK å®˜æ–¹æŒ‡å—","link":"/2018/02/03/FFmpeg-on-Android/"},{"title":"Friday Ink ä»Šå¤©æ˜¯å‘¨äº”å—","text":"ä»Šå¤©æ˜¯å‘¨äº”å— 2025å¹´11æœˆ29æ—¥æ›´æ–°ï¼šæ ¹æ®è¯»è€…çš„åé¦ˆå’Œé•¿è¾¾ä¸€å¹´çš„å®æµ‹ï¼Œæˆ‘è¡¥å……äº†å…³äº SSD1607 ä¸ SSD1681 å±å¹•é©±åŠ¨çš„åŠŸè€—å¯¹æ¯”ç»†èŠ‚ï¼Œä»¥åŠ Rust å›ºä»¶å¼€å‘çš„æ›´å¤šèƒŒæ™¯ã€‚ å‰è¨€è¿™æ˜¯ä¸€ä¸ªæ‹–äº†å¾ˆä¹…çš„é¡¹ç›®, æœ‰å¾ˆå¤šåºŸæ¡ˆ. éš”ä¸€æ®µæ—¶é—´æƒ³èµ·æ¥æœ‰è¿™å›äº‹æƒ…,äºæ˜¯ç¼ç¼è¡¥è¡¥, æ¨å€’å¾ˆå¤šæ¬¡. æ—§è®¾è®¡å›é¡¾MCUä»æœ€å¼€å§‹ä½¿ç”¨çš„æ˜¯ESP32, ä¹Ÿç”¨è¿‡ESP32C3, æœ€åä½¿ç”¨æ˜¯CH582F. èµ·åˆä»–æœ‰å¾ˆå¤šåŠŸèƒ½,æ¯”å¦‚ç§»æ¤äº†ä¸€ä¸ªluaè§£æå™¨, è¿™æ ·å°±å¯ä»¥åŠ¨æ€çš„åŠ è½½luaè„šæœ¬, ä»¥æ˜¾ç¤ºä¸åŒçš„å†…å®¹. ä¹Ÿå¼•å…¥è¿‡FreeType, ç”¨æ¥è§£æ.ttfå­—ä½“, ä»¥å…·æœ‰æ˜¾ç¤ºä¸åŒå°ºå¯¸æ–‡å­—çš„æ•ˆæœ. å°½ç®¡åºŸæ¡ˆçš„å®Œæˆåº¦å·²ç»ç›¸å½“é«˜äº†.ä½†æ˜¯å®æµ‹ç»­èˆªè¡¨ç°ååˆ†ç³Ÿç³•. ä¸€æƒ³åˆ°ä»–è¦å……ç”µå°±è®©æˆ‘æ„Ÿåˆ°æ— å¥ˆ. ç»ˆäºæœ‰ä¸€å¤©çœ‹åˆ°äº†CH582Fè¿™æ¬¾èŠ¯ç‰‡. å”¤èµ·äº†é‡æ–°å®ç°Friday Inkçš„å¿µå¤´. æŸ¥äº†ä¸€äº›èµ„æ–™å, é‚£ä¸€åˆ»æˆ‘è§‰å¾—è¿™å°±æ˜¯æˆ‘è¦æ‰¾çš„èŠ¯ç‰‡. QFN28å°è£…, çº½æ‰£ç”µæ± å°±èƒ½é©±åŠ¨, äºŒè¯ä¸è¯´æ–¥å·¨èµ„12å…ƒä¹°å…¥å¼€å‘æ¿ç€æ‰‹å¼€å‘. åŸºç¡€å‚æ•°ç¡¬ä»¶å‚æ•° ä¸»æ§ä¸ºCH582F 32KB Ram + 448KB Flash æ—¶é’ŸèŠ¯ç‰‡æ˜¯PCF8563T å±å¹•ä¸º1.54è‹±å¯¸å¢¨æ°´å± SSD1607 DCDCèŠ¯ç‰‡é€‰ç”¨SGM6603-3.3YN6G CR2032ç”µæ± æä¾›ç”µæº æ³¨: å½“ä½¿ç”¨å±å¹•é©±åŠ¨ICä¸ºSSD1607æ—¶å€™, éœ€è¦ç„Šæ¥SGM6603, å› ä¸ºéœ€è¦å€ŸåŠ©SGM6603æ¥å½»åº•æ–­å¼€å¢¨æ°´å±ä¾›ç”µ è¿™å—å±å¹•æ˜¯æˆ‘ä»é—²é±¼ä¸Šæ¡æ¥çš„, ä¹°å›æ¥å‘ç°å’Œåˆå®™9.9å—é’±çš„å¢¨æ°´å±ä¸å°ä¸€æ ·, é©±åŠ¨ICä¹Ÿä¸€æ ·. åœ¨å®é™…ä½¿ç”¨æ—¶å€™,ä¼‘çœ çŠ¶æ€ä¸‹åŠŸè€—å§‹ç»ˆé™ä½ä¸ä¸‹æ¥. äºæ˜¯æˆ‘ä¸€æ€’ä¹‹ä¸‹æ€’ä¸€ä¸‹äº†, åŠ äº†ä¸ªDCDCæ¥ç®¡ç†å¢¨æ°´å±çš„ä¾›ç”µ. æœ‰æ•ˆçš„å°†ä»–çš„ä¼‘çœ ç”µæµä»70Î¼Aé™ä½åˆ°äº†3Î¼A å½“ä½¿ç”¨å±å¹•é©±åŠ¨ICä¸ºSSD1681æ—¶å€™, ä¸éœ€è¦ç„Šæ¥SGM6603, æ­¤æ—¶ä½¿ç”¨0æ¬§ç”µé˜»çŸ­æ¥SGM6603çš„Pin5å’ŒPin6, å¹¶ä¸”æ— éœ€ç„Šæ¥SGM6603ä¸‹æ–¹4.7Î¼Hçš„ç”µæ„Ÿ è¿™æ˜¯ç›®å‰ä¸­æ™¯å›­åœ¨å”®çš„é»‘ç™½åŒè‰²ç”µå­å¢¨æ°´å±, æ˜¾ç¤ºæ•ˆæœæ¯”æˆ‘åœ¨å’¸é±¼ä¸Šä¹°çš„æ•ˆæœå¥½å¾ˆå¤š. è™½ç„¶åˆ†è¾¨ç‡åŒä¸º200x200,ä½†å°±æ˜¯æ•ˆæœæ¸…æ™°, å¯¹æ¯”åº¦ä¹Ÿå¥½, ç¼ºç‚¹å°±æ˜¯æ¯”æˆ‘å’¸é±¼ä¸Š5å—é’±ä¹°çš„è´µ. ç”±äºèƒ½å¤Ÿæ­£å¸¸ä¼‘çœ ,æ‰€ä»¥ä¸éœ€è¦DCDCäº†, åŠŸè€—è¡¨ç°ç¨å¾®æ¯”SSD1607ç‰ˆæœ¬å¥½ä¸€ä¸¢ä¸¢ å°ºå¯¸ 34mmÃ—39mmÃ—8mm è€—ç”µä¿¡æ¯ ä¼‘çœ çŠ¶æ€ä¸‹â‰ˆ3Î¼A åˆ·æ–° 10~20mA, åˆ·æ–°å®Œæ¯•åä¼šç«‹åˆ»è¿›å…¥ä¼‘çœ  ç”¨çº½æ‰£ç”µæ± ä½œä¸ºè¾“å…¥,ç„¶åæ¥ä¸Šåˆå®™çš„ç”µæµè¡¨, 110å°æ—¶åç»Ÿè®¡ä¿¡æ¯å¦‚ä¸‹: Rustå›ºä»¶å¼€å‘å›ºä»¶æœ€å¼€å§‹æ˜¯ä½¿ç”¨Cå¼€å‘çš„, è€Œä¸”å®Œæˆåº¦ä¹Ÿæ˜¯å¾ˆé«˜, åªå·®ä¼‘çœ å’Œè“ç‰™éƒ¨åˆ†äº†. ç»“æœè¿™æ—¶å€™è«åå…¶å¦™çš„åŠ äº†ä¸€ä¸ªRuståµŒå…¥å¼çš„ç¾¤, ç¾¤é‡Œé¢æœ‰ä¸ªä½¬åˆæ­£å¥½åšäº†CH582Fçš„Rusté€‚é….äºæ˜¯å†³å®šè¯•è¯•Rustæ¥å¼€å‘.æ˜¾ç¤ºéƒ¨åˆ†ç›´æ¥ç”¨äº†bindgenæŠŠu8g2ç»‘è¿‡æ¥, bindå°±å®Œäº‹.ä¼‘çœ éƒ¨åˆ†, ch58x-halæ²¡æœ‰å°è£…, æ‰€ä»¥è¿™æ¬¡åªèƒ½æ‰‹æ“å¯„å­˜å™¨, äºæ˜¯å¯¹ç€å®˜æ–¹çš„ä¼‘çœ ä»£ç , äººè‚‰ç¿»è¯‘äº†èµ·æ¥. å¥½åœ¨æœ€åèƒ½å·¥ä½œ(å½“ç„¶èƒ½å·¥ä½œ, æ¯•ç«Ÿæˆ‘åªæ˜¯ç¿»è¯‘äº†ä¸€ä¸‹) Friday Inkçš„æ ¸å¿ƒåŠŸèƒ½åªè¦å¯åŠ¨æ—¶å€™æ£€æµ‹ä¸€ä¸‹æœ‰æ²¡æœ‰æŒ‰ä¸‹æŒ‰é’®,æŒ‰ä¸‹å°±æ˜¾ç¤ºä¸€å¼ å›¾ç‰‡, å†å»æ‰«æå‘¨è¾¹çš„è“ç‰™å¹¿æ’­,æ‰«æåˆ°ç¬¦åˆæ—¶é—´åè®®çš„å°±è®¾ç½®æœ¬åœ°RTCæ‰§è¡Œé‡å¯.å¦‚æœæ²¡æœ‰æŒ‰ä¸‹æŒ‰é’®å°±æ£€æµ‹ä»Šå¤©æ˜¯ä¸æ˜¯æ˜ŸæœŸäº”, æ‰§è¡Œåˆ·å±, æ­¤æ—¶è®¾å¤‡ç«‹åˆ»ä¼‘çœ . ç›´åˆ°ç¬¬äºŒå¤©00:00å”¤é†’. é™„åŠ è¯´æ˜:åœ¨315å¤©åçš„2025å¹´6æœˆ24æ—¥, æˆ‘æ‰‹ä¸Šä½¿ç”¨SSD1607ç‰ˆæœ¬çš„Friday Inkæ²¡ç”µäº†, ç†è®ºä¸ŠSSD1681ç‰ˆæœ¬åŠŸè€—è¡¨ç°æ›´åŠ ä¼˜å¼‚, ç»è¿‡åé¦ˆç»­èˆªå¤§æ¦‚åœ¨400å¤©. Q&amp;AQ: æ—¶é—´æ ¡å‡†æ—¶å€™å¡åœ¨æ ¡å‡†é¡µæ€ä¹ˆåŠA: æ¨èæå‰å‘é€æ—¶é—´å¹¿æ’­, è®©æ‰‹æœºå’Œè£…ç½®è¶³å¤Ÿæ¥è¿‘. ç„¶åè£…ç½®è¿›å…¥æ ¡å‡†, å¹¶åœ¨å‘ç°20Såæœªèƒ½è‡ªåŠ¨é€€å‡ºæ ¡å‡†æˆ–æŒ‰é’®æ— æ³•å¼ºåˆ¶é€€å‡ºæ ¡å‡†æ—¶, å–ä¸‹ç”µæ± , é‡æ–°å®‰è£…ç”µæ± .Q: å°ç¨‹åºå·²ç»æ— æ³•ä½¿ç”¨A: æ—¶é—´æ ¡å‡†åè®®å·²ç»å…¬å¼€, è¿˜è¯·å„ä½å¤åˆ»è€…ä½¿ç”¨è“ç‰™å¼€å‘æ¿å‘å¸ƒç¬¦åˆåè®®çš„å¹¿æ’­è¿›è¡Œæ—¶é—´åŒæ­¥ç¤¾åŒºå¤åˆ»å±•ç¤ºå¾ˆé«˜å…´åœ¨é¡¹ç›®å¼€æºä¹‹åæœ‰å°ä¼™ä¼´åšäº†å‡ºæ¥, è¿˜åŠ ä¸Šäº†ä¸€ä¸ªéº¦é‡‘å¡”çš„å¤–å£³. é¡¹ç›®é“¾æ¥GitHubé¡¹ç›®åœ°å€ç«‹åˆ›å¼€æºå¹¿åœº","link":"/2024/07/29/Friday-Ink/"},{"title":"åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬ä¸€ç« ","text":"åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬ä¸€ç«  åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬äºŒç«  åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬ä¸‰ç«  å‰è¨€ (2025å¹´11æœˆ é‡åˆ¶ç‰ˆè¯´æ˜):è¿™ç¯‡æ–‡ç« çš„åˆç‰ˆæˆ‘æ›¾å‘å¸ƒäºç¬¬ä¸‰æ–¹å¹³å°ï¼ˆç®€ä¹¦+Bilibiliï¼‰ï¼Œå¹¶ç´¯è®¡è·å¾—äº†50,000+ æ¬¡é˜…è¯» å’Œå¤§é‡å¼€å‘è€…çš„åé¦ˆã€‚ä¸ºäº†æä¾›æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œæˆ‘å¯¹æ–‡ç« æ’ç‰ˆå’Œéƒ¨åˆ†å†…å®¹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¹¶å°†å…¶ç‹¬å®¶å‘å¸ƒåœ¨æ­¤ä¸ªäººåšå®¢ ä¸çŸ¥é“å¤šä¹…å‰çœ‹åˆ°äº†MIUIæ›´æ–°äº†â€åŠ¨æ€å­—ä½“ç³»ç»Ÿâ€œåŠŸèƒ½,ä¸è¿‡å½“æ—¶æ²¡å¤ªåœ¨æ„(æ¯•ç«Ÿæˆ‘ç”¨çš„ä¹Ÿä¸æ˜¯MIUI,å“ˆå“ˆå“ˆ,ä¸è¿‡ç¡®å®æŒºæ–¹ä¾¿çš„),æ¼”ç¤ºè§†é¢‘é‡Œé¢å±•ç¤ºäº†éšæ„è°ƒèŠ‚å­—ä½“ç²—ç»†çš„åŠŸèƒ½,åæ¥çŸ¥é“è¿™ä¸ªå‚æ•°å«åšå­—é‡(zhongç¬¬å››å£°). ç„¶ååˆæœ‰ä¸€æ¬¡å»Material.ioæ—¶å€™,çœ‹è§äº†é¦–é¡µçš„Material Youæ¦‚å¿µè§†é¢‘æ‰‹æœºè§£é”ä»¥å,ç³»ç»Ÿæ—¶é—´çš„å­—ä½“ç”±ç»†å˜ç²—.å’Œä¸Šé¢MIUIåŠ¨æ€å­—ä½“ç³»ç»Ÿè°ƒèŠ‚å­—é‡çš„æ—¶å€™æ•ˆæœååˆ†ç›¸ä¼¼. è€æ—©å°±å¬è¯´äº†LVGLçš„å¤§å,ä½†æ˜¯ä¸€ç›´æ²¡æœ‰è¡ŒåŠ¨èµ·æ¥. åæ¥çœ‹è§ç¨šæ™–å›çš„Peakå’ŒFASTSHIFTçš„X-Track, ç¾¡æ…•æäº†.äºæ˜¯å†³å®šè¿™æ¬¡ä¸€å®šè¦è¯•è¯•LVGL,çœ‹çœ‹ç”¨èµ·æ¥åˆ°åº•æ˜¯å•¥æ„Ÿè§‰. ä¹‹å‰è‡ªå·±æé‚£çæ£é¼“è¿‡ä¸€é˜µå­çš„GUI,ç»“æœå˜›,ç»“æœå°±æ˜¯å°±å¼ƒå‘äº†. è¿™æ¬¡æ‰“ç®—ç›´æ¥ä¸ŠLVGLè¿™ç§æˆç†Ÿçš„GUIæ–¹æ¡ˆäº†,è€Œæ°å¥½LVGLæ˜¯æ”¯æŒFreeTypeçš„,å€ŸåŠ©FreeTypeå°±å¯ä»¥ç›¸å¯¹è½»æ¾çš„å®ç°ä¸Šé¢çš„å­—é‡åŠ¨ç”». ä»€ä¹ˆæ˜¯FreeTypeFreeTypeåº“æ˜¯ä¸€ä¸ªå®Œå…¨å…è´¹ï¼ˆå¼€æºï¼‰çš„ã€é«˜è´¨é‡çš„ä¸”å¯ç§»æ¤çš„å­—ä½“å¼•æ“ ç›®å‰ä¸»æµçš„å±å¹•å‡éƒ½æ˜¯ç”±åƒç´ ç‚¹æ„æˆ,ä¸èƒ½ç›´æ¥æ˜¾ç¤ºçŸ¢é‡å›¾,æ‰€ä»¥å°±éœ€è¦å­—ä½“å¼•æ“å°†å­—ä½“çš„çŸ¢é‡æ•°æ®è½¬æ¢ä¸ºä½å›¾æ•°æ®,ç„¶ååœ¨å±å¹•ä¸Šæ˜¾ç¤º â€œç‚¹ç¯â€ å‡ºæ¥. Variable Fontåˆæ˜¯ä»€ä¹ˆå‚¨å­˜è½®å»“å˜åŒ–æ•°æ®çš„å¯å˜å­—ä½“ï¼Œåœ¨åˆå§‹å­—å½¢è½®å»“çš„åŸºç¡€ä¸Šè‡ªåŠ¨ç”Ÿæˆä¸°å¯Œçš„å˜åŒ–é€ å‹ï¼Œä½¿ç”¨æˆ·å¯ä»¥è‡ªç”±è°ƒæ•´æ–‡å­—çš„å¤–è§‚ã€‚æ¯ç‡¥çš„æè¿°ä¸å¦‚ç›´æ¥ä¸Šæ‰‹ä½“éªŒä¸€ä¸‹,V-Fontsæ˜¯ä¸€ä¸ªåœ¨çº¿ä½“éªŒå¯å˜å­—ä½“çš„ç½‘ç«™,æ‹–åŠ¨æ»‘å—å°±å¯ä»¥ä¿®æ”¹å­—ä½“åœ¨å¯¹åº”è½´ä¸Šçš„å€¼,å³ä¸Šè¿°çš„è‡ªç”±è°ƒæ•´æ–‡å­—çš„å¤–è§‚. å‡†å¤‡å·¥ä½œå‡†å¤‡å·¥ä½œçš„å‡†å¤‡å·¥ä½œä¹‹å…ˆæŠŠVisual Studioè£…äº†å†è¯´ ä¸‹è½½LVGLæ¨¡æ‹Ÿå™¨æœ¬æ‰“ç®—å†å¼€ä¸€ç¯‡æ–‡ç« è¯´æ¨¡æ‹Ÿå™¨å®‰è£…çš„,é‡è£…çš„æ—¶å€™æ‰å‘ç°åŸæ¥ä¸€é”®å°±èƒ½å®‰è£…. (å¯èƒ½éœ€è¦ç§‘å­¦ä¸Šç½‘)ç›´æ¥å¤åˆ¶gitå‘½ä»¤å°±å®Œäº‹äº†,ä¸‹å®Œç‚¹å‡»LVGL.Simulator.slnç›´æ¥å¯åŠ¨. 1git clone --recurse-submodules https://github.com/lvgl/lv_sim_visual_studio.git å¯åŠ¨ä»¥åçœ‹åˆ°lvglè‡ªå¸¦çš„**lv_demo_widgets()**è¿è¡Œæ•ˆæœ. ä¸ºLVGLé…ç½®FreeTypeå¾—ç›Šäºlv_sim_visual_studioçš„å®Œæ•´æ€§,åˆšæ‰git clone â€“recurse-submodulesæ—¶å€™freetypeè¢«ä¸€å¹¶ä¸‹è½½äº†.æ‰€ä»¥ç°åœ¨æš‚æ—¶ä¸éœ€è¦é¢å¤–é…ç½®ä»€ä¹ˆå†…å®¹,ä½†æ˜¯åœ¨å…¶ä»–æƒ…å†µä¸‹è¿˜æ˜¯éœ€è¦æ‰‹åŠ¨çš„é…ç½®ä¸€ä¸‹LVGLçš„FreeTypeæ”¯æŒ.(æ¯”å¦‚åœ¨æ¿å­ä¸Šè·‘freetypeçš„æ—¶å€™) LVGLå†…ç½®çš„FreeType Demoå°†LVGL.Simulator.cppå†… 12345678910111213// ----------------------------------// Demos from lv_examples// ----------------------------------lv_demo_widgets(); // ok// lv_demo_benchmark();// lv_demo_keypad_encoder(); // ok// lv_demo_music(); // removed from repository// lv_demo_printer(); // removed from repository// lv_demo_stress(); // ok// ----------------------------------// LVGL examples// ---------------------------------- ä¿®æ”¹ä¸º 1234567891011121314// ----------------------------------// Demos from lv_examples// ----------------------------------// lv_demo_widgets(); // ok// lv_demo_benchmark();// lv_demo_keypad_encoder(); // ok// lv_demo_music(); // removed from repository// lv_demo_printer(); // removed from repository// lv_demo_stress(); // oklv_example_freetype_1();// ----------------------------------// LVGL examples// ---------------------------------- å¦‚æœä¸€åˆ‡é¡ºåˆ©,ç‚¹å‡»è¿è¡Œ.ä¼šçœ‹è§ä¸‹å›¾ ä¸‹é¢åˆ™æ˜¯lv_example_freetype_1çš„å†…å®¹,æˆ‘å·²ç»ä¸ºä»–æ·»åŠ äº†è¯¦luoç»†suoçš„ä¸­æ–‡æ³¨é‡Š lv_example_freetype_1.c1234567891011121314151617181920212223242526272829303132333435363738394041/** * ä½¿ç”¨FreeTypeåŠ è½½å­—ä½“ */void lv_example_freetype_1(void){ /* åˆ›å»ºå­—ä½“ç»“æ„ä½“ info */ static lv_ft_info_t info; /* FreeType ä½¿ç”¨ C standard æ–‡ä»¶ç³»ç»Ÿ, æ‰€ä»¥ä¸éœ€è¦ç›˜ç¬¦ */ /* ç›®å‰ç¨‹åºåœ¨Windowsä¸Šè¿è¡Œ, æ ¹ç›®å½•ä¸ºLVGL.Simulator.cæ‰€åœ¨æ–‡ä»¶å¤¹ */ // å¸Œæœ›ä½¿ç”¨çš„å­—ä½“çš„æ‰€åœ¨ä½ç½®,å³å®ƒçš„è·¯å¾„ info.name = &quot;./lvgl/examples/libs/freetype/arial.ttf&quot;; // å¸Œæœ›ç”Ÿæˆå­—ä½“çš„é«˜åº¦, è¿™é‡Œå«ä½œweightæ„Ÿè§‰æŒºå¥‡æ€ªçš„,weightåº”è¯¥æ˜¯å­—é‡çš„è‹±æ–‡ // [update-2021.12.17] ä½œè€…è¿™é‡Œæ˜¯ä¸€ä¸ªå¤±è¯¯,ä½†æ˜¯ä¸ºäº†å…¼å®¹æ€§å°±æ²¡æ›´æ­£ // [Issues](https://github.com/lvgl/lv_lib_freetype/issues/17) info.weight = 24; // å­—ä½“çš„é£æ ¼ info.style = FT_FONT_STYLE_NORMAL; // å­—ä½“æ–‡ä»¶æŒ‡é’ˆ info.mem = NULL; // åˆå§‹åŒ–å­—ä½“ if(!lv_ft_font_init(&amp;info)) { LV_LOG_ERROR(&quot;create failed.&quot;); } // ä¸ºä¸Šé¢çš„æ–°å­—ä½“åˆ›å»ºä¸€ä¸ªstyle static lv_style_t style; // åˆå§‹åŒ–style lv_style_init(&amp;style); // åº”ç”¨åˆšæ‰åˆ›å»ºçš„å­—ä½“åˆ°styleä¸Š lv_style_set_text_font(&amp;style, info.font); // è®¾ç½®styleçš„alignä¸ºå±…ä¸­ lv_style_set_text_align(&amp;style, LV_TEXT_ALIGN_CENTER); // ä¸ºä¸Šé¢çš„styleåˆ›å»ºä¸€ä¸ªlabelä»¥å±•ç¤º lv_obj_t * label = lv_label_create(lv_scr_act()); // ä¸ºlabelæ·»åŠ åˆšæ‰åˆ›å»ºçš„style lv_obj_add_style(label, &amp;style, 0); // è®¾ç½®labelçš„å†…å®¹ä¸ºHello world\\nI'm a font created with FreeType lv_label_set_text(label, &quot;Hello world\\nI'm a font created with FreeType&quot;); // å±…ä¸­label lv_obj_center(label);} è¿«äºarial.ttfä¸æ˜¯å¯å˜å­—ä½“,æ‰€ä»¥æˆ‘ä»¬è¶æ­¤æœºä¼šä¿®æ”¹ä¸€ä¸‹lv_example_freetype_1ä¸­ç”¨åˆ°çš„å­—ä½“,ç†Ÿæ‚‰ä¸‹ä½¿ç”¨å…¶ä»–å­—ä½“çš„æ–¹å¼. **Archivo-VF.ttf**æ˜¯ä¸€æ¬¾Open Font Licenseçš„å­—ä½“ç‚¹å‡»è¿™é‡Œå¯ä»¥ä¸‹è½½Archivo-VF.ttf å°†å…¶å¤åˆ¶åˆ°arial.ttfåŒçº§ç›®å½•,ç„¶åä¿®æ”¹ 1info.name = &quot;./lvgl/examples/libs/freetype/arial.ttf&quot;; ä¸º 1info.name = &quot;./lvgl/examples/libs/freetype/Archivo-VF.ttf&quot;; è¿è¡Œç»“æœå¦‚ä¸‹ å­—ä½“åœ¨çº¿å±•ç¤ºç‚¹å‡»è¿™é‡Œåœ¨çº¿ä½“éªŒArchivoVFå­—ä½“çš„å¯å˜å±æ€§ ArchivoVFçš„å¯å˜å±æ€§å¦‚ä¸‹ æœ€å°å­—é‡100 æœ€å¤§å­—é‡900 æœ€å°å®½åº¦62 æœ€å¤§å®½åº¦125 æ‹“å±•LVGLçš„FreeTypeæ”¯æŒç”±äºLVGLç›®å‰ç‰ˆæœ¬(8.10-dev)è¿˜æ²¡æœ‰å†…ç½®å¯å˜å­—ä½“å‚æ•°æ§åˆ¶,æ‰€ä»¥éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çš„ä¸ºå…¶æ·»åŠ è¿™éƒ¨åˆ†å†…å®¹. æ·»åŠ æ”¯æŒå‰,é€Ÿè§ˆä¸‹ä¿®æ”¹å¯å˜å‚æ•°çš„æ–¹å¼åŠå…¶å•°å—¦çš„æ³¨é‡Š(éœ€è¦ä½¿ç”¨å¯å˜å­—ä½“è¿›è¡Œæ“ä½œ,å¦åˆ™æ— æ³•æ­£å¸¸è¿è¡Œ(åŒ…æ‹¬ä¸é™äºå´©æºƒä»¥åŠå´©æºƒ),æµ‹è¯•ç”¨çš„å­—ä½“æ–‡ä»¶ä¸ºArchivo-VF,å¯åœ¨å‰é¢ä¸€èŠ‚æœ«å°¾è·å–åˆ°) foo.c1234567891011121314151617181920212223242526272829303132333435363738394041// faceçš„ç±»å‹ä¸ºFT_FaceFT_Error error;FT_MM_Var *amaster = nullptr;// è·å–å¯å˜å‚æ•°error = FT_Get_MM_Var(face, &amp;amaster);printf(&quot;error %d\\n&quot;, error);// å¯å˜å‚æ•°æ•°é‡(æ¯ä¸€ä¸ªå¯å˜å‚æ•°è¢«ç§°ä¸ºä¸€ä¸ªaxis(è½´)))printf(&quot;amaster-&gt;axis=%d\\n&quot;, (amaster)-&gt;num_axis);// æ³¨æ„:ä¸Šé¢æä¾›çš„Archivo-VFæ–‡ä»¶åªæœ‰2ä¸ªå¯å˜è½´Weightå’ŒWidth// è€Œamaster-&gt;axisæ˜¯ä¸€ä¸ªæŒ‡å‘å¯å˜è½´æ•°ç»„é¦–ä½æ•°æ®çš„æŒ‡é’ˆ// å¯å˜å‚æ•°çš„åç§°id,åœ¨fontæ–‡ä»¶å†…è¡¨'name'çš„idprintf(&quot;amaster-&gt;axis-&gt;strid=%u\\n&quot;, amaster-&gt;axis-&gt;strid);// å¯å˜å‚æ•°çš„å†…ç½®æ ‡ç­¾printf(&quot;amaster-&gt;axis-&gt;tag=%lu\\n&quot;, amaster-&gt;axis-&gt;tag);// å¯å˜å‚æ•°çš„åç§°printf(&quot;amaster-&gt;axis-&gt;name=%s\\n&quot;, amaster-&gt;axis-&gt;name);// å¯å˜å‚æ•°çš„é»˜è®¤å€¼printf(&quot;amaster-&gt;axis-&gt;def=%ld\\n&quot;, amaster-&gt;axis-&gt;def);// å¯å˜å‚æ•°çš„æœ€å¤§å€¼ 16.16çš„å®šç‚¹æ•° amaster-&gt;axis-&gt;maximum / 65536; // é™¤ä»¥65536è½¬åŒ–printf(&quot;amaster-&gt;axis-&gt;maximum=%ld\\n&quot;, amaster-&gt;axis-&gt;maximum);// å¯å˜å‚æ•°çš„æœ€å°å€¼ 16.16çš„å®šç‚¹æ•° amaster-&gt;axis-&gt;minimum / 65536; // é™¤ä»¥65536è½¬åŒ–printf(&quot;amaster-&gt;axis-&gt;minimum=%ld\\n&quot;, amaster-&gt;axis-&gt;minimum);// ä»¥å‰ä¸ºäº†è·å¾—ä¸åŒç²—ç»†çš„å­—ä½“,å°±éœ€è¦å‡†å¤‡å­—é‡Thin,Bold,Normalè¿™æ ·ä¸åŒå­—é‡çš„æ–‡ä»¶// è€Œå¼•å…¥å¯å˜å­—ä½“å,ä¸€ä¸ªå­—ä½“æ–‡ä»¶å°±å†…ç½®äº†è¿™äº›Thin Bold Normalçš„å¯¹åº”å­—é‡.// æ­¤å¤„å‚¨å­˜äº†å½“å‰è½´å†…ç½®é»˜è®¤å€¼çš„æ•°é‡printf(&quot;amaster-&gt;num_namedstyles=%d\\n&quot;, amaster-&gt;num_namedstyles); // æ­¤å¤„æ‰“å°2// å¯å˜å‚æ•°çš„å†…ç½®num_namedstyleå€¼çš„æ•°ç»„,ä»¥å­—é‡ä¸ºä¾‹,é‡Œé¢å¯èƒ½å­˜æœ‰(100,200,300,400,500,600,700,800,900)printf(&quot;amaster-&gt;namedstyle-&gt;coords=%ld\\n&quot;, (signed long) amaster-&gt;namedstyle-&gt;coords);FT_Fixed coords[2] = { (amaster-&gt;axis)-&gt;maximum ,(amaster-&gt;axis + 1)-&gt;maximum};printf(&quot;amaster-&gt;(axis)-&gt;maximum=%ld\\n&quot;, (amaster-&gt;axis)-&gt;maximum /65536); // æ­¤å¤„æ‰“å°900,ç¬¦åˆå‰ä¸€èŠ‚çš„å›¾ä¸­å­—é‡æœ€å¤§å€¼printf(&quot;amaster-&gt;(axis+1)-&gt;maximum=%ld\\n&quot;, (amaster-&gt;axis+1)-&gt;maximum /65536); // æ­¤å¤„æ‰“å°125,ç¬¦åˆå‰ä¸€èŠ‚çš„å›¾ä¸­å­—å®½æœ€å¤§å€¼// è°ƒæ•´å¯å˜å‚æ•°çš„å€¼,æ­¤å¤„å°†å­—é‡å’Œå­—å®½éƒ½è®¾ç½®ä¸ºæœ€å¤§å€¼error = FT_Set_Var_Design_Coordinates(face, 2, coords);printf(&quot;FT_Set_Var_Design_Coordinates error %d\\n&quot;, error);printf(&quot;face num_faces: %ld\\n&quot;, face-&gt;num_faces);// ä½¿ç”¨å¯å˜å‚æ•°çš„å†…ç½®num_namedstyle// styleIndexéœ€è¦å°äºä¸Šè¿°num_namedstyles// error = FT_Set_Named_Instance(m_face, styleIndex);// printf(&quot;FT_Set_Named_Instance error %d\\n&quot;, error);FT_Done_MM_Var(m_library, amaster); ç”±äºç›®å‰ç‰ˆæœ¬çš„lvgl(8.1.0-dev)è¿˜æ²¡æœ‰æä¾›ç›¸åº”çš„API,æ‰€ä»¥éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä¸€äº›åœ°æ–¹.æ‰“å¼€lv_freetype.h,ä¿®æ”¹lv_ft_info_tå†…å®¹,å¦‚ä¸‹æ‰€ç¤º lv_freetype.h1234567typedef struct { const char * name; /* The name of the font file */ lv_font_t * font; /* point to lvgl font */ uint16_t weight; /* font weight */ uint16_t height; /* font size */ uint16_t style; /* font style */} lv_ft_info_t; è¯·æ³¨æ„: lv_ft_info_tæœ¬èº«å°±æœ‰ä¸€ä¸ªåä¸ºweightçš„uint16_tå±æ€§,ä½†æ˜¯åç»­è¢«ç”¨åˆ°äº†å­—ä½“çš„å®½é«˜å°ºå¯¸ä¸Š,æ‰€ä»¥ç°åœ¨æˆ‘ä»¬éœ€è¦æ·»åŠ heightå–ä»£åŸæ¥çš„weight,è®©weightæˆä¸ºåå‰¯å…¶å®çš„weight æ¨èå…ˆæŠŠweighté‡å‘½åä¸ºheight,å†æŠŠåç»­ç”¨åˆ°weightçš„åœ°æ–¹æ”¹æˆheight,å½“lv_example_freetype_1åˆèƒ½å¤ŸæˆåŠŸè¿è¡Œçš„æ—¶å€™å†æ·»åŠ â€uint16_t weight;â€ lv_font_fmt_ft_dsc_tä¹Ÿè¦æ·»åŠ å­—é‡(weight)æ‰“å¼€lv_freetype.c,ä¿®æ”¹lv_font_fmt_ft_dsc_tå†…å®¹,å¦‚ä¸‹æ‰€ç¤º lv_freetype.c1234567891011typedef struct {##if LV_FREETYPE_CACHE_SIZE &gt;= 0 void *face_id;##else FT_Size size;##endif lv_font_t *font; uint16_t style; uint16_t height; uint16_t weight;} lv_font_fmt_ft_dsc_t; è¿™é‡Œç›´æ¥æ·»åŠ â€uint16_t weight;â€å³å¯ å°†ä¿®æ”¹å­—é‡çš„ä»£ç æ·»åŠ åˆ°lv_freetype.cå†…get_glyph_dsc_cb_cacheä¸­ lv_freetype.c123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116static bool get_glyph_dsc_cb_cache(const lv_font_t * font, lv_font_glyph_dsc_t * dsc_out, uint32_t unicode_letter, uint32_t unicode_letter_next){ LV_UNUSED(unicode_letter_next); if(unicode_letter &lt; 0x20) { dsc_out-&gt;adv_w = 0; dsc_out-&gt;box_h = 0; dsc_out-&gt;box_w = 0; dsc_out-&gt;ofs_x = 0; dsc_out-&gt;ofs_y = 0; dsc_out-&gt;bpp = 0; return true; } lv_font_fmt_ft_dsc_t * dsc = (lv_font_fmt_ft_dsc_t *)(font-&gt;dsc); FTC_FaceID face_id = (FTC_FaceID)dsc-&gt;face_id; FT_Size face_size; struct FTC_ScalerRec_ scaler; scaler.face_id = face_id; scaler.width = dsc-&gt;height; scaler.height = dsc-&gt;height; scaler.pixel = 1; if(FTC_Manager_LookupSize(cache_manager, &amp;scaler, &amp;face_size) != 0) { return false; } FT_Face face = face_size-&gt;face; FT_MM_Var* amaster = NULL; FT_Error err = FT_Get_MM_Var(face, &amp;amaster); if (err) { LV_LOG_ERROR(&quot;FT_Get_MM_Var error:%d\\n&quot;, err); return err; } // åˆ«å¿˜è®°å·¦ç§»16ä½,è¿˜æœ‰ä¸€ä»¶äº‹,æˆ‘åªä¿®æ”¹äº†å­—é‡,æ²¡ä¿®æ”¹å­—å®½,æ‰€ä»¥æ•°ç»„å¤§å°æ˜¯1 FT_Fixed coords[1] = { dsc-&gt;weight&lt;&lt;16 }; err = FT_Set_Var_Design_Coordinates(face, 1, coords); if (err) { LV_LOG_ERROR(&quot;FT_Set_Var_Design_Coordinates error:%d\\n&quot;, err); return err; } FT_Done_MM_Var(library, amaster); FT_UInt charmap_index = FT_Get_Charmap_Index(face-&gt;charmap); FT_UInt glyph_index = FTC_CMapCache_Lookup(cmap_cache, face_id, charmap_index, unicode_letter); dsc_out-&gt;is_placeholder = glyph_index == 0; if(dsc-&gt;style &amp; FT_FONT_STYLE_ITALIC) { FT_Matrix italic_matrix; italic_matrix.xx = 1 &lt;&lt; 16; italic_matrix.xy = 0x5800; italic_matrix.yx = 0; italic_matrix.yy = 1 &lt;&lt; 16; FT_Set_Transform(face, &amp;italic_matrix, NULL); } if(dsc-&gt;style &amp; FT_FONT_STYLE_BOLD) { current_face = face; if(!get_bold_glyph(font, face, glyph_index, dsc_out)) { current_face = NULL; return false; } goto end; } FTC_ImageTypeRec desc_type; desc_type.face_id = face_id; desc_type.flags = FT_LOAD_RENDER | FT_LOAD_TARGET_NORMAL; desc_type.height = dsc-&gt;height; desc_type.width = dsc-&gt;height;##if LV_FREETYPE_SBIT_CACHE FT_Error error = FTC_SBitCache_Lookup(sbit_cache, &amp;desc_type, glyph_index, &amp;sbit, NULL); if(error) { LV_LOG_ERROR(&quot;SBitCache_Lookup error&quot;); return false; } dsc_out-&gt;adv_w = sbit-&gt;xadvance; dsc_out-&gt;box_h = sbit-&gt;height; /*Height of the bitmap in [px]*/ dsc_out-&gt;box_w = sbit-&gt;width; /*Width of the bitmap in [px]*/ dsc_out-&gt;ofs_x = sbit-&gt;left; /*X offset of the bitmap in [pf]*/ dsc_out-&gt;ofs_y = sbit-&gt;top - sbit-&gt;height; /*Y offset of the bitmap measured from the as line*/ dsc_out-&gt;bpp = 8; /*Bit per pixel: 1/2/4/8*/##else FT_Error error = FTC_ImageCache_Lookup(image_cache, &amp;desc_type, glyph_index, &amp;image_glyph, NULL); if(error) { LV_LOG_ERROR(&quot;ImageCache_Lookup error&quot;); return false; } if(image_glyph-&gt;format != FT_GLYPH_FORMAT_BITMAP) { LV_LOG_ERROR(&quot;Glyph_To_Bitmap error&quot;); return false; } FT_BitmapGlyph glyph_bitmap = (FT_BitmapGlyph)image_glyph; dsc_out-&gt;adv_w = (glyph_bitmap-&gt;root.advance.x &gt;&gt; 16); dsc_out-&gt;box_h = glyph_bitmap-&gt;bitmap.rows; /*Height of the bitmap in [px]*/ dsc_out-&gt;box_w = glyph_bitmap-&gt;bitmap.width; /*Width of the bitmap in [px]*/ dsc_out-&gt;ofs_x = glyph_bitmap-&gt;left; /*X offset of the bitmap in [pf]*/ dsc_out-&gt;ofs_y = glyph_bitmap-&gt;top - glyph_bitmap-&gt;bitmap.rows; /*Y offset of the bitmap measured from the as line*/ dsc_out-&gt;bpp = 8; /*Bit per pixel: 1/2/4/8*/##endifend: if((dsc-&gt;style &amp; FT_FONT_STYLE_ITALIC) &amp;&amp; (unicode_letter_next == '\\0')) { dsc_out-&gt;adv_w = dsc_out-&gt;box_w + dsc_out-&gt;ofs_x; } return true;} åˆå§‹åŒ–çš„æ—¶å€™,åˆ«å¿˜äº†lv_ft_font_init_cacheæ—¶å€™ä¼ é€’å­—é‡ä¿¡æ¯ lv_freetype.c123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263static bool lv_ft_font_init_cache(lv_ft_info_t * info){ lv_font_fmt_ft_dsc_t * dsc = lv_mem_alloc(sizeof(lv_font_fmt_ft_dsc_t)); if(dsc == NULL) return false; dsc-&gt;font = lv_mem_alloc(sizeof(lv_font_t)); if(dsc-&gt;font == NULL) { lv_mem_free(dsc); return false; } lv_memset_00(dsc-&gt;font, sizeof(lv_font_t)); lv_face_info_t * face_info = NULL; face_info = lv_mem_alloc(sizeof(lv_face_info_t) + strlen(info-&gt;name) + 1); if(face_info == NULL) { goto Fail; } face_info-&gt;mem = info-&gt;mem; face_info-&gt;size = info-&gt;mem_size; face_info-&gt;name = ((char *)face_info) + sizeof(lv_face_info_t); strcpy(face_info-&gt;name, info-&gt;name); dsc-&gt;face_id = face_info; dsc-&gt;height = info-&gt;height; dsc-&gt;weight = info-&gt;weight; dsc-&gt;style = info-&gt;style; /* use to get font info */ FT_Size face_size; struct FTC_ScalerRec_ scaler; scaler.face_id = (FTC_FaceID)dsc-&gt;face_id; scaler.width = info-&gt;height; scaler.height = info-&gt;height; scaler.pixel = 1; FT_Error error = FTC_Manager_LookupSize(cache_manager, &amp;scaler, &amp;face_size); if(error) { lv_mem_free(face_info); LV_LOG_ERROR(&quot;Failed to LookupSize&quot;); goto Fail; } lv_font_t * font = dsc-&gt;font; font-&gt;dsc = dsc; font-&gt;get_glyph_dsc = get_glyph_dsc_cb_cache; font-&gt;get_glyph_bitmap = get_glyph_bitmap_cb_cache; font-&gt;subpx = LV_FONT_SUBPX_NONE; font-&gt;line_height = (face_size-&gt;face-&gt;size-&gt;metrics.height &gt;&gt; 6); font-&gt;base_line = -(face_size-&gt;face-&gt;size-&gt;metrics.descender &gt;&gt; 6); FT_Fixed scale = face_size-&gt;face-&gt;size-&gt;metrics.y_scale; int8_t thickness = FT_MulFix(scale, face_size-&gt;face-&gt;underline_thickness) &gt;&gt; 6; font-&gt;underline_position = FT_MulFix(scale, face_size-&gt;face-&gt;underline_position) &gt;&gt; 6; font-&gt;underline_thickness = thickness &lt; 1 ? 1 : thickness; /* return to user */ info-&gt;font = font; return true;Fail: lv_mem_free(dsc-&gt;font); lv_mem_free(dsc); return false;} æ•ˆæœé¢„è§ˆä¸å‡ºæ„å¤–çš„è¯,éœ€è¦ä¿®æ”¹çš„åœ°æ–¹å·²ç»ä¿®æ”¹å®Œäº†,ç°åœ¨å›åˆ°lv_example_freetype_1ä¸Šæ¥.åˆå§‹åŒ–infoçš„æ—¶å€™æŠŠweightä¹Ÿç»™åˆå§‹åŒ–äº†. 12// ç”±äºå·²ç»çŸ¥é“äº†è¦ä½¿ç”¨çš„Archivo-VFæœ€å¤§å­—é‡900;info.weight = 900 ; ç„¶åè¿è¡Œå°±å¯ä»¥çœ‹åˆ°å­—é‡900çš„Archivo-VF ä¸‹å›¾æ˜¯åœ¨LVGLæ¨¡æ‹Ÿå™¨ä¸Šçš„è¿è¡Œæ•ˆæœã€‚ ä¸‹é›†é¢„å‘Š ç¯å¢ƒ1234Windows 10 Pro 18363.1556Microsoft Visual Studio Community 2019 16.6.2LVGL 8.1.1-devFreeType 2.11.0 å‚è€ƒèµ„æ–™ http://www.cppblog.com/cokecoffe/archive/2011/09/07/155264.html https://mingplusplus.com/tech/2014/09/13/freetype/ https://baike.baidu.com/item/freetype/6281493?fr=aladdin https://www.arphic.com.cn/2017/09/28/variable-font-%E5%8F%AF%E5%8F%98%E5%AD%97%E4%BD%93/ https://zh.wikipedia.org/wiki/FreeType é™„ä»¶","link":"/2021/12/12/FreeType-and-LVGL/"},{"title":"Other è®­ç»ƒä¸€ä¸ªè‡ªå·±çš„YOLO-tinyæ¨¡å‹","text":"è®­ç»ƒä¸€ä¸ªè‡ªå·±çš„YOLO-tinyæ¨¡å‹0x01 YOLOæ˜¯ä»€ä¹ˆYOLOæ˜¯ä¸€ä¸ªå®æ—¶ç›®æ ‡æ£€æµ‹ç³»ç»Ÿï¼Œé€šä¿—ç‚¹è¯´å°±æ˜¯åœ¨è¾“å…¥æ•°æ®(å›¾ç‰‡æˆ–è€…è§†é¢‘)ä¸­æŸ¥æ‰¾ç‰¹å®šçš„ç›®æ ‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè®©ä¸€ä¸ªä¸“é—¨è¯†åˆ«é¾™çš„YOLOæ¨¡å‹è§‚çœ‹ã€ŠæƒåŠ›çš„æ¸¸æˆã€‹ï¼Œåœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸€æ—¦ç”»é¢ä¸­å‡ºç°äº†é¾™ï¼ŒYOLOç³»ç»Ÿå°±ä¼šæ¿€åŠ¨åœ°ç”¨æ¡†æ¡†æ ‡è®°å‡ºç”»é¢ä¸­çš„é¾™ã€‚ ä¸ºä»€ä¹ˆæ˜¯YOLO-tinyå¤§æ¦‚æ˜¯è´«ç©·é™åˆ¶äº†æˆ‘çš„è¿ç®—é€Ÿåº¦å§ï¼ŒYOLO-tinyç”¨ç²¾ç¡®åº¦æ¢æ¥äº†é€Ÿåº¦å¿«å’Œæ€§èƒ½è¦æ±‚ä½çš„ä¼˜ç‚¹ï¼Œé€‚åˆç»ƒæ‰‹å’Œå­¦ä¹ æˆ–è€…åƒæˆ‘ä¸€æ ·ç©ä¸€ç©çš„ç”¨æˆ·ã€‚ 0x02 äº‹å‰å‡†å¤‡çš„å‡†å¤‡é¦–å…ˆä½ å¯èƒ½éœ€è¦ä¸€å°ç”µè„‘å§ï¼ˆå¯èƒ½æœ‰äº›ç”¨æˆ·ä¼šä½¿ç”¨æ ‘è“æ´¾ç”šè‡³æ˜¯è£…äº†linuxæ¨¡æ‹Ÿå™¨çš„å®‰å“ç”¨æˆ·æ¥è™å¾…è‡ªå·±å§ï¼‰ã€‚æˆ‘çš„CPUæ˜¯ä¸çŸ¥é“åº”è¯¥å«å•¥å››ä»£ESç‰ˆæœ¬çš„i7,æ˜¾å¡æ˜¯ä¸Šå¤æ—¶ä»£çš„GTX860Mï¼Œå†…å­˜åªæœ‰8Gï¼Œåå‰¯å…¶å®çš„ä½é…ç½®ç”¨æˆ·äº†ã€‚é¡ºä¾¿ä¸€æï¼Œè¿™å°ç”µè„‘ä¸€å¤©ä¼šç»¿å±Næ¬¡ï¼Œæˆ‘ä¼šä»ç°åœ¨å¼€å§‹è®°å½•ç»¿å±æ¬¡æ•°ï¼Œç›´åˆ°è¿™ç¯‡æ–‡ç« å†™å®Œï¼Œå†é¡ºå¸¦ä¸€æï¼Œè¿™æ˜¯äºŒå¥¶æœºï¼Œå› ä¸ºå¤§å¥¶æœºç”¨çš„AMDçŸ¿å¡ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨GPUæ¥åŠ é€ŸTensorFlowè®­ç»ƒã€‚å†å†é¡ºå¸¦ä¸€æï¼Œæ—è¾¹çš„å®¤å‹è™½ç„¶æ˜¯1070Tiï¼Œä½†æ˜¯ä»–éœ€è¦ç”¨ä»–çš„ç”µè„‘ç©æ¬¢ä¹æ–—åœ°ä¸»ï¼Œæ‰€ä»¥ä¸èƒ½å¸®æˆ‘è·‘è®­ç»ƒæ¨¡å‹ã€‚å›åˆ°ä¸»çº¿ä¸Šæ¥ï¼Œä½ è¿˜å¾—å…·æœ‰ä¸€äº›å¸¸è¯†â€¦ä¼šä½¿ç”¨æœç´¢å¼•æ“çš„é‚£ç§å¸¸è¯†ã€‚ 0x03 äº‹å‰å‡†å¤‡è¿™é‡Œå‡è®¾ä½ å·²ç»å®‰è£…å¥½äº†Pythonï¼Œå¹¶ä¸”å…·å¤‡äº†ä¸€äº›â€å¸¸è¯†â€åï¼Œä½ å°±å¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹äº†ã€‚ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä½¿ç”¨äº†Pythonçš„è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶ä¸”å®‰è£…äº†å¦‚ä¸‹åº“ ä¸‹è½½ https://raw.githubusercontent.com/qqwweee/keras-yolo3 é¡µé¢ä¸­çš„æ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨git cloneæˆ–è€…ç›´æ¥ç‚¹å‡»ä¸‹è½½ï¼Œç„¶åè§£å‹ã€‚ ä¸‹è½½ yolo-tinyçš„weightsæ–‡ä»¶ https://pjreddie.com/media/files/yolov3-tiny.weights, å¹¶æ”¾åˆ°ä¸Šä¸€æ­¥è§£å‹åçš„æ–‡ä»¶å¤¹ä¸­è¿›è¡Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥éœ€è¦ç”¨åˆ°çš„æ–‡ä»¶å·²ç»å‡†å¤‡äº†ä¸€åŠäº†ï¼Œå¦å¤–ä¸€åŠå°±æ˜¯è·‘æ¨¡å‹éœ€è¦ç”¨åˆ°çš„æ•°æ®ã€‚ 0x04 é…ç½®ç›¸å…³æ–‡ä»¶é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¹yolov3-tiny.cfgè¿›è¡Œç¼–è¾‘ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨[yolo]å’Œ[yolo]å‰çš„ä¸€ä¸ª[convolutional]é¦–å…ˆå°†æ‰€æœ‰[yolo]é‡Œé¢classesä¿®æ”¹ä¸º1å¾—åˆ°classes=1classesçš„å«ä¹‰æ˜¯æœ‰å¤šå°‘ç§éœ€è¦è¢«è¯†åˆ«çš„ç‰©ä½“ï¼Œè¿™é‡Œæˆ‘åªè®­ç»ƒyoloè¯†åˆ«ä¸€ç§ç‰©ä½“ï¼Œæ‰€ä»¥è®¾ç½®ä¸º1 å¯¹æ‰€æœ‰[yolo]çš„å‰ä¸€ä¸ª[convolutional]ä¸­çš„filtersè¿›è¡Œä¿®æ”¹å…¶å–å€¼ä¸ºfilters = 3 * ( classes + 5 ),ç”±äºä¸Šä¸€æ­¥ä¸­classes=1æ‰€ä»¥è¿™é‡Œfilterså–18åˆ°è¿™é‡Œï¼Œyolov3-tiny.cfgå°±ä¿®æ”¹å®Œæ¯•äº†ç„¶åæ˜¯ä¿®æ”¹model_dataä¸­çš„coco_classes.txtå’Œvoc_classes.txtï¼Œå°†å¾…æ£€æµ‹ç‰©ä½“çš„æ ‡ç­¾å¡«å†™è¿›å»ï¼Œæ¯ç§æ ‡ç­¾å ä¸€è¡Œã€‚å› ä¸ºæˆ‘åªæœ‰ä¸€ç§å¾…è¯†åˆ«ç‰©ä½“ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­éƒ½åªæœ‰ä¸€ä¸ªå•è¯è¿›å…¥åˆ°yoloæ‰€åœ¨ç›®å½•ï¼Œè¿è¡Œ 1python convert.py -w yolov3-tiny.cfg yolov3-tiny.weights model_data/tiny_yolo_weights.h5 è½¬æ¢å®Œæˆåå¯ä»¥çœ‹è§å¦‚å›¾æ‰€ç¤ºå†…å®¹ 0x05 å½“ç„¶æ˜¯åˆ¶ä½œæ•°æ®å•¦,DIOæ€ä¹ˆåˆ¶ä½œæ•°æ®å‘¢â€¦æˆ‘å†™äº†ImgTagå»æ ‡æ³¨æ•°æ®ï¼Œå¹¶ä¸”åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨ImgTagäº§ç”Ÿçš„æ•°æ® 0x06 è®­ç»ƒæ¨¡å‹åœ¨è®­ç»ƒè‡ªå·±çš„æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¼–è¾‘ä¸€ä¸‹train.pyä¸­çš„å†…å®¹ anchors_path = â€˜model_data/tiny_yolo_anchors.txtâ€™ æŒ‡å®šanchorsä¸ºtiny-yoloç‰ˆæœ¬ å› ä¸ºæˆ‘å·²ç»æ˜ç¡®çŸ¥é“æˆ‘è®­ç»ƒçš„æ˜¯yolo-tinyæ¨¡å‹ï¼Œæ‰€ä»¥åœ¨27è¡Œï¼Œä¿®æ”¹ä¸ºis_tiny_version = Trueæ­¤æ—¶å°±å¯ä»¥æ‰§è¡Œ1python train.py æ¼«é•¿çš„ç­‰å¾…ä¹‹åï¼Œæ¨¡å‹å°±è·‘å®Œäº†.è·‘å®Œä»¥åä¼šæ˜¾ç¤ºç±»ä¼¼å†…å®¹ 0x07 ä½¿ç”¨æ¨¡å‹ä½¿ç”¨æ¨¡å‹ï¼Œå°±æ˜¯æŒ‡å®šyoloåœ¨æ£€æµ‹ç›®æ ‡æ—¶å€™ï¼Œä½¿ç”¨æˆ‘ä»¬åˆšåˆšï¼ˆå¯èƒ½å¹¶ä¸æ˜¯åˆšåˆšï¼‰äº§ç”Ÿçš„æƒé‡æ–‡ä»¶ã€‚è¿›å…¥åˆ°yoloçš„ç›®å½•ï¼Œç¼–è¾‘yolo.pyå…¶ä¸­éœ€è¦é‡ç‚¹å…³æ³¨çš„å†…å®¹å°±æ˜¯ 123456789_defaults = {&quot;model_path&quot;: 'model_data/yolo.h5', # æŒ‡å®šä½¿ç”¨çš„æ¨¡å‹&quot;anchors_path&quot;: 'model_data/yolo_anchors.txt',&quot;classes_path&quot;: 'model_data/coco_classes.txt',&quot;score&quot; : 0.3, # å½“è¯„ä¼°å‡ºçš„å¾—åˆ†å¤§äº0.3æ—¶å€™ï¼Œå°±æ ‡è®°å‡ºæ¥&quot;iou&quot; : 0.45,&quot;model_image_size&quot; : (416, 416),&quot;gpu_num&quot; : 1,} æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä»¥ä¸‹model_pathçš„å€¼ï¼Œå› ä¸º..æŸäº›ç‰¹æ®Šçš„åŸå› ï¼Œæˆ‘åœ¨è¿è¡Œçš„æ—¶å€™æŒ‡å®šæ¨¡å‹å¹¶ä¸èƒ½æ­£å¸¸è¿›è¡Œï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚model_pathé‚£ä¸€è¡Œä¿®æ”¹ä¸º 1&quot;model_path&quot;: 'logs/000/trained_weights_final.h5', æˆ‘ä¸€å…±æ ‡æ³¨äº†200å¼ å›¾ç‰‡ï¼Œç›¸å¯¹è€Œè¨€å›¾ç‰‡æ•°é‡å¯èƒ½è¿˜ä¸å¤Ÿï¼Œä½†æ˜¯å·²ç»å¯ä»¥çœ‹åˆ°ç›®å‰æ¨¡å‹å·²ç»å¯ä»¥æ­£å¸¸è¯†åˆ«éƒ¨åˆ†æµ£ç†Šäº†ã€‚æ¯”å¦‚é“¶æ²³æŠ¤å«é˜Ÿä¸­çš„ç«ç®­æµ£ç†Šå“¦","link":"/2019/06/16/ImgTag%E6%95%99%E7%A8%8B/"},{"title":"è”æƒ³æ‹¯æ•‘è€… R720 é”®ç›˜çŸ©é˜µåˆ†æä¸æ”¹é€ ","text":"è”æƒ³æ‹¯æ•‘è€…R720 é”®ç›˜çŸ©é˜µåˆ†æä¸æ”¹é€ åºæœ‹å‹æ‰˜æˆ‘å¸®ä»–çš„R720ç¬”è®°æœ¬æ”¹è£…æˆKVM.äºæ˜¯ä¾¿æœ‰äº†æ­¤æ–‡. é”®ç›˜ä»‹ç»ä¸»æµé”®ç›˜åŸºæœ¬ä¸Šéƒ½æ˜¯çŸ©é˜µé”®ç›˜.è¿™ç§æ–¹å¼æ¯”è¾ƒèŠ‚çœIO.è¿™å—R720ä¹Ÿä¸ä¾‹å¤–.R720çš„é”®ç›˜ä¸€å…±æœ‰96ä¸ªé”®,ç”¨çŸ©é˜µé”®ç›˜çš„æ–¹å¼,ç†è®ºä¸Šéœ€è¦(6+16=22)ä¸ªIO.(å…¶å®è¿˜æ˜¯æŒºå¤šçš„)ä¸ºäº†é¿å…é¬¼é”®,å®é™…çš„æ¥çº¿æ¯”ç†æƒ³æƒ…å†µä¸‹å¤æ‚.è€Œä¸”ç›¸è¾ƒäºå¾ˆå¤šDIYæœºæ¢°é”®ç›˜çš„ç›´æ¥ç›´å»çº¿è·¯:R720è¿™å—é”®ç›˜çš„å†…éƒ¨Wiringå°±æ˜¾å¾—å¾ˆä¹±äº†:åˆšæµ‹å‡ºç»“æœçš„æ—¶å€™,æ€»æ„Ÿè§‰è‡ªå·±ä¸€å®šæ˜¯å¼„é”™äº†ä»€ä¹ˆåœ°æ–¹.ç›´åˆ°åæ¥æœåˆ°äº†ä¸€æ¬¾åå«Framework Laptopçš„ç¬”è®°æœ¬,æœ‰ç€ç±»ä¼¼çš„KeyMapæ‰æ”¾ä¸‹å¿ƒæ¥. KeyMapæµ‹ç»˜æœåˆ°ä¸€ç¯‡æ•™äººæŠŠç¬”è®°æœ¬æ”¹è£…ä¸ºKVMçš„æ–‡ç« ,æ–‡ç« é‡Œé¢æåˆ°äº†çŸ©é˜µé”®ç›˜é©±åŠ¨æ§åˆ¶æ¨¡å—Monkey.æˆ‘ä¸€çœ‹è¿™ä¸å’ŒATMEGA32U4å·®ä¸å¤šå—,åº”è¯¥æ˜¯åŒä¸€ä¸ªç³»åˆ—çš„äº§å“,æ·˜å®ä¸Šè¿™ä¸œè¥¿å–50.è¿™ä¸æ˜¯è¦äº†æˆ‘çš„å‘½å—.è‡ªä»å»å¹´å•ç‰‡æœºæ¶¨ä»·å,Atmelçš„äº§å“åˆ°ç°åœ¨ä¹Ÿæ²¡æ¢å¤è¿‡å»çš„ä»·æ ¼,è§‰å¾—è‡ªå·±ç°åœ¨è¦æ˜¯ä¹°äº†å°±æ˜¯çº¯çº¯å¤§å†¤ç§.å†µä¸”å®Œå…¨å¯ä»¥è‡ªå·±åšä¸€ä¸ªç±»ä¼¼çš„ä¸œè¥¿,å½“æ—¶æ‰‹ä¸Šæœ‰è¿™ä¹ˆå¤šIOçš„æ¿å­å°±ä¸€ä¸ªRaspberry Pi Pico,è€ŒQMKä¹Ÿæ”¯æŒäº†Pico,äºæ˜¯å…ˆå€ŸåŠ©Picoå¯¹KeyMapè¿›è¡Œæµ‹ç»˜.å¾—åˆ°å¦‚ä¸‹ç»“æœ ä½ é—®æˆ‘æ€ä¹ˆçŸ¥é“Row Pinå’ŒCol Pinçš„,è¿™ä¸æ˜¯å·§äº†å—,Googleä¸€ä¸‹æ‰¾åˆ°äº†åŒæ¨¡å…·ç¬”è®°æœ¬çš„åŸç†å›¾(ç½‘ç«™).é¡ºä¾¿è¿˜çŸ¥é“äº†è§¦æ‘¸æ¿å¼•è„šå®šä¹‰,åé¢ç›´æ¥å¼€å¯QMKçš„PS/2é¼ æ ‡æ”¯æŒé¡ºä¾¿æŠŠè§¦æ‘¸æ¿ä¸€èµ·é©±åŠ¨äº†. Schematicå¾—åˆ°Key Mapå,å°±å¯ä»¥å¼€å§‹ç”»æ¿å­çš„å·¥ä½œäº†.è¿«äºå½“æ—¶æ— æ³•ä½¿ç”¨Picoç¼–è¯‘å‡ºæ”¯æŒPS/2 Mouseçš„å›ºä»¶,æ‰€ä»¥æŠŠä¸»æ§æ¢æˆäº†å¸¸è§çš„ATMEGA32U4.æ¢ä¸»æ§å,IOå¼€å§‹ç´§ç¼ºäº†,ä¸è¿‡æ²¡å…³ç³».å¯ä»¥ä½¿ç”¨æ‹“å±•IOçš„èŠ¯ç‰‡æ¥åº”ä»˜è¿™ç§æƒ…å†µ.çœ‹äº†ä¸€çœ¼QMKä»“åº“é‡Œé¢çš„æ–¹æ¡ˆ,å¤§éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨çš„è¾“å‡ºIOæ‹“å±•æ¥è§£å†³é—®é¢˜.éå¸¸ä¸å·§çš„æ˜¯,è¿™å—é”®ç›˜çš„æ‰«ææ–¹å‘å’Œå¸¸è§„é”®ç›˜ç›¸å,æ‰€ä»¥ä¸å‡ºæ„å¤–çš„è¯æˆ‘å°±è¦å‡ºæ„å¤–äº†.äºæ˜¯è´­å…¥74HC595å¯¹è¾“å‡ºIOè¿›è¡Œæ‹“å±•å¹¶å®Œç¾çš„è¸©äº†å‘.é‡æ–°æ£€æŸ¥æ‰æ„è¯†åˆ°æˆ‘å¾—ä½¿ç”¨74HC165æ‹“å±•è¾“å…¥IOæ‰è¡Œ. æ‹–æ‹‰å¥½ä¹…å¹¶ä¸”åˆè¸©åˆ°äº†PS/2 Mouseå¿…é¡»ä½¿ç”¨æŒ‡å®šçš„IOé©±åŠ¨ç­‰å¥½å‡ ä¸ªå‘,æœ€ç»ˆç»˜åˆ¶å‡ºä¸‹é¢ä½¿ç”¨74HC165åŸç†å›¾çš„æ–¹æ¡ˆ(æ²‰ç—›æµªè´¹å¾ˆå¤šæ¬¡JLCå…è´¹æ‰“æ¿æœºä¼š.) QMK Pin Mapå‚è€ƒæµ‹ç»˜å‡ºçš„Key Map,å†å€ŸåŠ©ç½‘é¡µå·¥å…·å¾—åˆ°æœ€ç»ˆQMKå›ºä»¶æ‰€éœ€çš„KeyMapä¸ºäº†è®©å¤šåª’ä½“é”®å·¥ä½œæ­£å¸¸,äºæ˜¯è®¾ç½®äº†ä¸¤å±‚Key Map. 12345678910111213141516171819202122const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = { LAYOUT_pa( KC_PMNS, KC_PSLS, KC_P0, KC_LALT, KC_SPC, KC_Z, KC_B, KC_N, KC_DOWN, KC_LSFT, KC_PAST, KC_LCTL, KC_UP, KC_ENT, KC_F8, KC_C, KC_Q, KC_RALT, KC_X, KC_V, KC_M, KC_DOT, KC_RSFT, KC_COMM, KC_RCTL, KC_SLSH, KC_QUOT, KC_PPLS, KC_P9, MO(1), KC_E, KC_F2, KC_G, KC_H, KC_BSLS, KC_F7, KC_P8, KC_MINS, KC_RGHT, KC_P2, KC_LGUI, KC_TAB, KC_F4, KC_F1, KC_T, KC_Y, KC_O, KC_F6, KC_F9, KC_F12, KC_PSLS, KC_P3, KC_P7, KC_GRV, KC_CAPS, KC_S, KC_5, KC_6, KC_F10, KC_F5, KC_0, KC_EQL, KC_DEL, KC_PDOT, KC_1, KC_3, KC_2, KC_4, KC_7, KC_9, KC_8, KC_P, KC_BSPC, KC_P4, KC_P1, KC_F3, KC_W, KC_R, KC_U, KC_F11, KC_I, KC_LEFT, KC_LBRC, KC_RBRC, KC_P5, KC_NUM, KC_A, KC_ESC, KC_F, KC_J, KC_L, KC_K, KC_APP, KC_SCLN, KC_D, KC_P6), LAYOUT_pa( KC_PAUS, KC_MNXT, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_PGDN, KC_TRNS, KC_TRNS, KC_TRNS, KC_PGUP, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_MPRV, KC_TRNS, KC_TRNS, KC_VOLD, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_MPLY, KC_TRNS, KC_END, KC_PSCR, KC_TRNS, KC_TRNS, KC_TRNS, KC_MUTE, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_DEL, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_INS, KC_VOLU, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_HOME, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS),}; å®ç‰© é—æ†¾èƒŒå…‰çš„ç”µå‹æ˜¯5V,ä½†æ˜¯æˆ‘æ²¡æœ‰é€‚é….æˆ‘å·²ç»è¿‡äº†é‚£ä¸ªå–œæ¬¢èƒŒå…‰çš„å¹´çºªäº†. Moreç¬”è®°æœ¬ä¸»æ¿çš„é‚£ä¸ªå«å•¥BoardViewä¹Ÿä¸‹è½½åˆ°äº†,å†å¯¹ç€è¿™ç©æ„äººè‚‰Convert(æµ‹é‡,ç„¶åæ‰‹åŠ¨ç»˜åˆ¶)ä¸€ä¸‹å°±å¾—åˆ°äº†DWGå›¾.çŸ¥é“äº†ç²¾ç¡®çš„å¼€å­”,å†ç”»æ¿å­å°±æ–¹ä¾¿å›ºå®šäº† å‚è€ƒèµ„æ–™è€æ—§ç¬”è®°æœ¬æ”¹é€ æˆä¾¿æºKVMFramework Laptop Key MatrixQMK FirmwareLaptop Bios &amp; Schematics","link":"/2022/11/13/Lenovo-R720-Keyboard-Matrix/"},{"title":"åšä¸ªæ¡Œé¢åƒç´ å°å±å¹•å§","text":"ç»™è‡ªå·±åšä¸ªæ¡Œé¢åƒç´ å°å±å¹•å§å±•ç¤ºä¸€ä¸‹è‡ªå·±åˆ¶ä½œè¿·ä½ ç‰ˆæœ¬çš„åƒç´ æ˜¾ç¤ºå±çš„è¿‡ç¨‹ èƒŒæ™¯ä¹‹å‰ç–«æƒ…æœŸé—´(2020-02~2020-03)åšè¿‡ä¸€ä¸ªå¤§å·çš„åƒç´ å±å¹•ä½œä¸ºç”Ÿæ—¥ç¤¼ç‰©é€äººäº†ï¼Œå½“æ—¶ä½¿ç”¨çš„èŠ¯ç‰‡æ˜¯ESP32ï¼Œå¼€å‘è¯­è¨€æ˜¯micropythonã€‚é‚£ä¸ªåˆå·æœºçš„æ€§èƒ½è¡¨ç°ä¸æ˜¯å¾ˆå¥½ï¼Œæ‰€ä»¥è®¡åˆ’åšä¸€ä¸ªä½¿ç”¨C/C++çš„ç‰ˆæœ¬ï¼Œèƒ½å¤Ÿæ›´é«˜å¸§ç‡è¿è¡Œã€‚ å¦‚æœåªæ˜¯çº¯ç²¹çš„é‡å†™å›ºä»¶ï¼Œé‚£ä¹ˆå’Œå¤§å¤šæ•°äººåšçš„AWatrixå°±æ²¡å¤šå¤§åŒºåˆ«äº†ï¼Œæ‰€ä»¥å†³å®šåšä¸€ä¸ªè¿·ä½ ç‰ˆæœ¬çš„åƒç´ æ˜¾ç¤ºå±å‡ºæ¥ã€‚ å¾ˆå¤šåœ°æ–¹æ˜¯å‚è€ƒäº†AWatrixçš„ä»£ç ï¼Œå› ä¸ºAWatrixé™¤äº†å¿…é¡»è¿æ¥æœåŠ¡å™¨æ‰å¯ä»¥ä½¿ç”¨ä»¥å¤–ï¼ŒçœŸçš„æ˜¯éå¸¸ä¼˜ç§€çš„ä¸€ä¸ªå›ºä»¶ã€‚AWatrixä½¿ç”¨åˆ°çš„ä¸€äº›åº“å¾ˆå…·æœ‰å‚è€ƒä»·å€¼ï¼Œæ¯”FastLED_NexPixelå¦‚å®ƒæŠŠLEDç‚¹é˜µå½“ä½œä¸€å—â€å±å¹•â€æ¥ä½¿ç”¨ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»˜åˆ¶å‡ºä¸€äº›åŸºç¡€å›¾å½¢ã€‚å¼€å‘å·¥å…·ä¸ºPlantformIO,ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„å·¥å…·äº†ï¼ŒVSCodeè£…ä¸Šæ’ä»¶å°±å¥½äº†ã€‚ å¼€å§‹æ•´æ´»0x01 ç»˜åˆ¶ç”µè·¯æ¿ä¸‡èƒ½çš„æŸå®ä¸Šèƒ½å¤Ÿæ‰¾åˆ°çš„å†…ç½®WS2812çš„LEDè´´ç‰‡ç¯æœ€å°çš„å°±æ˜¯2020LEDï¼Œé•¿å®½å„ä¸º2mmï¼Œæ¯”å¸¸è§„AWatrixä½¿ç”¨çš„5050æˆ–è€…3535å°å¾ˆå¤šã€‚å¥ˆä½•æ²¡æœ‰ç°æˆå“ï¼Œå°±åªèƒ½è‡ªå·±ç”»ä¸€ä¸ªç”µè·¯æ¿äº†ï¼Œå¥½åœ¨ç”µè·¯éå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªï¼Œç„¶åç»•æˆSå‹å°±å¥½å•¦ã€‚ è¿™æ¬¡é€‰æ‹©çš„PCBç»˜åˆ¶è½¯ä»¶ä¸ºEagle PCBï¼Œå› ä¸ºå…è´¹å°å·§ã€‚ï¼ˆä½†æ˜¯æˆ‘æ‰“ç®—ä»¥åç”¨KiCadç”»ç”µè·¯å›¾äº†ï¼Œå› ä¸ºå¼€æºå¼ºå¤§ï¼‰ç£¨ç£¨å”§å”§çš„ç”»å®Œäº†ç”µè·¯å›¾ã€‚ ç„¶åæäº¤Gerberæ–‡ä»¶åˆ°å‚å®¶ï¼Œç­‰å¾…3å¤©åå°±æ”¶åˆ°äº†æˆå“ã€‚ 0x02 ç„Šæ¥LEDè´´ç‰‡ç¯è¿™ä¸€æ­¥æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæˆ‘ç”¨çš„æ˜¯é”¡è†ï¼Œç†”ç‚¹åœ¨182åº¦ï¼Œäºæ˜¯å…ˆæ¶‚æŠ¹åœ¨æ¿å­ä¸Šï¼Œç„¶åé£æªå¯¹ç€å°±æ˜¯ä¸€é˜µå¹ã€‚ å¤§æ¦‚èŠ±è´¹äº†åŠå¤©æ—¶é—´æ‰ç„Šå®Œæ‰€æœ‰çš„è´´ç‰‡ç¯ï¼Œå› ä¸ºå®åœ¨æ˜¯å¤ªéº»çƒ¦äº†å•Šï¼Œä¸å°å¿ƒå°±ç¢°æ‰äº†ä¸€ä¸ªï¼Œç„¶åå‘ç”Ÿä¸€ç³»åˆ—è¿é”ååº”ã€‚ 0x03 è·å–ä»£ç ï¼Œä¿®æ”¹å‚æ•°ä»£ç ä½äºGithubä¸‹è½½ä»¥åï¼Œä½¿ç”¨PlantformIOå¯¼å…¥å·¥ç¨‹ã€‚ ä¿®æ”¹ä½äºgmatrix_config.hä¸­çš„Bç«™IDå’ŒåŸå¸‚ä»¥åŠå¤©æ°”çš„Key 123##define SUNING_TIME_URL &quot;http://quan.suning.com/getSysTime.do&quot;##define BILIBILI_SUBSCRIPTION_URL &quot;http://api.bilibili.com/x/relation/stat?vmid=å“”å“©å“”å“©UID&quot;##define WEATHER_URL &quot;http://api.openweathermap.org/data/2.5/weather?q=åŸå¸‚çš„æ‹¼éŸ³&amp;appid=å¤©æ°”api&quot; ä¿®æ”¹ä½äºGmartix.cppä¸­çš„WiFiåç§°å’Œå¯†ç ã€‚1234// WiFiåç§°const char *ssid = &quot;CloseWrt_9.6G_D96AS5&quot;;// WiFiå¯†ç const char *pwd = &quot;have5seeds&quot;; ç„¶åç›´æ¥ä½¿ç”¨PlantformIOçš„ç¼–è¯‘æˆ–è€…ä¸‹è½½åˆ°æ¿å­ 0x04 çƒ§å½•å›ºä»¶ä½¿ç”¨PlantformIOå¯ä»¥ç›´æ¥ä¸‹è½½åˆ°æ¿å­ä¸Šï¼Œä¹Ÿå¯ä¹ŸBuildä»¥åä½¿ç”¨å…¶ä»–çƒ§å½•å·¥å…·çƒ§å½•ã€‚æˆ‘ä½¿ç”¨çš„çƒ§å½•è½¯ä»¶æ˜¯NodeMCU Firmware Programmer æ’ä¸Šæ¿å­é€‰æ‹©å¯¹åº”çš„ç«¯å£å·ï¼Œç„¶åç‚¹å‡»Flashå°±å¯ä»¥è¿›è¡Œçƒ§å½•äº†ã€‚ 0x05 æ¥çº¿&amp;ç»„è£…ææ–™æ¸…å• åºå· åç§° æ•°é‡ å¤‡æ³¨ 1 WeMos D1 mini 1 æ—  2 LEDæ¿ 1 è‡ªåˆ¶ 3 htu01d 1 æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ 4 å¯¼çº¿ ? æ—  5 3Dæ‰“å°å¤–å£³ 1 æ—  6 äºšå…‹åŠ›å…‰æ … 1 æ—  7 A4çº¸ 1 æ—  8 æ·±è‰²åŠé€äºšå…‹åŠ› 1 æ—  9 åç›– 1 å¯ä»¥é‡‡ç”¨ä»»æ„ææ–™è‡ªåˆ¶ æ¥çº¿ WeMos D1 miniå¼•è„šåç§° htu01d 5V VCC GND GND D3 SDA D1 SCL WeMos D1 miniå¼•è„šåç§° LEDå±å¹• ä¸æ¥ æ­£é¢ä»ä¸Šè‡³ä¸‹ç¬¬2ä¸ªå­” GND æ­£é¢ä»ä¸Šè‡³ä¸‹ç¬¬2ä¸ªå­” 5V æ­£é¢ä»ä¸Šè‡³ä¸‹ç¬¬3ä¸ªå­” D2 æ­£é¢ä»ä¸Šè‡³ä¸‹ç¬¬4ä¸ªå­” WeMos D1 miniå¼•è„šåç§° æ•£çƒ­é£æ‰‡ 5V çº¢çº¿ GND é»‘çº¿ å…‰æ …åˆ¶ä½œä½¿ç”¨çš„æ˜¯å®šåˆ¶äºšå…‹åŠ›ï¼Œè€Œå¤–å£³ä½¿ç”¨çš„3Dæ‰“å°ï¼ŒæŒ‰ç…§ä¸‹å›¾çš„é¡ºåºç»„è£…ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å…‰æ …ä¸æ·±è‰²åŠé€äºšå…‹åŠ›ä¹‹é—´éœ€è¦åŠ ä¸€å±‚A4çº¸è¿›è¡ŒæŸ”å…‰ã€‚ 0x06æˆå“å±•ç¤º å‚è€ƒèµ„æ–™:AWatrix materialpalette","link":"/2020/07/30/Make%20A%20Tiny%20Pixel%20Screen/"},{"title":"ESP32å¹¶å£å±å¹•å’Œä¸²å£å±å¹•ä¸‹å¸§ç‡çš„å¯¹æ¯”","text":"å‰è¨€åœ¨åµŒå…¥å¼å¼€å‘ä¸­ï¼Œå±å¹•åˆ·æ–°ç‡æ˜¯ç”¨æˆ·ä½“éªŒçš„â€œç¬¬ä¸€ç”Ÿå‘½çº¿â€ã€‚æˆ‘ä¸€ç›´å¥½å¥‡ï¼Œä¸ºäº†è¿½æ±‚é«˜å¸§ç‡ï¼Œæˆ‘ä»¬æ˜¯åº”è¯¥æŠŠ 60MHz çš„ SPIâ€œä¼˜åŒ–åˆ°æè‡´â€ï¼Œè¿˜æ˜¯åº”è¯¥ç›´æ¥â€œå‡ç»´æ‰“å‡»â€ï¼Œé‡‡ç”¨ 8 ä½å¹¶å£ï¼Ÿä¸ºäº†ææ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å†³å®šè‡ªè´¹è´­ä¹°ç¡¬ä»¶æ¥è¿›è¡Œä¸€æ¬¡â€œåŸå§‹å¯¹å†³â€ æµ‹è¯•é¡¹ç›®æˆ‘ç‰¹æ„é€‰äº†ä¸¤ä¸ªâ€˜ä¸åŒç»´åº¦â€™çš„æµ‹è¯•ï¼š TFT_eSPI çš„ graphicstest æ˜¯ä¸€ä¸ªâ€˜åŸå§‹I/Oâ€™æµ‹è¯•ï¼Œå®ƒåªæµ‹é‡â€˜æ€»çº¿â€™çš„ååé€Ÿåº¦ã€‚ lv_demo_music æ˜¯ä¸€ä¸ªâ€˜çœŸå®ä¸–ç•Œâ€™æµ‹è¯•ï¼Œå®ƒæµ‹é‡çš„æ˜¯â€˜CPUæ¸²æŸ“ + æ€»çº¿I/Oâ€™çš„â€˜ç»¼åˆæ€§èƒ½â€™ æµ‹è¯•ç»“æœè¿è¡ŒLVGLè‡ªå¸¦çš„lv_demo_music å¯¹ç…§ç»„åºå· å±å¹•å‚æ•° ESP32è¿è¡Œé¢‘ç‡ LVGLç¼“å†²å‚æ•° SPIé€Ÿç‡ TFT_eSPIç‰ˆæœ¬ LVGLç‰ˆæœ¬ å¸§ç‡ 1 240x240 1.54å¯¸ SPI LCD 240MHz 240*120 å¯ç”¨DMA,æœªä½¿ç”¨åŒç¼“å†² 60MHz 2.3.70 8.1.1-dev 26å¸§ 2 240x240 1.33å¯¸ 8ä½å¹¶å£ LCD 240MHz 240*120 æœªä½¿ç”¨åŒç¼“å†² \\ 2.3.70 8.1.1-dev 28å¸§ æ„Ÿè§‰å¸§ç‡å·®å¼‚ä¸æ˜¯å¾ˆå¤§çš„æ ·å­. è¿è¡ŒTFT_eSPIè‡ªå¸¦çš„Viewport_graphicstest å¯¹ç…§ç»„åºå· å±å¹•å‚æ•° ESP32è¿è¡Œé¢‘ç‡ SPIé€Ÿç‡ TFT_eSPIç‰ˆæœ¬ 1 240x240 1.54å¯¸ SPI LCD 240MHz 60MHz 2.3.70 2 240x240 1.33å¯¸ 8ä½å¹¶å£ LCD 240MHz \\ 2.3.70 è¿è¡Œæ—¶å€™æ˜æ˜¾æ„Ÿè§‰åˆ°å¹¶å£çš„ç»˜åˆ¶é€Ÿåº¦æ›´å¿«,ä¸è¿‡è¿˜æ˜¯å¾—æ•°æ®è¯´è¯,äºæ˜¯æœ‰å¦‚ä¸‹Log 8ä½å¹¶å£ç»“æœ 123456789101112131415TFT_eSPI library test!Benchmark Time (microseconds)Screen fill 53073Text 21126Lines 36424Horiz/Vert Lines 10469Rectangles (outline) 5918Rectangles (filled) 122742Circles (filled) 28151Circles (outline) 22372Triangles (outline) 14111Triangles (filled) 46193Rounded rects (outline) 16475Rounded rects (filled) 127122Done! ä¸²å£ç»“æœ 123456789101112131415TFT_eSPI library test!Benchmark Time (microseconds)Screen fill 102725Text 12506Lines 38321Horiz/Vert Lines 9293Rectangles (outline) 6594Rectangles (filled) 234378Circles (filled) 30350Circles (outline) 16884Triangles (outline) 12893Triangles (filled) 79688Rounded rects (outline) 11730Rounded rects (filled) 240258Done! å¹¶å£é©±åŠ¨æƒ…å†µä¸‹ç»˜åˆ¶æ—¶é—´å‡ ä¹æ˜¯ä¸²å£é©±åŠ¨ç»˜åˆ¶æ—¶é—´çš„ä¸€åŠ. æœç„¶è¿˜æ˜¯æœ‰æå‡çš„. è‡³äºä¸ºä»€ä¹ˆåœ¨LVGLä¸­æ‹‰ä¸å¼€å·®è·,ç»è¿‡ç¾¤å‹Principleç‚¹æ‹¨åæ„è¯†åˆ°,è¿è¡ŒLVGLæ—¶å€™CPUæ€§èƒ½æ–¹é¢å‡ºç°äº†ç“¶é¢ˆ,æˆ‘çš„ESP32æ˜¯åˆä»£ç‰ˆæœ¬,å¦‚æœæ¢æˆæœ€æ–°çš„ESP32 S3åˆ™ä¼šæ‹‰å¼€å·®è·. ç»“è®ºåˆ†æï¼šCPU ç“¶é¢ˆ vs I/O ç“¶é¢ˆä» TFT_eSPIï¼ˆåŸå§‹I/Oï¼‰çš„æ—¥å¿—çœ‹ï¼Œç»“æœä¸€ç›®äº†ç„¶ï¼šå¹¶å£å‡ ä¹å¿«äº†ä¸€å€ï¼ˆä¾‹å¦‚ Screen fill 53,073Î¼s vs 102,725Î¼sï¼‰ã€‚è¿™è¯æ˜äº†â€˜å¹¶å£æ€»çº¿â€™å­˜åœ¨æ˜æ˜¾çš„ç‰©ç†ä¼˜åŠ¿ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆåœ¨â€˜çœŸå®ä¸–ç•Œâ€™ï¼ˆLVGLï¼‰ä¸­ï¼Œå·®è·å´å¾®ä¹å…¶å¾®ï¼ˆ26 vs 28 å¸§ï¼‰? è¿™æ­£æ­ç¤ºäº† ESP32ï¼ˆåˆä»£ï¼‰çš„çœŸæ­£ç“¶é¢ˆï¼šCPU æ¸²æŸ“é€Ÿåº¦ã€‚LVGL çš„â€˜lv_demo_musicâ€™æ•ˆæœéœ€è¦ CPU å¤§é‡è®¡ç®—ï¼Œå¯¼è‡´ CPU 100% æ»¡è½½ï¼Œè€Œå±å¹•æ€»çº¿ï¼ˆæ— è®ºæ˜¯ SPI è¿˜æ˜¯å¹¶å£ï¼‰å…¶å®éƒ½åœ¨â€˜ç©ºé—²ç­‰å¾…â€™ã€‚ æ€»ç»“: æ‰€ä»¥å¦‚æœæ‚¨çš„é¡¹ç›®æ˜¯â€˜é‡æ¸²æŸ“â€™çš„ï¼Œç›²ç›®å‡çº§å±å¹•æ¥å£æ˜¯æ²¡ç”¨çš„ï¼Œé‚£å°±åº”è¯¥é¦–å…ˆå‡çº§MCUï¼ˆä¾‹å¦‚ ESP32-S3ï¼‰.æ‹“å±•é˜…è¯»åæ¥æˆ‘åˆ·åˆ°è¿‡Pä½¬çš„æ–‡ç« , ä»–ä»èŠ¯ç‰‡ç»´åº¦å»å¯¹æ¯”lvglæ•ˆæœ. æ·±å…¥åˆ†æäº†ä¸€äº›CPU, Flashç›¸å…³çš„å†…å®¹, å—ç›ŠåŒªæµ….æ¨èå„ä½è¯»è€…ä¹Ÿå»æ‹œè¯»ä¸€ä¸‹((æ³¨ï¼šPä½¬åšå®¢çš„å›¾åºŠä¼¼ä¹æŒ‚äº†ï¼Œä½†ä¸å½±å“æ–‡å­—çš„å«é‡‘é‡))AT32F403Aè¯•ç©-ç§»æ¤LVGLå¹¶ä¸ESP32-S3å¯¹æ¯”","link":"/2022/02/12/Parallel-LCD-VS-SPI-LCD/"},{"title":"å¦‚ä½•ä»é›¶å¼€å§‹ï¼šç”¨ CH592F åˆ¶ä½œ CS2 åŒäººç”Ÿå‘½å€¼èƒ¸ç« å¹¶å®ç° GSI è”åŠ¨","text":"å…è´£å£°æ˜ (Disclaimer)æœ¬é¡¹ç›®ä»…ä¸ºä½œè€…å‡ºäºæŠ€æœ¯æ¢ç´¢å’Œä¸ªäººå…´è¶£è¿›è¡Œçš„éå•†ä¸šåŒäººåˆ›ä½œ (Fan-made Project)ã€‚æ‰€æœ‰è®¾è®¡èµ„æºï¼ˆPCB/ä»£ç ï¼‰ä»…ä¾›ç”µå­æŠ€æœ¯äº¤æµä¸å­¦ä¹ å‚è€ƒï¼Œä¸¥ç¦ç”¨äºä»»ä½•å•†ä¸šç”¨é€”æˆ–æ‰¹é‡ç”Ÿäº§é”€å”®ã€‚ å…³äºæƒå±ï¼šæ–‡ä¸­æåŠçš„ â€œCounter-Strike 2â€ (CS2) åŠå…¶ç›¸å…³ç´ ææƒå±å½’ Valve Corporation æ‰€æœ‰ã€‚æœ¬ç«™ä¸ Valve æ— ä»»ä½•å…³è”ï¼Œäº¦æœªè·å¾—å®˜æ–¹æˆæƒï¼Œæœ¬é¡¹ç›®æ˜¯å¯¹æ¸¸æˆæœºåˆ¶åœ¨ç¡¬ä»¶å±‚é¢çš„åŒæ­¥æŠ€æœ¯éªŒè¯ã€‚ èƒŒæ™¯åœ¨CS2ä¸­(CS:GOé‡Œé¢ä¹Ÿæœ‰)ä¸­æœ‰ä¸€ä¸ªå«åšç”Ÿå‘½å€¼èƒ¸ç« çš„é¥°å“ç¬¬ä¸€æ¬¡çœ‹åˆ°æ—¶å€™å°±è§‰å¾—è¿™ä¸ªå¾ˆé€‚åˆä½¿ç”¨LEDåšå‡ºæ¥.è€Œä¸”è¿˜å¯ä»¥é€šè¿‡CSGO GSIåŒæ­¥æ¸¸æˆä¸­ç”Ÿå‘½å€¼çŠ¶æ€. è¡¥å……è¯´æ˜æœ‰ä¸å°‘äººæŒ‡å‡ºèƒ¸ç« å‡ºè‡ªåŠæ¡å‘½:Alyx,ä»¥å‰åªåœ¨æœ‹å‹å®¶ç©è¿‡å¼€å¤´, å¯¹è¿™ä¸ªè£…ç½®åœ¨åŠæ¡å‘½ä¸­çš„å°è±¡ä¸æ˜¯å¾ˆæ·±äº†.è§‚çœ‹äº†ä¸€äº›Alyxçš„å®å†µè§†é¢‘åäº†è§£åˆ°è¿™ä¸ªè£…ç½®çš„æ›´ä¸ºå…·ä½“çš„ä¸€äº›ä¿¡æ¯, æˆ–è®¸å°†æ¥å¯ä»¥åˆ¶ä½œä¸‰ä¸ªå®Œæ•´çš„çˆ±å¿ƒç‰ˆæœ¬,ç„¶ååƒAlyxä¸­çš„ä¸€æ ·, æ¯é¢—å¿ƒéƒ½æœ‰å¤§å°çš„å˜åŒ–, æå¤§çš„æé«˜äº†ä¸°å¯Œè¡¨ç°åŠ›. å…ƒä»¶é€‰å‹MCUé€‰å‹ç”±äºèƒ¸ç« çš„å°ºå¯¸è¾ƒå°(60mmx20mm), è€Œä¸”æˆ‘ä¹Ÿä¸å¸Œæœ›æˆå“å¤ªåšæ— æ³•ä½©æˆ´,è¿˜ä¸æƒ³æ‹–ç€ä¸€æ ¹çº¿,æ‰€ä»¥ä¸»æ§å¾—æ˜¯ä¸€ä¸ªæ”¯æŒæ— çº¿(ä¹é‘«:æœ‰äººå«æˆ‘?)çš„èŠ¯ç‰‡.è™½ç„¶æˆ‘å¾ˆå–œæ¬¢ä¹é‘«å®¶çš„èŠ¯ç‰‡(æˆ‘ä¹‹å‰å†™è¿‡å¾ˆå¤šå…³äº ESP32 ä¸²æµ å’Œ ESP32 æ˜¾ç¤ºå…¬ç½‘å›¾ç‰‡ çš„æ•™ç¨‹ï¼‰),ä½†æ˜¯æŠ±æ­‰, è¿™æ¬¡çœŸçš„å¯¹ä¸èµ·,ä½ çš„åŠŸè€—å®åœ¨æ˜¯å¤ªé«˜äº†. ä¹‹å‰åœ¨åˆ¶ä½œFriday Inkæ—¶å€™,ç”¨çš„èŠ¯ç‰‡æ˜¯CH582F, ä½¿æˆ‘å¯¹WCHç‹ç¿ èŠ±å®¶çš„èŠ¯ç‰‡ç•¥æœ‰å¥½æ„Ÿ,ä¸ä»…ä¾¿å®œå¤Ÿç”¨,åŠŸè€—è¿˜ä½. ç»“åˆæˆæœ¬å’Œå¼€å‘é‡è¯„ä¼°å, æœ€ç»ˆé€‰æ‹©WCHç‹ç¿ èŠ±å®¶çš„CH592Fä½œä¸ºä¸»æ§, å’Œä¹‹å‰çš„CH582Få¯¹æ¯”, åªæ˜¯RAMç•¥æœ‰äº›å‡å°‘, ä½†æ˜¯å¯¹äºå½“å‰çš„HealthPinæ˜¯ç»å¯¹è¶³å¤Ÿçš„. LDOé€‰å‹ä¹‹å‰çˆ±ç”¨çš„LDOæ˜¯AP2112K-3.3TRG, æºè‡ªå¤šå¹´å‰æŠ„Arduino Pro microæ—¶å€™å½¢æˆçš„ä¹ æƒ¯. ä¸ºäº†è¿›ä¸€æ­¥å‹ç¼©æˆæœ¬, LDOæ¢æˆäº†æ›´å®¹æ˜“è´­ä¹°åˆ°è€Œä¸”ä»…éœ€0.18å…ƒçš„ME6211. é”‚ç”µæ± å……ç”µèŠ¯ç‰‡é€‰å‹åœ¨ä¹‹å‰çš„ç½—ç›˜è®¾è®¡ä¸­, é”‚ç”µæ± å……ç”µç®¡ç†èŠ¯ç‰‡ç”¨çš„æ˜¯MCP73831, è¿™æ¬¾ICæˆ‘é¦–æ¬¡è´­ä¹°æ—¶å€™4å…ƒ,åæ¥å±…ç„¶æ¶¨ä»·åˆ°äº†8å…ƒ(ä¸è¿‡æœ€è¿‘æœ‰æ‰€å›è½,ä½†è¿˜æ˜¯è®©æˆ‘æœ‰æ‰€å¿Œæƒ®).å› æ­¤å……ç”µç®¡ç†èŠ¯ç‰‡æ¢æˆäº†ä»…éœ€0.45å…ƒçš„TP4057, äºŒè€…å¤–å›´å™¨ä»¶å·®å¼‚ä¸å¤§,ä»…éœ€æ³¨æ„å¼•è„šå®šä¹‰. ç¯ç å’ŒMOSé€‰æ‹©ä½ çŸ¥é“çš„, RGBå¯ä»¥æå‡300%æ€§èƒ½,æ‰€ä»¥ç¯ç æ¯«ä¸çŠ¹è±«çš„é€‰æ‹©äº†å†…ç½®WS2812Bçš„1mm x 1mm RGBç¯ç . è€ƒè™‘åˆ°WS2812Bçš„é™æ€åŠŸè€—æœ‰ç‚¹å¤§, å¯¹äºæˆ‘ä»¬æœ¬æ¥å°±ä¸å¤§çš„ç”µæ± æ¥è¯´é›ªä¸ŠåŠ éœœ, æ‰€ä»¥ä¸‰é¢—å¿ƒåˆ†ä¸ºä¸‰ç»„, é™¤äº†æœ€å°çš„é‚£é¢—å¿ƒæ— æ³•ä¸»åŠ¨å…³é—­ä¾›ç”µå¤–, å…¶ä½™ä¸¤é¢—å¿ƒéƒ½ä¼šä½¿ç”¨MOSç®¡æ§åˆ¶ç”µæºå¼€å…³,è¾¾åˆ°ä¸ç”¨æ—¶å€™å½»åº•å…³é—­çœç”µçš„ç›®çš„.å¯¹äºç¯æ³¡ã€ç”µæœºè¿™ç±»æ— æºè´Ÿè½½ï¼Œé€šå¸¸ä½¿ç”¨é©±åŠ¨ç®€å•çš„NMOSä½œä¸ºä¸‹ç®¡æ¥æ§åˆ¶å…¶åœ°çº¿å›è·¯ã€‚è€Œå¯¹äºWS2812Bè¿™ç±»éœ€è¦ä¸MCUè¿›è¡Œç²¾ç¡®æ•°å­—é€šä¿¡çš„æœ‰æºå™¨ä»¶ï¼Œä¸ºäº†ç¡®ä¿é€šä¿¡ä¿¡å·çš„å®Œæ•´æ€§ä»¥åŠä¸¤è€…ä¹‹é—´çš„ç¨³å®šå…±åœ°ï¼Œä¼˜é€‰ä½¿ç”¨PMOSä½œä¸ºä¸Šç®¡æ¥æ§åˆ¶å…¶ç”µæºï¼Œè€Œä¸æ˜¯æ§åˆ¶å…¶åœ°çº¿ã€‚ä¸ºäº†èŠ‚çœç©ºé—´, é€‰æ‹©ä¸€ä¸ªSOT23-6å°è£…çš„BRCS4953æä¾›åŒPMOS. å…³äº WS2812 çš„é©±åŠ¨åŸç†ï¼Œæˆ‘æœ€ç»ˆé‡‡ç”¨äº† SPI+DMA é›¶ CPU å ç”¨æ–¹æ¡ˆã€‚è¯¦ç»†çš„å®ç°åŸç†å’Œä»£ç è§£æï¼Œè¯·å‚é˜…æœ¬é¡¹ç›®çš„æ·±åº¦åˆ†ææ–‡ç« ï¼šã€ŠCH592Fåˆ©ç”¨SPI+DMAé©±åŠ¨WS2812ç¯ç ã€‹ã€‚ PCBè®¾è®¡å°è¯•è¿‡æŠŠç¯ç å’Œä¸»æ§åˆ†åˆ«æ”¾åœ¨ä¸¤å¼ æ¿å­ä¸Š, å†ç„Šæ¥æ–¹å¼ç²˜åœ¨ä¸€èµ·, ä½†æ˜¯è¿™æ ·ä¼šå¢åŠ ä¸€ä¸ªæ¿å­çš„åšåº¦,æˆæœ¬ä¹Ÿä¼šå› æ­¤ä¸Šå‡.é‚æ”¾å¼ƒè¿™ä¸ªæ–¹æ¡ˆ, ç»§è€Œä½¿ç”¨ä¼ ç»Ÿçš„åŒé¢å…ƒä»¶æ–¹å¼å®ç°.PCBAæœ€ç»ˆæ¸²æŸ“å¦‚ä¸‹:å…¶ä¸­ç”µæ± å¤–å›´åˆ™å°æœ‰BOMB HAS BEEN PLANTED HANDLE WITH CAREå­—æ ·å½©è›‹. å®ç‰©ç„Šæ¥æ•ˆæœå±•ç¤ºç”±äºæ²¡æœ‰å¤–å£³, è€Œä¸”é˜»ç„Šæ˜¯ç™½è‰²,æ‰€ä»¥çœ‹ä¸Šå»å’Œæ¸¸æˆåŸè®¾è®¡æœ‰æ‰€å‡ºå…¥. ç¨‹åºStatTraké¡¹ç›®å›é¡¾åœ¨CS:GOè¿˜æ²¡å‡çº§æˆä¸ºCS2çš„æ—¶å€™,æˆ‘å°±åœ¨ç°å®ä¸­åˆ¶ä½œè¿‡ä¸€ä¸ªå¯ä»¥å’Œæ¸¸æˆè”åŠ¨çš„StatTrak.å½“æ—¶æ–¹æ¡ˆæ˜¯ç›´æ¥ç¼–å†™ä¸€ä¸ªpythonè„šæœ¬å’ŒCS:GO GSIé€šä¿¡, å†å€ŸåŠ©pyserialå‘è£…ç½®å‘é€å‡»æ€æ•°æ®. Auraroæˆ‘è®°å¾—ç½—æŠ€çš„GHUBæ˜¯èƒ½å¤Ÿæ§åˆ¶è‡ªå®¶è®¾å¤‡å’Œæ¸¸æˆçš„è”åŠ¨, äºæ˜¯å°±åœ¨æƒ³æ˜¯å¦æœ‰ç±»ä¼¼çš„å¼€æºæ–¹æ¡ˆæ¥åšåˆ°ç±»ä¼¼çš„ç»Ÿä¸€ç®¡ç†. ä¸€æ–¹æœç´¢åå¾—çŸ¥äº†Project Auroraè¿™ä¸ªå¼€æºé¡¹ç›®. æœ€æœ€ä»¤äººæ¿€åŠ¨çš„æ˜¯, Auroraä¸ä»…ä»…é€‚é…äº†å¾ˆå¤šçŸ¥åå‚å•†çš„è®¾å¤‡, ä»–ç”šè‡³è¿˜æœ‰ä¸€å¥—Device Scriptæ¥ä¾›ç¬¬ä¸‰æ–¹è®¾å¤‡å®ç°å¯¹æ¥. Device Scriptç¼–å†™åœ¨Auroraçš„ä»“åº“ä¸‹æœ‰ä¸€ä¸ªexample_script.csæä¾›äº†ç®€å•çš„ç¤ºä¾‹.HealthPinçš„é€šä¿¡æ–¹å¼æ˜¯ä½¿ç”¨è“ç‰™HID, è€Œè“ç‰™HIDè£…ç½®åœ¨è¿æ¥ç”µè„‘åä¼šè¢«è§†ä½œä¸€ä¸ªæ™®é€šçš„HIDè£…ç½®, åªéœ€è¦ä½¿ç”¨æ ‡å‡†HIDé€šä¿¡APIå‘è£…ç½®å‘é€æ•°æ®å³å¯. åè®®æ‹Ÿå®šå’Œå®ç°æˆ‘ä»¬çš„è£…ç½®æœ‰LEDå’Œèœ‚é¸£å™¨, æ‰€ä»¥åè®®ä¸­åœ¨å°†è£…ç½®è¿™äº›èƒ½åŠ›æš´éœ²å‡ºæ¥. åˆæ­¥å®šä¹‰å¦‚ä¸‹ç±»å‹çš„åè®®ç»“æ„å’ŒCommand, å¹¶ä¸”ç€é‡ä»‹ç»SetHeartColorå‘½ä»¤ 1234567891011121314151617181920212223242526272829303132333435363738394041424344// å‘½ä»¤ ID æšä¸¾enum class HidCommand : uint8_t { Ping = 0x01, Reboot = 0x0F, SetAllLEDs = 0x11, ShowLEDs = 0x12, ClearAllLEDs = 0x13, SetSingleLED = 0x14, SetHeartColor = 0x15, SetLEDRange = 0x16, PlayBeep = 0x21, BuzzerOn = 0x22, BuzzerOff = 0x23};// CMD 0x15 (Set Heart)struct Payload_SetHeart { uint8_t heart_id; uint8_t r; uint8_t g; uint8_t b; uint8_t reserved[3];};// Payload çš„ Unionunion HidPayloadUnion { uint8_t raw[7]; // åŸå§‹ 7 å­—èŠ‚ Payload_SetAll setAll; Payload_SetSingle setSingle; Payload_SetHeart setHeart; Payload_SetRange setRange; Payload_PlayBeep playBeep; Payload_BuzzerOn buzzerOn; Payload_NoArgs noArgs;};/** * @brief HID å‘½ä»¤åŒ…ç»“æ„ä½“ * HID å †æ ˆå·²ç»æ¶ˆè´¹äº† Report IDï¼Œæ‰€ä»¥ä¸åŒ…å« Report IDï¼Œ */struct HidCommandPacket { uint8_t cmd; // Byte 0 (å‘½ä»¤ ID) HidPayloadUnion payload; // Bytes 1-7 (è´Ÿè½½)}; Device Scriptå®Œå–„Auroraä¸‹å‘é¢œè‰²é…ç½®æ—¶å€™, ä¼šè§¦å‘Script Deviceçš„UpdateDevice(object keyColors, bool forced)å‡½æ•°, è¿™ä¸ªå‡½æ•°é‡Œé¢æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢åˆ°æ‰€æœ‰é”®ä½é¢œè‰²ä¿¡æ¯. è€ŒHealthPinä¸‰é¢—å¿ƒåˆ†åˆ«è¢«æ˜ å°„åˆ°äº†é”®ç›˜çš„7,8,9ä¸‰ä¸ªé”®,æ‰€ä»¥åªå…³æ³¨è¿™ä¸‰ä¸ªé”®çš„æ•°æ®å³å¯. å½“ç„¶å¦‚æœä½ æƒ³å…³æ³¨F1,F2,F3çš„é…ç½®ä¹Ÿæ²¡é—®é¢˜, åªæ˜¯éœ€è¦æ³¨æ„åœ¨è°ƒæ•´Profilesæ—¶å€™è¦è®¾ç½®å¯¹åº”çš„æŒ‰é”®. 123456789101112131415161718192021222324Color targetHeart1 = Color.Black;Color targetHeart2 = Color.Black;Color targetHeart3 = Color.Black;var dict = keyColors as IDictionary;foreach (DictionaryEntry entry in dict){ string key = entry.Key?.ToString(); if (string.IsNullOrEmpty(key)) continue; if (key.Equals(&quot;NUM_SEVEN&quot;, StringComparison.OrdinalIgnoreCase)) { targetHeart1 = ParseColorObject(entry.Value); hasUpdate = true; } else if (key.Equals(&quot;NUM_EIGHT&quot;, StringComparison.OrdinalIgnoreCase)) { targetHeart2 = ParseColorObject(entry.Value); hasUpdate = true; } else if (key.Equals(&quot;NUM_NINE&quot;, StringComparison.OrdinalIgnoreCase)) { targetHeart3 = ParseColorObject(entry.Value); hasUpdate = true; }} è·å–åˆ°é¢œè‰²æ•°æ®,åªéœ€è¦ä½¿ç”¨HidD_SetFeatureå‡½æ•°å‘é€æ•°æ®å³å¯. 1234private static extern bool HidD_SetFeature( SafeFileHandle HidDeviceObject, byte[] ReportBuffer, uint ReportBufferLength); ä¸‹ä½æœºç¨‹åºå½“åˆé€‰æ‹©CH592Fæœ‰å¤§åŸå› å°±æ˜¯æœ‰å¾ˆå¤šäººç”¨å®ƒåšé”®ç›˜, è€Œä¸”å®˜æ–¹çš„ä¾‹å­ä¸­å°±æœ‰ä¸€ä¸ªåŸºäºè“ç‰™çš„HID_Keyboard example. åœ¨æ„æ€æœ¬é¡¹ç›®æ—¶å€™, å°±åƒå¥½äº†è¦ä¼ªè£…æˆä¸ºä¸€ä¸ªHIDè®¾å¤‡, å†å’Œç”µè„‘èµ°HIDè¿›è¡Œé€šä¿¡. è¿™ä¸ªæ–¹æ¡ˆä¸ç”¨è€ƒè™‘ä¸²å£é©±åŠ¨æˆ–è€…å…¶ä»–USBé©±åŠ¨çš„éº»çƒ¦äº‹æƒ…äº†. é©±åŠ¨WS2812Bå…·ä½“å¯ä»¥å‚è€ƒWCHå®˜æ–¹å®ç°, å·§å¦™åœ°ä½¿ç”¨äº†SPIæ¥æ¨¡æ‹ŸWS2812æ—¶åº,è¿™é‡Œä¸åšèµ˜è¿°. HIDå‘½ä»¤è§£æè¿™éƒ¨åˆ†å’Œä¸Šä½æœºåç€å¤„ç†å³å¯, åœ¨hidEmuRptCBå‡½æ•°ä¸­, å¤„ç†HID_DEV_OPER_WRITEçš„æƒ…å†µ,ç„¶ååŒºåˆ†æ˜¯å¦æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„äº‹ä»¶. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// è§£æè‡ªå®šä¹‰çš„HIDç¯å…‰åè®®HidCommandPacket *packet = reinterpret_cast&lt;HidCommandPacket *&gt; (pData);// USB_Printf(&quot; -&gt; Received Command ID: %d\\n&quot;, packet-&gt;cmd);switch (static_cast&lt;HidCommand&gt; (packet-&gt;cmd)) {case HidCommand::ShowLEDs: { extern NeoPixelController *g_pLeds; if (g_pLeds) { g_pLeds-&gt;show(); } break;}case HidCommand::SetHeartColor: { uint8_t heart_id = packet-&gt;payload.setHeart.heart_id; uint8_t r = packet-&gt;payload.setHeart.r; uint8_t g = packet-&gt;payload.setHeart.g; uint8_t b = packet-&gt;payload.setHeart.b; extern NeoPixelController *g_pLeds; if (g_pLeds) { switch (heart_id) { case 0: g_pLeds-&gt;heart1 (r &lt;&lt; 16 | g &lt;&lt; 8 | b); break; case 1: g_pLeds-&gt;heart2 (r &lt;&lt; 16 | g &lt;&lt; 8 | b); break; case 2: g_pLeds-&gt;heart3 (r &lt;&lt; 16 | g &lt;&lt; 8 | b); break; default: // æ— æ•ˆçš„ heart_idï¼Œå¿½ç•¥ break; } } break;}case HidCommand::PlayBeep: case HidCommand::BuzzerOff:case HidCommand::SetSingleLED:case HidCommand::SetAllLEDs: { // çœç•¥å…¶ä½™å…·ä½“å®ç° break;}default: // æ”¶åˆ°æœªçŸ¥å‘½ä»¤ break;} ç„¶åäº«å—Auroraå¯¹å¤§é‡æ¸¸æˆçš„æ”¯æŒ,ä»¥åŠä¸°å¯Œçš„ç¯å…‰é…ç½®. è§†é¢‘ æ³•å¾‹åŠç‰ˆæƒè¯´æ˜ è½¯ä»¶åè®®ï¼šæœ¬é¡¹ç›®ä¸­æ¶‰åŠçš„ä»£ç éƒ¨åˆ†ä»…ä¾›å­¦ä¹ ç ”ç©¶ã€‚ å•†æ ‡å£°æ˜ï¼šValve, Counter-Strike, Steam, Half-Life åŠå…¶å¯¹åº”çš„å¾½æ ‡å‡ä¸º Valve Corporation çš„å•†æ ‡åŠ/æˆ–æ³¨å†Œå•†æ ‡ã€‚ ä¸è¯šå®è¡Œä¸ºåˆè§„ï¼šæœ¬é¡¹ç›®ä¸æ¶‰åŠå¯¹æ¸¸æˆçš„ä¿®æ”¹ã€ç ´è§£æˆ–ä½œå¼Šï¼Œä»…é€šè¿‡å®˜æ–¹å…è®¸çš„ GSI (Game State Integration) æ¥å£è¯»å–åªè¯»æ•°æ®å±•ç¤ºå‘¼å¸ç¯æ•ˆæœã€‚","link":"/2025/10/29/Real-life-HealthPin/"},{"title":"åšä¸ªæš—é‡‘è®¡æ•°å™¨å§ï¼šCS:GO StatTrak ç¡¬ä»¶å¤åˆ»å…¨è®°å½•","text":"æš—é‡‘è®¡æ•°å™¨ (StatTrak) å¤åˆ»å®æˆ˜åœ¨ CS:GO ä¸­ï¼Œæœ‰äº›æ­¦å™¨å…·æœ‰ä¸€ä¸ªåä¸º StatTrak çš„è£…ç½®ï¼Œè¿™ä¸ªè£…ç½®å¯ä»¥è®°å½•ç©å®¶åœ¨æ¸¸æˆå†…çš„æ€æ•Œæ•°é‡ã€‚è§‰å¾—è¿™ä¸ªè£…ç½®å¾ˆæœ‰æ„æ€ï¼Œäºæ˜¯æƒ³åšä¸€ä¸ªå‡ºæ¥ã€‚ ä¸ºäº†è¿‘è·ç¦»è§‚å¯Ÿè¿™ä¸ªè£…ç½®ï¼Œæˆ‘æ–¥ 8.8 å…ƒå·¨èµ„è´­ä¹°äº†ä¸€æŠŠ æ ¼æ´›å…‹18å‹(StatTrakâ„¢)|çƒˆç„°å¤©ä½¿ï¼Œå¹¶åœ¨äººæœºå¯¹æˆ˜ä¸­å¤§æ€å››æ–¹ã€‚ æ–¹æ¡ˆè¿­ä»£å†ç¨‹ç”±äºåªæ˜¯ä¸ªè®¡æ•°å™¨ï¼Œæœ¬è´¨å°±æ˜¯ä¸ªå¯ä»¥è‡ªå®šä¹‰æ˜¾ç¤ºå†…å®¹çš„æ˜¾ç¤ºå±ã€‚ä½†è¦åšåˆ°ã€Œå½¢ç¥å…¼å¤‡ã€ï¼Œé€‰å‹å’Œç»†èŠ‚è®¾è®¡éå¸¸å…³é”®ã€‚ æ–¹æ¡ˆ 1ï¼šOLED 12832 + Arduinoè°·æ­Œä¸€ç•ªåï¼Œå‘ç° YouTube ä¸Šæœ‰ä½è€å“¥å¹²è¿‡ç±»ä¼¼çš„äº‹æƒ…ï¼Œä»–ä½¿ç”¨çš„æ–¹æ¡ˆæ­£æ˜¯ 12832 OLED + Arduinoã€‚ é—®é¢˜ï¼šOLED åªæœ‰ç™½è‰²å’Œè“è‰²ï¼Œé‚£ä¹ˆå¦‚ä½•å®ç°æ¸¸æˆé‡Œçš„æ©™è‰²æ•ˆæœå‘¢ï¼Ÿ è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ ä¸€å±‚æ©™è‰²æ»¤è†œã€‚è¿™ä½è€å“¥ä½¿ç”¨çš„æ»¤è†œä»·æ ¼èµ·é£ï¼Œè¿˜åªæœ‰å°å°çš„ä¸€å—ã€‚ä¸å°±æ˜¯ä¸ªæ©™è‰²å¡‘æ–™ç‰‡å—ï¼Ÿçª—æˆ·ç”¨çš„å°±ä¸è¡Œå—ï¼Ÿäºæ˜¯æˆ‘æ–¥å·¨èµ„è´­ä¹°äº†è€å¤§ä¸€å¼ æ©™è‰²åŠé€æ˜å¡‘æ–™è†œï¼Œè´´åˆ°äº† OLED ä¸Šï¼Œæ•ˆæœè¿˜æŒºå¥½çš„ã€‚ æˆ‘å½“æ—¶è§‰å¾—è¿™ä¸ªå¤ªå°äº†ï¼Œä¸å¥½å¾®å‹åŒ–ã€‚ï¼ˆ2020-11-21 ç°åœ¨å›æƒ³ä¸€ä¸‹ï¼Œå·²ç»æ²¡æœ‰å¤ªå¤§éš¾åº¦äº†ï¼‰ æ–¹æ¡ˆ 2ï¼šLED ç‚¹é˜µå± + MAX7219åœ¨æŸå®ç•…æ¸¸ä¸€ç•ªä»¥åï¼Œå‘ç°å¹¶æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ç‚¹é˜µå±å¹•ã€‚ä¸è¿‡æœ‰ä¸ª 30mm é«˜çš„å€’æ˜¯ç¬¦åˆä¸€äº›è¦æ±‚ï¼Œé‚å†³å®šç­‰æ¯”æ”¾å¤§åšå‡ºå®ç‰©ã€‚ æŠ€æœ¯è¦ç‚¹ è¯¦æƒ… é©±åŠ¨èŠ¯ç‰‡ MAX7219ï¼ˆSPI æ¥å£çº§è”ï¼‰ ç‚¹é˜µè§„æ ¼ 8x8 LED æ¨¡å— x N PCB è®¾è®¡ KiCad ç»˜åˆ¶ ç„Šæ¥å¥½ä»¥åå°±æ˜¯è¿™æ ·ï¼Œè‡³äºä¸ºå•¥çœ‹èµ·æ¥ä¸ä¸€æ ·â€¦â€¦å› ä¸ºæˆ‘ç¬¬ä¸€æ¬¡å¤±è´¥äº†ã€‚ç‚¹é˜µå±å–å®¶ç»™çš„èµ„æ–™æ˜¯é”™çš„ï¼Œè‡ªå·±æµ‹æ˜¯æµ‹å‡ºæ¥äº†ï¼Œç»“æœç”»åŸç†å›¾çš„æ—¶å€™åˆæé”™äº†ã€‚ åŠ ä¸Šä¸€å±‚é»‘è‰²æ»¤é•œåï¼Œæ˜¾ç¤ºæ•ˆæœè¿˜å‡‘åˆçš„æ ·å­ã€‚ç„¶è€Œè§‰å¾—å¤–è§‚å®åœ¨æ˜¯å¤ªä¸‘äº†ï¼Œå°±æ”¾å¼ƒäº†ã€‚ çœŸçš„ä¸‘å•Šï¼Œæˆ‘æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ‰ä¼šæœ‰è¦ä½¿ç”¨é»‘è‰²è®°å·ç¬”æ¶‚é»‘çš„å¿µå¤´å•Šã€‚ æ–¹æ¡ˆ 3ï¼šHDSP2072 å¤è‘£å± + è‡ªåˆ¶æ ¸å¿ƒæ¿æœ‰æ¬¡é€›é—²é±¼ï¼Œå‘ç°äº†æœ‰ä¸ªå±å¹•çš„å‚æ•°æŒºç¬¦åˆè¦æ±‚çš„ï¼Œä¸€é—®ä»·æ ¼ 72ï¼Œæ‰“æ‰°äº†ã€‚ä¸è¿‡å’¬å’¬ç‰™è¿˜æ˜¯ä¹°äº†ä¸‹æ¥ã€‚ è¿™å—å±å¹•æ˜¯ä¸Šä¸ªä¸–çºªçš„åº“å­˜äº†ï¼ŒåŸæ¥æ˜¯ç”¨äºå¤§å“¥å¤§ä¸Šçš„ã€‚ ç¡¬ä»¶è§„æ ¼ è¯¦æƒ… å±å¹•å‹å· HDSP-2072 ä¸»æ§èŠ¯ç‰‡ ATmega32U4ï¼ˆä» Pro Micro ä¸Šæ‹†ä¸‹ï¼‰ æ¥å£ Type-Cï¼ˆ16Pï¼‰ PCB å·¥è‰º JLC 5å…ƒ24å°æ—¶åŠ æ€¥é¡ºä¸°åŒ…é‚® å¥½åœ¨è¿™ä¸ªä¸–çºªçš„ Arduino ä¹Ÿå¯ä»¥æ­£å¸¸é©±åŠ¨ ç„¶åè§‰å¾—è¿™æ¬¡å¯ä»¥ç›´æ¥ç”»ä¸€å—å®Œæ•´çš„æ¿å­ï¼Œä¸ä½¿ç”¨å¤–æ¥çš„ Arduino äº†ï¼Œæ˜¯ç»ƒæ‰‹çš„å¥½æœºä¼šã€‚å°±ç…§ç€ SparkFun æä¾›çš„ Pro Micro åŸç†å›¾ä¸€é¡¿æŠ„ï¼ˆç²¾ç®€ï¼‰ï¼Œä¸€å¤©æ—¶é—´æ€»ç®—æ˜¯ç”»çš„å·®ä¸å¤šäº†ã€‚ ç„¶åæ‰¾ JLC 24å°æ—¶åŠ æ€¥ã€‚24å°æ—¶åï¼Œæ¿å­å°±åˆ°å®¶äº†ã€‚ ä¸å¾—ä¸è¯´ï¼ŒType-C æ¥å£æ¯” QFN44 è¿˜éš¾ç„Šã€‚ ç”±äºæˆ‘æ˜¯ä» Pro Micro ä¸Šæ‹†ä¸‹æ¥çš„ ATmega32U4 èŠ¯ç‰‡ï¼ˆæèŠ¯çªå­ï¼‰ï¼Œæ‰€ä»¥ä¸éœ€è¦çƒ§å†™ bootloaderã€‚ å¤–å£³è®¾è®¡è¿­ä»£è¿™ä¸ªæ–¹æ¡ˆå†…éƒ¨ç”µè·¯éƒ¨åˆ†è¿˜æ˜¯æŒºæ»¡æ„çš„ï¼Œäºæ˜¯å°±å¼€å§‹ç€æ‰‹äºå¤–å£³åˆ¶ä½œã€‚ å¤–å£³ V1ï¼šBB æœºé£æ ¼ï¼ˆå¤±è´¥ï¼‰ å±å¹•å®½åº¦å äº†æ•´ä½“å®½åº¦çš„ä¸€åŠï¼Œç›´æ¥åŠ å£³å­å°±åƒä¸€ä¸ª BB æœºä¸€æ ·äº†ï¼Œæˆ–è€…è¯´å¥½åƒä¸€ä¸ªæ”¶éŸ³æœºã€‚ æˆ–è®¸æˆ‘å¯ä»¥è®© PCB æ–œç€æ”¾â€¦â€¦ æˆ–è€…å°±è®©ä»–æœ‰è¿™ä¸ªå¤§ä¸‹å·´äº†ï¼Œæˆ‘æ˜¯æ•‘ä¸äº†äº†â€¦â€¦ ä¸è¡Œï¼Œä¸å¯ä»¥åœ¨è¿™é‡Œå¦¥åå•Šï¼äºæ˜¯è¢«è¿«æƒ³å‡ºäº†ç¬¬äºŒä¸ªæ–¹æ¡ˆã€‚ å¤–å£³ V2ï¼šID æ— è¾¹æ¡†è®¾è®¡è®©æˆ‘ä»¬è‡´æ•¬ä¹è§†çš„ ID æ— è¾¹æ¡†å§ï¼ åªè¦ä¸ç‚¹äº®å±å¹•ï¼Œä½ å°±æ°¸è¿œæ— æ³•çŸ¥é“æˆ‘çš„å®é™…æ˜¾ç¤ºåŒºåŸŸæ˜¯å¤šå°‘ã€‚ æŠ€æœ¯è¦ç‚¹æ€»ç»“ é˜¶æ®µ è¸©å‘ç‚¹ ç»éªŒæ•™è®­ æ–¹æ¡ˆ 1 OLED å°ºå¯¸è¿‡å° å…ˆåšå°ºå¯¸éªŒè¯å†å†³å®šæ–¹æ¡ˆ æ–¹æ¡ˆ 2 ç‚¹é˜µå±å¼•è„šèµ„æ–™é”™è¯¯ æ°¸è¿œè‡ªå·±æµ‹é‡éªŒè¯ï¼Œä¸è¦ç›²ä¿¡å–å®¶èµ„æ–™ æ–¹æ¡ˆ 2 å¤–è§‚è¿‡äºç²—ç³™ å¤–è§‚è®¾è®¡åº”ä¸ç”µè·¯è®¾è®¡åŒæ­¥è¿›è¡Œ æ–¹æ¡ˆ 3 Type-C ç„Šæ¥å›°éš¾ å‡†å¤‡åŠ©ç„Šå‰‚å’Œç»†å°–å¤´çƒ™é“ æ–¹æ¡ˆ 3 å¤–å£³æ¯”ä¾‹å¤±è°ƒ è€ƒè™‘ã€ŒID æ— è¾¹æ¡†ã€ç­‰è§†è§‰æ¬ºéª—æ‰‹æ³• é¡¹ç›®å¼€æºæœ¬é¡¹ç›®çš„æ‰€æœ‰è®¾è®¡æ–‡ä»¶ï¼ˆåŸç†å›¾ã€PCBã€å›ºä»¶ä»£ç ï¼‰å‡å·²å¼€æºï¼Œæ¬¢è¿å‚è€ƒå’Œæ”¹è¿›ã€‚ å‚è€ƒèµ„æ–™ Pro Micro - 5V/16MHz SparkFun Qwiic Pro Micro - USB-C (ATmega32U4) Real life StatTrak - YouTube MAX7219LedMatrix - GitHub HDSP2000_Display - GitHub","link":"/2020/11/20/StatTrak/"},{"title":"CH592Fåˆ©ç”¨SPI+DMAé©±åŠ¨WS2812ç¯ç ","text":"å‰è¨€ åœ¨ä¸Šä¸€ç¯‡ã€Šä»é›¶å¼€å§‹ï¼šç”¨CH592Fåˆ¶ä½œCS2ç”Ÿå‘½å€¼èƒ¸ç« ã€‹çš„æ–‡ç« ä¸­ï¼Œæˆ‘å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨CH592Fè¿™é¢—è“ç‰™èŠ¯ç‰‡åˆ¶ä½œä¸€ä¸ªå’Œæ¸¸æˆè”åŠ¨çš„ç”Ÿå‘½å€¼æŒ‡ç¤ºå™¨. è€Œæœ¬æ–‡å°†ä»‹ç»ç”Ÿå‘½å€¼è®¡æ•°å™¨çš„ä¸€ä¸ªæŠ€æœ¯ç»†èŠ‚:å¦‚ä½•ä½¿ç”¨CH592Fé©±åŠ¨WS2812.è™½ç„¶WS2812çš„æ—¶åºè¦æ±‚æ¯”è¾ƒä¸¥æ ¼ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨GPIOç¿»è½¬é…åˆç²¾å‡†å»¶æ—¶æ¥å®ç°ï¼Œä½†é‚£æ ·ä¼šå ç”¨å¤§é‡çš„CPUèµ„æºï¼Œå¯¼è‡´è“ç‰™åè®®æ ˆæˆ–å…¶ä»–ä¸­æ–­ä»»åŠ¡å—é˜».ä¸ºäº†å®ç°â€œé›¶â€CPUå ç”¨çš„ç‚«é…·ç¯æ•ˆï¼Œæˆ‘å†³å®šåˆ©ç”¨CH592Fçš„SPIå¤–è®¾é…åˆDMAæ¥æ¨¡æ‹ŸWS2812çš„æ—¶åº. åŸç†åˆ†æWS2812çš„é€šè®¯åè®®å¤§å®¶éƒ½çƒ‚ç†Ÿäºå¿ƒäº†ï¼Œæ ¸å¿ƒå°±æ˜¯é€šè¿‡é«˜ä½ç”µå¹³çš„å ç©ºæ¯”æ¥åŒºåˆ†0ç å’Œ1ç . 0ç ï¼šé«˜ç”µå¹³æ—¶é—´çŸ­ï¼ˆ~0.4usï¼‰ï¼Œä½ç”µå¹³æ—¶é—´é•¿. 1ç ï¼šé«˜ç”µå¹³æ—¶é—´é•¿ï¼ˆ~0.8usï¼‰ï¼Œä½ç”µå¹³æ—¶é—´çŸ­. æ•´ä¸ªå‘¨æœŸå¤§çº¦åœ¨1.25uså·¦å³ï¼Œå³é¢‘ç‡çº¦ä¸º800kHz. å¦‚æœæˆ‘ä»¬å°†SPIçš„æ—¶é’Ÿé¢‘ç‡è®¾å®šä¸ºWS2812é¢‘ç‡çš„4å€ï¼ˆçº¦3.2MHzï¼‰ï¼Œé‚£ä¹ˆå‘é€ä¸€ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰çš„SPIæ•°æ®æ‰€å ç”¨çš„æ—¶é—´ï¼Œåˆšå¥½å¯¹åº”2ä¸ªWS2812çš„ä½å‘¨æœŸï¼ˆå› ä¸ºè¿™é‡Œæˆ‘ä»¬ç”¨4ä¸ªSPIä½æ¥è¡¨ç¤º1ä¸ªWS2812ä½ï¼‰. æ¨¡æ‹Ÿ0ç ï¼šå‘é€äºŒè¿›åˆ¶ 1000 (0x8)ï¼Œå³1ä¸ªé«˜ç”µå¹³+3ä¸ªä½ç”µå¹³. æ¨¡æ‹Ÿ1ç ï¼šå‘é€äºŒè¿›åˆ¶ 1110 (0xE)ï¼Œå³3ä¸ªé«˜ç”µå¹³+1ä¸ªä½ç”µå¹³. è¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€å—ç¼“å­˜ï¼Œå°†RGBé¢œè‰²æ•°æ®â€œè†¨èƒ€â€è½¬åŒ–ä¸ºå¯¹åº”çš„SPIæ•°æ®ï¼Œç„¶åé€šè¿‡DMAä¸€é”®å‘é€ï¼Œå³å¯å½»åº•è§£æ”¾CPU. æ ¸å¿ƒä»£ç å®ç°1. åˆå§‹åŒ–SPIé¦–å…ˆéœ€è¦é…ç½®SPI0ä¸ºä¸»æœºæ¨¡å¼.CH592Fçš„ç³»ç»Ÿä¸»é¢‘é€šå¸¸ä¸º48MHzï¼Œä¸ºäº†å‡‘å‡º3.2MHzçš„SPIæ—¶é’Ÿï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®åˆ†é¢‘ç³»æ•°.48MHz / 15 = 3.2MHz. NeoPixel.cpp - init12345678910111213141516void NeoPixelController::begin() { // é…ç½®GPIOï¼ŒPA12/13/14é€šå¸¸å¯¹åº”SPI0 GPIOA_ResetBits (GPIO_Pin_12); GPIOA_ModeCfg (GPIO_Pin_12 |GPIO_Pin_13 | GPIO_Pin_14, GPIO_ModeOut_PP_5mA); // åˆå§‹åŒ–SPI0 SPI0_MasterDefInit(); // è®¾ç½®åˆ†é¢‘ï¼Œ15åˆ†é¢‘å¾—åˆ°3.2MHz // æ³¨æ„ï¼šå®é™…è°ƒè¯•ä¸­å¯èƒ½éœ€è¦æ ¹æ®ç¤ºæ³¢å™¨å¾®è°ƒ SPI0_CLKCfg (15); // å‘é€å¤ä½ä¿¡å·ï¼ˆWS2812éœ€è¦ &gt;50us çš„ä½ç”µå¹³å¤ä½ï¼‰ // è¿™é‡Œå‘é€ä¸€æ®µå…¨0æ•°æ®å³å¯ memset (_spiBuffer, 0, 24); SPI0_MasterDMATrans (_spiBuffer, 24);} 2. æ•°æ®è½¬æ¢ (GRB -&gt; SPI)è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥.æˆ‘ä»¬éœ€è¦å°†å†…å­˜ä¸­ç´§å‡‘çš„RGBï¼ˆå®é™…æ˜¯GRBé¡ºåºï¼‰æ•°æ®ï¼Œå±•å¼€ä¸ºSPIæ€»çº¿éœ€è¦çš„æ³¢å½¢æ•°æ®.è¿™é‡Œå®šä¹‰äº†ä¸¤ä¸ªå®æ¥ä»£è¡¨SPIå‘é€çš„4ä½æ•°æ®ç‰‡æ®µï¼š GRB_CODE_0: 0x8 (å¯¹åº”äºŒè¿›åˆ¶ 1000) GRB_CODE_1: 0xE (å¯¹åº”äºŒè¿›åˆ¶ 1110) ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œæˆ‘ä»¬ä¸€ä¸ªå­—èŠ‚çš„SPI bufferå­˜å‚¨ä¸¤ä¸ªWS2812ä½. NeoPixel.cpp - convert12345678910111213141516171819202122232425262728// è¡¥å……å®å®šä¹‰ï¼Œç”¨äºç”Ÿæˆæ³¢å½¢##define GRB_CODE_0 0x8##define GRB_CODE_1 0xEvoid NeoPixelController::convertGRBtoSPI (const uint8_t *grb, uint8_t *spi, uint16_t len) { // len æ˜¯LEDçš„æ•°é‡ // æ¯ä¸ªLED 3ä¸ªå­—èŠ‚é¢œè‰²ï¼Œæ¯ä¸ªé¢œè‰²ä½éœ€è¦4ä½SPIæ•°æ® // æ‰€ä»¥SPI bufferé•¿åº¦ = len * 3 * 4 (bytes) memset (spi, 0, len * 3 * 4); for (uint16_t i = 0; i &lt; len; i++) { for (uint8_t j = 0; j &lt; 3; j++) { // R, G, B ä¸‰ä¸ªé€šé“ for (uint8_t k = 0; k &lt; 4; k++) { // æ¯ä¸ªå­—èŠ‚8ä½ï¼Œåˆ†ä¸º4ç»„ï¼Œæ¯ç»„2ä½ for (uint8_t m = 0; m &lt; 2; m++) { // å¤„ç†æ¯ç»„ä¸­çš„2ä½ // æ£€æŸ¥GRBé¢œè‰²æ•°æ®çš„ç‰¹å®šä½æ˜¯å¦ä¸º1 // é€»è¾‘æ¯”è¾ƒç»•ï¼Œæœ¬è´¨å°±æ˜¯ä»é«˜ä½åˆ°ä½ä½é€šè¿‡æ©ç å–å€¼ if (grb[3 * i + j] &amp; (0x80 &gt;&gt; (2 * k + m))) { // å¦‚æœæ˜¯1ï¼ŒSPI bufferå¡«å…¥ 1110 (é«˜ä½) æˆ– 1110 (ä½ä½) spi[3 * 4 * i + 4 * j + k] |= (GRB_CODE_1 &gt;&gt; (m * 4)); } else { // å¦‚æœæ˜¯0ï¼ŒSPI bufferå¡«å…¥ 1000 (é«˜ä½) æˆ– 1000 (ä½ä½) spi[3 * 4 * i + 4 * j + k] |= (GRB_CODE_0 &gt;&gt; (m * 4)); } } } } }} 3. DMA å‘é€æ•°æ®è½¬æ¢å®Œæˆåï¼Œå‘é€è¿‡ç¨‹å°±éå¸¸ç®€å•äº†.ç›´æ¥è°ƒç”¨CH592Fçš„DMAä¼ è¾“å‡½æ•°ï¼ŒCPUå°±å¯ä»¥å»å¤„ç†è“ç‰™è¿æ¥æˆ–è€…ç¡è§‰äº†. NeoPixel.cpp - show1234567void NeoPixelController::show() { // 1. å°†é¢œè‰²æ•°æ®è½¬æ¢ä¸ºSPIæ³¢å½¢æ•°æ® convertGRBtoSPI (_grbBuffer, _spiBuffer, _numLeds); // 2. å¯åŠ¨DMAä¼ è¾“ // é•¿åº¦è®¡ç®—ï¼šLEDæ•°é‡ * 3(RGB) * 4(è†¨èƒ€ç³»æ•°) SPI0_MasterDMATrans (_spiBuffer, _numLeds * 3 * 4);} å°è£…ä¸è°ƒç”¨ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘å°†å…¶å°è£…æˆäº†ä¸€ä¸ªNeoPixelControllerç±»ï¼Œæ¨¡ä»¿äº†Arduino Adafruit_NeoPixelçš„æ¥å£é£æ ¼. å¤´æ–‡ä»¶ NeoPixel.h: NeoPixel.h1234567891011121314151617181920212223242526272829303132333435##ifndef NEOPIXEL_H##define NEOPIXEL_H##include &quot;CH59x_common.h&quot;class NeoPixelController {public: // æ„é€ å‡½æ•°ï¼Œéœ€è¦æŒ‡å®šLEDæ•°é‡å’ŒSPI bufferå¤§å° // æ³¨æ„ï¼š_spiBuffer æœ€å¥½åœ¨å¤–éƒ¨ç”³è¯·æˆ–è€…åœ¨ç±»ä¸­åŠ¨æ€ç”³è¯· NeoPixelController (uint16_t numLeds, uint8_t spiInstance = 0); void begin(); void show(); void setPixelColor(uint16_t index, uint32_t color); void setPixelHSV(uint16_t index, uint8_t hue, uint8_t sat, uint8_t val); void clear(); void setBrightness(uint8_t brightness); // ç®€å•çš„é¢œè‰²å·¥å…· static uint32_t Color(uint8_t r, uint8_t g, uint8_t b);private: uint16_t _numLeds; uint8_t _spiInstance; uint8_t _brightness; // è¿™é‡Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œå‡è®¾æœ€å¤§æ”¯æŒä¸€å®šæ•°é‡ï¼Œå®é™…åº”åŠ¨æ€åˆ†é… uint8_t _grbBuffer[100 * 3]; uint8_t _spiBuffer[100 * 3 * 4]; void convertGRBtoSPI(const uint8_t *grb, uint8_t *spi, uint16_t len); uint32_t colorHSV(uint8_t hue, uint8_t sat, uint8_t val);};##endif åœ¨ä¸»ç¨‹åº Main.c ä¸­è°ƒç”¨ï¼š 123456789101112131415NeoPixelController strip(32); // æ§åˆ¶32é¢—ç¯ç int main() { SetSysClock(CLK_SOURCE_PLL_48MHz); strip.begin(); strip.setBrightness(50); while(1) { // è·‘ä¸ªå½©è™¹ç‰¹æ•ˆ static uint8_t hue = 0; strip.rainbow(hue++, 255, 255); strip.show(); DelayMs(10); }} æ€»ç»“é€šè¿‡SPI+DMAçš„æ–¹å¼é©±åŠ¨WS2812ï¼Œæœ€å¤§çš„ä¼˜åŠ¿åœ¨äºæ—¶åºæå…¶ç¨³å®šï¼Œä¸”ä¸æ¶ˆè€—CPUç®—åŠ›.è¿™å¯¹äºCH592Fè¿™ç§å•æ ¸è“ç‰™SoCæ¥è¯´éå¸¸é‡è¦ï¼Œé¿å…äº†å› ä¸ºå…³é—­ä¸­æ–­å†™æ—¶åºè€Œå¯¼è‡´è“ç‰™è¿æ¥ä¸ç¨³å®šçš„é—®é¢˜. å”¯ä¸€çš„ä»£ä»·å°±æ˜¯å†…å­˜å ç”¨ç¨å¾®å¤§äº†ä¸€äº›ï¼ˆæ¯ä¸ªLEDéœ€è¦12å­—èŠ‚çš„SPI bufferï¼‰ï¼Œä½†å¯¹äºå‡ åé¢—ç¯ç çš„è£…é¥°åº”ç”¨æ¥è¯´ï¼ŒCH592Fçš„RAMç»°ç»°æœ‰ä½™. è¡¥å……è¯´æ˜ä»£ç ä¸ä»…ä»…å¯ä»¥è¿è¡Œåœ¨CH592ç³»åˆ—èŠ¯ç‰‡, è¿˜å¯ä»¥è¿è¡Œåœ¨CH582ç³»åˆ—èŠ¯ç‰‡.","link":"/2025/12/01/ch58x-dma-spi-ws2812-driver/"},{"title":"ESP32 è¿›é˜¶å¼€å‘æ‚è°ˆï¼šä»å¼‚æ­¥è¯·æ±‚ã€åŠ¨å›¾æ˜¾ç¤ºåˆ°èµ„æºOTA","text":"å‰è¨€ å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªESP32é¡¹ç›®ï¼Œå¾€å¾€ä¼šæ‰è¿›å„ç§å„æ ·çš„â€œå‘â€é‡Œã€‚ åœ¨ä¹‹å‰çš„ä¸€äº›é¡¹ç›®ä¸­(æ¯”å¦‚åšä¸ªæ¡Œé¢åƒç´ å°å±å¹•å§)ï¼Œæˆ‘é‡åˆ°è¿‡å„ç§å„æ ·çš„é—®é¢˜ï¼šç½‘ç»œè¯·æ±‚å¡æ­»ä¸»çº¿ç¨‹ã€å±å¹•æ˜¾ç¤ºå¤ªå•è°ƒã€ä¼‘çœ æ—¶PWMåœè½¬ã€ä»¥åŠæ¯æ¬¡åªæ›´æ–°å‡ å¼ å›¾ç‰‡å´è¦é‡åˆ·æ•´ä¸ªå›ºä»¶çš„ç—›è‹¦ã€‚ æŠŠè¿™äº›å‘è¸©å¹³ä¹‹åï¼Œæˆ‘æ•´ç†äº†å››ä¸ªåœ¨ESP32å¼€å‘ä¸­éå¸¸å®ç”¨çš„æŠ€å·§ã€‚ä¸ºäº†é¿å…å¤§å®¶é‡è¹ˆè¦†è¾™ï¼Œä¹Ÿä¸ºäº†æ–¹ä¾¿æˆ‘è‡ªå·±æ—¥åæŸ¥é˜…ï¼ˆCopyï¼‰ï¼Œè¿™ç¯‡æ–‡ç« å°†æŠŠè¿™äº›æŠ€æœ¯ç‚¹æ±‡æ€»èµ·æ¥ã€‚ å¸Œæœ›èƒ½ç»™æ­£åœ¨æŠ˜è…¾ESP32çš„ä½ æä¾›ä¸€äº›çµæ„Ÿã€‚ æŠ€å·§ä¸€ï¼šæ‹’ç»é˜»å¡ï¼ä½¿ç”¨å¼‚æ­¥ç½‘ç»œè¯·æ±‚ç—›ç‚¹åˆ†æåœ¨æ—©æœŸçš„åƒç´ å°å±å¹•é¡¹ç›®ä¸­ï¼Œæˆ‘ä¸ºäº†è·å–Bç«™ç²‰ä¸æ•°ï¼Œç›´æ¥ä½¿ç”¨äº†åŒæ­¥çš„HTTP Clientã€‚ç»“æœå°±æ˜¯æ¯æ¬¡è¯·æ±‚ç½‘ç»œæ—¶ï¼Œæ•´ä¸ªè®¾å¤‡çš„UIéƒ½ä¼šå¡ä½å‡ ç™¾æ¯«ç§’ç”šè‡³å‡ ç§’ã€‚è¿™å¯¹äºç”¨æˆ·ä½“éªŒæ¥è¯´ç®€ç›´æ˜¯ç¾éš¾â€”â€”ä½ ä¸èƒ½è®©ç”¨æˆ·è§‰å¾—è®¾å¤‡â€œæ­»æœºâ€äº†ã€‚ ä¸ºäº†ä¼˜é›…ï¼Œå¿…é¡»ä¸Šå¼‚æ­¥ã€‚ è§£å†³æ–¹æ¡ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ AsyncTCP åº“æ¥å®ç°éé˜»å¡çš„HTTPè¯·æ±‚ã€‚è™½ç„¶å†™èµ·æ¥å›è°ƒå‡½æ•°ï¼ˆCallbackï¼‰å¥—å¨ƒæœ‰ç‚¹å¤šï¼Œä½†æ¢æ¥çš„æ˜¯ä¸èˆ¬é¡ºæ»‘çš„ä¸»å¾ªç¯ã€‚ æ ¸å¿ƒä»£ç è¿™é‡Œä½¿ç”¨çš„æ˜¯ AsyncTCP-esphome åº“ã€‚ AsyncRequest.cpp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#include &lt;Arduino.h&gt;#include &lt;AsyncTCP.h&gt;#include &lt;WiFi.h&gt;// ... WiFié…ç½®çœç•¥ ...void asyncReqeust() { static AsyncClient *aClient; if (aClient) return; // é˜²æ­¢é‡å¤åˆ›å»º aClient = new AsyncClient(); if (!aClient) return; // æ³¨å†Œé”™è¯¯å›è°ƒ aClient-&gt;onError([](void *arg, AsyncClient *client, int error) { Serial.println(&quot;Connect Error&quot;); aClient = NULL; delete client; }, NULL); // æ³¨å†Œè¿æ¥å›è°ƒ aClient-&gt;onConnect([](void *arg, AsyncClient *client) { Serial.println(&quot;Connected&quot;); aClient-&gt;onError(NULL, NULL); // æ³¨å†Œæ–­å¼€è¿æ¥å›è°ƒ client-&gt;onDisconnect([](void *arg, AsyncClient *c) { aClient = NULL; delete c; Serial.println(&quot;Disconnected&quot;); }, NULL); // æ³¨å†Œæ•°æ®æ¥æ”¶å›è°ƒï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰ client-&gt;onData([](void *arg, AsyncClient *c, void *data, size_t len) { Serial.write((uint8_t *)data, len); // è¿™é‡Œå¯ä»¥è§£æJSONæ•°æ® }, NULL); // å‘é€HTTP GETè¯·æ±‚ client-&gt;write(&quot;GET /x/relation/stat?vmid=14374079 HTTP/1.1\\r\\n&quot; &quot;Host: api.bilibili.com\\r\\n&quot; &quot;Content-Type: application/json; charset=utf-8\\r\\n\\r\\n&quot;); }, NULL); if (!aClient-&gt;connect(&quot;api.bilibili.com&quot;, 80)) { Serial.println(&quot;Connect Fail&quot;); AsyncClient *client = aClient; aClient = NULL; delete client; }} è¿™æ ·ï¼Œç½‘ç»œè¯·æ±‚åœ¨åå°é»˜é»˜è¿›è¡Œï¼Œä½ çš„ä¸»å¾ªç¯ loop() ä¾ç„¶å¯ä»¥è·‘å¾—é£èµ·ï¼Œå»å¤„ç†æŒ‰é”®æ‰«ææˆ–è€…å±å¹•åˆ·æ–°ã€‚ æŠ€å·§äºŒï¼šè®©ç”»é¢åŠ¨èµ·æ¥â€”â€”æ’­æ”¾GIFåŠ¨å›¾è§†è§‰å‡çº§ç½‘ç»œé€šç•…äº†ï¼Œç•Œé¢ä¹Ÿä¸èƒ½å¤ªå¯’é…¸ã€‚åœ¨åšä¸€ä¸ªå¸¦æœ‰240x135åˆ†è¾¨ç‡çš„è£…ç½®æ—¶ï¼Œæˆ‘å®åœ¨æƒ³ä¸å‡ºä»€ä¹ˆé«˜çº§çš„ç®—æ³•åŠ¨ç”»ï¼Œäºæ˜¯å†³å®šâ€œå·æ‡’â€ï¼šç›´æ¥åœ¨å±å¹•ä¸Šæ’­æ”¾GIFè¡¨æƒ…åŒ…ã€‚ è¿™é‡Œæ¨èä½¿ç”¨ AnimatedGIF åº“ï¼Œé…åˆ TFT_eSPI é©±åŠ¨ï¼Œæ•ˆæœéå¸¸ä¸é”™ã€‚ åˆ¶ä½œGIFå¤´æ–‡ä»¶é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŠŠGIFæ–‡ä»¶è½¬æ¢æˆä»£ç èƒ½è¯»å–çš„æ•°ç»„ã€‚åœ¨Linuxæˆ–è€…WSLå­ç³»ç»Ÿä¸‹ï¼Œä¸€è¡Œ xxd å‘½ä»¤å°±èƒ½æå®šï¼š 12## å°†GIFè½¬æ¢ä¸ºCæ•°ç»„xxd -i angry_80px.gif &gt;&gt; loading.h ç”Ÿæˆçš„ loading.h é‡Œé¢å°±æ˜¯ä¸€ä¸ªå·¨å¤§çš„ unsigned char æ•°ç»„ã€‚ é©±åŠ¨ä»£ç ä»£ç åŸºäºå®˜æ–¹ç¤ºä¾‹ä¿®æ”¹ï¼Œé€‚é…äº† TFT_eSPIã€‚ GifPlayer.cpp1234567891011121314151617181920212223242526272829##include &lt;AnimatedGIF.h&gt;##include &lt;TFT_eSPI.h&gt;##include &quot;loading.h&quot; // åˆšæ‰ç”Ÿæˆçš„å¤´æ–‡ä»¶AnimatedGIF gif;TFT_eSPI tft = TFT_eSPI();// å›è°ƒå‡½æ•°ï¼šå°†è§£ç åçš„ä¸€è¡Œåƒç´ æ¨é€åˆ°å±å¹•void GIFDraw(GIFDRAW *pDraw) { // ... æ ¸å¿ƒç»˜åˆ¶é€»è¾‘ï¼ŒåŒ…å«é€æ˜åº¦å¤„ç†å’ŒDMAåŠ é€Ÿ ... // ç¯‡å¹…åŸå› ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯è°ƒç”¨ tft.pushPixels å°† pDraw-&gt;pPixels æ¨é€æ˜¾ç¤º // å®Œæ•´é€»è¾‘å‚è€ƒ AnimatedGIF çš„ TFT_eSPI_memory ç¤ºä¾‹}void setup() { tft.begin(); tft.setRotation(1); tft.fillScreen(TFT_BLACK); gif.begin(BIG_ENDIAN_PIXELS);}void loop() { if (gif.open((uint8_t *)angry_80px_gif, sizeof(angry_80px_gif), GIFDraw)) { while (gif.playFrame(true, NULL)) { yield(); // å–‚ç‹—ï¼Œé˜²æ­¢å¤ä½ } gif.close(); }} åªè¦å†…å­˜å¤Ÿå¤§ï¼Œæ”¾ä¸ªè”¡å¾å¤æ‰“ç¯®çƒçš„GIFä¹Ÿä¸æ˜¯ä¸å¯èƒ½ï¼ˆé€ƒï¼‰ã€‚ æŠ€å·§ä¸‰ï¼šLight-Sleepæ¨¡å¼ä¸‹ä¿æŒPWMè¾“å‡ºå¥‡æ€ªçš„éœ€æ±‚æœ‰äº›åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚èƒŒå…‰ä¿æŒï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ESP32è¿›å…¥ Light-Sleep çœç”µï¼Œä½†åˆä¸å¸Œæœ› å±å¹•èƒŒå…‰çš„PWM ä¿¡å·ä¸­æ–­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿›å…¥ç¡çœ åé«˜é€Ÿæ—¶é’Ÿä¼šå…³é—­ï¼Œå¯¼è‡´ PWM åœæ‘†ã€‚ å¼€å¯ RTC8M æ—¶é’ŸæŸ¥é˜… ESP-IDF æ‰‹å†Œå‘ç°ï¼Œå¦‚æœå°† PWM çš„æ—¶é’Ÿæºé…ç½®ä¸º RTC8M_CLKï¼Œå³ä½¿åœ¨ Light-Sleep ä¸‹ä¹Ÿèƒ½å·¥ä½œã€‚ä½†è¿™æœ‰ä¸ªå‰æï¼Œéœ€è¦ä¿®æ”¹ menuconfigã€‚ ç¯å¢ƒé…ç½®ï¼š 1idf.py menuconfig è¿›å…¥ Component config -&gt; Hardware Settings -&gt; Sleep Configã€‚åŠ¡å¿…å…³é—­ light sleep GPIO reset workaroundã€‚ ä»£ç å®ç°ï¼šä½¿ç”¨ ESP-IDF åŸç”Ÿ API é…ç½® LEDCã€‚ pwm_sleep.c1234567891011121314151617181920212223242526272829#include &quot;driver/ledc.h&quot;#include &quot;esp_sleep.h&quot;void app_main(void) { // 1. å®šæ—¶å™¨é…ç½®ï¼šé‡ç‚¹æ˜¯é€‰ç”¨ LEDC_USE_RTC8M_CLK ledc_timer_config_t ledc_timer = { .duty_resolution = LEDC_TIMER_13_BIT, .freq_hz = 1000, .speed_mode = LEDC_LOW_SPEED_MODE, // å¿…é¡»æ˜¯ä½é€Ÿæ¨¡å¼ .timer_num = LEDC_TIMER_0, .clk_cfg = LEDC_USE_RTC8M_CLK, // å…³é”®ï¼ }; ESP_ERROR_CHECK(ledc_timer_config(&amp;ledc_timer)); // 2. é€šé“é…ç½®... (å¸¸è§„é…ç½®ï¼Œç•¥) // 3. å¼ºåˆ¶å¼€å¯RTC8Mç”µæºåŸŸ esp_sleep_pd_config(ESP_PD_DOMAIN_RTC8M, ESP_PD_OPTION_ON); while (1) { // è®¾ç½®ä¸€ä¸ªå ç©ºæ¯” ledc_set_duty(LEDC_LOW_SPEED_MODE, LEDC_CHANNEL_0, 1000); ledc_update_duty(LEDC_LOW_SPEED_MODE, LEDC_CHANNEL_0); // è¿›å…¥æµ…ç¡çœ ï¼ŒPWMä¾ç„¶ä¼šä¿æŒè¾“å‡º esp_sleep_enable_timer_wakeup(1000 * 1000 * 5); // ç¡5ç§’ esp_light_sleep_start(); }} å®æµ‹è¿™ä¸ªåŠŸèƒ½å¯¹äºé™ä½åŠŸè€—éå¸¸æœ‰ç”¨ã€‚ æŠ€å·§å››ï¼šåªæ›´æ–°èµ„æºæ–‡ä»¶ï¼Ÿè¯•è¯• SPIFFS åˆ†åŒº OTAåœºæ™¯éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œæˆ‘å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šæœ‰æ—¶å€™æˆ‘åªæƒ³æ›´æ–°ä¸€ä¸‹UIé‡Œçš„å›¾ç‰‡èµ„æºæˆ–è€…å­—ä½“åº“ï¼Œå¹¶ä¸æƒ³æ›´æ–°ä»£ç ã€‚ä¼ ç»Ÿçš„OTAæ˜¯æ›´æ–° App åˆ†åŒºï¼Œè¿™å¾ˆæµªè´¹æµé‡å’Œæ—¶é—´ã€‚å…¶å®æˆ‘ä»¬å®Œå…¨å¯ä»¥åªé’ˆå¯¹ SPIFFS æ•°æ®åˆ†åŒºè¿›è¡Œ OTAã€‚ åˆ†åŒºè¡¨è®¾è®¡é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰åˆ†åŒºè¡¨ï¼ˆpartitions.csvï¼‰ï¼ŒæŠŠæ•°æ®ç‹¬ç«‹å‡ºæ¥ã€‚ 12345## Name, Type, SubType, Offset, Size, Flagsnvs, data, nvs, 0x9000, 0x5000,otadata, data, ota, 0xe000, 0x2000,app0, app, ota_0, 0x10000, 0x300000,storage, data, spiffs, 0x310000, 0xC000, è¿™é‡Œæˆ‘åˆ’äº†ä¸€ä¸ª 48KB çš„ storage åˆ†åŒºç”¨äºæ¼”ç¤ºã€‚ OTA æ ¸å¿ƒé€»è¾‘ä¸åŒäºæ›´æ–° Appï¼Œæ›´æ–°åˆ†åŒºå®é™…ä¸Šå°±æ˜¯â€œæ“¦é™¤ + å†™å…¥â€çš„è¿‡ç¨‹ã€‚å‡è®¾æ–°çš„æ–‡ä»¶é•œåƒå·²ç»é€šè¿‡ç½‘ç»œä¸‹è½½åˆ°äº†å†…å­˜ä¸­ï¼ˆæˆ–è€…åƒæœ¬ä¾‹ä¸€æ ·ï¼Œä¸ºäº†æ¼”ç¤ºç›´æ¥ embed åœ¨ä»£ç é‡Œï¼‰ã€‚ spiffs_ota.c123456789101112131415161718192021222324void update_spiffs_partition() { // 1. æŸ¥æ‰¾ SPIFFS åˆ†åŒº const esp_partition_t *spiffs_part = esp_partition_find_first( ESP_PARTITION_TYPE_DATA, ESP_PARTITION_SUBTYPE_DATA_SPIFFS, NULL); if (spiffs_part == NULL) { ESP_LOGE(&quot;OTA&quot;, &quot;SPIFFS partition not found!&quot;); return; } // 2. æ“¦é™¤åŸåˆ†åŒºå†…å®¹ ESP_LOGI(&quot;OTA&quot;, &quot;Erasing partition...&quot;); esp_partition_erase_range(spiffs_part, 0, spiffs_part-&gt;size); // 3. å†™å…¥æ–°æ•°æ® // å‡è®¾ spiffs2_start å’Œ spiffs2_end æ˜¯æ–°é•œåƒåœ¨å†…å­˜ä¸­çš„åœ°å€ size_t image_size = spiffs2_end - spiffs2_start - 1; ESP_LOGI(&quot;OTA&quot;, &quot;Writing new data: %d bytes&quot;, image_size); esp_partition_write(spiffs_part, 0, spiffs2_start, image_size); ESP_LOGI(&quot;OTA&quot;, &quot;Done! Restarting...&quot;); esp_restart();} è¿™ä¸ªæŠ€å·§åœ¨åšå›¾ç‰‡æ›´æ¢ã€å­—ä½“åˆ‡æ¢ç­‰åŠŸèƒ½æ—¶ç‰¹åˆ«å¥½ç”¨ï¼Œä¸ç”¨åŠ¨æ ¸å¿ƒä»£ç ï¼Œå®‰å…¨åˆå¿«é€Ÿã€‚ æ€»ç»“ä»¥ä¸Šå°±æ˜¯æˆ‘è¿‘æœŸæŠ˜è…¾ESP32æ—¶æ€»ç»“çš„å››ä¸ªå®ç”¨æŠ€å·§ã€‚ä»é¿å…é˜»å¡çš„å¼‚æ­¥è¯·æ±‚ï¼Œåˆ°èŠ±é‡Œèƒ¡å“¨çš„GIFæ’­æ”¾ï¼Œå†åˆ°ä½åŠŸè€—ä¸‹çš„PWMæ§åˆ¶å’Œçµæ´»çš„èµ„æºOTAï¼Œæ¯ä¸€ä¸ªç‚¹éƒ½æ˜¯åœ¨å®é™…å¼€å‘ä¸­ä¸ºäº†è§£å†³ç‰¹å®šç—›ç‚¹è€Œæ‘¸ç´¢å‡ºæ¥çš„ã€‚ ç¡¬ä»¶å¼€å‘çš„ä¹è¶£å¤§æ¦‚å°±åœ¨äºæ­¤ï¼šé‡åˆ°ä¸€ä¸ªå‘ï¼Œå¡«å¹³å®ƒï¼Œç„¶åçœ‹ç€è®¾å¤‡æŒ‰ç…§é¢„æƒ³çš„æ–¹å¼è¿è¡Œï¼Œé‚£ç§æˆå°±æ„Ÿæ˜¯æ— æ³•æ›¿ä»£çš„ã€‚ å¸Œæœ›è¿™äº›ç¬”è®°å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæˆ‘ä»¬ä¸‹ä¸ªé¡¹ç›®è§ï¼","link":"/2022/09/20/esp32-advanced-dev-tips/"},{"title":"å¤åˆ» Stack Overflow æ„šäººèŠ‚â€œç¥ä½œâ€ï¼š3 é”®æœºæ¢°é”®ç›˜å®æˆ˜æŒ‡å—","text":"èƒŒæ™¯2021 å¹´æ„šäººèŠ‚ï¼ŒStack Overflow æäº†ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„å½©è›‹ï¼šé™åˆ¶ç”¨æˆ·çš„å¤åˆ¶æ¬¡æ•°ï¼Œå¹¶â€œæ¨é”€â€äº†ä¸€æ¬¾åªæœ‰ä¸‰ä¸ªé”®çš„å®šåˆ¶é”®ç›˜ã€‚ è¿™ä¸ªå°å·§ç²¾è‡´çš„é”®ç›˜æ¿€å‘äº†æˆ‘çš„åˆ›ä½œæ¬²ã€‚æ€è€ƒäº†ä¸€ä¸‹ï¼Œå®ç°é€»è¾‘å…¶å®éå¸¸ç®€å•ï¼ŒåŸºæœ¬ä¸ŠæŠŠæˆ‘ä¹‹å‰åšçš„â€œåŸç¥è‡ªåŠ¨å¼¹ç´è£…ç½®â€ç¨åŠ ä¿®æ”¹å³å¯ï¼Œæ ¸å¿ƒä»£ç ç”šè‡³åœ¨ç™¾è¡Œä»¥å†…ã€‚ éšåæˆ‘æ‰“å¼€ KiCad ç›´æ¥å¼€å¹²ï¼Œä»åŸç†å›¾åˆ° 3D æ¸²æŸ“ä¸€æ°”å‘µæˆã€‚ğŸ› ï¸ æ ¸å¿ƒè®¾è®¡æ€è·¯ï¼šä¸ºä»€ä¹ˆæ˜¯ ATMega32u4ï¼Ÿåœ¨å¼€å§‹åˆ¶ä½œä¹‹å‰ï¼Œé€‰å‹æ˜¯å…³é”®ã€‚Stack Overflow å®˜æ–¹å½©è›‹ä¸­çš„é”®ç›˜åªæœ‰ä¸‰ä¸ªé”®ï¼šCtrlã€Cã€Vã€‚ ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘é€‰æ‹©äº† ATMega32u4 ä½œä¸ºä¸»æ§ï¼š åŸç”Ÿ HID æ”¯æŒï¼š ä¸æ™®é€šçš„ ESP32 æˆ– ATMega328P ä¸åŒï¼Œ32u4 è‡ªå¸¦ç¡¬ä»¶ USB æ”¯æŒï¼Œå¯ä»¥ç›´æ¥è¢«ç”µè„‘è¯†åˆ«ä¸ºæ ‡å‡†é”®ç›˜ï¼ˆHID ç»ˆç«¯ï¼‰ï¼Œæ— éœ€é¢å¤–çš„ä¸²å£è½¬ USB èŠ¯ç‰‡ã€‚ æˆç†Ÿçš„å›ºä»¶åº“ï¼š åˆ©ç”¨ Arduino çš„ Keyboard.h åº“ï¼Œå¯ä»¥æé€Ÿå®ç°ç»„åˆé”®é€»è¾‘ã€‚ ğŸ“ ç¡¬ä»¶å¼€å‘ï¼šKiCad æµç¨‹ä¸ PCB ç»†èŠ‚åœ¨ KiCad ä¸­ï¼Œæˆ‘è®¾è®¡äº†ä¸€å—æç®€çš„ 3% é…åˆ— çº¿è·¯æ¿ã€‚ æ¸²æŸ“æ•ˆæœ å…³é”®ç”µè·¯ç‰¹æ€§ çƒ­æ’æ‹”æ”¯æŒï¼š å¼•å…¥äº†å‡¯åçƒ­æ’æ‹”è½´åº§ï¼ˆ1511 ç³»åˆ—ï¼‰ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥éšæ—¶æ›´æ¢é’è½´ã€çº¢è½´æˆ–é™éŸ³è½´ã€‚ ç”µæºç®¡ç†ï¼š ä½¿ç”¨äº† AP2112K-3.3 LDO èŠ¯ç‰‡ï¼Œç¡®ä¿ 32u4 åœ¨ç¨³å®šçš„ç”µå‹ä¸‹å·¥ä½œï¼Œå¹¶åŠ å…¥è‚–ç‰¹åŸºäºŒæç®¡é˜²æ­¢ Type-C æ¥å£åå‘ä¾›ç”µã€‚ æ¨¡å¼åˆ‡æ¢ï¼š å¢åŠ äº†ä¸€ä¸ª 2 ä½æ‹¨ç å¼€å…³ã€‚è¿™ä¸ä»…å¯ä»¥ç”¨æ¥åˆ‡æ¢ä¸åŒçš„æŒ‰é”®æ˜ å°„ï¼ˆå¦‚ Mac/Win åˆ‡æ¢ï¼‰ï¼Œè¿˜èƒ½å¼€å¯æˆ–å…³é—­â€œè¿å‘æ¨¡å¼â€ã€‚ ğŸ’» è½¯ä»¶å®ç°ï¼šç»„åˆé”®é€»è¾‘å›ºä»¶çš„æ ¸å¿ƒé€»è¾‘æ˜¯å°†ç‰©ç†æŒ‰é”®çš„ç”µå¹³å˜åŒ–æ˜ å°„ä¸ºæ ‡å‡†çš„ HID ç¼–ç ã€‚å®ç° Ctrl + C çš„é€»è¾‘å¦‚ä¸‹ï¼š 1234567// ç¤ºä¾‹ï¼šå®ç° Ctrl + C çš„ä¼ªä»£ç if (digitalRead(KEY_C_PIN) == LOW) { Keyboard.press(KEY_LEFT_CTRL); // å…ˆæŒ‰ä¸‹ Ctrl Keyboard.press('c'); // å†æŒ‰ä¸‹ C delay(100); // ä¿æŒä¸€å°æ®µæ—¶é—´ Keyboard.releaseAll(); // é‡Šæ”¾æ‰€æœ‰æŒ‰é”®} ææ–™æ¸…å• (BOM) åºå· åç§° æ•°é‡ å¤‡æ³¨ 1 ATMega32u4 1 ä¸»æ§èŠ¯ç‰‡ QFN44å°è£… 2 AP2112K-3.3 1 5Vè½¬3.3VèŠ¯ç‰‡ SOT-23-5 3 16Mhzæ™¶æŒ¯ 1 2.0*1.6 4 1uFç”µå®¹ 1 0603 5 22pfç”µå®¹ 2 0603 6 10ufç”µå®¹ 2 0603 7 1KÎ©ç”µé˜» 5 0805 8 10KÎ©ç”µé˜» 1 0805 9 22Î©ç”µé˜» 2 0805 10 å‡¯åçƒ­æ’æ‹”è½´åº§ 3 1511ç³»åˆ— 11 è½´ä½“ 3 ä»»æ„è½´ä½“ 12 2ä½æ‹¨ç å¼€å…³ 1 1.27mm 13 Type-Cæ¥å£ 1 16p 14 è‚–ç‰¹åŸºäºŒæç®¡ 1 BAT60JFILM SOD-323 15 å¾®åŠ¨å¼€å…³ 1 3x4x2.5 å››è„šè´´ç‰‡ ç„Šæ¥ä¸ç»„è£…ç„Šæ¥å¿ƒå¾—ï¼š QFN44 å°è£…è™½ç„¶å¼•è„šå¯†é›†ï¼Œä½†åœ¨æ¶‚æŠ¹é€‚é‡é”¡è†åï¼Œé…åˆçƒ­é£æªï¼ˆå»ºè®® 350Â°Cï¼Œä¸­ç­‰é£é€Ÿï¼‰å¯ä»¥å®ç°è‡ªåŠ¨å¯¹å‡†å¸é™„ã€‚ ç»„è£…ï¼š ç®€å•çš„ç”»äº†ä¸ªæ–¹ç›’å­ä½œä¸ºå¤–å£³ï¼Œç„¶åä»æˆ‘çš„æ—§é”®ç›˜ä¸Šæ‰£ä¸‹æ¥ä¸‰ä¸ªé”®å¸½è£…ä¸Šå»ã€‚ è¿›é˜¶ç‰¹æ€§ä¸å¼€æºè¿™æŠŠé”®ç›˜è™½ç„¶æºäºå½©è›‹ï¼Œä½†å…·å¤‡å¾ˆå¼ºçš„å®ç”¨æ€§ï¼š è¿å‘æ¨¡å¼ï¼š é€šè¿‡æ‹¨ç å¼€å…³å¼€å¯ï¼Œé€‚åˆæŸäº›éœ€è¦å¿«é€Ÿé‡å¤æ“ä½œçš„åœºæ™¯ã€‚ å…¨å¹³å°å…¼å®¹ï¼š åŸºäºæ ‡å‡† HID åè®®ï¼Œæ’ä¸Šå³ç”¨ï¼Œæ— éœ€å®‰è£…é©±åŠ¨ã€‚ å¼€æºåœ°å€ï¼š https://github.com/chaosgoo/HairsPP é™„ï¼šHID æ‰«æç é€ŸæŸ¥è¡¨ (éƒ¨åˆ†)ä¸ºäº†æ–¹ä¾¿è‡ªå®šä¹‰æŒ‰é”®ï¼Œæˆ‘æ•´ç†äº†å¸¸ç”¨çš„éæ ‡å‡†æŒ‰é”®ç¼–ç ã€‚ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹å›ºä»¶ï¼Œå®ç° F13-F24 ç­‰å®åŠŸèƒ½ã€‚ æ§åˆ¶ä¸ä¿®é¥°é”® (Modifier Keys) å®šä¹‰ ç¼–ç  (Hex) åŠŸèƒ½æè¿° KEY_LEFT_CTRL 0x80 å·¦ä¾§ Ctrl é”® KEY_LEFT_SHIFT 0x81 å·¦ä¾§ Shift é”® KEY_LEFT_ALT 0x82 å·¦ä¾§ Alt é”® KEY_LEFT_GUI 0x83 å·¦ä¾§ Win / Command é”® KEY_RIGHT_CTRL 0x84 å³ä¾§ Ctrl é”® KEY_RIGHT_SHIFT 0x85 å³ä¾§ Shift é”® KEY_RIGHT_ALT 0x86 å³ä¾§ Alt é”® KEY_RIGHT_GUI 0x87 å³ä¾§ Win / Command é”® ç³»ç»Ÿä¸å¯¼èˆªé”® (System &amp; Navigation) å®šä¹‰ ç¼–ç  (Hex) åŠŸèƒ½æè¿° KEY_UP_ARROW 0xDA æ–¹å‘é”®ï¼šä¸Š KEY_DOWN_ARROW 0xD9 æ–¹å‘é”®ï¼šä¸‹ KEY_LEFT_ARROW 0xD8 æ–¹å‘é”®ï¼šå·¦ KEY_RIGHT_ARROW 0xD7 æ–¹å‘é”®ï¼šå³ KEY_BACKSPACE 0xB2 é€€æ ¼é”® (Backspace) KEY_TAB 0xB3 åˆ¶è¡¨é”® (Tab) KEY_RETURN 0xB0 å›è½¦é”® (Enter) KEY_ESC 0xB1 é€€å‡ºé”® (Esc) KEY_INSERT 0xD1 æ’å…¥é”® (Insert) KEY_DELETE 0xD4 åˆ é™¤é”® (Delete) KEY_PAGE_UP 0xD3 ä¸Šç¿»é¡µé”® (Page Up) KEY_PAGE_DOWN 0xD6 ä¸‹ç¿»é¡µé”® (Page Down) KEY_HOME 0xD2 èµ·å§‹é”® (Home) KEY_END 0xD5 ç»“æŸé”® (End) KEY_CAPS_LOCK 0xC1 å¤§å†™é”å®šé”® (Caps Lock) åŠŸèƒ½é”® (Function Keys) å®šä¹‰ ç¼–ç  (Hex) åŠŸèƒ½æè¿° KEY_F1 - KEY_F12 0xC2 - 0xCD æ ‡å‡†åŠŸèƒ½é”® F1 è‡³ F12 KEY_F13 - KEY_F24 0xF0 - 0xFB æ‰©å±•åŠŸèƒ½é”®ï¼ˆå¸¸ç”¨äºç»‘å®šå®å‘½ä»¤ï¼Œä¸ä¼šä¸ç³»ç»Ÿå¿«æ·é”®å†²çªï¼‰ æ€»ç»“ä¸å±•æœ›è¿™æŠŠå¤åˆ»è‡ª Stack Overflow æ„šäººèŠ‚å½©è›‹çš„ 3 é”®å®é”®ç›˜ï¼Œè™½ç„¶åˆè¡·æ˜¯ä¸ºäº†å¥½ç©ï¼Œä½†åœ¨å®é™…åˆ¶ä½œè¿‡ç¨‹ä¸­ï¼Œå®ƒæ¶µç›–äº† åŸç”Ÿ USB-HID é€šä¿¡ã€ç¡¬ä»¶ç”µè·¯è®¾è®¡ä»¥åŠäººä½“å·¥ç¨‹å­¦æŒ‰é”®æ˜ å°„ç­‰å¤šä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚ é€šè¿‡æœ¬é¡¹ç›®ï¼Œæˆ‘ä»¬ä¸ä»…å®ç°äº†ä¸€ä¸ªæç®€çš„ç”Ÿäº§åŠ›å·¥å…·ï¼Œæ›´æ·±å…¥ç†è§£äº†ï¼š ä¸»æ§é€‰å‹çš„é‡è¦æ€§ï¼šATMega32u4 çš„ç¡¬ä»¶ USB æ”¯æŒæ˜¯å®ç°ä½å»¶è¿Ÿã€é«˜å…¼å®¹æ€§ HID è®¾å¤‡çš„å…³é”®ã€‚ æ¨¡å—åŒ–è®¾è®¡çš„ä¼˜åŠ¿ï¼šå¼•å…¥çƒ­æ’æ‹”è½´åº§å’Œæ‹¨ç å¼€å…³ï¼Œè®©ä¸€ä¸ªå°å·§çš„ç¡¬ä»¶å…·å¤‡äº†æé«˜çš„è‡ªå®šä¹‰ç¨‹åº¦ã€‚ è½¯ç¡¬ç»“åˆçš„é­…åŠ›ï¼šç®€å•çš„å‡ è¡Œä»£ç ï¼Œé…åˆç²¾å‡†çš„ç¡¬ä»¶è§¦å‘ï¼Œå°±èƒ½å¤§å¹…æå‡æ—¥å¸¸åŠå…¬ä¸­é«˜é¢‘æ“ä½œï¼ˆå¦‚å‰ªè´´ã€ä»£ç é‡æ„ã€å®å‘½ä»¤æ‰§è¡Œï¼‰çš„æ•ˆç‡ã€‚","link":"/2021/04/01/diy-stackoverflow-3-key-macro-keyboard-with-atmega32u4/"},{"title":"å‘Šåˆ«ATæŒ‡ä»¤ï¼šESP32é€šè¿‡PPPoSé©±åŠ¨4Gæ¨¡å—ä¸Šç½‘","text":"å‰è¨€ åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯åˆ©ç”¨ESP32è‡ªå¸¦çš„WiFiè¿›è¡Œç½‘ç»œè¿æ¥ã€‚ä½†åœ¨æˆ·å¤–æˆ–è€…æ²¡æœ‰WiFiè¦†ç›–çš„è§’è½ï¼Œæƒ³è¦è®©è®¾å¤‡è”ç½‘ï¼Œå°±å¾—è¯·å‡ºâ€œ4Gæ¨¡å—â€äº†ã€‚ é€šå¸¸å¤§å®¶é©±åŠ¨4Gæ¨¡å—ï¼ˆæ¯”å¦‚SIM800, Air724, EC20ç­‰ï¼‰æœ€åŸå§‹çš„æ–¹æ³•æ˜¯ç”¨UARTå‘é€ATæŒ‡ä»¤ã€‚æ¯”å¦‚ AT+HTTPINITã€AT+HTTPPARAâ€¦ è¿™ç§æ–¹å¼ä¸ä»…ç¹çï¼Œè€Œä¸”è§£æè¿”å›å­—ç¬¦ä¸²ç®€ç›´æ˜¯å™©æ¢¦ï¼Œå†™å‡ºæ¥çš„ä»£ç å…¨æ˜¯çŠ¶æ€æœºï¼Œä¸€æ—¦æ¨¡å—åç‚¹ä¹±ç ï¼Œç¨‹åºç›´æ¥æš´æ¯™ã€‚æ‰‹åŠ¨è§£æATæŒ‡ä»¤ç®€ç›´æ˜¯åæ–‡æ˜ï¼ ä¸ºäº†ä¼˜é›…åœ°ä½¿ç”¨4Gæ¨¡å—ï¼Œæˆ‘å†³å®šä½¿ç”¨ PPPoS(Point-to-Point Protocol over Serial)ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠä¸²å£â€œä¼ªè£…â€æˆä¸€ä¸ªç½‘å¡ã€‚è¿™æ ·åº•å±‚çš„TCP/IPåè®®æ ˆï¼ˆLwIPï¼‰å°±èƒ½ç›´æ¥æ¥ç®¡ç½‘ç»œï¼Œæˆ‘ä»¬å†™ä¸Šå±‚ä»£ç æ—¶ï¼Œå®Œå…¨ä¸ç”¨å…³å¿ƒæ˜¯åœ¨ç”¨WiFiè¿˜æ˜¯4Gï¼Œç›´æ¥è°ƒæ ‡å‡†çš„Socketæ¥å£å°±å®Œäº‹äº†ã€‚ å‡†å¤‡å·¥ä½œ1. ç¡¬ä»¶è¿æ¥æ‰¾ä¸€ä¸ªæ”¯æŒPPPæ‹¨å·çš„æ¨¡å—ï¼ˆå¸‚é¢ä¸Šç»å¤§å¤šæ•°Cat.1/Cat.4æ¨¡å—éƒ½æ”¯æŒï¼‰ã€‚æˆ‘ç”¨çš„æ˜¯åˆå®™çš„Air780EG, è¿™ä¸ªæ¨¡å—å±äº4G+GNSSäºŒåˆä¸€æ¨¡å—, åœ¨åˆ¶ä½œéœ€è¦å®šä½çš„è®¾å¤‡å¾ˆæ–¹ä¾¿.å°†æ¨¡å—çš„ TX/RX æ¥åˆ° ESP32C3 çš„ä¸²å£å¼•è„šä¸Šï¼ˆè®°å¾—å…±åœ°ï¼‰ PS: æ¨¡å—è¿›å…¥PPPOSçŠ¶æ€ä»¥åGPSå°±ä¸èƒ½èµ°ä¸»ä¸²å£è¾“å‡ºå¥½æ¶ˆæ¯æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ESP32C3çš„å¦å¤–ä¸€ä¸ªä¸²å£å’ŒGPSä¸²å£å¯¹æ¥, è¿™æ ·å°±å¯ä»¥åŒæ—¶ä½¿ç”¨GPSå’Œ4G PPPOSæ‹¨å·äº†æ¯”å¦‚è¯´æˆ‘ç”¨çš„æ˜¯GPIO8å’ŒGPSTXè¿æ¥, TXD0å’ŒRXD0æ¥4Gæ¨¡å—çš„ä¸»ä¸²å£ æ ¸å¿ƒä»£ç å®ç°ç¤ºä¾‹é¡¹ç›®å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤åˆ›å»º 1idf.py create-project-from-example &quot;espressif/esp_modem=1.0.3:pppos_client&quot; æ¥ä¸‹æ¥ä¼šåŸºäº ESP-IDF çš„ pppos_client ç¤ºä¾‹è§£æè§£æå¹¶è¡¥å……è¯´æ˜. æ•´ä¸ªè¿‡ç¨‹å…¶å®å°±åˆ†ä¸‰æ­¥ï¼šå®šä¹‰äº‹ä»¶ã€åˆå§‹åŒ–DCE/DTEã€åˆ‡æ¢åˆ°æ•°æ®æ¨¡å¼ã€‚ 1. äº‹ä»¶å¤„ç† (Event Handler)PPPoS çš„è¿è¡Œä¾èµ–äºäº‹ä»¶é©±åŠ¨ã€‚æˆ‘ä»¬éœ€è¦ç›‘å¬ IP å±‚é¢çš„äº‹ä»¶ï¼Œå½“æ‹¿åˆ° IP åœ°å€æ—¶ï¼Œæ‰ç®—çœŸæ­£è”ç½‘æˆåŠŸã€‚ modem_event.c123456789101112131415161718192021222324static EventGroupHandle_t event_group = NULL;static const int CONNECT_BIT = BIT0;static const int DISCONNECT_BIT = BIT1;// ç›‘å¬ IP è·å–äº‹ä»¶static void on_ip_event(void *arg, esp_event_base_t event_base, int32_t event_id, void *event_data){ if (event_id == IP_EVENT_PPP_GOT_IP) { ip_event_got_ip_t *event = (ip_event_got_ip_t *)event_data; // æ‰“å°ä¸€ä¸‹è·å–åˆ°çš„IPä¿¡æ¯ï¼Œçœ‹ç€å°±èˆ’æœ ESP_LOGI(TAG, &quot;Modem Connect to PPP Server&quot;); ESP_LOGI(TAG, &quot;IP : &quot; IPSTR, IP2STR(&amp;event-&gt;ip_info.ip)); ESP_LOGI(TAG, &quot;Netmask : &quot; IPSTR, IP2STR(&amp;event-&gt;ip_info.netmask)); ESP_LOGI(TAG, &quot;Gateway : &quot; IPSTR, IP2STR(&amp;event-&gt;ip_info.gw)); // é€šçŸ¥ä¸»ä»»åŠ¡ï¼šæˆ‘ä»¬è¿ä¸Šç½‘äº†ï¼ xEventGroupSetBits(event_group, CONNECT_BIT); } else if (event_id == IP_EVENT_PPP_LOST_IP) { ESP_LOGW(TAG, &quot;Modem Disconnect from PPP Server&quot;); xEventGroupSetBits(event_group, DISCONNECT_BIT); }} 2. åˆå§‹åŒ–ä¸æ‹¨å·è¿™ä¸€æ­¥æ˜¯é‡å¤´æˆã€‚æˆ‘ä»¬éœ€è¦åˆå§‹åŒ– Netifï¼ˆç½‘ç»œæ¥å£ï¼‰ï¼Œé…ç½® DTEï¼ˆæ•°æ®ç»ˆç«¯è®¾å¤‡ï¼Œå³ESP32C3ç«¯çš„UARTï¼‰ï¼Œç„¶ååˆå§‹åŒ– DCEï¼ˆæ•°æ®é€šä¿¡è®¾å¤‡ï¼Œå³4Gæ¨¡å—ï¼‰ã€‚ main.c12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455void app_main(void){ // 1. åˆå§‹åŒ–ç½‘ç»œæ¥å£å’Œäº‹ä»¶å¾ªç¯ ESP_ERROR_CHECK(esp_netif_init()); ESP_ERROR_CHECK(esp_event_loop_create_default()); ESP_ERROR_CHECK(esp_event_handler_register(IP_EVENT, ESP_EVENT_ANY_ID, &amp;on_ip_event, NULL)); event_group = xEventGroupCreate(); // 1.5 é‡å¯æ¨¡å—, æˆ‘çš„æ¨¡å—Resetè„šæ¥çš„GPIO7 gpio_config_t io_config = {.pin bit mask = BIT64(7), .mode = GPIO MODE OUTPUT}; gpio_config(&amp;io_config); gpio_set_level(7ï¼Œ0); TaskDelay(pdMS_TO_TICKS(500)); gpio_set_level(7ï¼Œ1); // 2. é…ç½® PPP ç½‘ç»œæ¥å£ esp_modem_dce_config_t dce_config = ESP_MODEM_DCE_DEFAULT_CONFIG(&quot;cmnet&quot;); // APNé€šå¸¸æ˜¯cmnet esp_netif_config_t netif_ppp_config = ESP_NETIF_DEFAULT_PPP(); esp_netif_t *esp_netif = esp_netif_new(&amp;netif_ppp_config); // 3. é…ç½®ä¸²å£ (DTE) esp_modem_dte_config_t dte_config = ESP_MODEM_DTE_DEFAULT_CONFIG(); dte_config.uart_config.tx_io_num = 21; // TXå¼•è„š dte_config.uart_config.rx_io_num = 20; // RXå¼•è„š dte_config.uart_config.flow_control = ESP_MODEM_FLOW_CONTROL_NONE; // æ²¡æ¥æµæ§çº¿å°±é€‰NONE // 4. åˆ›å»º Modem å¯¹è±¡ (è¿™é‡Œæ ¹æ®å®é™…å‹å·é€‰æ‹©, ç”±äºæ²¡æœ‰Air780egçš„é…ç½®,æ‰€ä»¥ä½¿ç”¨çš„ESP_MODEM_DCE_CUSTOM) ESP_LOGI(TAG, &quot;Initializing esp_modem...&quot;); esp_modem_dce_t *dce = esp_modem_new_dev(ESP_MODEM_DCE_CUSTOM, &amp;dte_config, &amp;dce_config, esp_netif); // 5. æ£€æŸ¥ä¿¡å·è´¨é‡, å¦‚æœæ²¡æœ‰ä¿¡å·, å¾ˆå¤§æ¦‚ç‡ä¼šæœ‰é—®é¢˜, 4Gæ¨¡å—å¯èƒ½æ²¡æœ‰æ­£å¸¸å·¥ä½œ int rssi, ber; if (esp_modem_get_signal_quality(dce, &amp;rssi, &amp;ber) == ESP_OK) { ESP_LOGI(TAG, &quot;Signal quality: rssi=%d, ber=%d&quot;, rssi, ber); } // 6. å…³é”®æ­¥éª¤ï¼šåˆ‡æ¢åˆ° DATA æ¨¡å¼ï¼ // è¿™ä¸€æ­¥ä¹‹åï¼Œä¸²å£å°±å˜æˆäº†é€æ˜ä¼ è¾“çš„ç½‘å¡é€šé“ï¼Œä¸èƒ½å†å‘ATæŒ‡ä»¤äº† ESP_LOGI(TAG, &quot;Switching to Data Mode...&quot;); esp_err_t err = esp_modem_set_mode(dce, ESP_MODEM_MODE_DATA); if (err != ESP_OK) { ESP_LOGE(TAG, &quot;Failed to enter data mode!&quot;); return; } // 7. ç­‰å¾…è·å– IP ESP_LOGI(TAG, &quot;Waiting for IP address...&quot;); xEventGroupWaitBits(event_group, CONNECT_BIT, pdFALSE, pdFALSE, portMAX_DELAY); // åˆ°è¿™é‡Œï¼Œä½ å·²ç»è¿ä¸Šç½‘äº†ï¼ // å¯ä»¥å°è¯• Ping ä¸€ä¸‹ ESP_LOGI(TAG, &quot;Pinging example.com...&quot;); esp_console_run(&quot;ping example.com&quot;, NULL);} å°¤å…¶è¦æ³¨æ„åˆå§‹åŒ–ä¹‹å‰è¿›è¡Œæ¨¡å—çš„é‡å¯, å®˜æ–¹ä¾‹å­å·²ç»æ²¡æœ‰è¿™éƒ¨åˆ†ä»£ç äº†.æ‰€ä»¥æˆ‘ä»¬æ‰‹åŠ¨è¡¥å……åœ¨åˆå§‹åŒ–ä¹‹å‰ å¦‚æœä¸€åˆ‡é¡ºåˆ©å°±ä¼šçœ‹åˆ°ä¸‹å›¾pingæˆåŠŸçš„è¾“å‡º è¸©å‘å°è®°åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­é‡åˆ°è¿‡å‡ ä¸ªå‘ï¼Œé¡ºä¾¿è®°å½•ä¸€ä¸‹ï¼š ä¾›ç”µé—®é¢˜ï¼š4Gæ¨¡å—ç¬æ—¶ç”µæµå¾ˆå¤§ï¼Œæ™®é€šçš„3.3V LDOé€šå¸¸æ‰›ä¸ä½ï¼Œå¯¼è‡´æ¨¡å—ä¼šåå¤é‡å¯, å»ºè®®å•ç‹¬ç»™æ¨¡å—ä¾›ç”µã€‚æˆ‘ç”¨äº†ä¸€ä¸ªDCDCæä¾›3.9Vç”µå‹ç»™æ¨¡å—. æµæ§ï¼šå¦‚æœä½ çš„çº¿æ²¡æ¥ RTS/CTSï¼Œä¸€å®šè¦åœ¨é…ç½®é‡ŒæŠŠ flow_control è®¾ä¸º ESP_MODEM_FLOW_CONTROL_NONEï¼Œå¦åˆ™æ•°æ®å‘ä¸å‡ºå»ã€‚ APNï¼šè™½ç„¶ç°åœ¨å¾ˆå¤šå¡éƒ½èƒ½è‡ªåŠ¨è¯†åˆ«APNï¼Œä½†æœ€å¥½è¿˜æ˜¯æ˜¾å¼æŒ‡å®šä¸€ä¸‹ï¼ˆç§»åŠ¨é€šå¸¸æ˜¯ cmnetï¼Œè”é€š 3gnetï¼‰ã€‚ 4Gæ¨¡å—åˆå§‹åŒ–ï¼š RESETè„šä¹Ÿå¾—ç”¨ESP32 GPIOæ§åˆ¶, ç”¨äº4Gæ¨¡å—åˆå§‹åŒ–é‡å¯ æ€»ç»“ä½¿ç”¨ PPPoS åï¼Œ4G æ¨¡å—çš„ä½¿ç”¨ä½“éªŒå’Œ WiFi å‡ ä¹æ²¡æœ‰åŒºåˆ«ã€‚é…åˆæˆ‘åœ¨ã€ŠESP32å¼‚æ­¥ç½‘ç»œè¯·æ±‚ã€‹ä¸­ä»‹ç»çš„ AsyncHTTP æˆ–è€… MQTT åº“ï¼Œå°±å¯ä»¥è½»æ¾åœ°æŠŠè®¾å¤‡éƒ¨ç½²åˆ°é‡å¤–äº†ã€‚ é‚£ä¹ˆï¼Œå¤å°”ä¸¹ï¼Œä»£ä»·æ˜¯ä»€ä¹ˆå‘¢?ç­”æ¡ˆæ˜¯åŠŸè€—çˆ†ç‚¸.ç”±äº4Gæ¨¡å—ä¸€ç›´å¤„äºæ•°æ®æ¨¡å¼, å¦‚æœéœ€è¦å‘é€ä¸€äº›åŠŸè€—ä¼˜åŒ–çš„ATæŒ‡ä»¤, æ¯”å¦‚é£è¡Œæ¨¡å¼, ä¼‘çœ . é‚£ä¹ˆä¼šå¼‚å¸¸éº»çƒ¦, æ¯æ¬¡éƒ½éœ€è¦åˆ‡æ¢å›Commandæ¨¡å¼å†å‘é€æŒ‡ä»¤.å¦‚æœå’Œæˆ‘ä¸€æ ·æ˜¯è‡ªå¸¦çš„GPSåŠŸèƒ½çš„4Gæ¨¡å—, é‚£ä¹ˆåŠŸè€—æ›´æ˜¯çˆ†ç‚¸, æƒ³è¦ç‹¬ç«‹æ§åˆ¶GPSç”µæºå¿…é¡»é€šè¿‡ATæŒ‡ä»¤, æ¥å›åˆ‡æ¢å¤±è´¥é£é™©å¾ˆé«˜. å‚è€ƒèµ„æ–™ ESP-IDF Modem Component LwIP PPPoS Interface","link":"/2025/12/13/esp32-pppos-4g-modem/"},{"title":"ä¸º AdSense é“ºè·¯ï¼šæˆ‘å¦‚ä½•ä¿®å¤ &#39;GSC é‡å¤ç½‘é¡µ&#39; ä¸ Canonical è‡´å‘½é”™è¯¯(Hexo, 301, robots è¯¦è§£)","text":"èƒŒæ™¯ä¹‹å‰ MCompass é¡¹ç›®çš„åšæ–‡å¼•æ¥ä¸å°‘æµé‡ï¼ŒCloudflare åå°çš„æ•°æ®çœ‹å¾—æˆ‘æŒºæƒŠå–œã€‚åŸæœ¬æƒ³è¿‡æŠŠè¿™ä¸ªå°è£…ç½®åšæˆäº§å“ï¼Œä½†ç‰ˆæƒå’Œé‡äº§æˆæœ¬ç¡®å®æ˜¯ä¸ªç ã€‚äºæ˜¯æˆ‘å¼€å§‹æƒ³ï¼Œèƒ½ä¸èƒ½é€šè¿‡ AdSense è¿™ç§æˆç†Ÿçš„å¹³å°ï¼Œè®©è¿™äº›æµé‡è½¬åŒ–æˆä¸€ç‚¹ç»´æŠ¤ç½‘ç«™çš„æœåŠ¡å™¨æˆæœ¬ã€‚ ç»“æœæ²¡æƒ³åˆ°ï¼ŒGoogle åœ¨æ¥è¿å‡ æ¬¡ç”³è¯·ä¸­éƒ½ç»™æˆ‘å‘äº†â€œéœ€è¦é‡‡å–è¡ŒåŠ¨â€çš„å›æ‰§ã€‚ä¿¡é‡Œè¯´ç”³è¯·éœ€è¦è°ƒæ•´ï¼Œä½†å…·ä½“çš„â€œç—›è‹¦é¢â€åœ¨å“ªåˆæ²¡è¯´æ¸…æ¥šã€‚ æˆ‘æ„è¯†åˆ°ï¼Œå•çº¯å †å†…å®¹æ˜¯ä¸å¤Ÿçš„ï¼Œç«™ç‚¹çš„â€œæŠ€æœ¯å«ç”Ÿä¹ æƒ¯â€â€”â€”ä¹Ÿå°±æ˜¯ SEO å’ŒæŠ“å–åˆè§„æ€§ï¼Œå¯èƒ½å·²ç»çƒ‚é€äº†ã€‚äºæ˜¯ï¼Œæˆ‘å†³å®šç»™åšå®¢åšä¸€æ¬¡å½»åº•çš„åº•å±‚æ¸…ç†ã€‚ è¯Šæ–­ï¼šå…ˆçœ‹ Google çœ¼ä¸­çš„æˆ‘ç¬¬ä¸€æ­¥ï¼Œæˆ‘å¿…é¡»ææ¸…æ¥šâ€œè°·æ­Œçœ¼ä¸­çš„æˆ‘â€æ˜¯ä»€ä¹ˆæ ·, æœç´¢å¼•æ“æœ‰ä¸ªä¸“é—¨æŒ‡å®šæœç´¢å†…å®¹çš„å‘½ä»¤å«åšsite, ç”¨æ³•å°±æ˜¯åœ¨æœç´¢å†…å®¹å‰é¢æ·»åŠ site: xxx.com, è¿™æ ·æœç´¢åˆ°çš„ç»“æœå°±åªä¼šæ¥è‡ªæˆ‘ä»¬æŒ‡å®šçš„ç«™ç‚¹. site: å‘½ä»¤çš„â€œææ€–â€ç°çŠ¶æ£€ç´¢ç½‘ç«™æ”¶å½•æƒ…å†µ, ç¬¬ä¸€é¡µå†…å®¹ä¸­ä¸ä»…æ²¡æœ‰æ ¹åŸŸå,è¿˜é”™è¯¯çš„æ”¶å½•äº†blogåŸŸåä¸‹çš„æ— å…³ç´§è¦çš„å†…å®¹.æ¯”å¦‚è¿™ä¸ªè«åå…¶å¦™çš„â€å¿«æ¥æŠ¢æ²™å‘å§!â€çš„linksåœ°å€, å†é ååˆ™æ˜¯compassåŸŸåçš„ç›¸å…³é¡µé¢. è¡ŒåŠ¨ä¸€ï¼šå†…å®¹ä¸Šçš„â€œæ–­èˆç¦»â€åˆ æ‰é‚£äº›å‡‘æ•°çš„æ–‡ç« ç¿»äº†ä¸‹æ—§æ¡£ï¼Œå‘ç°å‡ å¹´å‰å­¦ Kotlin æ—¶å†™çš„ç¬”è®°å†™å¾—æƒ¨ä¸å¿ç¹ã€‚åŸºæœ¬å°±æ˜¯å¯¹ç€å®˜æ–¹æ–‡æ¡£å¤è¯»äº†ä¸€éï¼Œå†åŠ ä¸Šä¸€å †æ²¡æ„ä¹‰çš„è‡ªè¨€è‡ªè¯­ã€‚è¿™äº›ä¸œè¥¿å­˜ç”µè„‘é‡Œè‡ªå·±çœ‹è¿˜è¡Œï¼Œæ”¾ç½‘ä¸Šç¡®å®æ˜¯åœ¨æµªè´¹çˆ¬è™«çš„ç²¾åŠ›ã€‚ è¿˜æœ‰ä¸€äº›æ—©æœŸçš„ Blender ç»ƒä¹ å±•ç¤ºï¼Œåªæœ‰å‡ å¼ å›¾ï¼Œæ²¡æœ‰æŠ€æœ¯ç»†èŠ‚ã€‚AdSense æƒ³è¦çš„æ˜¯å…·æœ‰åŸåˆ›æ·±åº¦çš„å†…å®¹ï¼Œè¿™ç§â€œæ¬è¿æ„Ÿâ€å¾ˆé‡çš„è–„å†…å®¹ (Thin Content) å¿…é¡»æ¸…ç†æ‰ã€‚ è™½è¯´æœ‰ç‚¹èˆä¸å¾—ï¼Œä½†æˆ‘è¿˜æ˜¯â€œå£®å£«æ–­è…•â€ï¼ŒæŠŠæ–‡ç« ä» 58 ç¯‡ç åˆ°äº† 22 ç¯‡ã€‚ æ¸…ç†ä½ä»·å€¼æ–‡ç« å‡ å¹´å‰, æˆ‘æ›¾æœ‰è¿‡ä¸€æ®µå­¦ä¹ Kotlinçš„æ—¶å…‰, å½“æ—¶ä¸ºäº†åŠ æ·±å°è±¡, ç¼–å†™è¿‡ä¸€äº›å­¦ä¹ Kotlinçš„ç¬”è®°, ä½†æ˜¯ç¬”è®°åŸºæœ¬ä¸Šå°±æ˜¯æŠŠå®˜æ–¹æ–‡æ¡£çš„å†…å®¹æ‰‹åŠ¨æ•²æ‰“äº†ä¸€é.è€Œä¸”è¿˜æœ‰å¾ˆå¤šè‡ªè¨€è‡ªè¯­, è¿™ç§æ–‡ç« å¯¹äºå…¶ä»–äººçš„å¸®åŠ©å…¶å®æ˜¯å¾®ä¹å…¶å¾®çš„, é€‚åˆå­˜æ”¾åˆ°ä¸€äº›ä¸“é—¨çš„ç¬”è®°å·¥å…·(å¦‚notion)ä¸­å», æ‰€ä»¥æ˜¯é¦–è¦æ¸…ç†å¯¹è±¡. æ­¤å¤–,åœ¨19~20å¹´çš„ä¸€äº›æ—¥å­, æˆ‘è¿˜ä½¿ç”¨Blenderè¿›è¡Œäº†åˆ›ä½œ.å†…å®¹åªæ˜¯ç®€å•çš„åˆ†äº«åˆ›ä½œç»“æœ, æ²¡æœ‰æ·±å…¥åˆ¶ä½œæŠ€å·§, ç»†èŠ‚. è¿™ç§ç±»å‹çš„æ–‡ç« ä¹Ÿå¾ˆæœ‰å¯èƒ½è¢«åˆ¤å®šä¸ºä½ä»·å€¼æ–‡ç« ,ä¹Ÿè¦è¢«çº³å…¥æ¸…ç†å¯¹è±¡ä¸­. AdSense æå…¶çœ‹é‡**â€˜åŸåˆ›ä»·å€¼â€™ã€‚åƒè¿™ç§å•çº¯â€˜æ¬è¿æ–‡æ¡£â€™æˆ–â€˜è‡ªè¨€è‡ªè¯­â€™çš„å†…å®¹ï¼Œææ˜“è¢«åˆ¤å®šä¸ºâ€˜å†…å®¹å•è–„â€™ (Thin Content)**ã€‚ä¸ºäº†ä¸æ‹–ç´¯æ•´ä¸ªç½‘ç«™çš„è¯„åˆ†ï¼Œæˆ‘å¿…é¡»å£®å£«æ–­è…•ã€‚ åœ¨ä»”ç»†æ’æŸ¥ä¸€ç•ªå, ä»æœ€å¼€å§‹çš„58ç¯‡æ–‡ç« , å‡å°‘åˆ°äº†22ç¯‡æ–‡ç« . ä¿®å¤é“¾æ¥é”™è¯¯åœ¨ä¿ç•™ä¸‹æ¥çš„è¿™22ç¯‡æ–‡ç« é‡Œé¢, ç”±äºåšå®¢å¤šæ¬¡è¿ç§», å¯¼è‡´çš„é‡Œé¢çš„å›¾ç‰‡å’Œè§†é¢‘é“¾æ¥å¤±æ•ˆäº†.è¿™ä¸ªæ˜¯ä¸èƒ½å®¹å¿çš„, å› ä¸ºçˆ¬è™«ä¼šæ£€æµ‹åˆ°, æ‰€ä»¥èƒ½ä¿®å¤æ­»é“¾çš„ä¸€å®šè¦ä¿®å¤.æˆ‘çš„è¿™ä¸ªä¿®å¤èµ·æ¥æ¯”è¾ƒç®€å•, å› ä¸ºåªæ˜¯å°‘äº†?raw=true, è¡¥å……å³å¯. æ–‡ç« å†…å®¹ä¼˜åŒ–22ç¯‡æ–‡ç« ä¸­æœ‰äº›æ˜¯å±äºåŸåˆ›æ€§é«˜, ä½†æ˜¯å†…å®¹ç•¥å¾®ç®€ç•¥, æˆ‘ä»¬å¯ä»¥å¯¹é½è¿›è¡Œä¼˜åŒ–å’Œæ‰©å……. ä½¿å…¶å…·æœ‰çœŸå®ä»·å€¼.æ¯”å¦‚æˆ‘çš„é‚£ç¯‡CS2èƒ¸ç« æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»äº†å…ƒä»¶é€‰å‹ç­–ç•¥, Auroraæ–°å¢Script Deviceæ–¹æ³•. è¡ŒåŠ¨äºŒï¼šè§£å†³é‚£å››ä¸ªæŠ€æœ¯ç—‡ç»“1. åŸŸåæ‰“æ¶ï¼ˆ301 é‡å®šå‘ï¼‰æˆ‘çš„ç«™åŸŸåå˜è¿å²æœ‰ç‚¹ä¹±ã€‚æœ€å¼€å§‹åœ¨ blog.chaosgoo.comï¼Œåæ¥åˆè¯•è¿‡ wwwã€‚ç”³è¯· AdSense æ—¶å¿…é¡»æäº¤ root åŸŸåï¼ˆchaosgoo.comï¼‰ï¼Œå¯¼è‡´ç°åœ¨æœç´¢ç»“æœé‡Œå……æ–¥ç€ä¸€å †è¿‡æœŸçš„äºŒçº§åŸŸåï¼Œæƒé‡å…¨åˆ†æ•£äº†ã€‚æˆ‘çš„ç«™ç‚¹è¿‡å»è¾ƒé•¿ä¸€æ®µæ—¶é—´é‡Œéƒ¨ç½²åœ¨blog.ä¸Š, rootåŸŸå(chaosgoo.com)å¤„äºé—²ç½®çŠ¶æ€.åœ¨ç”³è¯·AdSenseæ—¶å€™,è¦æ±‚å¡«å…¥çš„æ˜¯rootåŸŸå, è€Œéblog.åŸŸå, æ‰€ä»¥å‡ ä¸ªæœˆå‰,è¿˜ä¸“é—¨è¿ç§»åˆ°äº†rootåŸŸå.å†å¾€å‰ä¸€æ®µæ—¶é—´,ç½‘ç«™ä¹Ÿæ›¾éƒ¨ç½²åˆ°wwwä¸Š, æ‰€ä»¥site:å‘½ä»¤æ£€ç´¢åˆ°çš„ç»“æœèƒ½çœ‹åˆ°blog. å’Œ www. ä¸¤ä¸ªâ€œåºŸå¼ƒâ€åŸŸååœ¨â€œæ±¡æŸ“â€ç´¢å¼•ã€‚ä¸ºäº†æé«˜rootåŸŸåæƒé‡, è¿˜æœ‰æœç´¢ç»“æœçš„æ•´æ´æ¸…æ™°, è¿™ä¸¤ä¸ªæ—§åŸŸåè¦è¿›è¡Œå¤§æ¸…ç†ä¸€ç•ª. æ—§åŸŸåå¤„ç†é¡µé¢è§„åˆ™æ„Ÿè°¢èµ›åšå¤§å–„äººCloudflare æä¾›äº†å¾ˆå¤šæ–¹ä¾¿çš„å·¥å…·.è¿™é‡Œæˆ‘ä»¬æ¥åˆ°cloudflareçš„æ§åˆ¶å°,æ‰¾åˆ°é¡µé¢è§„åˆ™, ä¸ºwww.å’Œblog.ä¸¤ä¸ªæ—§åŸŸåæ·»åŠ é‡å®šå‘è§„åˆ™.å‚æ•°å¦‚ä¸‹å›¾æ‰€ç¤º: Cloudflare è§£æä¼˜åŒ–é…ç½®å¥½é¡µé¢è§„åˆ™ä»¥å, å¹¶ä¸æ˜¯ä¸‡äº‹å¤§å‰äº†, è¿˜éœ€è¦åœ¨è§£ææ·»åŠ ä¸¤æ¡è™šæ‹Ÿçš„Aè®°å½•ç‰¹åˆ«æ³¨æ„ï¼š è¿™æ¡ A è®°å½•çš„ä»£ç†çŠ¶æ€å¿…é¡»å¼€å¯ï¼ˆç‚¹äº®æ©™è‰²äº‘æœµï¼‰ï¼Œå¦åˆ™ Cloudflare çš„é¡µé¢è§„åˆ™æ— æ³•æ¥ç®¡æµé‡ã€‚é‡è¦:å¦åˆ™é¡µé¢è§„åˆ™ä¸ä¼šç”Ÿæ•ˆ. #2ï¼šç´¢å¼•æ±¡æŸ“ï¼ˆRobots é˜²ç«å¢™ï¼‰æ˜¯å¦è¿˜è®°å¾—å‰é¢ä½¿ç”¨site:å‘½ä»¤çœ‹åˆ°çš„tagsé¡µé¢ç›¸å…³çš„æ— å…³å†…å®¹æ¥ä¸‹æ¥æˆ‘ä»¬è¦å°†å…¶ä»æœç´¢ç»“æœé‡Œé¢ç§»é™¤. robots.txtå†…å®¹ä¼˜åŒ–æˆ‘ä»¬è¦ä¸»åŠ¨å‘Šè¯‰çˆ¬è™«æœºå™¨äºº, è¿™äº›é¡µé¢æ˜¯ä¸éœ€è¦çš„,è¯·ä¸è¦çˆ¬å–è¿™äº›å†…å®¹.ç¼–å†™å¦‚ä¸‹robots.txtè§„åˆ™ #3ï¼šåœ°å›¾æ··ä¹±ï¼ˆSitemap ç™½åå•ï¼‰è™½ç„¶æˆ‘ä»¬å·²ç»æ‰‹åŠ¨ç¼–å†™äº†robots.txtè§„åˆ™å‘Šè¯‰è°·æ­Œä¸è¦å†æŠ“å–æŒ‡å®šçš„å†…å®¹äº†, ä½†æ˜¯åœ¨ç«™ç‚¹åœ°å›¾ä¸­ä¾æ—§å­˜åœ¨è¿™äº›å†…å®¹.ä¸ºäº†ä¿è¯å†…å®¹è§„èŒƒç»Ÿä¸€, å°±éœ€è¦å¯¹ä¸æƒ³è¦çš„å†…å®¹æ ‡è®°,è®©ä»–ä¸è¦å‡ºç°åœ¨sitemapä¸­. hexo-generator-sitemapæ’ä»¶å®‰è£…æˆ‘çš„åšå®¢ä½¿ç”¨çš„æ˜¯hexoç”Ÿæˆ, æ‰€ä»¥ä½¿ç”¨hexoä¸“ç”¨çš„sitemapç”Ÿæˆå·¥å…·, hexo-generator-sitemapå®‰è£…å¾ˆç®€å•,åªéœ€è¦åœ¨åšå®¢æºæ–‡ä»¶æ ¹ç›®å½•è¾“å…¥ 1npm install hexo-generator-sitemap --save hexo-generator-sitemapä½¿ç”¨ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•, åªéœ€è¦åœ¨æ ¹ç›®å½•çš„_config.ymlé…ç½®è§„åˆ™å³å¯. è¿™ä¸ªæ’ä»¶ä¼šåœ¨hexo gçš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆä¸€ä»½å¯¹äºçš„ç«™ç‚¹åœ°å›¾. #4ï¼šä¿®å¤Canonical (è‡´å‘½é”™è¯¯)ä½ æ˜¯å¦è¿˜è®°å¾—å‰é¢GSC çš„â€œæœ€ç»ˆå®¡åˆ¤â€ä¸€èŠ‚æåˆ°çš„ç½‘é¡µæœªçº³å…¥è”ç³»ï¼šé‡å¤ç½‘é¡µï¼Œç”¨æˆ·æœªé€‰æ‹©è§„èŒƒç½‘é¡µ è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç½‘ç«™é¡µé¢ç¼ºå°‘canonicalæ ‡è®°, è°·æ­Œä¸çŸ¥é“blog.å’Œrootç‰ˆæœ¬å“ªä¸€ä¸ªæ‰æ˜¯è§„èŒƒç½‘é¡µ, ç„¶åæ ¹æ®ç»éªŒé€‰æ‹©äº†æ—©å°±æ”¶å½•çš„blog.ç‰ˆæœ¬ä½œä¸ºè§„èŒƒå‡ºç°åœ¨æœç´¢ç»“æœä¸­. æ’æŸ¥å› ä¸ºä¸€èˆ¬è€Œè¨€,hexoçš„ä¸»é¢˜ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆcanonicalæ ‡è®°æ‰å¯¹.æ‰€ä»¥æˆ‘æ‰“å¼€ç«™ç‚¹ä¸»é¡µ, æŒ‰F12å®¡æŸ¥å…ƒç´ å‘ç°ä¸»é¡µç¡®å®æ²¡æœ‰canonicalæ ‡è®°, ä½†æ˜¯éšä¾¿ç‚¹å¼€å‡ ç¯‡æ–‡ç« å´åˆçœ‹åˆ°äº†canonicalæ ‡è®°, è¿™å°±å¾ˆè¯¡å¼‚äº†. æˆ‘ä»¥ä¸ºæ˜¯â€˜åƒµå°¸ç¼“å­˜â€™ï¼ˆdb.jsonï¼‰ï¼Œæ¸…ç†ä¹‹åé‡æ–°ç”Ÿæˆé¡µé¢æ£€æŸ¥, è¿˜æ˜¯æ²¡æœ‰canonicalæ ‡è®°.éš¾é“æ˜¯ _config.yml é‡Œçš„ url æ²¡é…ç½®, ä¹Ÿä¸å¯¹, å› ä¸ºæˆ‘æ—©å°±é…ç½®äº†è¿™ä¸ªå±æ€§.äºæ˜¯å†³å®šæœç´¢æºç æ£€æŸ¥è¿™ä¸ªä¸œè¥¿çš„ç”Ÿæˆè§„åˆ™. æ‰‹åŠ¨æ ‡è®°canonicalåœ¨æˆ‘çš„ä¸»é¢˜ç”Ÿæˆcanonicalæ ‡è®°çš„ä»£ç é€»è¾‘æ˜¯,ä¸»é¡µæ²¡æœ‰pageè¿™ä¸ªæ¦‚å¿µ, è¿™é‡Œçš„ä¸‰å…ƒè¿ç®—ç¬¦ç®—å‡ºnull, æ‰€ä»¥éœ€è¦æ‰‹åŠ¨ä¿®æ”¹æ­¤å¤„é€»è¾‘ä¸º 12345// ä¿®æ”¹å‰ (Bug): ä¸»é¡µçš„ page.permalink ä¸ºç©ºï¼Œå¯¼è‡´ canonical ä¸ºç©º{canonical_url ? &lt;link rel=&quot;canonical&quot; href={canonical_url} /&gt; : null}// ä¿®æ”¹å (Fix): å¼ºåˆ¶å›é€€ä½¿ç”¨ url é…ç½®{&lt;link rel=&quot;canonical&quot; href={page.permalink || url} /&gt;} ä¿å­˜åé‡æ–°ç”Ÿæˆé¡µé¢æœ¬åœ°éƒ¨ç½², ä½¿ç”¨F12å®¡æŸ¥å…ƒç´ æˆåŠŸçœ‹åˆ°äº†ä¸»é¡µä¹Ÿæœ‰äº†canonicalæ ‡è®°, ç»ˆäºå¤§åŠŸå‘Šæˆäº†. é‡æ–°éƒ¨ç½²ç«™ç‚¹ç°åœ¨æˆ‘ä»¬ä¿®å¤äº†åšå®¢çš„robots.txtå’Œsitemap.xmlä»¥åŠcanonicalæ ‡è®°, å¯ä»¥é‡æ–°éƒ¨ç½²äº†. è¡ŒåŠ¨ä¸‰ï¼šæ¨ Google ä¸€æŠŠï¼Œæ›´æ–°â€œè®°å¿†â€å…‰æ”¹å®Œä»£ç è¿˜æ²¡å®Œï¼Œæˆ‘å¾—ä¸»åŠ¨å‘Šè¯‰ GSC æŠŠæ—§çš„ã€ä¹±çš„ç´¢å¼•åˆ æ‰ã€‚ä¸ºäº†åŠ å¿«ä¿®å¤, æˆ‘ä»¬å¯ä»¥åœ¨Google Search Consoleä¸Šä¸»åŠ¨å‘Šè¯‰è°·æ­Œsitemapåœ¨å“ª, ä»¥åŠrotots.txtè§„åˆ™å¯ä»¥é‡æ–°æŠ“å–äº† ç”³è¯·é‡æ–°æŠ“å–robots.txt ä¸»åŠ¨æäº¤sitemap.xmlæ–‡ä»¶ æäº¤éšè—æœç´¢ç»“æœç”³è¯·è¿˜å¯ä»¥ä½¿ç”¨ç§»é™¤åŠŸèƒ½, å°†ä¸éœ€è¦çš„ç½‘é¡µç§»é™¤.è¿™é‡Œæˆ‘å¸Œæœ›æŠŠtags, linksä¹‹ç±»çš„å†…å®¹ç§»é™¤, æ‰€ä»¥åˆ›å»ºäº†å¦‚ä¸‹çš„è¯·æ±‚ æ€»ç»“åœ¨åšäº†ä¸Šè¿°æ“ä½œå, å‰©ä¸‹çš„å°±æ˜¯è€å¿ƒç­‰å¾…è°·æ­Œçš„æœºå™¨äººæŠ“å–ç½‘é¡µ, å¤§æ¦‚è¿‡äº†2å¤©.æˆ‘å®¡æŸ¥ç½‘é¡µçš„æ—¶å€™çœ‹åˆ°rootåŸŸåå·²ç»è¢«æ­£ç¡®æ”¶å½•äº†å¹¶ä¸”site:å‘½ä»¤å†…å®¹ä¹Ÿå˜å¾—å¹²å‡€è®¸å¤š, åŸºæœ¬ä¸Šåªå‰©ä¸‹å°‘éƒ¨åˆ†blog.çš„è¿æ¥äº†. è¿™æ¬¡æ’æŸ¥è®©æˆ‘æ˜ç™½ï¼ŒSEO ä¸æ˜¯ç„å­¦ï¼Œè€Œæ˜¯å¯¹ç»†èŠ‚çš„æè‡´æŠŠæ§ã€‚è™½ç„¶ AdSense ç”³è¯·è¿˜åœ¨è·¯ä¸Šï¼Œä½†çœ‹ç€ GSC é‡Œé‚£æ¡æ˜‚æ‰¬å‘ä¸Šçš„æ”¶å½•æ›²çº¿ï¼Œæˆ‘çŸ¥é“ï¼Œæˆ‘å·²ç»å‡†å¤‡å¥½äº†ã€‚","link":"/2025/11/21/hexo-seo-gsc-canonical-301/"},{"title":"åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬ä¸‰ç« ","text":"åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬ä¸€ç«  åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬äºŒç«  åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬ä¸‰ç«  å‰è¨€ (2025å¹´11æœˆ é‡åˆ¶ç‰ˆè¯´æ˜):è¿™ç¯‡æ–‡ç« çš„åˆç‰ˆæˆ‘æ›¾å‘å¸ƒäºç¬¬ä¸‰æ–¹å¹³å°ï¼ˆç®€ä¹¦+Bilibiliï¼‰ï¼Œå¹¶ç´¯è®¡è·å¾—äº†50,000+ æ¬¡é˜…è¯» å’Œå¤§é‡å¼€å‘è€…çš„åé¦ˆã€‚ä¸ºäº†æä¾›æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œæˆ‘å¯¹æ–‡ç« æ’ç‰ˆå’Œéƒ¨åˆ†å†…å®¹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¹¶å°†å…¶ç‹¬å®¶å‘å¸ƒåœ¨æ­¤ä¸ªäººåšå®¢ ç¬¬äºŒç« ä¸­ä»‹ç»äº†å¦‚ä½•åœ¨ESP32ä¸Šè¿è¡ŒLVGL,ç°åœ¨ç»ˆäºå¯ä»¥å¼€å§‹å¥”ç€ç¬¬ä¸€ç« æ–‡ç« æœ«å°¾çš„æ•ˆæœå»äº†. å‡†å¤‡å·¥ä½œè½¯ä»¶å‡†å¤‡è®¿é—®https://download.savannah.gnu.org/releases/freetype/ä¸‹è½½æºç ,è§£å‹åé‡å‘½åä¸ºfreetypeå¹¶å¤åˆ¶åˆ°é¡¹ç›®libæ–‡ä»¶å¤¹ä¸‹æˆ‘ä¸‹è½½çš„æ˜¯ç›®å‰(2021.12.11)æœ€æ–°ç‰ˆæœ¬freetype-2.11.1.tar.gz(è¾ƒè€çš„ç‰ˆæœ¬ä¸æ”¯æŒå¯å˜å­—ä½“æ“ä½œ)ç„¶åå»è¿™ä¸ªRepoè·å–SDå’ŒSPIåº“,å¤åˆ¶åˆ°é¡¹ç›®libæ–‡ä»¶å¤¹ä¸‹ 12345678910111213141516171819.â”œâ”€â”€ includeâ”‚ â””â”€â”€ READMEâ”œâ”€â”€ libâ”‚ â””â”€â”€ READMEâ”‚ â””â”€â”€ lvgl_freetypeâ”‚ â””â”€â”€ lvglâ”‚ â””â”€â”€ freetypeâ”‚ â””â”€â”€ SDâ”‚ â””â”€â”€ SPIâ”‚ â””â”€â”€ TFT_eSPIâ”œâ”€â”€ platformio.iniâ”œâ”€â”€ srcâ”‚ â””â”€â”€ main.cppâ”‚ â””â”€â”€ Portâ”‚ â””â”€â”€ lv_port_disp.cppâ”‚ â””â”€â”€ lv_port_disp.hâ””â”€â”€ test â””â”€â”€ README åˆ°freetypeæ–‡ä»¶å¤¹ä¸‹,åˆ›å»ºFreeTypeçš„library.jsonå’Œlibrary.propertiesæ–‡ä»¶library.propertieså†…å®¹å¦‚ä¸‹ 1234567891011name=FreeTypeversion=2.11.1author=David Turner, Robert Wilhelm, Werner Lembergmaintainer=Werner Lembergsentence=A freely available software library to render fonts.paragraph=It is written in C, designed to be small, efficient, highly customizable, and portable while capable of producing high-quality output (glyph images) of most vector and bitmap font formats.documentation.category=Fonturl=https://freetype.org/architectures=*repository=https://gitlab.freedesktop.org/freetype/freetypelicense=GNU library.jsonå†…å®¹å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435{ &quot;name&quot;:&quot;freetype&quot;, &quot;version&quot;: &quot;2.11.1&quot;, &quot;description&quot;:&quot;Software library to render fonts&quot;, &quot;keywords&quot;:&quot;freetype&quot;, &quot;license&quot;: &quot;FreeType License&quot;, &quot;repository&quot;: { &quot;type&quot;: &quot;git&quot;, &quot;url&quot;: &quot;https://gitlab.freedesktop.org/freetype&quot; }, &quot;frameworks&quot;: &quot;*&quot;, &quot;platforms&quot;: &quot;*&quot;, &quot;build&quot;: { &quot;srcFilter&quot;: [ &quot;+&lt;base/ftsystem.c&gt;&quot;, &quot;+&lt;base/ftmm.c&gt;&quot;, &quot;+&lt;base/ftinit.c&gt;&quot;, &quot;+&lt;base/ftdebug.c&gt;&quot;, &quot;+&lt;base/ftbase.c&gt;&quot;, &quot;+&lt;base/ftbbox.c&gt;&quot;, &quot;+&lt;base/ftglyph.c&gt;&quot;, &quot;+&lt;base/ftbdf.c&gt;&quot;, &quot;+&lt;bdf/bdf.c&gt;&quot;, &quot;+&lt;cff/cff.c&gt;&quot;, &quot;+&lt;truetype/truetype.c&gt;&quot;, &quot;+&lt;sfnt/sfnt.c&gt;&quot;, &quot;+&lt;smooth/smooth.c&gt;&quot;, &quot;+&lt;cache/ftcache.c&gt;&quot;, &quot;+&lt;gzip/ftgzip.c&gt;&quot;, &quot;+&lt;base/ftbitmap.c&gt;&quot; ], &quot;flags&quot;: [ &quot;-DFT2_BUILD_LIBRARY&quot;, &quot;-I include&quot; ], &quot;includeDir&quot;: &quot;devel&quot; }} ç¡¬ä»¶å‡†å¤‡å’Œä¸Šç¯‡ç›¸æ¯”,å¤šäº†ä¸€ä¸ªSDå¡æ¨¡å—. èµ·åˆä¹Ÿå°è¯•äº†ç›´æ¥æŠŠå­—ä½“æ–‡ä»¶å­˜åœ¨SPIFFSé‡Œé¢,å‡å°‘æ¶‰åŠåˆ°çš„ç¡¬ä»¶,å¥ˆä½•é€Ÿåº¦æ…¢çš„æ„Ÿäºº,äºæ˜¯å›åˆ°è¿™é‡Œé‡æ–°å†™äº†SDå¡ç‰ˆæœ¬. 2022.02.08: å‘ç°LVGLè‡ª8.1.1-dev(æ­£å¼ç‰ˆä¸º8.2.0)å¼€å§‹,å†…ç½®çš„lv_freetypeæ¨¡å—å·²ç»æ”¯æŒFT_New_Memory_Faceæ–¹å¼åˆ›å»ºå­—ä½“äº†.å¦‚æœæ²¡æœ‰å†…å­˜å¡çš„è¯,è¯·å°†å­—ä½“æ–‡ä»¶å‘½åä¸ºLite.ttfæ”¾åˆ°æºç srcæ–‡ä»¶å¤¹å†…,åœ¨platformio.iniå†…æ·»åŠ  12board_build.embed_txtfiles = src/Lite.ttf å¹¶åœ¨main.cppä¸­æ·»åŠ  123extern const uint8_t font_start[] asm(&quot;_binary_src_Lite_ttf_start&quot;);extern const uint8_t font_end[] asm(&quot;_binary_src_Lite_ttf_end&quot;);extern const size_t size = font_end - font_end - 1; åˆ›å»ºå­—ä½“æ—¶å€™é¢å¤–æ·»åŠ å¦‚ä¸‹å†…å®¹ 12345static lv_ft_info_t info;/**/info.mem = font_start;info.mem_size = size;/**/ æœ‰SDå¡çš„æƒ…å†µä¸‹ åç§° æ•°é‡ å¤‡æ³¨ å›¾ä¾‹ ESP32 å¼€å‘æ¿ 1 \\ 1.54å¯¸LCD 1 é©±åŠ¨ST7789,åˆ†è¾¨ç‡240x240 æœé‚¦çº¿è‹¥å¹² N \\ Micro SDå¡æ¨¡å—å’Œå¡ 1 \\ æ¥çº¿å’Œç‚¹äº®å±å¹•è¯·å»å‚è€ƒLVGLé…åˆFreeTypeä¸ºå¯å˜å­—ä½“è®¾ç½®å­—é‡-ESP32ç¯‡(ä¸Š) Micro SDå¡æ¨¡å—çš„æ¥çº¿å¦‚ä¸‹ ESP32å¼•è„šåç§° Micro SDå¡æ¨¡å—å¼•è„šåç§° GND GND G26 MISO G13 MOSI G14 SCK G15 CS 5V(Vin) VCC å‡†å¤‡å®Œæ¯•,å¼€å¹²å¯ç”¨LVGLçš„FreeTypeå°†lv_conf.hå†…çš„å®å®šä¹‰å†…å®¹, å¹¶å¯ç”¨FTC_SBitCache_Lookup 1234567891011121314151617/*FreeType library*/##define LV_USE_FREETYPE 0##define LV_USE_FREETYPE 1##if LV_USE_FREETYPE /*Memory used by FreeType to cache characters [bytes] (-1: no caching)*/ #define LV_FREETYPE_CACHE_SIZE (16 * 1024) #if LV_FREETYPE_CACHE_SIZE &gt;= 0 /* 1: bitmap cache use the sbit cache, 0:bitmap cache use the image cache. */ /* sbit cache:it is much more memory efficient for small bitmaps(font size &lt; 256) */ /* if font size &gt;= 256, must be configured as image cache */ #define LV_FREETYPE_SBIT_CACHE 1 /* Maximum number of opened FT_Face/FT_Size objects managed by this cache instance. */ /* (0:use system defaults) */ #define LV_FREETYPE_CACHE_FT_FACES 0 #define LV_FREETYPE_CACHE_FT_SIZES 0 #endif##endif 0è®¾ç½®ä¸º1 é…ç½®FreeTypeçš„æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªå‘½ä¸ºft_fs_port.cppçš„æ–‡ä»¶,å†…å®¹ä¸º 123456789101112131415161718192021222324252627282930313233343536373839404142434445##include &quot;FS.h&quot;##include &quot;SD.h&quot;##include &quot;SPIFFS.h&quot;extern &quot;C&quot; {typedef void lvbe_FILE;lvbe_FILE *lvbe_fopen(const char *filename, const char *mode) { File f = SD.open(filename, mode); if (f) { File *f_ptr = new File(f); // copy to dynamic object *f_ptr = f; // TODO is this necessary? return f_ptr; } return nullptr;}int lvbe_fclose(lvbe_FILE *stream) { File *f_ptr = (File *)stream; f_ptr-&gt;close(); delete f_ptr; return 0;}size_t lvbe_fread(void *ptr, size_t size, size_t count, lvbe_FILE *stream) { File *f_ptr = (File *)stream; int32_t ret = f_ptr-&gt;read((uint8_t *)ptr, size * count); if (ret &lt; 0) { // error ret = 0; } return ret;}int lvbe_fseek(lvbe_FILE *stream, long int offset, int origin) { File *f_ptr = (File *)stream; fs::SeekMode mode = fs::SeekMode::SeekSet; if (SEEK_CUR == origin) { mode = fs::SeekMode::SeekCur; } else if (SEEK_END == origin) { mode = fs::SeekMode::SeekEnd; } bool ok = f_ptr-&gt;seek(offset, mode); return ok ? 0 : -1;}int lvbe_ftell(lvbe_FILE *stream) { File *f_ptr = (File *)stream; return f_ptr-&gt;position();}} æ‰“å¼€ä½äºfreetypeæ–‡ä»¶å¤¹ä¸‹çš„devel\\ft2build.hå¹¶æ·»åŠ  12345678910##ifndef FT2BUILD_H_##define FT2BUILD_H_##define FT_CONFIG_MODULES_H &lt;ftmodule.h&gt;##define FT_CONFIG_OPTIONS_H &lt;ftoption.h&gt;##define FT_CONFIG_STANDARD_LIBRARY_H &lt;ftstdlib.h&gt;##include &lt;freetype/config/ftheader.h&gt;##endif /* FT2BUILD_H_ */ åœ¨åŒçº§ç›®å½•ä¸‹åˆ›å»ºftstdlib.h(æ–‡æœ«Repoå†…æœ‰å®Œæ•´ç‰ˆ)æ–‡ä»¶,å†…å®¹ä»freetype\\include\\freetype\\config\\ftstdlib.hå¤åˆ¶ ä¿®æ”¹file handlingéƒ¨åˆ†çš„å†…å®¹ä¸º 1234567891011121314151617181920 /************************************************************************** * * file handling * */##include &lt;stdio.h&gt;typedef void lvbe_FILE;extern lvbe_FILE * lvbe_fopen(const char * filename, const char * mode );extern int lvbe_fclose(lvbe_FILE * stream);extern size_t lvbe_fread(void * ptr, size_t size, size_t count, lvbe_FILE * stream);extern int lvbe_fseek(lvbe_FILE * stream, long int offset, int origin );extern int lvbe_ftell(lvbe_FILE * stream);##define FT_FILE lvbe_FILE##define ft_fclose lvbe_fclose##define ft_fopen lvbe_fopen##define ft_fread lvbe_fread##define ft_fseek lvbe_fseek##define ft_ftell lvbe_ftell##define ft_sprintf sprintf åœ¨åŒçº§ç›®å½•ä¸‹åˆ›å»ºftmodule.h,å¯ç”¨æ‰€éœ€æ¨¡å—å†…å®¹ä¸º 123FT_USE_MODULE( FT_Driver_ClassRec, tt_driver_class )FT_USE_MODULE( FT_Module_Class, sfnt_module_class )FT_USE_MODULE( FT_Renderer_Class, ft_smooth_renderer_class ) åœ¨åŒçº§ç›®å½•ä¸‹åˆ›å»ºftoption.h**, å†…å®¹ä»freetype\\include\\freetype\\config\\ftoptions.hå¤åˆ¶,è¯¦ç»†çš„é…ç½®è¿‡é•¿,æ•…æ­¤å¤„çœç•¥,è§æ–‡æœ«Repoå†…** æ­¤æ—¶FreeTypeçš„åŸºæœ¬åŠŸèƒ½é…ç½®å®Œæˆ ä¸»è¦çš„æ¶‰åŠåˆ°freetype\\develä¸‹çš„4ä¸ªæ–‡ä»¶ 123456â”‚ â””â”€â”€ freetypeâ”‚ â””â”€â”€ develâ”‚ â””â”€â”€ ft2build.hâ”‚ â””â”€â”€ ftmodule.hâ”‚ â””â”€â”€ ftoption.hâ”‚ â””â”€â”€ ftstdlib.h æµ‹è¯•FreeTypeç§»æ¤ç»“æœæ‰“å¼€main.cpp éšä¾¿å†™ç‚¹å†…å®¹,çƒ§å½•åˆ°ESP32ä¸Šè¿è¡ŒæŸ¥çœ‹æ•ˆæœ. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081##include &lt;Arduino.h&gt;##include &quot;./Port/lv_port_disp.h&quot;##include &quot;SD.h&quot;##include &quot;SPI.h&quot;// åˆå§‹åŒ–SDå¡bool SD_Init() { pinMode(22, INPUT); SPIClass *sd_spi = new SPIClass(HSPI); // another SPI if (!SD.begin(15, *sd_spi, 12000000, &quot;&quot;)) // SD-Card SS pin is 15 { Serial.println(&quot;Card Mount Failed&quot;); return false; } uint8_t cardType = SD.cardType(); if (cardType == CARD_NONE) { Serial.println(&quot;No SD card attached&quot;); return false; } Serial.print(&quot;SD Card Type: &quot;); if (cardType == CARD_MMC) { Serial.println(&quot;MMC&quot;); } else if (cardType == CARD_SD) { Serial.println(&quot;SDSC&quot;); } else if (cardType == CARD_SDHC) { Serial.println(&quot;SDHC&quot;); } else { Serial.println(&quot;UNKNOWN&quot;); } uint64_t cardSize = SD.cardSize() / (1024 * 1024); Serial.printf(&quot;SD Card Size: %lluMB, used size:%llu\\n&quot;, cardSize, SD.usedBytes()); return true;}void setup() { Serial.begin(115200); // Set to a high rate for fast image transfer to a PC Port_Init(); if (!SD_Init()) { Serial.println(&quot;SPIFFS Mount Failed&quot;); }; /*åˆ›å»ºå­—ä½“*/ static lv_ft_info_t info; /*åœ¨SDå¡æ ¹ç›®å½•ä¸‹æ”¾ç½®å‰ä¸€èŠ‚ä¸­çš„å¯å˜å­—ä½“æ–‡ä»¶,é‡å‘½åä¸ºarchivo.ttf*/ info.name = &quot;/archivo.ttf&quot;; info.weight = 18; info.style = FT_FONT_STYLE_NORMAL; if (!lv_ft_font_init(&amp;info)) { LV_LOG_ERROR(&quot;create failed.&quot;); } else { LV_LOG_ERROR(&quot;create done.&quot;); } /*ä¸ºæ–°å­—ä½“åˆ›å»ºStyle*/ static lv_style_t style; lv_style_init(&amp;style); lv_style_set_text_font(&amp;style, info.font); lv_style_set_text_color(&amp;style, lv_color_black()); /*åº”ç”¨Styleåˆ°Label*/ lv_obj_t *altria = lv_label_create(lv_scr_act()); lv_obj_t *shirou = lv_label_create(lv_scr_act()); // lv_obj_add_style(altria, &amp;style, 0); lv_label_set_text(altria, &quot;Toou.\\nAnata wa watashi no masuta ka?&quot;); lv_label_set_text(shirou, &quot;Master?&quot;); lv_obj_set_style_text_font(shirou, info.font, 0); lv_obj_center(shirou); // ä¸€åˆ‡å°±ç»ª, å¯åŠ¨LVGLä»»åŠ¡ xTaskNotifyGive(handleTaskLvgl);}void loop() {} è¿è¡Œæ•ˆæœå¦‚ä¸‹ æ‹“å±•LVGLçš„FreeTypeå°±åƒå‰ç¯‡å†…å®¹ä¸­çš„ä¸€æ ·,éœ€è¦æ‰‹åŠ¨åœ°ä¸ºå½“å‰ç‰ˆæœ¬LVGLæ·»åŠ å¯å˜å­—ä½“æ”¯æŒ. lv_freetype.hå†…çš„lv_ft_info_tä¿®æ”¹ä¸º 123456789typedef struct { const char * name; /* The name of the font file */ const void * mem; /* The pointer of the font file */ size_t mem_size; /* The size of the memory */ lv_font_t * font; /* point to lvgl font */ uint16_t height; /* font size */ uint16_t weight; /* font weight */ uint16_t style; /* font style */} lv_ft_info_t; ç„¶åå»lv_freetype.cé‡Œæ·»åŠ å¯å˜å­—ä½“æ“ä½œä»£ç  12345678910111213141516FT_MM_Var *amaster = NULL;FT_Error err = FT_Get_MM_Var(face, &amp;amaster);if (err) { LV_LOG_ERROR(&quot;FT_Get_MM_Var error:%d\\n&quot;, err); return err;}FT_Fixed w = dsc-&gt;weight &lt;&lt; 16;if (w &gt; amaster-&gt;axis-&gt;maximum) { w = amaster-&gt;axis-&gt;maximum;}err = FT_Set_Var_Design_Coordinates(face, 1, &amp;w);if (err) { LV_LOG_ERROR(&quot;FT_Set_Var_Design_Coordinates error:%d\\n&quot;, err); return err;}FT_Done_MM_Var(library, amaster); åˆ«å¿˜è®°æˆ‘ä»¬å·²ç»ä¿®æ”¹äº†weightçš„å«ä¹‰,æ­¤æ—¶å­—ä½“å¤§å°å·²ç»ç”±heightå†³å®šäº† å›åˆ°main.cpp,åœ¨åˆ›å»ºå­—ä½“åˆæ—¶å€™,è®¾ç½®weightä¸º100 12345static lv_ft_info_t info;info.name = &quot;/archivo.ttf&quot;;info.height = 18;info.weight = 100;info.style = FT_FONT_STYLE_NORMAL; ç„¶åçƒ§å½•åˆ°ESP32,å¯ä»¥çœ‹åˆ°å­—é‡å·²ç»é™ä½äº†. åŠ¨èµ·æ¥å§,å­—é‡åˆ©ç”¨LVGLçš„lv_timer_tæˆ–è€…lv_anim_tåŠ¨æ€çš„ä¿®æ”¹å­—é‡ 1234567891011121314151617181920212223242526272829303132typedef struct _VF_Label { lv_obj_t *label; lv_ft_info_t *font;} VF_Label;static void onTimer(lv_timer_t *timer) { static uint16_t weight = 100; static uint16_t size = 18; VF_Label *vfl = (VF_Label *)(timer-&gt;user_data); if (vfl == nullptr) { printf(&quot;vfl == nullptr\\n&quot;); } if (vfl == nullptr) { printf(&quot;vfl-&gt;font-&gt;font == nullptr\\n&quot;); } lv_ft_font_destroy(vfl-&gt;font-&gt;font); printf(&quot;lv_ft_font_destroy\\n&quot;); vfl-&gt;font-&gt;name = &quot;/archivo.ttf&quot;; vfl-&gt;font-&gt;height = size; vfl-&gt;font-&gt;weight = weight; vfl-&gt;font-&gt;style = FT_FONT_STYLE_NORMAL; lv_ft_font_init(vfl-&gt;font); printf(&quot;lv_ft_font_init\\n&quot;); size = 48; weight += 100; if (weight &gt; 600) { weight = 100; } lv_obj_set_style_text_font(vfl-&gt;label, vfl-&gt;font-&gt;font, 0);} 123lv_timer_t *weightTimer = lv_timer_create(onTimer, 50, &amp;label);// ä¸€åˆ‡å°±ç»ª, å¯åŠ¨LVGLä»»åŠ¡xTaskNotifyGive(handleTaskLvgl); æ•ˆæœå›¾ ç¯å¢ƒ:1234567Espressif 32 (3.4.0) &gt; ESP32 Pico Kitframework-arduinoespressif32 3.10006.210326 (1.0.6)tool-esptoolpy 1.30100.210531 (3.1.0)toolchain-xtensa32 2.50200.97 (5.2.0)&lt;lvgl&gt; 8.1.1-dev&lt;TFT_eSPI&gt; 2.3.89esptool.py v3.1 å‚è€ƒèµ„æ–™ https://github.com/lvgl/lvgl https://github.com/peng-zhihui/Peak https://www.youtube.com/watch?v=LY3ypzPcDCE Repo vf_font_on_esp32","link":"/2022/01/03/lvgl-freetype-and-esp32-2/"},{"title":"åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬äºŒç« ","text":"åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬ä¸€ç«  åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬äºŒç«  åœ¨LVGLä¸­å®ç°å¯å˜å­—ä½“(Variable Font)-ç¬¬ä¸‰ç«  å‰è¨€ (2025å¹´11æœˆ é‡åˆ¶ç‰ˆè¯´æ˜):è¿™ç¯‡æ–‡ç« çš„åˆç‰ˆæˆ‘æ›¾å‘å¸ƒäºç¬¬ä¸‰æ–¹å¹³å°ï¼ˆç®€ä¹¦+Bilibiliï¼‰ï¼Œå¹¶ç´¯è®¡è·å¾—äº†50,000+ æ¬¡é˜…è¯» å’Œå¤§é‡å¼€å‘è€…çš„åé¦ˆã€‚ä¸ºäº†æä¾›æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Œæˆ‘å¯¹æ–‡ç« æ’ç‰ˆå’Œéƒ¨åˆ†å†…å®¹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¹¶å°†å…¶ç‹¬å®¶å‘å¸ƒåœ¨æ­¤ä¸ªäººåšå®¢ æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« ä¸­å·²ç»å®ç°äº†æ¨¡æ‹Ÿå™¨ç¯å¢ƒä¸‹å¯å˜å­—ä½“å­—é‡çš„è®¾ç½®. æ˜¯æ—¶å€™æå‡ºä½ åƒç°å·²ä¹…çš„ESP32äº†. æœ¬æ–‡ä¼šä½¿ç”¨PlatformIOåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„é¡¹ç›®,ç›´åˆ°æ˜¾ç¤ºå‡ºç°ä¸Šç¯‡æ–‡ç« æœ«å°¾çš„åŠ¨å›¾ä¸ºæ­¢.å¦‚é‡åˆ°é—®é¢˜,å¯å‚è€ƒå¸¸è§é—®é¢˜å†…è§£ç­”. å‡†å¤‡å·¥ä½œè½¯ä»¶å‡†å¤‡ä¸ºäº†åç»­å†…å®¹é¡ºåˆ©è¿›è¡Œä¸‹å»,è¿™é‡Œéœ€è¦ä½ å®‰è£…å¥½VSCode,å¹¶åœ¨VSCodeä¸Šå®‰è£…PlatformIOæ’ä»¶. ç¡¬ä»¶å‡†å¤‡åç§° | æ•°é‡ | å¤‡æ³¨ | å›¾ä¾‹ |:-: | :-: | :-:ESP32 å¼€å‘æ¿ | 1 | \\ | 1.54å¯¸LCD | 1 | é©±åŠ¨ST7789,åˆ†è¾¨ç‡240x240 | æœé‚¦çº¿è‹¥å¹² | N | \\ | åˆ›å»ºé¡¹ç›®ä½¿ç”¨PlatformIOåˆ›å»ºä¸€ä¸ªåä¸ºlvgl_with_freetypeçš„é¡¹ç›®åˆ›å»ºå®Œæ¯•åç›®å½•ç»“æ„å¦‚ä¸‹: 12345678910.â”œâ”€â”€ includeâ”‚ â””â”€â”€ READMEâ”œâ”€â”€ libâ”‚ â””â”€â”€ READMEâ”œâ”€â”€ platformio.iniâ”œâ”€â”€ srcâ”‚ â””â”€â”€ main.cppâ””â”€â”€ test â””â”€â”€ README ç‚¹äº®å±å¹•ç”±äºå·²ç»å†™è¿‡ä¸€ç¯‡ç‚¹äº®å±å¹•çš„æ–‡ç« ,æ•…æœ¬æ–‡ä¸åšè¿‡å¤šèµ˜è¿°,åªè¯´æ˜ä¸€ä¸‹åŒºåˆ«. ä¹‹å‰çš„å±å¹•åˆ†è¾¨ç‡æ˜¯135x240,è¿™æ¬¡çš„å±å¹•åˆ†è¾¨ç‡æ˜¯240x240. æ‰€ä»¥éœ€è¦ä½¿ç”¨TFT_eSPIé‡Œé¢çš„Setup24_ST7789.h åŒæ—¶æ¥çº¿å˜æ›´ä¸º ESP32å¼•è„šåç§° æ¶²æ™¶å±å¼•è„šåç§° VCC VCC GND GND G23 SDA G18 SCL G2 DC G4 RES GND CS VCC BLK å¯¹åº”Setup24_ST7789.hé‡Œé¢å†…å®¹ Setup24_ST7789.h123456##define TFT_MISO 19##define TFT_MOSI 23##define TFT_SCLK 18##define TFT_CS -1##define TFT_DC 2##define TFT_RST 4 éšä¾¿å†™ç‚¹å†…å®¹.æµ‹è¯•ä¸‹å±å¹•çš„ç‚¹äº®. main.cpp1234567891011121314151617##include &lt;Arduino.h&gt;##include &lt;TFT_eSPI.h&gt; // Hardware-specific library##include &lt;SPI.h&gt;TFT_eSPI tft = TFT_eSPI(); // Invoke custom libraryvoid setup() { Serial.begin(115200); // Set to a high rate for fast image transfer to a PC tft.init(); tft.setRotation(0); tft.fillScreen(TFT_BLACK);}void loop() { tft.print(&quot;Ready Perfectly&quot;);} ç§»æ¤LVGLå±å¹•ç‚¹äº®ä»¥å,å°±å¯ä»¥å¼€å§‹ç§»æ¤LVGLäº†. å½“å‰æ—¶é—´ä¸º2021.12.19,GitHubä¸ŠLVGLæœ€æ–°ç‰ˆæœ¬æ˜¯8.1.1-dev ä½¿ç”¨å‘½ä»¤ 1git clone https://github.com/lvgl/lvgl.git è·å–LVGLåå°†å…¶å¤åˆ¶åˆ°libæ–‡ä»¶å¤¹ä¸‹.æ­¤æ—¶æ–‡ä»¶ç›®å½•ä¸º 123456789101112.â”œâ”€â”€ includeâ”‚ â””â”€â”€ READMEâ”œâ”€â”€ libâ”‚ â””â”€â”€ READMEâ”‚ â””â”€â”€ lvglâ”‚ â””â”€â”€ TFT_eSPIâ”œâ”€â”€ platformio.iniâ”œâ”€â”€ srcâ”‚ â””â”€â”€ main.cppâ””â”€â”€ test â””â”€â”€ README platformio.iniæ–‡ä»¶å†…å®¹ 12345678[env:pico32]platform = espressif32board = pico32framework = arduinomonitor_speed = 115200lib_extra_dirs = lib/TFT_eSPI lib/lvgl ä¿®æ”¹LVGLé…ç½®æ–‡ä»¶åˆ›å»ºLVGLçš„é…ç½®æ–‡ä»¶,æ‰¾åˆ°lvglæ–‡ä»¶å¤¹å†…çš„lv_conf_templat.h,å¤åˆ¶ä¸€ä»½lv_conf_templat.hå¹¶é‡å‘½åä¸ºlv_conf.h,ç„¶åæ‰“å¼€lv_conf.h ä¸ºäº†ä½¿é…ç½®æ–‡ä»¶å†…å®¹ç”Ÿæ•ˆ,æ‰¾åˆ°ç¬¬15è¡Œ(å…¶ä»–ç‰ˆæœ¬çš„lvglè¡Œæ•°å¯èƒ½ä¸åœ¨è¿™é‡Œ,éœ€è¦è‡ªè¡Œå¯»æ‰¾) 1##if 0 /*Set it to &quot;1&quot; to enable content*/ æ”¹ä¸º 1##if 1 /*Set it to &quot;1&quot; to enable content*/ æ‰¾åˆ°ç¬¬30è¡Œ,ä¿®æ”¹é¢œè‰²é¡ºåº 1##define LV_COLOR_16_SWAP 0 æ”¹ä¸º 1##define LV_COLOR_16_SWAP 1 æ‰¾åˆ°ç¬¬49è¡Œ,å¯ç”¨è‡ªå®šä¹‰å†…å­˜ç®¡ç† 1##define LV_MEM_CUSTOM 0 ä¿®æ”¹ä¸º 1##define LV_MEM_CUSTOM 1 æ‰¾åˆ°ç¬¬88è¡Œ,è®¾ç½®è‡ªå®šä¹‰å‘¨æœŸå‡½æ•° 1##define LV_TICK_CUSTOM 0 ä¿®æ”¹ä¸º 1##define LV_TICK_CUSTOM 1 æ‰¾åˆ°ç¬¬174è¡Œ,å¯ç”¨LVGLæ—¥å¿—åŠŸèƒ½ 1##define LV_USE_LOG 1 ä¿®æ”¹ä¸º 1##define LV_USE_LOG 1 å¯¹æ¥LVGLå’ŒTFT_eSPIæŒ‰ç…§ç›®å½• 123456789101112131415.â”œâ”€â”€ includeâ”‚ â””â”€â”€ READMEâ”œâ”€â”€ libâ”‚ â””â”€â”€ READMEâ”‚ â””â”€â”€ lvglâ”‚ â””â”€â”€ TFT_eSPIâ”œâ”€â”€ platformio.iniâ”œâ”€â”€ srcâ”‚ â””â”€â”€ main.cppâ”‚ â””â”€â”€ Portâ”‚ â””â”€â”€ lv_port_disp.cppâ”‚ â””â”€â”€ lv_port_disp.hâ””â”€â”€ test â””â”€â”€ README åˆ›å»ºlv_port_disp.cppå’Œlv_port_disp.h lv_port_disp.h123456789101112131415##ifndef LV_PORT_DISP_H_##define LV_PORT_DISP_H_##include &quot;TFT_eSPI.h&quot;##include &quot;lvgl.h&quot;##define DISP_HOR_RES 240##define DISP_VER_RES 240##define DISP_BUF_SIZE (DISP_HOR_RES*DISP_VER_RES/4)extern TaskHandle_t handleTaskLvgl;void Port_Init();void lv_port_disp_init(TFT_eSPI* scr);##endif lv_port_disp.cpp123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899##include &quot;lv_port_disp.h&quot;// ç”¨äºåˆå§‹åŒ–å®Œæ¯•åå¯ç”¨LVGLæ˜¾ç¤ºçš„TaskHandle_tTaskHandle_t handleTaskLvgl;// lvglæ˜¾ç¤ºé©±åŠ¨static lv_disp_drv_t disp_drv;// lvglæ›´æ–°ä»»åŠ¡void TaskLvglUpdate(void* parameter) { // é˜»å¡åœ¨æ­¤å¤„,ç›´åˆ°xTaskNotifyGive ulTaskNotifyTake(pdTRUE, portMAX_DELAY); for (;;) { lv_task_handler(); delay(5); }}/** * @brief æ˜¾ç¤ºåˆå§‹åŒ– * @param æ—  * @retval æ—  */void Port_Init() { static TFT_eSPI screen; /* å±å¹•åˆå§‹åŒ– */ screen.begin(); screen.initDMA(true); screen.setRotation(0); screen.fillScreen(TFT_BLACK); /* lvglåˆå§‹åŒ– */ lv_init(); lv_port_disp_init(&amp;screen); printf(&quot;lvInitDone\\n&quot;); // åœ¨æ ¸å¿ƒ2ä¸Šæ‰§è¡ŒLVGL xTaskCreatePinnedToCore(TaskLvglUpdate, &quot;LvglThread&quot;, 20480, nullptr, configMAX_PRIORITIES, &amp;handleTaskLvgl, 1);}/** * @brief è‡ªå®šä¹‰æ‰“å°å‡½æ•° * @param æ—  * @retval æ—  */void my_print(lv_log_level_t level, const char *file, uint32_t line, const char *fun, const char *dsc) { Serial.printf(&quot;%s@%d %s-&gt;%s\\r\\n&quot;, file, line, fun, dsc); Serial.flush();}/** * @brief å±å¹•åˆ·æ–°å›è°ƒå‡½æ•° * @param disp:å±å¹•é©±åŠ¨åœ°å€ * @param area:åˆ·æ–°åŒºåŸŸ * @param color_p:åˆ·æ–°ç¼“å†²åŒºåœ°å€ * @retval æ—  */static void disp_flush_cb(lv_disp_drv_t *disp, const lv_area_t *area, lv_color_t *color_p) { TFT_eSPI *screen = (TFT_eSPI *)disp-&gt;user_data; int32_t w = (area-&gt;x2 - area-&gt;x1 + 1); int32_t h = (area-&gt;y2 - area-&gt;y1 + 1); screen-&gt;startWrite(); screen-&gt;setAddrWindow(area-&gt;x1, area-&gt;y1, w, h); screen-&gt;pushPixelsDMA((uint16_t *)(&amp;color_p-&gt;full), w * h); screen-&gt;endWrite(); lv_disp_flush_ready(disp);}/** * @brief å±å¹•åˆå§‹åŒ– * @param æ—  * @retval æ—  */void lv_port_disp_init(TFT_eSPI* scr) { lv_log_register_print_cb(reinterpret_cast&lt;lv_log_print_g_cb_t&gt;( my_print)); /* register print function for debugging */ DMA_ATTR static lv_color_t *lv_disp_buf = static_cast&lt;lv_color_t *&gt;(heap_caps_malloc( DISP_BUF_SIZE * sizeof(lv_color_t), MALLOC_CAP_DMA)); static lv_disp_draw_buf_t disp_buf; lv_disp_draw_buf_init(&amp;disp_buf, lv_disp_buf, nullptr, DISP_BUF_SIZE); /*Initialize the display*/ lv_disp_drv_init(&amp;disp_drv); disp_drv.hor_res = DISP_HOR_RES; disp_drv.ver_res = DISP_VER_RES; disp_drv.flush_cb = disp_flush_cb; disp_drv.draw_buf = &amp;disp_buf; disp_drv.user_data = scr; lv_disp_drv_register(&amp;disp_drv);} å†å†™ä¸ªç®€å•ä¾‹å­æµ‹è¯•ä¸‹LVGLèƒ½ä¸èƒ½è¿è¡Œ main.cpp123456789101112131415161718##include &lt;Arduino.h&gt;##include &quot;./Port/lv_port_disp.h&quot;void setup() { Serial.begin(115200); // Set to a high rate for fast image transfer to a PC Port_Init(); lv_obj_t *label = lv_label_create(lv_scr_act()); lv_label_set_text(label, &quot;Toou.\\nAnata wa watashi no masuta ka?&quot;); // ä¸€åˆ‡å°±ç»ª, å¯åŠ¨LVGLä»»åŠ¡ xTaskNotifyGive(handleTaskLvgl);}void loop() {} Toou.Anata wa watashi no masuta ka? æ–½å·¥ä¸­,å¾…æ›´æ–°å¸¸è§é—®é¢˜Q:ç‚¹äº®å±å¹•æ—¶å€™,ç¼–è¯‘å™¨æŠ¥æ‰¾ä¸åˆ°TFT_eSPI A:æ£€æŸ¥TFT_eSPIæ˜¯å¦é›†æˆå°†TFT_eSPIæ”¾ç½®åœ¨libæ–‡ä»¶å¤¹å†…,å¹¶å‘platformio.iniæ–‡ä»¶æœ«å°¾æ·»åŠ  1lib_extra_dirs = lib/TFT_eSPI Q:åœ¨ç§»æ¤LVGLæ—¶å€™,å±å¹•é¢œè‰²å¼‚å¸¸ A:å¯èƒ½ä¸lv_conf.hæ–‡ä»¶å†…#define LV_COLOR_16_SWAP 0æœ‰å…³å¯ä»¥å°è¯•å°†æ­¤å¤„çš„0æ”¹æˆ1,æˆ–1æ”¹å›0 ç¯å¢ƒ:1234567Espressif 32 (3.4.0) &gt; ESP32 Pico Kitframework-arduinoespressif32 3.10006.210326 (1.0.6)tool-esptoolpy 1.30100.210531 (3.1.0)toolchain-xtensa32 2.50200.97 (5.2.0)&lt;lvgl&gt; 8.1.1-dev&lt;TFT_eSPI&gt; 2.3.89esptool.py v3.1 å‚è€ƒèµ„æ–™ https://github.com/lvgl/lvgl https://github.com/peng-zhihui/Peak","link":"/2021/12/18/lvgl-freetype-and-esp32/"},{"title":"Arduino Pro Micro(Leonardo)æ— å“åº”ä¿®å¤ï¼šå¼ºåˆ¶ Bootloader æ¢å¤æŒ‡å—","text":"èƒŒæ™¯æˆ‘ä½¿ç”¨çš„ Pro Micro æ˜¯ä¸€æ¬¾åŸºäº ATmega32U4 èŠ¯ç‰‡çš„ç´§å‡‘å‹å¼€å‘æ¿ã€‚å®ƒçš„æœ€å¤§ç‰¹ç‚¹æ˜¯å†…ç½® USB æ§åˆ¶å™¨ï¼Œå¯ä»¥ç›´æ¥è¢«ç”µè„‘è¯†åˆ«ä¸º HID è®¾å¤‡ï¼ˆé”®ç›˜ã€é¼ æ ‡ç­‰ï¼‰ï¼Œæ— éœ€é¢å¤–çš„ä¸²å£è½¬ USB èŠ¯ç‰‡ï¼Œä½“ç§¯å°å·§ï¼ŒUSB è‡ªæ›´æ–°ã€‚ æœ€è¿‘ç€æ‰‹åˆ¶ä½œä¸€ä¸ªæ–°ç©æ„å„¿ï¼Œä½¿ç”¨çš„å¼€å‘æ¿æ˜¯ Pro Microã€‚èµ·åˆç”¨èµ·æ¥å¾ˆæ­£å¸¸ï¼Œçƒ§å½•ç¨‹åºå„ç§æ§åˆ¶éƒ½æ²¡æœ‰é—®é¢˜ã€‚ å‡Œæ™¨çªç„¶å‡ºç°æ’å…¥ç”µè„‘æ— æ³•è¯†åˆ«ï¼Œæˆ–è€…è¯†åˆ«åˆ°äº†ç«‹åˆ»åˆä¼šæ–­å¼€ï¼Œåœ¨ Windows çš„è®¾å¤‡ç®¡ç†å™¨é‡Œé¢ä¹Ÿæ˜¯ä¸€é—ªè€Œè¿‡ã€‚ é—®é¢˜åˆ†æè™½ç„¶å¾ˆä¸ç”˜å¿ƒçš„æ‹†å¼€äº†å‰å¤©åˆšåˆ°çš„æ–° Pro Microï¼Œæƒ³çœ‹çœ‹æ¿å­æ˜¯ä¸æ˜¯çœŸçš„å‡ºç°äº†é—®é¢˜ã€‚å¥½å®¶ä¼™ï¼Œæ–°æ¿å­ä¹Ÿå‡ºç°äº†åŒæ ·çš„é—®é¢˜ã€‚ æ–°æ¿å­åæ‰çš„æ¦‚ç‡ä¸æ˜¯å¾ˆå¤§ï¼Œäºæ˜¯è½¬è€Œå»æ£€æŸ¥äº†ç¼–å†™çš„ .ino æ–‡ä»¶ã€‚ ğŸ” æ ¹å› å®šä½ç»è¿‡æ’æŸ¥ï¼Œå‘ç°æ–‡ä»¶æ¯”ä¸Šä¸€æ¬¡å¤šäº†å‡ è¡Œ SoftwareSerial çš„å†…å®¹ã€‚é—®é¢˜å¾ˆæœ‰å¯èƒ½å°±æ˜¯å¤šçš„å‡ è¡Œä»£ç å¯¼è‡´ Pro Micro æ— æ³•ä¸ PC æ­£å¸¸é€šä¿¡ã€‚ åŸç†åˆ†æï¼šPro Microï¼ˆä»¥åŠ Leonardoã€Micro ç­‰ 32U4 ç³»åˆ—ï¼‰çš„ USB é€šä¿¡æ˜¯ç”±å›ºä»¶æ§åˆ¶çš„ã€‚å½“ä½ çš„ä»£ç åœ¨ setup() æˆ– loop() ä¸­å‡ºç°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œå¯èƒ½ä¼šé˜»å¡ USB é€šä¿¡ï¼š æ— é™å¾ªç¯ç­‰å¾…ï¼šå¦‚ while (!Serial); åœ¨æœªè¿æ¥ä¸²å£ç›‘è§†å™¨æ—¶ä¼šæ°¸ä¹…é˜»å¡ SoftwareSerial å†²çªï¼šåœ¨æŸäº›å¼•è„šä¸Šä½¿ç”¨è½¯ä¸²å£å¯èƒ½å¹²æ‰° USB æ—¶åº ä¸­æ–­å ç”¨è¿‡å¤šï¼šé«˜é¢‘ä¸­æ–­å¯¼è‡´ USB æ¡æ‰‹å¤±è´¥ ä»£ç å´©æºƒï¼šç¨‹åºè·‘é£å¯¼è‡´ USB æ§åˆ¶å™¨æ— æ³•æ­£å¸¸å“åº” äºæ˜¯å¤§é‡çš„æœé›†èµ„æ–™ï¼Œç»ˆäºæ‰¾åˆ°äº†ç±»ä¼¼çš„æƒ…å†µï¼Œå¹¶æˆåŠŸè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ è§£å†³æ–¹æ³•ï¼šå¼ºåˆ¶è¿›å…¥ Bootloader æ¨¡å¼è®© Pro Micro å¼ºåˆ¶è¿›å…¥ Bootloader æ¨¡å¼ï¼Œå¹¶çƒ§å½•è¿›å»æ­£å¸¸çš„ä»£ç ï¼Œå°±èƒ½æ¢å¤ä¸ç”µè„‘çš„è¿æ¥ã€‚ âš¡ å…³é”®æ“ä½œæ­¥éª¤ æ­¥éª¤ æ“ä½œ è¯´æ˜ 1 å‡†å¤‡ä¸€æ ¹æœé‚¦çº¿æˆ–é•Šå­ ç”¨äºçŸ­æ¥ RST å’Œ GND 2 å¿«é€ŸçŸ­æ¥ RST ä¸ GND ä¸¤æ¬¡ é—´éš”çº¦ 0.5 ç§’ï¼Œç±»ä¼¼â€åŒå‡»â€ 3 è¿›å…¥ Bootloader æ¨¡å¼ æ¿è½½ LED ä¼šé—ªçƒï¼ŒæŒç»­çº¦ 8 ç§’ 4 ç«‹å³åœ¨ Arduino IDE ç‚¹å‡»ä¸Šä¼  å¿…é¡»åœ¨ 8 ç§’å†…å®Œæˆçƒ§å½• âš ï¸ æ³¨æ„ï¼šBootloader æ¨¡å¼åªä¼šæŒç»­ 8 ç§’ï¼Œè¶…æ—¶åä¼šé‡æ–°è¿è¡ŒåŸæ¥çš„é—®é¢˜ä»£ç ã€‚å»ºè®®æå‰å‡†å¤‡å¥½ç©ºç™½å·¥ç¨‹ï¼Œä¸€è§¦å‘ Bootloader å°±ç«‹å³ä¸Šä¼ ã€‚ ğŸ“ ç©ºç™½æ¢å¤ä»£ç åˆ›å»ºä¸€ä¸ªç©ºçš„å·¥ç¨‹ï¼Œsetup å’Œ loop å‡½æ•°å†…éƒ½ä¸ºç©ºï¼š 1234567void setup() { // ç©º}void loop() { // ç©º} çƒ§å½•å®Œæˆåç”µè„‘å°±å¯ä»¥æ­£å¸¸æ£€æµ‹åˆ°ç«¯å£å·ï¼Œå°±åƒå¾€å¸¸ä¸€æ ·ä½¿ç”¨äº†ã€‚ é¢„é˜²æªæ–½ï¼šé¿å…å†æ¬¡â€å˜ç –â€ä¸ºäº†é¿å…ä»¥åå†æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜ï¼Œå»ºè®®åœ¨ä»£ç ä¸­åŠ å…¥ä»¥ä¸‹ä¿æŠ¤æªæ–½ï¼š 123456789101112void setup() { // ç»™ USB åˆå§‹åŒ–ç•™å‡ºæ—¶é—´ delay(1000); // æˆ–è€…ä½¿ç”¨å¸¦è¶…æ—¶çš„ç­‰å¾… unsigned long startTime = millis(); while (!Serial &amp;&amp; (millis() - startTime &lt; 3000)) { // æœ€å¤šç­‰å¾… 3 ç§’ } // ä½ çš„åˆå§‹åŒ–ä»£ç ...} ğŸ’¡ å…¶ä»–å»ºè®® æµ‹è¯•æ–°ä»£ç æ—¶ï¼šå…ˆæ³¨é‡Šæ‰å¯èƒ½é˜»å¡çš„ä»£ç ï¼Œç¡®è®¤ USB é€šä¿¡æ­£å¸¸åå†é€æ­¥å¯ç”¨ ä½¿ç”¨ ICSP ç¼–ç¨‹å™¨ï¼šä½œä¸ºç»ˆæåå¤‡æ–¹æ¡ˆï¼Œå¯ä»¥é€šè¿‡ ICSP æ¥å£å¼ºåˆ¶çƒ§å½• Bootloader æ ‡è®°å±é™©ä»£ç ï¼šåœ¨ä½¿ç”¨ while(1)ã€delay(å¾ˆå¤§çš„å€¼) æ—¶æ·»åŠ æ³¨é‡Šæé†’ ç¯å¢ƒä¿¡æ¯ é¡¹ç›® ç‰ˆæœ¬/å‹å· å¼€å‘æ¿ Arduino Pro Micro (ATmega32U4, 5V/16MHz) IDE Arduino IDE 1.8.9+ æ“ä½œç³»ç»Ÿ Windows 10/11 å‚è€ƒèµ„æ–™ Pro Micro &amp; Fio V3 Hookup Guide - Troubleshooting Arduino Leonardo å®˜æ–¹æ–‡æ¡£ ATmega32U4 Datasheet","link":"/2020/04/25/pro-micro/"},{"title":"ä½¿ç”¨Bindgenä¸ºELKç”ŸæˆRustç»‘å®š","text":"ä»‹ç»bindgen æ˜¯ä¸€ä¸ªèƒ½è‡ªåŠ¨ä¸º Cï¼ˆæˆ– C++ï¼‰åº“ç”Ÿæˆ Rust ç»‘å®šçš„è¾…åŠ©åº“å’Œå‘½ä»¤è¡Œå·¥å…·ã€‚ elk æ˜¯ä¸€ä¸ªè¿·ä½ çš„JSå¼•æ“.èƒ½å¤Ÿå®ç°ç±»ä¼¼äºè¿™æ ·çš„æ•ˆæœ main.rs12345678910111213141516171819##include &lt;stdio.h&gt;##include &quot;elk.h&quot;// C function that adds two numbers. Will be called from JSjsval_t sum(struct js *js, jsval_t *args, int nargs) { if (nargs != 2) return js_err(js, &quot;2 args expected&quot;); double a = js_getnum(args[0]); // Fetch 1st arg double b = js_getnum(args[1]); // Fetch 2nd arg return js_mknum(a + b);}int main(void) { char mem[200]; struct js *js = js_create(mem, sizeof(mem)); // Create JS instance js_set(js, js_glob(js), &quot;sum&quot;, js_mkfun(sum))); // Import sum() jsval_t result = js_eval(js, &quot;sum(3, 4);&quot;, ~0); // Call sum printf(&quot;result: %s\\n&quot;, js_str(js, result)); // result: 7 return 0;} å¦‚æœè¿™ä¸ªæ‰§è¡Œå†…å®¹æ¥è‡ªäºæœåŠ¡å™¨ä¸‹å‘,é‚£å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åŠ¨æ€ä¸‹å‘ç¨‹åºç„¶åæ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡. åºä¹‹å‰åœ¨ç©ESP-IDFæ—¶å€™å°±å°è¯•å†…åµŒä¸€ä¸ªLuaå¼•æ“æ¥åŠ¨æ€æ‰§è¡ŒLuaè„šæœ¬çš„æ“ä½œ,ç„¶åç”¨è“ç‰™æ›´æ–°Luaè„šæœ¬ä»¥å®ç°åŠ¨æ€çš„ç»˜åˆ¶ç•Œé¢.æœ€è¿‘å¼„ESP-RSæ—¶å€™æƒ³è¯•è¯•ç±»ä¼¼çš„æ•ˆæœ,å› ä¸ºæ„Ÿè§‰Luaç”¨èµ·æ¥å¾ˆå•°å—¦,ç°åœ¨å·²ç»å®Œå…¨å¿˜è®°å¦‚ä½•ç¼–å†™Luaè„šæœ¬äº†.å½“ç„¶Rustä¹Ÿæœ‰ä¸€äº›Luaå¼•æ“çš„ç°æˆcrates,æ¯”å¦‚rLua.ä½†æ˜¯æ•°ç»„ç´¢å¼•ä»1å¼€å§‹çœŸçš„æ˜¯åæ–‡æ˜å•Š, æˆ‘ä»¬è¿˜æ˜¯ç»§ç»­æ£é¼“jså§. åˆ›å»ºRusté¡¹ç›®1cargo new &quot;bindgen_elk&quot; å…‹éš†elkæºç è¿›å…¥åˆšæ‰åˆ›å»ºçš„ç›®å½•å,åœ¨srcåŒçº§ç›®å½•ä¸‹å…‹éš†elk. 123456789cd bindgen_elkgit clone https://github.com/cesanta/elk.gitCloning into 'elk'...remote: Enumerating objects: 932, done.remote: Counting objects: 100% (204/204), done.remote: Compressing objects: 100% (101/101), done.remote: Total 932 (delta 95), reused 152 (delta 87), pack-reused 728 (from 1)Receiving objects: 100% (932/932), 4.66 MiB | 12.09 MiB/s, done.Resolving deltas: 100% (442/442), done. é…ç½®ä¾èµ–åœ¨å½“å‰é¡¹ç›®çš„Cargo.tomlä¸­æ·»åŠ bindgenå’Œccä¾èµ–. Cargo.toml1234567891011[package]name = &quot;bindgen_elk&quot;version = &quot;0.1.0&quot;edition = &quot;2024&quot;[dependencies]libc = &quot;0.2&quot;[build-dependencies]cc = &quot;1.0&quot;bindgen = &quot;0.69&quot; åˆ›å»ºwrapper.hæ ¹æ®bindgençš„è§„åˆ™,éœ€è¦åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå«åšwrapper.hçš„å¤´æ–‡ä»¶,å¹¶åœ¨è¯¥æ–‡ä»¶å†…å¼•å…¥æƒ³è¦ç»‘å®šçš„åº“å¤´æ–‡ä»¶. wrapper.h1##include &quot;elk/elk.h&quot; ç¼–å†™build.rsåœ¨srcåŒçº§åˆ«ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºbuild.rsçš„æ–‡ä»¶, å½“å­˜åœ¨build.rsæ–‡ä»¶æ—¶å€™, Cargoä¼šä¼˜å…ˆç¼–è¯‘æ‰§è¡Œè¯¥æ–‡ä»¶. è¯·æ³¨æ„æŒ‡å®šincludeç›®å½•, æˆ‘ç”¨çš„æ˜¯mingw64, æ‰€ä»¥åœ¨bindgen::Builder::default()æ—¶å€™,æ‰‹åŠ¨æŒ‡å®šäº†targetå’Œsysroot 1234567891011let bindings = bindgen::Builder::default() .header(&quot;wrapper.h&quot;) .parse_callbacks(Box::new(bindgen::CargoCallbacks)) // 1. æŒ‡å®šç›®æ ‡ä¸‰å…ƒç»„ .clang_arg(&quot;--target=x86_64-w64-mingw32&quot;) // 2. æŒ‡å®š MinGW çš„æ ¹ç›®å½• .clang_arg(format!(&quot;--sysroot={}&quot;, &quot;C:/Program Files/mingw64&quot;)) // 3. æ˜¾å¼æ·»åŠ å¿…è¦çš„ GCC å†…éƒ¨è·¯å¾„ (å¦‚æœä¸Šè¿°ä¸¤é¡¹è¿˜ä¸å¤Ÿ) .clang_arg(&quot;-IC:/Program Files/mingw64/lib/gcc/x86_64-w64-mingw32/8.1.0/include&quot;) .generate() .expect(&quot;Unable to generate bindings&quot;); å†…å®¹å¦‚ä¸‹,å…·ä½“æ­¥éª¤å«ä¹‰è§æ³¨é‡Š. build.rs123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960use std::{ env, path::{Path, PathBuf},};extern crate cc;/** * ç¼–è¯‘å‡ºlibæ–‡ä»¶ */fn compile_libelk() { // å®šä¹‰æºæ–‡ä»¶è·¯å¾„ let src = [&quot;elk/elk.c&quot;]; // åˆ›å»ºcc builder let mut builder = cc::Build::new(); /* * files æºæ–‡ä»¶ä»¬ * include å¤´æ–‡ä»¶è·¯å¾„ * flag -DJS_DUMPå®ç”¨äºæ‰“å°jsè°ƒè¯•ä¿¡æ¯. è§elk.hå†…js_dumpå‡½æ•°æ³¨é‡Š */ let build = builder.files(src.iter()).include(&quot;elk&quot;).flag(&quot;-DJS_DUMP&quot;); build.compile(&quot;elk&quot;);}/** * ç”Ÿæˆbinding.rs */fn bindgen_generate() { // è·å–å½“å‰Cargo.tomlæ‰€åœ¨æ–‡ä»¶å¤¹,ä¸€èˆ¬æ¥è¯´å°±æ˜¯è¯¥é¡¹ç›®ä½ç½® let dir = env::var(&quot;CARGO_MANIFEST_DIR&quot;).unwrap(); // æŒ‡å®šåº“è·¯å¾„,å³elkæ–‡ä»¶å¤¹ println!( &quot;cargo:rustc-link-search=native={}&quot;, Path::new(&amp;dir).join(&quot;elk&quot;).display() ); // å¦‚æœ wrapper.h æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–, å°±é‡æ–°è¿è¡Œæ„å»ºè„šæœ¬ println!(&quot;cargo:rerun-if-changed=wrapper.h&quot;); // é…ç½®ç»‘å®š let bindings = bindgen::Builder::default() .header(&quot;wrapper.h&quot;) .parse_callbacks(Box::new(bindgen::CargoCallbacks)) // 1. æŒ‡å®šç›®æ ‡ä¸‰å…ƒç»„ .clang_arg(&quot;--target=x86_64-w64-mingw32&quot;) // 2. æŒ‡å®š MinGW çš„æ ¹ç›®å½• .clang_arg(format!(&quot;--sysroot={}&quot;, &quot;C:/Program Files/mingw64&quot;)) // 3. æ˜¾å¼æ·»åŠ å¿…è¦çš„ GCC å†…éƒ¨è·¯å¾„ (å¦‚æœä¸Šè¿°ä¸¤é¡¹è¿˜ä¸å¤Ÿ) .clang_arg(&quot;-IC:/Program Files/mingw64/lib/gcc/x86_64-w64-mingw32/8.1.0/include&quot;) .generate() .expect(&quot;Unable to generate bindings&quot;); let out_path = PathBuf::from(env::var(&quot;OUT_DIR&quot;).unwrap()); // ç”Ÿæˆæ–‡ä»¶å†™å…¥åˆ°binding.rs bindings .write_to_file(out_path.join(&quot;bindings.rs&quot;)) .expect(&quot;Couldn't write bindings!&quot;);}fn main() { compile_libelk(); bindgen_generate();} ç”Ÿæˆå¹¶ä½¿ç”¨binding.rså¦‚æœä½ çš„ç¯å¢ƒæ­£å¸¸,è¿™æ—¶å€™åªéœ€è¦æ‰§è¡Œcargo buildå³å¯ 1234PS E:\\GitHub\\bindgen_elk&gt; cargo build # ...å¿½ç•¥å¤§é‡æ— ç”¨ä¿¡æ¯ Compiling bindgen_elk v0.1.0 (E:\\GitHub\\bindgen_elk) Finished `dev` profile [unoptimized + debuginfo] target(s) in 11.25s æœ€ç»ˆåœ¨target\\debug\\build\\bindgen_elk-b6aa022ece64a1fa\\out\\bindings.rsä¸‹æ‰¾åˆ°ç”Ÿæˆç»‘å®šæ–‡ä»¶. æµ‹è¯•JSè„šæœ¬å‚ç…§æ–‡ç« å¼€å¤´çš„Cè°ƒç”¨JSä»£ç , æˆ‘ä»¬å†™å‡ºRustç‰ˆæœ¬ 12345678910111213141516171819202122232425262728293031323334use std::ffi::{CString, CStr};include!(concat!(env!(&quot;OUT_DIR&quot;), &quot;/bindings.rs&quot;));##[unsafe(no_mangle)]pub unsafe extern &quot;C&quot; fn sum(js: *mut js, args: *mut jsval_t, nargs: i32) -&gt; jsval_t { if nargs != 2 { let msg = CString::new(&quot;2 args expected&quot;).unwrap(); return js_mkerr(js, msg.as_ptr()); } let a = js_getnum(*args.offset(0)); let b = js_getnum(*args.offset(1)); js_mknum(a + b)}fn main() { unsafe { let mut mem = [0u8; 8192]; let js = js_create(mem.as_mut_ptr() as *mut _, mem.len()); let name = CString::new(&quot;sum&quot;).unwrap(); js_set(js, js_glob(js), name.as_ptr(), js_mkfun(Some(sum))); let code = CString::new(&quot;sum(3, 4);&quot;).unwrap(); let code_len = code.as_bytes().len(); let result = js_eval(js, code.as_ptr(), code_len); let s = CStr::from_ptr(js_str(js, result)).to_str().unwrap(); println!(&quot;result: {}&quot;, s); }} æ‰§è¡Œä»¥åå¯ä»¥çœ‹åˆ°è¾“å‡º 1234PS E:\\GitHub\\bindgen_elk&gt; cargo run Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.94s Running `target\\debug\\bindgen_elk.exe`result: 7 ç¯å¢ƒ rustup 1.28.2 (e4f3ad6f8 2025-04-28) cargo 1.89.0-nightly (fc1518ef0 2025-06-06) elk @ a9bb856 å‚è€ƒèµ„æ–™ Rust Cargo è‡ªå®šä¹‰æ„å»º Rust Cargoä½¿ç”¨æŒ‡å— | ç¬¬åä¸ƒç¯‡ | æ„å»ºè„šæœ¬ build.rs","link":"/2025/12/05/rust-bindgen-for-elk/"},{"title":"å£°æ˜å¼ UI æ¶æ„ä¸‹çš„ç”Ÿå‘½å‘¨æœŸæ¼”è¿›ï¼šä»å†…å»ºå±æ€§åˆ°æ˜¾å¼è®¢é˜…","text":"æ¶ˆå¤±çš„â€œå®ä½“â€: ä»Viewåˆ°Composable/Widgetåœ¨åŸç”ŸAndroidå¼€å‘çš„ä¸–ç•Œ, åˆ›å»ºæ¨¡ç‰ˆé¡¹ç›®åå°±ä¼šå¾—åˆ°ä¸€ä¸ªMainActivityå’Œactivity_main.xml.æˆ‘ä»¬ä¹ æƒ¯äº†åœ¨MainActivityé‡Œå»ç»‘å®šButtonå’ŒTextå†è®¾ç½®å„ç§å±æ€§. ä»–ä»¬éƒ½æ˜¯å†…å­˜ä¸­çœ‹å¾—è§,æ‘¸å¾—ç€çš„View.ä½†æ˜¯åˆ°äº†Flutterä¸­, å¾—åˆ°çš„äº†å´æ˜¯main()å‡½æ•°å’Œä¸€å †StatelessWidgetå’ŒStatefulWidget.ä¸ä»…ä»…æ˜¯Flutter, è¿Jetpack Composeä¹Ÿåœ¨å‘è¿™ç§â€™å£°æ˜å¼UIâ€™é æ‹¢.Composeä¸­åŒæ ·æ‰¾ä¸åˆ°onResume(å…¥å£Activityé™¤å¤–),å–è€Œä»£ä¹‹çš„è€Œæ˜¯å±‚å±‚åµŒå¥—çš„Composableå‡½æ•° è¿™ç§è½¬å˜æœ¬è´¨ä¸Šæ˜¯ï¼šæˆ‘ä»¬ä¸å†æŒæœ‰ UI çš„â€œå¥æŸ„â€ï¼Œæˆ‘ä»¬åªæŒæœ‰â€œæ•°æ®â€ã€‚ æ­£å› ä¸ºæˆ‘ä»¬æŒæœ‰çš„åªæ˜¯æ•°æ®ï¼Œè€Œæ•°æ®æœ¬èº«æ˜¯æ²¡æœ‰â€˜å‰åå°â€™æ¦‚å¿µçš„ï¼ˆä¸€ä¸ª String å­—ç¬¦ä¸²å“ªé‡ŒçŸ¥é“è‡ªå·±æ˜¯å¦åœ¨å‰å°ï¼Ÿï¼‰ã€‚æ‰€ä»¥ï¼Œåœ¨å£°æ˜å¼ UI ä¸­å¯»æ‰¾ onResume æœ¬èº«å°±æ˜¯ä¸€ä¸ªä¼ªå‘½é¢˜ã€‚åªæœ‰å½“æ•°æ®éœ€è¦æ ¹æ®ç³»ç»ŸçŠ¶æ€ï¼ˆå¦‚ç”¨æˆ·å›æ¥äº†ï¼‰è¿›è¡Œåˆ·æ–°æ—¶ï¼Œæˆ‘ä»¬æ‰å»ä¸»åŠ¨è¯¢é—®ç³»ç»Ÿã€‚ ä¸ºä»€ä¹ˆ onResume ä¸å†å±äº UI ç»„ä»¶Viewä½“ç³»çš„â€œé‡å½¢çº¦æŸâ€åœ¨åŸç”Ÿ Android ä¸­ï¼ŒActivity æ˜¯ä¸€ä¸ªé‡å‹å®¹å™¨ï¼Œå®ƒç›´æ¥å æ®ç€ç³»ç»Ÿçš„çª—å£èµ„æºå’Œè¾“å…¥ç„¦ç‚¹ã€‚è¿™ç§è®¾è®¡å†³å®šäº†å¼€å‘è€…å¿…é¡»æ‹¥æœ‰æå¼ºçš„â€œç”Ÿå­˜æ„è¯†â€ï¼š å‰åå°åˆ‡æ¢: æˆ‘ä»¬å¿…é¡»ç²¾ç¡®æŒæ¡ onPause å’Œ onResumeï¼Œä»¥ä¾¿åœ¨å¤±å»ç„¦ç‚¹æ—¶åœæ­¢åŠ¨ç”»æˆ–æš‚åœè§†é¢‘ã€‚ æé™ç”Ÿå­˜ï¼š åœ¨ç”µæ± ä¼˜åŒ–ç­–ç•¥æˆ–â€œä¸ä¿ç•™æ´»åŠ¨â€çš„æé™æµ‹è¯•ä¸‹ï¼ŒActivity éšæ—¶ä¼šè¢«é”€æ¯ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä¾èµ– onSaveInstanceState è‰°éš¾åœ°ç»´æŒçŠ¶æ€ã€‚ ä»»åŠ¡æµè½¬ï¼š è€—æ—¶åå°ä»»åŠ¡å¿…é¡»æŒªåˆ°ä¸“é—¨çš„ Foreground/Background Service ä¸­ï¼Œå¦åˆ™éšæ—¶ä¼šè¢«ç³»ç»Ÿâ€œç¥­å¤©â€ã€‚ å£°æ˜å¼ UI çš„â€œé€»è¾‘é‡æ„â€ä½†åœ¨ Flutter å’Œ Compose çš„ä¸–ç•Œé‡Œï¼Œè¿™ç§â€œèµ„æºç„¦è™‘â€è¢«å±è”½äº†ã€‚æˆ‘ä»¬é¢å¯¹çš„æ˜¯è½»é‡çº§çš„å‡½æ•°å’Œé…ç½®ã€‚ UI å³å¿«ç…§ï¼š ç•Œé¢ä¸å†æ˜¯é•¿å­˜çš„å®ä½“ï¼Œè€Œæ˜¯æ•°æ®çš„ç¬æ—¶è¡¨è¾¾ã€‚é”€æ¯ä¸€ä¸ª Widget å°±åƒæ‰”æ‰ä¸€å¼ è‰ç¨¿çº¸ï¼Œæˆæœ¬æä½ã€‚ åº•å±‚é‡æ„ï¼š è¿™ç§å˜åŒ–ä¸ä»…ä»…æ˜¯è¯­æ³•ä¸Šçš„ï¼Œæ›´æ˜¯åº•å±‚ç”Ÿå­˜é€»è¾‘çš„é‡æ„ã€‚ä½ ä¸å†éœ€è¦ç›¯ç€æ¯ä¸€ä¸ª View å¯¹è±¡çš„æ­»æ´»ï¼Œåªéœ€è¦å®ˆæŠ¤å¥½èƒŒåçš„ Stateã€‚ æ¶ˆå¤±çš„æœ¬è´¨ï¼šä¸ºä»€ä¹ˆå®ƒä»¬æ•¢â€œå¹²æ‰â€ onResumeï¼Ÿåœ¨åŸç”Ÿ Android ä¸­ï¼ŒView æ˜¯ä¸€ä¸ªå…·æœ‰ç¨³å®šèº«ä»½ï¼ˆStable Identityï¼‰çš„å¯¹è±¡ã€‚ä½ é€šè¿‡ findViewById æ‹¿åˆ°çš„ Buttonï¼Œåœ¨å®ƒè¢«é”€æ¯å‰ï¼Œå…¶å†…å­˜åœ°å€æ˜¯ä¸å˜çš„ï¼Œå› æ­¤å®ƒå¯ä»¥å®‰å…¨åœ°æŒæœ‰çŠ¶æ€ä¸ç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚ è€Œåœ¨ Flutter ä¸­ï¼ŒWidget ä»…æ˜¯ä¸å¯å˜çš„é…ç½®æè¿°ï¼ˆImmutable Configurationï¼‰ã€‚ å®ƒåœ¨æ¯ä¸€å¸§éƒ½å¯èƒ½è¢«é‡æ–°åˆ›å»ºã€‚ ä½ æ— æ³•ç»™ä¸€ä¸ªâ€œç¬æ—¶å¿«ç…§â€ç»‘å®šç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºè¿™ä¸ªå¯¹è±¡æœ¬èº«éšæ—¶ä¼šæ¶ˆå¤±ã€‚ çœŸæ­£å…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„ä¸æ˜¯ Widgetï¼Œè€Œæ˜¯åº•å±‚çš„ State å¯¹è±¡ï¼Œå› ä¸ºå®ƒåœ¨ Widget é‡å»ºæ—¶ä¾ç„¶ä¿æŒç¨³å®šã€‚ åªæœ‰å½“ä¸šåŠ¡éœ€è¦æ—¶ï¼Œæ‰å»â€œè®¢é˜…â€ç¯å¢ƒå…¶å® Flutter å¹¶éæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œåªæ˜¯å®ƒä¸å†ä½œä¸º UI ç»„ä»¶çš„å†…å»ºèƒ½åŠ›ã€‚ æˆ‘ä»¬éœ€è¦åŒºåˆ†ä¸‰ä¸ªç»´åº¦çš„ç”Ÿå‘½å‘¨æœŸï¼š App çº§åˆ«ï¼ˆWidgetsBindingï¼‰ï¼šæ•´ä¸ªåº”ç”¨è¿›ç¨‹çš„å‰åå°ä¿¡å·ã€‚ é¡µé¢çº§åˆ«ï¼ˆRouteAwareï¼‰ï¼šå½“å‰é¡µé¢æ˜¯å¦å¤„äºå¯¼èˆªæ ˆé¡¶çš„å¯è§çŠ¶æ€ã€‚ ç»„ä»¶çº§åˆ«ï¼ˆCompositionï¼‰ï¼šWidget è¿›å…¥æˆ–é€€å‡º UI æ ‘çš„è¿‡ç¨‹ã€‚ å°†è¿™äº›ä¿¡å·ä¸ UI æè¿°å½»åº•è§£è€¦ï¼Œæ­£æ˜¯ Flutter æè‡´çµæ´»çš„åŸå› ã€‚ Flutter æ–¹æ¡ˆï¼šç›‘å¬ AppLifecycleStateåœ¨ Flutter ä¸­ï¼Œéœ€è¦é€šè¿‡ WidgetsBindingObserver æ¥æ‰®æ¼”é‚£ä¸ªâ€œå“¨å…µâ€çš„è§’è‰²ã€‚ WidgetsBindingObserver çš„è®¢é˜…æ˜¯ State çº§åˆ«çš„ï¼Œè€Œä¸æ˜¯ Widget çº§åˆ«çš„ã€‚ 1234567891011121314151617181920212223// å»ºè®®æ›¿æ¢åŸæœ¬çš„ Flutter ä»£ç å—class MyState extends State&lt;MyWidget&gt; with WidgetsBindingObserver { @override void initState() { super.initState(); WidgetsBinding.instance.addObserver(this); } @override void didChangeAppLifecycleState(AppLifecycleState state) { // ä¸¥è°¨åˆ¤æ–­ï¼šåªæœ‰ App å›åˆ°å‰å°ï¼Œä¸”å½“å‰é¡µé¢æ­£å¤„äºæ ˆé¡¶å¯è§æ—¶ï¼Œæ‰è§¦å‘é€»è¾‘ if (state == AppLifecycleState.resumed &amp;&amp; ModalRoute.of(context)?.isCurrent == true) { _refreshData(); } } @override void dispose() { WidgetsBinding.instance.removeObserver(this); super.dispose(); }} Compose æ–¹æ¡ˆï¼šé€šè¿‡å‰¯ä½œç”¨æ˜¾å¼æ¥å…¥å®¿ä¸»ç”Ÿå‘½å‘¨æœŸCompose å¹¶æ²¡æœ‰â€œç§»é™¤â€ onResumeï¼Œè€Œæ˜¯æ‹’ç»è®© UI ç»„ä»¶éšå¼åœ°æŒæœ‰å®ƒã€‚ 123456789@Composablefun OnResumeEffect(onResume: () -&gt; Unit) { val lifecycleOwner = LocalLifecycleOwner.current LaunchedEffect(lifecycleOwner) { lifecycleOwner.lifecycle.repeatOnLifecycle(Lifecycle.State.RESUMED) { onResume() } }} ç»“è¯­ï¼šä»â€œè¢«åŠ¨æ¥å—â€åˆ°â€œä¸»åŠ¨è®¢é˜…â€ä»åŸç”Ÿ Android è½¬å‘ Flutter æˆ– Composeï¼Œæœ€éš¾çš„ä¸æ˜¯å­¦ä¹ æ–°çš„è¯­æ³•ï¼Œè€Œæ˜¯æ€ç»´æƒåŠ›çš„ç§»äº¤ã€‚ åœ¨ä¼ ç»Ÿçš„ View ä½“ç³»ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯ç³»ç»Ÿå¼ºè¡Œå¡ç»™æˆ‘ä»¬çš„â€œå…¨å®¶æ¡¶â€ï¼Œæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…ï¼Œæ›´å¤šæ˜¯åœ¨è¢«åŠ¨åœ°æ¥å— Activity çš„è°ƒåº¦ã€‚è€Œå£°æ˜å¼ UI çš„å‡ºç°ï¼Œå°†ç»„ä»¶å½»åº•ä»ç¹é‡çš„ç³»ç»Ÿç¯å¢ƒä¾èµ–ä¸­è§£æ”¾å‡ºæ¥ã€‚ è¿™ç§â€œæ¶ˆäº¡â€å®é™…ä¸Šæ˜¯ä¸€ç§è¿›åŒ–ï¼š å®ƒè®©æˆ‘ä»¬æ›´å…³æ³¨æ•°æ®æœ¬èº«ï¼šUI ä¸å†æ˜¯é•¿å­˜çš„â€œæˆ¿å­â€ï¼Œè€Œæ˜¯éšæ•°æ®æµåŠ¨çš„â€œå¿«ç…§â€ã€‚ å®ƒèµ‹äºˆäº†æˆ‘ä»¬è®¢é˜…çš„è‡ªç”±ï¼šä¸å†ä¸ºäº†é‚£ 1% çš„ä¸šåŠ¡éœ€æ±‚è®© 100% çš„ç»„ä»¶å»è´Ÿæ‹…ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œè€Œæ˜¯æ ¹æ®ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹ç²¾å‡†åœ°æ‹‰å‡ºä¸€æ ¹â€œä¿¡å·çº¿â€ã€‚ ç”Ÿå‘½å‘¨æœŸæ²¡æœ‰æ¶ˆå¤±ï¼Œåªæ˜¯ä»â€œéšå¼å›è°ƒâ€è¿›åŒ–ä¸ºäº†â€œæ˜¾å¼è®¢é˜…â€ã€‚","link":"/2024/01/02/the-death-of-onresume-declarative-ui-lifecycle/"},{"title":"UNO R4 Wi-Fi æ¥å…¥ Home Assistant","text":"é¡¹ç›®ä»‹ç»æœ¬é¡¹ç›®æ˜¯Funpackç¬¬äº”æœŸæ¿å¡ä¸‰çš„ä»»åŠ¡1å®ç°.ä»»åŠ¡ç›®æ ‡æ˜¯è®©UNO R4 Wi-Fié€šè¿‡ç½‘ç»œè¿æ¥åˆ°æ™ºèƒ½äº‘ç«¯, å¹¶æ¨¡æ‹Ÿæˆä¸€ä¸ªå¯ä»¥æ§åˆ¶çš„ç¯, é€šè¿‡è¿œç¨‹æ§åˆ¶è°ƒæ•´è‡ªå¸¦çš„LEDçŸ©é˜µç‚¹äº®èŒƒå›´. å®ç°æ€è·¯å°†UNO R4ä½œä¸ºç¯è£…ç½®æ¥å…¥IOTå¹³å°, éšååœ¨IOTå¹³å°ä¸Šä¸‹å‘å‘½ä»¤æ¥æ“ä½œUNO R4, è°ƒæ•´è¿™ä¸ªâ€ç¯â€çš„äº®åº¦.è¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯å¯ä»¥éƒ¨ç½²åœ¨å†…ç½‘ç¯å¢ƒä¸‹çš„Home Assistant. UNO R4é€šè¿‡MQTTæœåŠ¡å™¨ä¸Home Assistantè¿›è¡Œé€šä¿¡. MQTTæœåŠ¡å™¨é€‰æ‹©EMQXå¼€æºç‰ˆ. æœåŠ¡å™¨éƒ¨ç½²æœ¬é¡¹ç›®éœ€è¦æœ‰ä¸€å°æœåŠ¡å™¨,å¹¶ä¸”åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²Home Assistantå’ŒEMQXä¸¤ä¸ªæœåŠ¡.æœ¬èŠ‚ç®€å•ä»‹ç»ä¸‹ä¸¤ä¸ªæœåŠ¡çš„éƒ¨ç½²æ–¹å¼. Home Assistantåœ¨Home Assistantå®˜ç½‘ä¸Šæœ‰è¾ƒä¸ºè¯¦ç»†çš„å¤šç§å®‰è£…æ–¹å¼ä»‹ç».è¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯ä½¿ç”¨Dockerè¿›è¡Œå®‰è£…,å¯ä»¥å¿½ç•¥å¾ˆå¤šå…·ä½“ç¯å¢ƒå·®å¼‚,åªéœ€è¦è¾“å…¥å‘½ä»¤ä¾¿å¯å°†Home Assistantè·‘èµ·æ¥.å…·ä½“ä»‹ç»ä½äºInstall Home Assistant Container 123456789docker run -d \\ --name homeassistant \\ --privileged \\ --restart=unless-stopped \\ -e TZ=MY_TIME_ZONE \\ -v /PATH_TO_YOUR_CONFIG:/config \\ -v /run/dbus:/run/dbus:ro \\ --network=host \\ ghcr.io/home-assistant/home-assistant:stable å‘½ä»¤æ‰§è¡Œå®Œæ¯•,æ‰“å¼€ä½¿ç”¨æœåŠ¡å™¨IPé…åˆé»˜è®¤ç«¯å£å·8123-&gt;http://:8123å³å¯è¿›å…¥ä¸»é¢æ¿. EMQXEMQXåŒæ ·å¯ä»¥ä½¿ç”¨Dockerè¿›è¡Œå®‰è£…éƒ¨ç½², é¡µé¢é€šè¿‡ Docker è¿è¡Œ EMQXè¯¦ç»†ä»‹ç»äº†æ‰€éœ€çš„å‘½ä»¤. è¿è¡Œä»¥ä¸‹å‘½ä»¤è·å– Docker é•œåƒï¼š 1docker pull emqx/emqx:5.8.1 è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ Docker å®¹å™¨ã€‚ 1docker run -d --name emqx -p 1883:1883 -p 8083:8083 -p 8084:8084 -p 8883:8883 -p 18083:18083 emqx/emqx:5.8.1 HomeAssistantå¯¹æ¥åˆ°EMQXè¿›å…¥HomeAssistantä¸»é¡µåç‚¹å‡»å³ä¸‹è§’è®¾ç½®,é€‰æ‹©è®¾å¤‡ä¸æœåŠ¡, æœç´¢MQTT å®‰è£…å¥½MQTTæ’ä»¶å,è¿›å…¥æ’ä»¶é¢æ¿ç‚¹å‡»æ·»åŠ æ¡ç›®å¡«å†™ä¸Šä¸€æ­¥é…ç½®çš„EMQXä¿¡æ¯å³å¯. ä»£ç ç¼–å†™æ³¨å†Œåˆ°Home Assistantpublish æŒ‡å®šæ ¼å¼çš„payloadåˆ°topicå…¶ä¸­topicæ ¼å¼ä¸ºhomeassistant/è®¾å¤‡ç±»å‹/è‡ªå®šä¹‰åç§°/config,æ ¹æ®æ ¼å¼è¦æ±‚.å¾—åˆ°ä¸»é¢˜åº”å½“ä¸ºhomeassistant/light/fun_matrix/config.payloadå†…å®¹æ˜¯ä¸€ä¸ªæè¿°è®¾å¤‡çš„jsonå­—ç¬¦ä¸², å¦‚ä¸‹ä»£ç æ‰€ç¤º. å…¶ä¸­nameæ˜¯è®¾å¤‡åç§°; device_classè¦å’Œæ³¨å†Œtopicä¸­è®¾å¤‡ç±»å‹å¯¹åº”; command_topicä»£è¡¨è®¾å¤‡çš„å¼€å…³çŠ¶æ€; brightness_command_topicç¯çš„äº®åº¦æ§åˆ¶; unique_idè£…ç½®å”¯ä¸€ID; deviceè®¾å¤‡æè¿°; schemaä»£è¡¨å½“å‰ä¸ºjsonæ ¼å¼; brightnessä»£è¡¨æœ¬è£…ç½®æ”¯æŒäº®åº¦æ§åˆ¶;1234567891011121314151617181920212223void registerToHomeAssistantServer() { const char* topic = &quot;homeassistant/light/fun_matrix/config&quot;; std::string message = R&quot;({ &quot;name&quot;: &quot;led&quot;, &quot;device_class&quot;: &quot;light&quot;, &quot;command_topic&quot;: &quot;fun_matrix/light/state&quot;, &quot;brightness_command_topic&quot;: &quot;fun_matrix/light/brightness/set&quot;, &quot;unique_id&quot;: &quot;fun_matrix&quot;, &quot;device&quot;: { &quot;identifiers&quot;: &quot;fun_matrix&quot;, &quot;name&quot;: &quot;UnoR4WiFi&quot; }, &quot;schema&quot;: &quot;json&quot;, &quot;brightness&quot;: true})&quot;; bool retained = false; int qos = 1; bool dup = false; mqttClient.beginMessage(topic, message.length(), retained, qos, dup); mqttClient.print(message.c_str()); mqttClient.endMessage();} å“åº”HomeAssistantå‘½ä»¤æ ¹æ®æ³¨å†Œæ—¶å€™payloadä¸­brightness_command_topicå’Œcommand_topic, æ¥å“åº”å…·ä½“çš„åŠ¨ä½œå³å¯.å…¶ä¸­command_topicå›ºå®šä¼ é€’ONå’ŒOFFå­—ç¬¦ä¸², brightness_command_topicä¼ é€’äº®åº¦å€¼0-255. 123456789101112131415161718192021222324252627282930void onMqttMessage(int messageSize) { String topic = mqttClient.messageTopic(); Serial.println(topic); String payload; while (mqttClient.available()) { payload = mqttClient.readString(); Serial.println(payload); } if (topic.endsWith(&quot;state&quot;)) { Serial.print(&quot;brightness_state_topic&quot;); bool enable = payload.equals(&quot;ON&quot;); if (lightIsOn != enable) { lightIsOn = enable; if (lightIsOn) { showFrame(level); } else { showFrame(0); return; } } } if (topic.endsWith(&quot;set&quot;)) { Serial.print(&quot;brightness_command_topic&quot;); level = payload.toInt() / 25; Serial.println(level); showFrame(level); return; }} åŠŸèƒ½å±•ç¤ºåœ¨ç½‘é¡µä¸Šè®¾ç½®äº®åº¦, å‡èƒ½å¤Ÿåœ¨è®¾å¤‡ä¸Šå¾—åˆ°å®æ—¶çš„å“åº”.ä¸åŒçš„äº®åº¦,äº®èµ·çš„åŒºåŸŸ.","link":"/2024/09/27/uno-r4-wifi-and-home-assistant/"}],"tags":[{"name":"Embedded","slug":"Embedded","link":"/tags/Embedded/"},{"name":"C","slug":"C","link":"/tags/C/"},{"name":"ESP32","slug":"ESP32","link":"/tags/ESP32/"},{"name":"Dithering","slug":"Dithering","link":"/tags/Dithering/"},{"name":"ESP-IDF","slug":"ESP-IDF","link":"/tags/ESP-IDF/"},{"name":"JavaScript","slug":"JavaScript","link":"/tags/JavaScript/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","link":"/tags/%E7%AE%97%E6%B3%95/"},{"name":"å›¾åƒå¤„ç†","slug":"å›¾åƒå¤„ç†","link":"/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"},{"name":"HTTP","slug":"HTTP","link":"/tags/HTTP/"},{"name":"Android","slug":"Android","link":"/tags/Android/"},{"name":"DIY","slug":"DIY","link":"/tags/DIY/"},{"name":"Hardware Analysis","slug":"Hardware-Analysis","link":"/tags/Hardware-Analysis/"},{"name":"Keyboard","slug":"Keyboard","link":"/tags/Keyboard/"},{"name":"Arduino","slug":"Arduino","link":"/tags/Arduino/"},{"name":"WCH","slug":"WCH","link":"/tags/WCH/"},{"name":"CH592","slug":"CH592","link":"/tags/CH592/"},{"name":"IoT","slug":"IoT","link":"/tags/IoT/"},{"name":"BLE","slug":"BLE","link":"/tags/BLE/"},{"name":"Hardware DIY","slug":"Hardware-DIY","link":"/tags/Hardware-DIY/"},{"name":"SEO","slug":"SEO","link":"/tags/SEO/"},{"name":"Rust","slug":"Rust","link":"/tags/Rust/"},{"name":"ç§»åŠ¨å¼€å‘","slug":"ç§»åŠ¨å¼€å‘","link":"/tags/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91/"}],"categories":[{"name":"Hardware &amp; IoT","slug":"Hardware-IoT","link":"/categories/Hardware-IoT/"},{"name":"Software &amp; Dev","slug":"Software-Dev","link":"/categories/Software-Dev/"},{"name":"Project Logs","slug":"Project-Logs","link":"/categories/Project-Logs/"}],"pages":[{"title":"404 Not Found","text":"404 å¾ˆæŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¼¼ä¹å·²ç»å»æµæµªäº†... è¿™å¯èƒ½æ˜¯å› ä¸ºæ–‡ç« å·²è¢«ç§»é™¤ï¼Œæˆ–è€…æ‚¨è¾“å…¥äº†é”™è¯¯çš„é“¾æ¥ã€‚ è¿”å›é¦–é¡µ","link":"/404.html"},{"title":"å…³äº Chaosgoo","text":"Chaosgoo æ˜¯ç”± Chaos Goo åˆ›å»ºå¹¶ç»´æŠ¤çš„ç‹¬ç«‹è¿è¡Œçš„æŠ€æœ¯åšå®¢ã€‚ æœ¬ç½‘ç«™ä¸“æ³¨äºå‘å¸ƒä¸åµŒå…¥å¼ç³»ç»Ÿã€ç”µå­å·¥ç¨‹å’Œè½¯ç¡¬ä»¶ç»“åˆç›¸å…³çš„åŸåˆ›å®æˆ˜æŠ€æœ¯æ–‡ç« ã€‚æœ¬ç«™æ‰€æœ‰å†…å®¹å‡ç”±ç«™é•¿åŸºäºçœŸå®çš„å¼€å‘å’Œå·¥ç¨‹å®è·µç¼–å†™ã€ç¼–è¾‘å’Œç»´æŠ¤ã€‚ æœ¬ç«™å¤„äºæŒç»­ç»´æŠ¤ä¸­ï¼Œå¹¶è®¡åˆ’é•¿æœŸå‘å¸ƒã€‚æœ¬ç«™ä¸å­˜åœ¨ä»»ä½•é‡‡é›†ã€è‡ªåŠ¨ç”Ÿæˆæˆ–èšåˆçš„å†…å®¹ã€‚ æœ‰å…³å†…å®¹ã€ç‰ˆæƒæˆ–å¹¿å‘Šåˆä½œçš„å’¨è¯¢ï¼Œè¯·é€šè¿‡ admin@chaosgoo.com è”ç³»ç«™é•¿ã€‚ å…³äºæˆ‘ ä½ å¥½ï½ æˆ‘æ˜¯ Gooï¼ˆChaos Gooï¼‰ï¼Œä¸€ä¸ªæ²‰è¿· DIY çš„çˆ±å¥½è€…ã€‚ è¿™é‡Œè®°å½•å¼€å‘è¿‡ç¨‹ä¸­çš„å®éªŒä»£ç ã€è°ƒè¯•ç»éªŒä»¥åŠè®¾è®¡æ€è·¯ï¼ŒåŒæ—¶ä¿ç•™çœŸå®å¼€å‘è¿‡ç¨‹ä¸­çš„æ€è€ƒä¸æ€»ç»“ã€‚ æŠ€æœ¯æ ˆ &amp; ä¸“é•¿é¢†åŸŸ é¢†åŸŸ æŠ€æœ¯/å·¥å…· åµŒå…¥å¼å¼€å‘ ESP32 / ESP-IDF / ESP8266 / WCH (CH58x/CH592) / Arduino GUI æ¡†æ¶ LVGL / FreeType å­—ä½“å¼•æ“ / TFT_eSPI æ™ºèƒ½å®¶å±… HomeKit / Home Assistant / MQTT ç§»åŠ¨å¼€å‘ Android (Kotlin / Flutter) ç¡¬ä»¶è®¾è®¡ KiCad / Fusion 360 / 3D æ‰“å° (Bambu Lab P1SC) ç‰ˆæœ¬æ§åˆ¶ Git / GitHub æ ¸å¿ƒæŠ˜è…¾æ–¹å‘ ä½æˆæœ¬èŠ¯ç‰‡åˆ›æ„åº”ç”¨ï¼šä¸»åŠ›ä½¿ç”¨ä¹é‘« ESP32 ç³»åˆ—ï¼Œä»æ„æ€åˆ° PCB è®¾è®¡ã€ç„Šæ¥ã€å›ºä»¶å¼€å‘å…¨ç¨‹ç‹¬ç«‹å®Œæˆ WCH èŠ¯ç‰‡æ¢ç´¢ï¼šæœ€è¿‘åœ¨è§£é” CH58x/CH592 ç­‰è¶…ä½åŠŸè€—èŠ¯ç‰‡ï¼Œç ”ç©¶è“ç‰™ BLE + å¢¨æ°´å±çš„æé™åº”ç”¨ æ¸¸æˆé“å…·è¿˜åŸï¼šä¸åªåšåˆ°å¤–è§‚ç¥ä¼¼ï¼Œæ›´è¦å¤åˆ»æ ¸å¿ƒåŠŸèƒ½ â€”â€” å‘å…‰ã€éŸ³æ•ˆã€äº¤äº’åŠ¨ç”» ä»£è¡¨é¡¹ç›® é¡¹ç›® æè¿° é“¾æ¥ ESPFlash Android å¹³å°çš„ ESP32 çƒ§å½•å·¥å…·ï¼Œå·²ä¸Šæ¶ Google Play GitHub CS2 HealthPin çœŸå®è¿˜åŸ CS2 ç”Ÿå‘½å€¼èƒ¸ç« ï¼Œæ”¯æŒæ¸¸æˆ GSI å®æ—¶åŒæ­¥ åšæ–‡ Friday Ink åŸºäº CH582F çš„è¶…ä½åŠŸè€—å¢¨æ°´å±æ—¶é’Ÿ (â‰ˆ3Î¼A ä¼‘çœ ) åšæ–‡ LVGL FreeType ç³»åˆ— ESP32 ä¸Šå®ç°å¯å˜å­—ä½“åŠ¨æ€å­—é‡ (50,000+ é˜…è¯»é‡) ç³»åˆ—æ–‡ç«  ç¡¬ä»¶è£…å¤‡ 3D æ‰“å°æœºï¼šBambu Lab P1SCï¼ˆå®šåˆ¶å¤–å£³å’Œæœºæ¢°é›¶ä»¶ï¼‰ å»ºæ¨¡è½¯ä»¶ï¼šFusion 360ï¼ˆå¯¹æ¯” Inventor æ›´è½»é‡ï¼Œä¸Šæ‰‹æ›´é¡ºï¼‰ è”ç³»æ–¹å¼ Email: admin@chaosgoo.com GitHub: github.com/chaosgoo Bilibili: ä¸ªäººä¸»é¡µ YouTube: @chaosgoo è¯¥ç”µå­é‚®ä»¶åœ°å€ç”±ç«™é•¿ç›´æ¥ç®¡ç†ã€‚ ç‰ˆæƒå£°æ˜æœ¬ç«™ä½œä¸ºç¬”è€…çš„å”¯ä¸€å®˜æ–¹æŠ€æœ¯å­˜æ¡£ç‚¹ï¼ŒæŒç»­æ›´æ–°ä¸­ã€‚ æ‰€æœ‰åŸåˆ›æ–‡ç« ã€ä»£ç ç‰‡æ®µå’Œé¡¹ç›®èµ„æ–™å‡éµå¾ª CC BY-NC 4.0 åè®®å‘å¸ƒã€‚ æœ¬ç«™éƒ¨åˆ†æ–‡ç« çš„æ—©æœŸç‰ˆæœ¬æ›¾å‘å¸ƒåœ¨å…¶ä»–å¹³å°ï¼Œç°å·²åœ¨æœ¬ç«™è¿›è¡Œäº†é‡æ–°ä¿®è®¢ã€æ•´åˆå¹¶ç”±æœ¬ç«™ç‹¬å®¶ç»´æŠ¤ã€‚æ‰€æœ‰å†…å®¹çš„åˆ›å»ºå‡å‡ºäºæ•™è‚²å’Œä¿¡æ¯ç›®çš„ï¼Œå¹¶åœ¨å‘å¸ƒå‰ç»è¿‡å®¡æ ¸ã€‚æœ¬ç«™ä¸æ¥å—ç”¨æˆ·ç”Ÿæˆçš„å†…å®¹æˆ–å…¬å¼€æŠ•ç¨¿ã€‚æœ¬ç«™æ˜¾ç¤ºçš„ä»»ä½•å¹¿å‘Šå‡ä¸å½±å“ç¼–è¾‘å†³ç­–æˆ–å†…å®¹åˆ›ä½œã€‚ å¹¿å‘Šä¸å•†ä¸šåŒ–æœ¬ç½‘ç«™å¯èƒ½ä¼šå±•ç¤ºç¬¬ä¸‰æ–¹å¹¿å‘Šï¼ˆå¦‚ Google AdSenseï¼‰ï¼Œä»¥æ”¯æŒç½‘ç«™æ‰˜ç®¡å’ŒæŒç»­çš„å†…å®¹åˆ›ä½œã€‚ å¹¿å‘Šä¸ä¼šå½±å“å†…å®¹çš„ç¼–è¾‘ç‹¬ç«‹æ€§ã€‚ å†å²è´¦å·è¯´æ˜ Bilibili (æ—§): uid:14374079ï¼ˆå·²æ³¨é”€ï¼‰ ç®€ä¹¦: ä¸€åªä¸å’•çš„é¸½å­ï¼ˆå·²åœæ›´ï¼‰","link":"/about/index.html"},{"title":"è”ç³»æˆ‘ä»¬","text":"å¦‚æœæ‚¨å¯¹æœ¬ç«™çš„å†…å®¹ï¼ˆå¦‚ ESP32 å¼€å‘ã€Android æŠ€æœ¯åˆ†äº«ç­‰ï¼‰æœ‰ä»»ä½•ç–‘é—®ã€å»ºè®®ï¼Œæˆ–è€…æœ‰å•†åŠ¡åˆä½œæ„å‘ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸æˆ‘å–å¾—è”ç³»ã€‚ ç”µå­é‚®ä»¶ (Email)è¿™æ˜¯æœ€æ¨èçš„è”ç³»æ–¹å¼ï¼Œé€šå¸¸ä¼šåœ¨ 24-48 å°æ—¶å†…å›å¤ã€‚ admin@chaosgoo.comsindoutriqua@gmail.com (å»ºè®®åœ¨é‚®ä»¶æ ‡é¢˜ä¸­æ³¨æ˜æ¥æ„ï¼Œä¾‹å¦‚ï¼šâ€œå…³äº[æ–‡ç« æ ‡é¢˜]çš„ç–‘é—®â€) ç¤¾äº¤åª’ä½“ (Social Media)æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹å¹³å°å…³æ³¨æˆ‘çš„æœ€æ–°åŠ¨æ€ï¼š Bilibili: ç‚¹å‡»è®¿é—®æˆ‘çš„ B ç«™ä¸»é¡µ (åˆ†äº«ç¡¬ä»¶åˆ¶ä½œè§†é¢‘) GitHub: ç‚¹å‡»è®¿é—®æˆ‘çš„ GitHub (è·å–é¡¹ç›®æºç ) ç‰ˆæƒå£°æ˜æœ¬ç«™æ‰€æœ‰åŸåˆ›æ–‡ç« åŠä»£ç ï¼Œæœªç»æˆæƒè¯·å‹¿è½¬è½½ã€‚å¦‚éœ€è½¬è½½æˆ–å¼•ç”¨ï¼Œè¯·å…ˆé€šè¿‡é‚®ä»¶è”ç³»ç¡®è®¤ã€‚","link":"/contact/index.html"},{"title":"ESP32 å¼€å‘æŒ‡å—ï¼šä»å…¥é—¨åˆ°è¿›é˜¶","text":"ESP32 å¼€å‘èµ„æºæ±‡æ€»ESP32 æ˜¯ä¹é‘«ï¼ˆEspressifï¼‰æ¨å‡ºçš„ä¸€æ¬¾ä½æˆæœ¬ã€ä½åŠŸè€—çš„ç³»ç»Ÿçº§èŠ¯ç‰‡ï¼ˆSoCï¼‰ï¼Œé›†æˆäº† Wi-Fi å’Œè“ç‰™åŠŸèƒ½ï¼Œå¹¿æ³›åº”ç”¨äºç‰©è”ç½‘ï¼ˆIoTï¼‰ã€æ™ºèƒ½å®¶å±…ã€å¯ç©¿æˆ´è®¾å¤‡ç­‰é¢†åŸŸã€‚ æœ¬é¡µé¢æ±‡æ€»äº†æœ¬ç«™æ‰€æœ‰ä¸ ESP32 å¼€å‘ç›¸å…³çš„æŠ€æœ¯æ–‡ç« ï¼Œæ¶µç›–ä»åŸºç¡€å…¥é—¨åˆ°é«˜çº§åº”ç”¨çš„å®Œæ•´çŸ¥è¯†ä½“ç³»ã€‚ æ–‡ç« ç´¢å¼•GUI å¼€å‘ï¼šLVGL + FreeType å¯å˜å­—ä½“ç³»åˆ—è¿™æ˜¯æœ¬ç«™æœ€å—æ¬¢è¿çš„ç³»åˆ—æ–‡ç« ï¼Œç´¯è®¡é˜…è¯»é‡è¶…è¿‡ **50,000+**ã€‚ ç« èŠ‚ æ ‡é¢˜ ç®€ä»‹ ç¬¬ä¸€ç«  åœ¨ LVGL ä¸­å®ç°å¯å˜å­—ä½“ (Variable Font) FreeType å­—ä½“å¼•æ“åŸºç¡€ï¼Œåœ¨ Windows æ¨¡æ‹Ÿå™¨ä¸Šå®ç°åŠ¨æ€å­—é‡ ç¬¬äºŒç«  LVGL + FreeType - ESP32 ç§»æ¤ç¯‡ PlatformIO é¡¹ç›®é…ç½®ï¼ŒTFT_eSPI å±å¹•é©±åŠ¨ ç¬¬ä¸‰ç«  LVGL + FreeType - åŠ¨ç”»æ•ˆæœå®ç° SD å¡åŠ è½½å­—ä½“ï¼Œå­—é‡åŠ¨ç”»å®ç° ç½‘ç»œä¸é€šä¿¡ æ–‡ç«  ç®€ä»‹ ESP32 æ˜¾ç¤ºå…¬ç½‘ JPG å›¾ç‰‡ HTTP åè®®è¯¦è§£ï¼ŒAsyncTCP åˆ†å—ä¼ è¾“ï¼ŒContent-Length è§£æ ESP32 + 4G æ¨¡å—ï¼šPPPoS è”ç½‘æ–¹æ¡ˆ å‘Šåˆ« AT æŒ‡ä»¤ï¼Œä½¿ç”¨ PPPoS å°†ä¸²å£è™šæ‹Ÿä¸ºç½‘å¡ ESP32 PC ç”»é¢å®æ—¶ä¸²æµ Python æŠ“å¸§ç¼–ç  + è‡ªå®šä¹‰ TCP åè®® + DMA æ¸²æŸ“ æ™ºèƒ½å®¶å±…ï¼šHomeKit ç³»åˆ— ç« èŠ‚ æ ‡é¢˜ ç®€ä»‹ ç¬¬ä¸€ç«  ESP32 æ§åˆ¶ç¯å…‰ - èˆµæœºæ–¹æ¡ˆ éä¾µå…¥å¼æ”¹é€ ï¼Œèˆµæœº PWM æ§åˆ¶åŸç† ç¬¬äºŒç«  ESP32 æ§åˆ¶ç¯å…‰ - WSL ç¯å¢ƒé…ç½® esp-homekit-demo ç¼–è¯‘ä¸çƒ§å½• ç¬¬ä¸‰ç«  ESP32 æ§åˆ¶ç¯å…‰ - ä»£ç èåˆ Siri è¯­éŸ³æ§åˆ¶é—­ç¯å®ç° è¿›é˜¶é¡¹ç›®ï¼š ç±³å®¶å±å¹•æŒ‚ç¯ HomeKit æ”¹é€  - æ‹†è§£åˆ†æ + èŠ¯ç‰‡æ›¿æ¢ å¼€å‘æŠ€å·§ä¸å¡«å‘æŒ‡å— æ–‡ç«  ç®€ä»‹ ESP32 è¿›é˜¶å¼€å‘æŠ€å·§ å¼‚æ­¥ HTTPã€Light-Sleep PWMã€GIF æ’­æ”¾ã€SPIFFS OTA ESP-IDF embed_txtfiles ä½¿ç”¨æŠ€å·§ èµ„æºåµŒå…¥æœºåˆ¶è¯¦è§£ï¼Œè¯ä¹¦/HTML ç®¡ç†æœ€ä½³å®è·µ ESP32-C3 PlatformIO embed_txtfiles ä¿®å¤ RISC-V å·¥å…·é“¾é…ç½® Bug è§£å†³æ–¹æ¡ˆ SPI LCD vs å¹¶å£ LCD æ€§èƒ½å¯¹æ¯” 60MHz SPI ä¸ 8 ä½å¹¶å£å®æµ‹æ•°æ®åˆ†æ å›¾åƒå¤„ç†ï¼šDitherpunk æŠ–åŠ¨ç®—æ³• æ–‡ç«  ç®€ä»‹ Ditherpunk (ä¸€)ï¼šç®—æ³•åŸç†ä¸ JS å®æ—¶æ¼”ç¤º Gamma æ ¡æ­£ã€Bayer çŸ©é˜µã€è¯¯å·®æ‰©æ•£ç®—æ³•è¯¦è§£ Ditherpunk (äºŒ)ï¼šESP32 + å•è‰²å±å®æˆ˜ ST7305 1.54 å¯¸å±é©±åŠ¨ï¼Œå…¨å¥—æŠ–åŠ¨æ•ˆæœç§»æ¤ æ¨èå¤–éƒ¨èµ„æº ESP-IDF å®˜æ–¹æ–‡æ¡£ LVGL å®˜æ–¹æ–‡æ¡£ PlatformIO ESP32 å¹³å° ä¹é‘«å®˜æ–¹è®ºå› è”ç³»ä¸åé¦ˆå¦‚æœä½ åœ¨ ESP32 å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œæˆ–è€…å¯¹æ–‡ç« å†…å®¹æœ‰ä»»ä½•å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ï¼š Email: admin@chaosgoo.com GitHub: github.com/chaosgoo æœ¬é¡µé¢æŒç»­æ›´æ–°ä¸­ï¼Œæ”¶å½•æœ¬ç«™æ‰€æœ‰ ESP32 ç›¸å…³æŠ€æœ¯æ–‡ç« ã€‚","link":"/esp32-guide/index.html"},{"title":"GDPR æ•°æ®ä¿æŠ¤åˆè§„å£°æ˜","text":"Last updated: 2026 å¹´ 02 æœˆ 02 æ—¥ æœ¬åšå®¢ï¼ˆä»¥ä¸‹ç®€ç§° â€œæœ¬ç«™â€ï¼‰å°Šé‡å¹¶ä¿æŠ¤ç”¨æˆ·çš„ä¸ªäººæ•°æ®éšç§ï¼Œä¾æ®æ¬§ç›Ÿã€Šé€šç”¨æ•°æ®ä¿æŠ¤æ¡ä¾‹ã€‹ï¼ˆGDPRï¼ŒRegulation (EU) 2016/679ï¼‰åŠç›¸å…³æ•°æ®ä¿æŠ¤æ³•å¾‹æ³•è§„ï¼Œæ˜ç¡®å‘ŠçŸ¥æ¬§ç›Ÿç”¨æˆ·æœ¬ç«™çš„æ•°æ®æ”¶é›†ã€ä½¿ç”¨ã€ä¿æŠ¤è§„åˆ™åŠç”¨æˆ·äº«æœ‰çš„æ•°æ®æƒåˆ©ã€‚è‹¥ä½ å¯¹æ•°æ®ä¿æŠ¤æœ‰ä»»ä½•ç–‘é—®ï¼Œå¯é€šè¿‡ â€œè”ç³»æˆ‘ä»¬â€ æ–¹å¼ä¸æœ¬ç«™ç®¡ç†å‘˜æ²Ÿé€šã€‚ ä¸€ã€æˆ‘ä»¬æ”¶é›†å“ªäº›ç”¨æˆ·æ•°æ®ï¼Ÿç»“åˆæœ¬ç«™è¿è¥å®é™…ï¼Œä»…æ”¶é›†ä»¥ä¸‹ä¸æœåŠ¡å¿…è¦ç›¸å…³çš„æ•°æ®ï¼Œæ— é¢å¤–ä¸»åŠ¨æ”¶é›†è¡Œä¸ºï¼š ä¸»åŠ¨è”ç³»æ•°æ® è‹¥ä½ é€šè¿‡ç”µå­é‚®ä»¶ï¼ˆadmin@chaosgoo.comï¼‰æˆ–å…¶ä»–æ–¹å¼ä¸»åŠ¨è”ç³»æœ¬ç«™ï¼Œæˆ‘ä»¬ä¼šæ”¶é›†ä½ æä¾›çš„è”ç³»ä¿¡æ¯ï¼ˆå¦‚é‚®ç®±åœ°å€ã€æ²Ÿé€šå†…å®¹ï¼‰ã€‚ æ”¶é›†ç›®çš„ï¼šä»…ç”¨äºå›å¤ä½ çš„æŸ¥è¯¢ã€å¤„ç†ä½ çš„å»ºè®®ï¼Œä¸ä¼šç”¨äºå…¶ä»–æ— å…³ç”¨é€”ã€‚ ç¬¬ä¸‰æ–¹å·¥å…·å…³è”æ•°æ® æœ¬ç«™ä½¿ç”¨ Google Analyticsï¼ˆæµé‡åˆ†æï¼‰å’Œ Google AdSenseï¼ˆå¹¿å‘ŠæœåŠ¡ï¼‰ï¼Œç›¸å…³æ•°æ®æ”¶é›†ç”±è°·æ­Œè´Ÿè´£ï¼š Google Analytics å¯èƒ½æ”¶é›†ä½ çš„ IP åœ°å€ã€æµè§ˆå™¨ç±»å‹ã€è®¾å¤‡ä¿¡æ¯ã€è®¿é—®é¡µé¢ã€è®¿é—®æ—¶é—´ï¼ˆä»…ç”¨äºæµé‡ç»Ÿè®¡ä¸å†…å®¹ä¼˜åŒ–ï¼‰ï¼› Google AdSense å¯èƒ½é€šè¿‡ Cookie æ”¶é›†ä½ çš„æµè§ˆè¡Œä¸ºæ•°æ®ï¼ˆç”¨äºæ¨é€å…³è”å¹¿å‘Šï¼‰ï¼› è¯´æ˜ï¼šæ­¤ç±»æ•°æ®çš„æ”¶é›†ã€ä½¿ç”¨éµå¾ªè°·æ­Œå®˜æ–¹éšç§æ”¿ç­–ï¼Œæœ¬ç«™ä¸ç›´æ¥æ§åˆ¶æˆ–å­˜å‚¨è¯¥éƒ¨åˆ†æ•°æ®ã€‚ äºŒã€æˆ‘ä»¬å¦‚ä½•ä¿æŠ¤ç”¨æˆ·æ•°æ®ï¼Ÿ æœ¬ç«™ç›´æ¥æ”¶é›†çš„ â€œä¸»åŠ¨è”ç³»æ•°æ®â€ï¼Œä»…ä¿ç•™è‡³æ²Ÿé€šéœ€æ±‚å®Œæˆå 1 ä¸ªæœˆï¼Œä¹‹åå°†æ°¸ä¹…åˆ é™¤ï¼Œä¸é•¿æœŸç•™å­˜ï¼› ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆè¯„è®ºç³»ç»Ÿã€Google å·¥å…·ï¼‰çš„æ•°æ®ä¿æŠ¤ï¼Œç”±å¯¹åº”ç¬¬ä¸‰æ–¹è´Ÿè´£ï¼Œæœ¬ç«™å·²é€‰æ‹©åˆè§„æ€§è¾ƒå¼ºçš„æœåŠ¡å•†ï¼Œå¹¶è¦æ±‚å…¶éµå¾ª GDPR è§„åˆ™ï¼› æœ¬ç«™ä¸å°†ä»»ä½•ç”¨æˆ·æ•°æ®ï¼ˆå«ç¬¬ä¸‰æ–¹é—´æ¥æä¾›çš„æ•°æ®ï¼‰å‡ºå”®ã€å‡ºç§Ÿæˆ–è½¬è®©ç»™é™¤åˆä½œæœåŠ¡å•†å¤–çš„å…¶ä»–ç¬¬ä¸‰æ–¹ï¼› æœ¬ç«™é‡‡ç”¨åŸºç¡€ç½‘ç»œå®‰å…¨æªæ–½ï¼ˆå¦‚æœåŠ¡å™¨é˜²ç«å¢™ã€é‚®ç®±åŠ å¯†æ²Ÿé€šï¼‰ï¼Œé˜²æ­¢ç›´æ¥æ”¶é›†çš„æ•°æ®è¢«æœªæˆæƒè®¿é—®ã€‚ ä¸‰ã€æ¬§ç›Ÿç”¨æˆ·äº«æœ‰çš„æ•°æ®æƒåˆ©ï¼ˆä¾æ® GDPRï¼‰ä½œä¸ºæ¬§ç›Ÿç”¨æˆ·ï¼Œä½ å¯¹è‡ªèº«æ•°æ®äº«æœ‰ä»¥ä¸‹æƒåˆ©ï¼Œå¯éšæ—¶è”ç³»æœ¬ç«™è¡Œä½¿ï¼š çŸ¥æƒ…æƒï¼šæœ‰æƒäº†è§£æœ¬ç«™åŠç¬¬ä¸‰æ–¹æœåŠ¡æ”¶é›†ä½ æ•°æ®çš„å…·ä½“ç±»å‹ã€ç”¨é€”åŠå­˜å‚¨æœŸé™ï¼› è®¿é—®æƒï¼šæœ‰æƒè¦æ±‚æœ¬ç«™æä¾›ç›´æ¥æ”¶é›†çš„ä½ çš„è”ç³»æ•°æ®ï¼ˆå¦‚ä½ æ›¾å‘é€çš„é‚®ä»¶å†…å®¹ï¼‰ï¼Œæˆ–ååŠ©ä½ å‘ç¬¬ä¸‰æ–¹è¯„è®ºç³»ç»Ÿç”³è¯·è®¿é—®ä½ çš„è¯„è®ºæ•°æ®ï¼› æ›´æ­£æƒï¼šè‹¥æœ¬ç«™ç›´æ¥æ”¶é›†çš„ä½ çš„è”ç³»æ•°æ®å­˜åœ¨é”™è¯¯ï¼ˆå¦‚é‚®ç®±åœ°å€æ‹¼å†™é”™è¯¯ï¼‰ï¼Œæœ‰æƒè¦æ±‚æ›´æ­£ï¼› åˆ é™¤æƒï¼šæœ‰æƒè¦æ±‚æœ¬ç«™åˆ é™¤ç›´æ¥æ”¶é›†çš„ä½ çš„è”ç³»æ•°æ®ï¼Œæˆ–ååŠ©ä½ å‘ç¬¬ä¸‰æ–¹è¯„è®ºç³»ç»Ÿç”³è¯·åˆ é™¤ä½ çš„è¯„è®ºåŠå…³è”ä¿¡æ¯ï¼› æ‹’ç»æƒï¼šæœ‰æƒæ‹’ç»æœ¬ç«™æ”¶é›†ä½ çš„ä¸»åŠ¨è”ç³»æ•°æ®ï¼ˆå¦‚ä¸æä¾›é‚®ç®±è¿›è¡Œæ²Ÿé€šï¼‰ï¼Œæˆ–é€šè¿‡è°·æ­Œå®˜æ–¹æ¸ é“æ‹’ç» Google Analytics/AdSense çš„æ•°æ®æ”¶é›†ï¼ˆå…·ä½“è·¯å¾„è§ä¸‹æ–‡ï¼‰ï¼› æ•°æ®å¯æºå¸¦æƒï¼šæœ‰æƒè¦æ±‚æœ¬ç«™å°†ç›´æ¥æ”¶é›†çš„ä½ çš„æ•°æ®ï¼Œä»¥ç»“æ„åŒ–ã€æœºå™¨å¯è¯»æ ¼å¼æä¾›ç»™ä½ æˆ–ä½ æŒ‡å®šçš„å…¶ä»–åˆè§„ä¸»ä½“ï¼ˆå¦‚é€‚ç”¨ï¼‰ã€‚ åè°ƒç¬¬ä¸‰æ–¹åˆ é™¤ï¼šæ ¹æ® GDPR/CCPA ç­‰æ³•è§„ï¼Œæˆ‘ä»¬å°†å°½åŠ›åè°ƒ Google ç­‰ç¬¬ä¸‰æ–¹æœåŠ¡å•†åˆ é™¤ä¸æ‚¨ç›¸å…³çš„ä¸ªäººæ•°æ®ï¼ˆå¦‚å¯èƒ½ï¼‰ã€‚ å››ã€å¦‚ä½•è¡Œä½¿æ•°æ®æƒåˆ©ï¼Ÿ è”ç³»æœ¬ç«™ è‹¥ä½ éœ€è¦è¡Œä½¿ä¸Šè¿°æƒåˆ©ï¼ˆå¦‚åˆ é™¤è”ç³»æ•°æ®ã€å’¨è¯¢ç¬¬ä¸‰æ–¹æ•°æ®æ”¶é›†è¯¦æƒ…ï¼‰ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æœ¬ç«™ç®¡ç†å‘˜ï¼š ç”µå­é‚®ä»¶ï¼š admin@chaosgoo.comï¼ˆä¼˜å…ˆå¤„ç†æ–¹å¼ï¼‰ï¼› sindoutriqua@gmail.comæˆ‘ä»¬ä¼šåœ¨æ”¶åˆ°è¯·æ±‚å¹¶æ ¸å®èº«ä»½åçš„ 30 å¤©å†…å“åº”ã€‚ä¸ºäº†ç¡®ä¿æ•°æ®å®‰å…¨ï¼Œè¯·æä¾›è¶³å¤Ÿçš„èº«ä»½éªŒè¯ä¿¡æ¯ï¼ˆå¦‚æ³¨å†Œé‚®ç®±ã€è”ç³»æ—¶çš„ä¸»é¢˜ç­‰ï¼‰ã€‚æˆ‘ä»¬å°†è§†æƒ…å†µåè°ƒ Google ç­‰ç¬¬ä¸‰æ–¹åˆ é™¤ç›¸å…³æ•°æ®ã€‚ é’ˆå¯¹ç¬¬ä¸‰æ–¹å·¥å…·çš„æƒåˆ©è¡Œä½¿ è‹¥ä½ æƒ³æ‹’ç»æˆ–ç®¡ç† Google Analytics/AdSense çš„æ•°æ®æ”¶é›†ï¼Œå¯é€šè¿‡ä»¥ä¸‹å®˜æ–¹æ¸ é“æ“ä½œï¼š Google AdSenseï¼ˆDART Cookieï¼‰ï¼šè®¿é—® Google å¹¿å‘Šå’Œå†…å®¹ç½‘ç»œéšç§æƒæ”¿ç­–ï¼Œé€‰æ‹©åœç”¨ç›¸å…³ Cookieï¼› Google Analyticsï¼šè®¿é—® Google Analytics éšç§è®¾ç½®ï¼ŒæŒ‰æŒ‡å¼•è°ƒæ•´æ•°æ®æˆæƒèŒƒå›´ã€‚ äº”ã€æŠ•è¯‰æ¸ é“è‹¥ä½ è®¤ä¸ºæœ¬ç«™æˆ–åˆä½œç¬¬ä¸‰æ–¹æœªæŒ‰ GDPR ä¿æŠ¤ä½ çš„æ•°æ®ï¼Œé™¤è”ç³»æœ¬ç«™å¤–ï¼Œä¹Ÿå¯å‘æ¬§ç›Ÿæ•°æ®ä¿æŠ¤æœºæ„ï¼ˆEDPBï¼‰æˆ–ä½ æ‰€åœ¨æ¬§ç›Ÿæˆå‘˜å›½çš„æœ¬åœ°æ•°æ®ä¿æŠ¤æœºæ„æäº¤æŠ•è¯‰ï¼Œç»´æŠ¤è‡ªèº«æƒç›Šã€‚","link":"/gdpr/index.html"},{"title":"å‹æƒ…é“¾æ¥","text":"å¤§é»„çŒ«ã®åšå®¢ç²¤åŒ—å±±åŒºçš„æŠ€æœ¯å®…","link":"/links/index.html"},{"title":"éšç§æ”¿ç­–","text":"ç”Ÿæ•ˆæ—¥æœŸï¼š 2025 å¹´ 10 æœˆ 10 æ—¥æœ€åæ›´æ–°æ—¥æœŸï¼š 2026 å¹´ 02 æœˆ 02 æ—¥ æ¬¢è¿è®¿é—® Chaosgoo | ESP32, IoT &amp; Hardware DIY Blogï¼ˆä»¥ä¸‹ç®€ç§°â€œæœ¬ç½‘ç«™â€ï¼‰ã€‚æˆ‘ä»¬æ·±çŸ¥éšç§å¯¹æ‚¨çš„é‡è¦æ€§ï¼Œæœ¬æ”¿ç­–æ—¨åœ¨è¯´æ˜æœ¬ç½‘ç«™åœ¨è¿è¥è¿‡ç¨‹ä¸­å¦‚ä½•æ”¶é›†ã€ä½¿ç”¨å’Œä¿æŠ¤æ‚¨çš„ä¿¡æ¯ã€‚ 1. æˆ‘ä»¬æ”¶é›†çš„ä¿¡æ¯ä½œä¸ºä¸€ä¸ªé™æ€åšå®¢ï¼Œæœ¬ç½‘ç«™ä¸ä¼šä¸»åŠ¨æ”¶é›†å¯è¯†åˆ«æ‚¨ä¸ªäººèº«ä»½çš„ä¿¡æ¯ï¼ˆPersonal Identifiable Information, PIIï¼‰ï¼Œé™¤éæ‚¨è‡ªæ„¿æä¾›ï¼š ç›´æ¥è”ç³»æ•°æ®ï¼š å¦‚æœæ‚¨é€šè¿‡ç”µå­é‚®ä»¶æˆ–å…¶ä»–æ–¹å¼ä¸»åŠ¨è”ç³»æˆ‘ä»¬ï¼Œæˆ‘ä»¬å°†æ”¶é›†æ‚¨æä¾›çš„è”ç³»ä¿¡æ¯ï¼ˆå¦‚é‚®ç®±åœ°å€ã€é‚®ä»¶å†…å®¹ï¼‰ï¼Œä»¥ä¾¿è¿›è¡Œå›å¤å’Œæ²Ÿé€šã€‚ 2. é€šè¿‡ç¬¬ä¸‰æ–¹æœåŠ¡æ”¶é›†çš„ä¿¡æ¯ï¼ˆå…³é”®æŠ«éœ²ï¼‰æœ¬ç½‘ç«™ä½¿ç”¨ä»¥ä¸‹ç¬¬ä¸‰æ–¹æœåŠ¡æ¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œè¿™äº›æœåŠ¡å¯èƒ½ä¼šé—´æ¥æ”¶é›†æ‚¨çš„éä¸ªäººä¿¡æ¯å’Œä½¿ç”¨æ•°æ®ã€‚ A. Google AdSense (å¹¿å‘ŠæœåŠ¡) Google AdSenseï¼š Google ä½œä¸ºç¬¬ä¸‰æ–¹ä¾›åº”å•†ï¼Œä½¿ç”¨ Cookie æ¥æ ¹æ®ç”¨æˆ·è®¿é—®æœ¬ç½‘ç«™å’Œäº’è”ç½‘ä¸Šå…¶ä»–ç½‘ç«™çš„æƒ…å†µæŠ•æ”¾å¹¿å‘Šã€‚ Google å¹¿å‘Šè®¾ç½®ï¼š æ‚¨å¯ä»¥é€šè¿‡è®¿é—® Google å¹¿å‘Šè®¾ç½® é€‰æ‹©åœç”¨ä¸ªæ€§åŒ–å¹¿å‘Šã€‚ Google å¹¿å‘Šéšç§æ”¿ç­–ï¼š è®¿é—® Google å¹¿å‘Šéšç§æ”¿ç­– äº†è§£ Google å¹¿å‘Šçš„è¯¦ç»†åšæ³•ã€‚ DART Cookie è¯¦æƒ…ï¼š Google ä½¿ç”¨ DART Cookie å‘ç”¨æˆ·æŠ•æ”¾å¹¿å‘Šï¼Œè¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ DART Cookie å¸®åŠ©é¡µé¢ã€‚ æœ¬ç½‘ç«™ä½¿ç”¨ Google Analytics æ¥åˆ†æç½‘ç«™æµé‡ã€‚è¯¥æœåŠ¡å¯èƒ½ä¼šæ”¶é›†æ‚¨çš„ IP åœ°å€ã€æµè§ˆå™¨ç±»å‹ã€è®¾å¤‡ä¿¡æ¯ã€è®¿é—®é¡µé¢ã€è®¿é—®æ—¶é—´ç­‰æ•°æ®ã€‚è¿™äº›æ•°æ®ä»…ç”¨äºç»Ÿè®¡åˆ†æï¼Œä»¥æ”¹è¿›æœ¬ç½‘ç«™çš„å†…å®¹å’Œç»“æ„ã€‚ IP åŒ¿ååŒ–ï¼š æˆ‘ä»¬å·²å¯ç”¨ Google Analytics çš„ IP åŒ¿ååŒ–åŠŸèƒ½ï¼ˆanonymizeIpï¼‰ï¼Œä»¥è¿›ä¸€æ­¥ä¿æŠ¤æ‚¨çš„éšç§ã€‚æ•°æ®å¯èƒ½ä¼ è¾“è‡³ç¾å›½ï¼Œå¹¶å— Google çš„éšç§ç›¾æ¡†æ¶æˆ–ç­‰æ•ˆæœºåˆ¶ä¿æŠ¤ã€‚ éšç§æ”¿ç­–ï¼š æ‚¨å¯ä»¥è®¿é—® Google Analytics éšç§æ”¿ç­– è·å–è¯¦ç»†ä¿¡æ¯ã€‚ C. Cookie å’Œå…¶ä»–è·Ÿè¸ªæŠ€æœ¯æœ¬ç½‘ç«™å’Œä¸Šè¿°ç¬¬ä¸‰æ–¹æœåŠ¡ä¼šä½¿ç”¨ Cookieï¼ˆå‚¨å­˜åœ¨æ‚¨è®¾å¤‡ä¸Šçš„å°å‹æ–‡æœ¬æ–‡ä»¶ï¼‰æ¥è®°å½•æ‚¨çš„åå¥½è®¾ç½®ã€è·Ÿè¸ªè®¿é—®æ´»åŠ¨å’Œç»´æŠ¤ä¼šè¯çŠ¶æ€ã€‚å¦‚å¯ç”¨å¹¿å‘ŠæœåŠ¡ï¼ŒCookie ä¹Ÿå°†ç”¨äºæŠ•æ”¾å¹¿å‘Šã€‚ Google Analytics Cookie è¯¦æƒ… Cookie åç§° ç”¨é€” ä¿ç•™æœŸé™ _ga ç”¨äºåŒºåˆ†ç”¨æˆ·ï¼Œç”Ÿæˆå”¯ä¸€å®¢æˆ·ç«¯ ID 2 å¹´ _ga_&lt;ID&gt; ç”¨äºä¿æŒä¼šè¯çŠ¶æ€ 2 å¹´ _gid ç”¨äºåŒºåˆ†ç”¨æˆ· 24 å°æ—¶ _gat ç”¨äºé™åˆ¶è¯·æ±‚é€Ÿç‡ 1 åˆ†é’Ÿ æ•°æ®æ¥æ”¶æ–¹ï¼š Google LLC ä½œä¸ºæˆ‘ä»¬çš„åˆ†ææ•°æ®å¤„ç†æ–¹ æ•°æ®ä¿ç•™ï¼š æˆ‘ä»¬ä»…åœ¨ Analytics æ§åˆ¶å°ä¸­æŸ¥çœ‹åŒ¿åçš„èšåˆæŠ¥å‘Š æ”¶é›†çš„æ•°æ®ï¼š IP åœ°å€ã€å¤§è‡´åœ°ç†ä½ç½®ã€è®¾å¤‡ç±»å‹ã€è¯­è¨€ã€è®¿é—®çš„é¡µé¢ Google AdSense Cookie è¯¦æƒ…ï¼ˆå¦‚å¯ç”¨ï¼‰å¦‚æœ¬ç½‘ç«™å¯ç”¨ Google AdSenseï¼Œå¯èƒ½ä½¿ç”¨ä»¥ä¸‹ Cookieï¼š Cookie åç§° ç”¨é€” ä¿ç•™æœŸé™ __gads æŠ•æ”¾å¹¿å‘Šå¹¶è¡¡é‡å¹¿å‘Šæ•ˆæœ 13 ä¸ªæœˆ __gpi ç”¨äºå¹¿å‘Šä¸ªæ€§åŒ– 13 ä¸ªæœˆ DSID è¯†åˆ«å·²ç™»å½•ç”¨æˆ·ä»¥è¿›è¡Œå¹¿å‘Šä¸ªæ€§åŒ– 2 å‘¨ IDE ç”¨äºå±•ç¤º Google å¹¿å‘Š 13 ä¸ªæœˆ æ•°æ®æ¥æ”¶æ–¹ï¼š Google åŠå…¶å¹¿å‘Šåˆä½œä¼™ä¼´ ç”¨é€”ï¼š æ ¹æ®æ‚¨å¯¹æœ¬ç½‘ç«™å’Œ/æˆ–äº’è”ç½‘ä¸Šå…¶ä»–ç½‘ç«™çš„è®¿é—®ï¼Œå‘æ‚¨æŠ•æ”¾ç›¸å…³å¹¿å‘Š ç®¡ç† Cookieæ‚¨æœ‰æƒé€šè¿‡æµè§ˆå™¨è®¾ç½®éšæ—¶æ‹’ç»æˆ–åˆ é™¤ Cookieï¼Œä½†è¿™å¯èƒ½ä¼šå½±å“æ‚¨è®¿é—®æœ¬ç½‘ç«™æˆ–ä½¿ç”¨æŸäº›ç¬¬ä¸‰æ–¹åŠŸèƒ½çš„èƒ½åŠ›ã€‚ 3. ä¿¡æ¯çš„ä½¿ç”¨ç›®çš„æˆ‘ä»¬æ”¶é›†çš„ä¿¡æ¯ä¸»è¦ç”¨äºä»¥ä¸‹ç”¨é€”ï¼š è¿è¥å’Œç»´æŠ¤æœ¬ç½‘ç«™çš„æ­£å¸¸è¿è¡Œã€‚ åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œä»¥æ”¹è¿›å’Œä¼˜åŒ–ç½‘ç«™å†…å®¹åŠç”¨æˆ·ä½“éªŒã€‚ å¦‚å¯ç”¨å¹¿å‘ŠæœåŠ¡ï¼Œå¯èƒ½é€šè¿‡ Google AdSense å‘æ‚¨å±•ç¤ºç›¸å…³çš„å¹¿å‘Šã€‚ å›å¤å’Œå¤„ç†æ‚¨çš„æŸ¥è¯¢æˆ–å»ºè®®ã€‚ 4. ä¿¡æ¯çš„å…±äº«ä¸æŠ«éœ²é™¤éæ³•å¾‹è¦æ±‚æˆ–å¾å¾—æ‚¨çš„æ˜ç¡®åŒæ„ï¼Œæœ¬ç½‘ç«™æ‰¿è¯ºä¸ä¼šå‘ä»»ä½•æ— å…³çš„ç¬¬ä¸‰æ–¹å‡ºå”®ã€äº¤æ˜“æˆ–è½¬è®©æ‚¨çš„ä¸ªäººä¿¡æ¯ã€‚ æˆ‘ä»¬å¯èƒ½ä¼šä¸ä¸ºæˆ‘ä»¬æä¾›æŠ€æœ¯æ”¯æŒã€ä¸šåŠ¡è¿è¥æˆ–æœåŠ¡çš„ç¬¬ä¸‰æ–¹å…±äº«ä¿¡æ¯ï¼ˆä¾‹å¦‚ Google Analyticsï¼Œä»¥åŠå¦‚å¯ç”¨æ—¶çš„ Google AdSenseï¼‰ï¼Œä½†è¿™äº›åˆä½œæ–¹éœ€ä¸¥æ ¼éµå®ˆä¿å¯†åè®®ã€‚ 5. å¤–éƒ¨é“¾æ¥æœ¬ç½‘ç«™å¯èƒ½åŒ…å«æŒ‡å‘å…¶ä»–ç½‘ç«™çš„é“¾æ¥ã€‚å¯¹äºè¿™äº›å¤–éƒ¨ç½‘ç«™çš„å†…å®¹ã€å®‰å…¨æªæ–½æˆ–éšç§åšæ³•ï¼Œæˆ‘ä»¬ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚å»ºè®®æ‚¨åœ¨è®¿é—®ä»»ä½•å¤–éƒ¨ç½‘ç«™æ—¶ä»”ç»†é˜…è¯»å…¶éšç§æ”¿ç­–ã€‚ 6. ç¬¬ä¸‰æ–¹æœåŠ¡åŠèµ„æºæˆ‘ä»¬å°½é‡é€‰æ‹©é€æ˜ä¸”åˆè§„çš„æœåŠ¡å•†ã€‚ä»¥ä¸‹æ˜¯å½“å‰ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹æœåŠ¡å®Œæ•´æ¸…å•ï¼š æœåŠ¡åç§° ç”¨é€”è¯´æ˜ éšç§æ”¿ç­–/è¯¦æƒ… Google Analytics æ”¶é›†åŒ¿åçš„æµé‡ç»Ÿè®¡æ•°æ® éšç§æ”¿ç­– Google AdSense å±•ç¤ºä¸ªæ€§åŒ–æˆ–é€šç”¨å¹¿å‘Š å¹¿å‘Šéšç§ Google Tag Manager åŠ¨æ€åŠ è½½ Analytics å’Œ AdSense è„šæœ¬ GTM è¯¦æƒ… jsDelivr / Font Awesome æä¾›é™æ€èµ„æºã€CSS å’Œå­—ä½“åŠ è½½ ä»…åŠ è½½é™æ€æ–‡ä»¶ï¼Œä¸æ”¶é›† PII å…³äº CDN æœåŠ¡æœ¬ç½‘ç«™ä½¿ç”¨ CDNï¼ˆå¦‚ jsDelivrã€Font Awesomeï¼‰æ¥åŠ è½½å¿…è¦çš„é™æ€èµ„æºã€‚è¿™äº›æœåŠ¡ä»…ç”¨äºä¼ è¾“å…¬å…±èµ„æºåº“æ–‡ä»¶ï¼Œä¸ä¼šä¸»åŠ¨æ”¶é›†æ‚¨çš„ä¸ªäººå¯è¯†åˆ«ä¿¡æ¯ã€‚æˆ‘ä»¬ä¼˜å…ˆä½¿ç”¨éšç§å‹å¥½çš„ CDNï¼Œæ— éœ€é¢å¤–è¿½è¸ªã€‚ 7. æ‚¨çš„æƒåˆ© (GDPR/CCPA)æ ¹æ® GDPR/CCPA ç­‰æ³•è§„ï¼Œæ‚¨æœ‰æƒè®¿é—®ã€æ›´æ­£ã€åˆ é™¤æ‚¨çš„ä¸ªäººæ•°æ®ï¼Œæˆ–åå¯¹å¤„ç†ã€‚ è”ç³»æˆ‘ä»¬ï¼š è¯·å‘é€é‚®ä»¶è‡³ admin@chaosgoo.comï¼Œå¹¶æä¾›è¶³å¤Ÿèº«ä»½éªŒè¯ä¿¡æ¯ï¼ˆå¦‚æ³¨å†Œé‚®ç®±ï¼‰ã€‚æˆ‘ä»¬å°†åœ¨ 30 å¤©å†…å“åº”ï¼Œå¹¶åè°ƒ Google ç­‰ç¬¬ä¸‰æ–¹åˆ é™¤ç›¸å…³æ•°æ®ï¼ˆå¦‚å¯èƒ½ï¼‰ã€‚ é€€å‡º Google Analytics è¿½è¸ªï¼š å®‰è£… Google Analytics é€€å‡ºæµè§ˆå™¨æ’ä»¶ã€‚ ç®¡ç† Google å¹¿å‘Šï¼š è®¿é—® Google å¹¿å‘Šè®¾ç½® é€‰æ‹©é€€å‡ºã€‚ ç®¡ç†æµè§ˆå™¨ Cookieï¼š æ‚¨å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¾ç½®éšæ—¶æ‹’ç»æˆ–åˆ é™¤ Cookieã€‚ 8. å„¿ç«¥éšç§ä¿æŠ¤æœ¬ç½‘ç«™é¢å‘ 13 å²åŠä»¥ä¸Šçš„ç”¨æˆ·ã€‚æˆ‘ä»¬ä¸ä¼šæ•…æ„æ”¶é›† 13 å²ä»¥ä¸‹å„¿ç«¥çš„ä»»ä½•ä¸ªäººæ•°æ®ã€‚å¦‚æœæ‚¨è®¤ä¸ºæŸä½å„¿ç«¥é€šè¿‡æœ¬ç½‘ç«™å‘æˆ‘ä»¬çš„ç¬¬ä¸‰æ–¹åˆä½œä¼™ä¼´ï¼ˆå¦‚ Googleï¼‰å‘é€äº†ä¸ªäººæ•°æ®ï¼Œè¯·ç«‹å³è”ç³»æˆ‘ä»¬ï¼Œæˆ‘ä»¬å°†é…åˆç›¸å…³æœåŠ¡æä¾›å•†åˆ é™¤è¯¥æ•°æ®ã€‚ 9. è”ç³»æˆ‘ä»¬å¦‚æœæ‚¨å¯¹æœ¬éšç§æ”¿ç­–æˆ–æ‚¨ä¸ªäººä¿¡æ¯çš„å¤„ç†æœ‰ä»»ä½•ç–‘é—®æˆ–ç–‘è™‘ï¼Œè¯·éšæ—¶é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æœ¬ç½‘ç«™ç®¡ç†å‘˜ï¼š ç½‘ç«™ç®¡ç†å‘˜ï¼š chaosgoo ç”µå­é‚®ä»¶ï¼š admin@chaosgoo.comï¼ˆä¼˜å…ˆå¤„ç†æ–¹å¼ï¼‰ï¼› sindoutriqua@gmail.com","link":"/privacy-policy/index.html"},{"title":"ä½¿ç”¨æ¡æ¬¾","text":"æœ€åæ›´æ–°æ—¥æœŸï¼š 2025-11-01 æ¬¢è¿è®¿é—®æœ¬åšå®¢ï¼ˆä»¥ä¸‹ç®€ç§° â€œæœ¬ç«™â€ï¼‰ã€‚æœ¬ä½¿ç”¨æ¡æ¬¾ï¼ˆä»¥ä¸‹ç®€ç§° â€œæ¡æ¬¾â€ï¼‰æ—¨åœ¨è§„èŒƒä½ ï¼ˆç”¨æˆ·ï¼‰è®¿é—®å’Œä½¿ç”¨æœ¬ç«™çš„æ‰€æœ‰è¡Œä¸ºã€‚é€šè¿‡è®¿é—®ã€æµè§ˆæˆ–ä½¿ç”¨æœ¬ç«™å†…å®¹åŠæœåŠ¡ï¼Œå³è¡¨ç¤ºä½ å·²é˜…è¯»ã€ç†è§£å¹¶åŒæ„éµå®ˆæœ¬æ¡æ¬¾çš„å…¨éƒ¨è§„å®šã€‚è‹¥ä½ ä¸åŒæ„æœ¬æ¡æ¬¾ï¼Œè¯·å‹¿ä½¿ç”¨æœ¬ç«™ã€‚â€‹ ä¸€ã€ç½‘ç«™ä½¿ç”¨èŒƒå›´â€‹æœ¬ç«™æ˜¯ä¸ªäººéå•†ä¸šæ€§è´¨åšå®¢ï¼Œä¸»è¦åˆ†äº« DIY ç¡¬ä»¶åˆ¶ä½œã€èŠ¯ç‰‡ä½¿ç”¨ç»éªŒã€ä»£ç ç‰‡æ®µã€3D å»ºæ¨¡ä¸æ‰“å°ä½œå“åŠä¸ªäººæ—¥å¸¸åˆ†äº«ï¼ˆä»¥ä¸‹ç®€ç§° â€œå†…å®¹â€ï¼‰ï¼Œä»…ä¸ºç”¨æˆ·æä¾›ä¿¡æ¯å‚è€ƒ and äº¤æµç”¨é€”ã€‚â€‹ ä½ æœ‰æƒåœ¨éµå®ˆæœ¬æ¡æ¬¾åŠç›¸å…³æ³•å¾‹æ³•è§„çš„å‰æä¸‹ï¼Œè‡ªç”±æµè§ˆã€é˜…è¯»æœ¬ç«™å…¬å¼€å†…å®¹ã€‚â€‹ äºŒã€ç”¨æˆ·æƒåˆ©ä¸ä¹‰åŠ¡â€‹å¹´é¾„é™åˆ¶å£°æ˜ï¼š æœªæ»¡ 18 å‘¨å²çš„ç”¨æˆ·ï¼Œéœ€åœ¨çˆ¶æ¯æˆ–æ³•å®šç›‘æŠ¤äººçš„æŒ‡å¯¼å’Œç›‘ç£ä¸‹ä½¿ç”¨æœ¬ç«™ã€‚ åˆæ³•ä½¿ç”¨ä¹‰åŠ¡ï¼šä½ æ‰¿è¯ºä½¿ç”¨æœ¬ç«™æ—¶ï¼Œä¸å¾—è¿åä»»ä½•å›½å®¶ / åœ°åŒºæ³•å¾‹æ³•è§„ã€å…¬åºè‰¯ä¿—ï¼Œä¸å¾—å®æ–½ä»¥ä¸‹è¡Œä¸ºï¼š æœªç»æˆæƒè·å–ã€ç¯¡æ”¹æœ¬ç«™æ•°æ®ã€ä»£ç æˆ–åå°ä¿¡æ¯ï¼› ä¼ æ’­æ¶æ„è½¯ä»¶ã€ç—…æ¯’ã€åƒåœ¾ä¿¡æ¯ï¼Œæˆ–è¿›è¡Œç½‘ç»œæ”»å‡»ã€çˆ¬è™«æ»¥ç”¨ç­‰ç ´åæœ¬ç«™è¿è¡Œçš„è¡Œä¸ºï¼› å‘å¸ƒã€ä¼ æ’­è¿æ³•ã€è‰²æƒ…ã€æš´åŠ›ã€è¯½è°¤ã€ä¾µæƒç­‰ä¸è‰¯ä¿¡æ¯ï¼› å†’å……æœ¬ç«™ä½œè€…æˆ–å…¶ä»–ç”¨æˆ·ï¼Œè¿›è¡Œæ¬ºè¯ˆã€è¯¯å¯¼ä»–äººçš„è¡Œä¸ºã€‚ äº’åŠ¨è§„èŒƒï¼š è‹¥ä½ é€šè¿‡ç”µå­é‚®ä»¶æˆ–å…¶ä»–æ–¹å¼å‚ä¸äº’åŠ¨ï¼Œéœ€å¯¹è‡ªèº«å‘å¸ƒçš„å†…å®¹ï¼ˆå¦‚é‚®ä»¶å†…å®¹ï¼‰æ‰¿æ‹…å…¨éƒ¨è´£ä»»ï¼Œç¡®ä¿å†…å®¹çœŸå®ã€åˆæ³•ï¼Œä¸ä¾µçŠ¯ç¬¬ä¸‰æ–¹æƒç›Šã€‚æœ¬ç«™æœ‰æƒæ ¹æ®è‡ªèº«åˆ¤æ–­ï¼Œåˆ é™¤è¿è§„äº’åŠ¨å†…å®¹æˆ–é™åˆ¶ä½ çš„äº’åŠ¨æƒé™ã€‚ è´¦å·ä½¿ç”¨ï¼šè‹¥æœ¬ç«™åç»­å¼€é€šç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ï¼Œä½ éœ€å¦¥å–„ä¿ç®¡è´¦å·å¯†ç ï¼Œå¯¹è´¦å·ä¸‹çš„æ‰€æœ‰è¡Œä¸ºè´Ÿè´£ã€‚è‹¥å‘ç°è´¦å·è¢«ç›—ç”¨ï¼Œåº”åŠæ—¶è”ç³»æœ¬ç«™å¤„ç†ï¼Œæœ¬ç«™ä¸æ‰¿æ‹…æœªåŠæ—¶é€šçŸ¥å¯¼è‡´çš„æŸå¤±ã€‚ ä¸‰ã€å†…å®¹çŸ¥è¯†äº§æƒå£°æ˜â€‹æœ¬ç«™æ‰€æœ‰åŸåˆ›å†…å®¹ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºæ–‡å­—ã€ä»£ç ã€å›¾ç‰‡ã€è§†é¢‘ã€3D æ¨¡å‹æ–‡ä»¶ç­‰ï¼‰çš„çŸ¥è¯†äº§æƒå‡å½’æœ¬ç«™ä½œè€…ï¼ˆä»¥ä¸‹ç®€ç§° â€œä½œè€…â€ï¼‰æ‰€æœ‰ï¼Œå—ã€Šè‘—ä½œæƒæ³•ã€‹ã€Šå•†æ ‡æ³•ã€‹ç­‰ç›¸å…³æ³•å¾‹æ³•è§„ä¿æŠ¤ã€‚â€‹ éå•†ä¸šæ€§åˆç†ä½¿ç”¨ï¼šä½ å¯åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹å¼•ç”¨ã€åˆ†äº«æœ¬ç«™åŸåˆ›å†…å®¹ï¼šâ€‹ éœ€æ³¨æ˜å†…å®¹æ¥æºï¼ˆå¦‚ â€œè½¬è½½è‡ª Chaosgoo | ESP32, IoT &amp; Hardware DIY Tech Blogâ€ï¼‰åŠä½œè€…ä¿¡æ¯ï¼›â€‹ ä¸å¾—ä¿®æ”¹ã€ç¯¡æ”¹å†…å®¹çš„æ ¸å¿ƒä¿¡æ¯åŠå®Œæ•´æ€§ï¼›â€‹ ä¸å¾—ç”¨äºå•†ä¸šç”¨é€”ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºç›ˆåˆ©æ€§å®£ä¼ ã€å”®å–ã€äºŒæ¬¡åˆ›ä½œåå•†ç”¨ç­‰ï¼‰ã€‚â€‹ ç¦æ­¢ä¾µæƒä½¿ç”¨ï¼šæœªç»ä½œè€…ä¹¦é¢æˆæƒï¼Œä»»ä½•å•ä½æˆ–ä¸ªäººä¸å¾—æ“…è‡ªå¤åˆ¶ã€è½¬è½½ã€ä¼ æ’­ã€å•†ç”¨æœ¬ç«™åŸåˆ›å†…å®¹ï¼Œå¦åˆ™ä½œè€…æœ‰æƒè¿½ç©¶å…¶æ³•å¾‹è´£ä»»ã€‚â€‹ ç¬¬ä¸‰æ–¹å†…å®¹å£°æ˜ï¼šæœ¬ç«™éƒ¨åˆ†å¼•ç”¨çš„å›¾ç‰‡ã€ä»£ç ç‰‡æ®µã€å‚è€ƒèµ„æ–™ç­‰ç¬¬ä¸‰æ–¹å†…å®¹ï¼Œå…¶çŸ¥è¯†äº§æƒå½’åŸæƒåˆ©äººæ‰€æœ‰ã€‚è‹¥ç›¸å…³æƒåˆ©äººè®¤ä¸ºæœ¬ç«™å†…å®¹ä¾µçŠ¯å…¶æƒç›Šï¼Œè¯·åŠæ—¶è”ç³»ä½œè€…ï¼Œä½œè€…å°†åœ¨æ ¸å®åå°½å¿«å¤„ç†ï¼ˆå¦‚åˆ é™¤ã€æ ‡æ³¨æ­£ç¡®æ¥æºç­‰ï¼‰ã€‚â€‹ å››ã€å…è´£å£°æ˜â€‹æœ¬ç«™å†…å®¹å‡ä¸ºä½œè€…åŸºäºä¸ªäººç»éªŒã€å…´è¶£åˆ†äº«çš„åŸåˆ›å†…å®¹ï¼Œä»…ä¸ºå‚è€ƒäº¤æµä¹‹ç”¨ï¼Œä¸æ„æˆä¸“ä¸šå»ºè®®ï¼ˆå¦‚æŠ€æœ¯æŒ‡å¯¼ã€æŠ•èµ„å»ºè®®ç­‰ï¼‰ã€‚ä½ æ ¹æ®æœ¬ç«™å†…å®¹è¿›è¡Œçš„ä»»ä½•æ“ä½œï¼ˆå¦‚ç¡¬ä»¶åˆ¶ä½œã€ä»£ç ä½¿ç”¨ã€3D æ‰“å°ç­‰ï¼‰ï¼Œé£é™©ç”±ä½ è‡ªè¡Œæ‰¿æ‹…ï¼Œä½œè€…ä¸æ‰¿æ‹…å› æ“ä½œä¸å½“å¯¼è‡´çš„ä»»ä½•æŸå¤±ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºè®¾å¤‡æŸåã€æ•°æ®ä¸¢å¤±ç­‰ï¼‰ã€‚â€‹ æœ¬ç«™åŠ›æ±‚å†…å®¹å‡†ç¡®ã€å®Œæ•´ï¼Œä½†ä¸ä¿è¯å†…å®¹æ— é”™è¯¯ã€æ— é—æ¼ï¼Œä¹Ÿä¸ä¿è¯ç½‘ç«™æœåŠ¡çš„è¿ç»­æ€§ã€ç¨³å®šæ€§ï¼ˆå¦‚å› æœåŠ¡å™¨æ•…éšœã€ç½‘ç»œé—®é¢˜ç­‰å¯¼è‡´æ— æ³•è®¿é—®ï¼‰ã€‚ä½œè€…æœ‰æƒéšæ—¶ä¿®æ”¹ã€æ›´æ–°æˆ–åˆ é™¤æœ¬ç«™å†…å®¹ï¼Œæ— éœ€æå‰é€šçŸ¥ç”¨æˆ·ã€‚â€‹ å¯¹äºå› ä¸å¯æŠ—åŠ›ï¼ˆå¦‚è‡ªç„¶ç¾å®³ã€æ”¿ç­–å˜åŠ¨ç­‰ï¼‰ã€ç¬¬ä¸‰æ–¹è¡Œä¸ºï¼ˆå¦‚ç½‘ç»œæ”»å‡»ã€é»‘å®¢å…¥ä¾µç­‰ï¼‰å¯¼è‡´çš„æœ¬ç«™æœåŠ¡ä¸­æ–­æˆ–å†…å®¹æŸå¤±ï¼Œä½œè€…ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚â€‹ ä½ é€šè¿‡æœ¬ç«™é“¾æ¥è®¿é—®ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼ˆå¦‚èŠ¯ç‰‡å®˜ç½‘ã€å·¥å…·ä¸‹è½½å¹³å°ç­‰ï¼‰ï¼Œç›¸å…³ç½‘ç«™çš„ä½¿ç”¨æ¡æ¬¾å’Œéšç§æ”¿ç­–ä¸æœ¬ç«™æ— å…³ï¼Œä½œè€…ä¸æ‰¿æ‹…ç¬¬ä¸‰æ–¹ç½‘ç«™çš„ä»»ä½•è´£ä»»ã€‚â€‹ äº”ã€æ¡æ¬¾çš„ä¿®æ”¹ä¸æ›´æ–°â€‹ä½œè€…æœ‰æƒæ ¹æ®æ³•å¾‹æ³•è§„å˜åŒ–ã€ç½‘ç«™è¿è¥éœ€æ±‚ç­‰æƒ…å†µï¼Œéšæ—¶ä¿®æ”¹æœ¬æ¡æ¬¾ã€‚â€‹ æ¡æ¬¾ä¿®æ”¹åï¼Œå°†åœ¨æœ¬ç«™æ˜¾è‘—ä½ç½®æ›´æ–°å‘å¸ƒï¼Œæ›´æ–°åçš„æ¡æ¬¾è‡ªå‘å¸ƒä¹‹æ—¥èµ·ç”Ÿæ•ˆã€‚â€‹ ä½ ç»§ç»­ä½¿ç”¨æœ¬ç«™ï¼Œå³è§†ä¸ºåŒæ„ä¿®æ”¹åçš„æ¡æ¬¾ï¼›è‹¥ä½ ä¸åŒæ„ï¼Œåº”ç«‹å³åœæ­¢ä½¿ç”¨æœ¬ç«™ã€‚â€‹ å…­ã€äº‰è®®è§£å†³â€‹æœ¬æ¡æ¬¾çš„è§£é‡Šä¸æ‰§è¡Œå‡é€‚ç”¨ä½ æ‰€åœ¨åœ°åŒºçš„æ³•å¾‹æ³•è§„ã€‚â€‹ å› ä½¿ç”¨æœ¬ç«™äº§ç”Ÿçš„ä»»ä½•äº‰è®®ï¼Œä½ ä¸ä½œè€…åº”é¦–å…ˆé€šè¿‡å‹å¥½åå•†è§£å†³ï¼›åå•†ä¸æˆçš„ï¼Œå¯å‘æœ‰ç®¡è¾–æƒçš„äººæ°‘æ³•é™¢æèµ·è¯‰è®¼ã€‚â€‹ ä¸ƒã€è”ç³»æˆ‘ä»¬â€‹è‹¥ä½ å¯¹æœ¬æ¡æ¬¾æœ‰ä»»ä½•ç–‘é—®ã€å»ºè®®æˆ–æŠ•è¯‰ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ä½œè€…ï¼šâ€‹admin@chaosgoo.com","link":"/terms/index.html"}]}