<!DOCTYPE html>
<html
  lang="zh">
<head>
  <!-- preconnect to critical origins -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <!-- so meta -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
  <meta name="description" content="ESP-IDF的资源嵌入机制。从CMake配置到C语言调用，embed_txtfiles的使用方法及注意事项。">
<meta property="og:type" content="article">
<meta property="og:title" content="ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件">
<meta property="og:url" content="https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/index.html">
<meta property="og:site_name" content="Chaosgoo | ESP32, IoT &amp; Hardware DIY Blog">
<meta property="og:description" content="ESP-IDF的资源嵌入机制。从CMake配置到C语言调用，embed_txtfiles的使用方法及注意事项。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chaosgoo.com/images/archives/embed_textfiles/embed_textfiles.png">
<meta property="article:published_time" content="2026-01-04T04:12:44.000Z">
<meta property="article:modified_time" content="2026-01-04T04:12:44.000Z">
<meta property="article:author" content="Chaos Goo">
<meta property="article:tag" content="ESP32">
<meta property="article:tag" content="ESP-IDF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chaosgoo.com/images/archives/embed_textfiles/embed_textfiles.png">
    
      
        
          
                    <link rel="shortcut icon" href="/images/favicon_chaosgoo.ico">
                    
                      
                        
                          
                                    <link rel="icon" type="image/png" href="/images/Logo_Sketch.webp"
                                      sizes="192x192">
                                    
                                      
                                        
                                          
                                                    <link rel="apple-touch-icon" sizes="180x180"
                                                      href="/images/Logo_Sketch.webp">
                                                    
                                                      
                                                        
                                                          <!-- title -->
                                                          <title>
                                                            ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件
                                                          </title>
                                                          <link rel="canonical"
                                                            href="https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/">
                                                          <!-- async scripts -->
                                                          
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EVWTNN57LZ"></script>
  <script>
    if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-EVWTNN57LZ');
    }
  </script>


                                                            <!-- Umami Analytics -->

                                                              <!-- styles -->
                                                              <link rel="stylesheet"
                                                                href="/css/style.css">
                                                              <!-- styles -->

            <!-- Font Awesome removed - using inline SVG icons instead -->
                                                                <!-- persian styles -->
                                                                
                                                                      <!-- rss -->
                                                                      
                                                                            
                                                                                
                                                                                  <!-- <script async
                                                                                    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1189115759021088"
                                                                                    crossorigin="anonymous"></script> -->
                                                                                  
                                                                                    <!-- mathjax -->
                                                                                    
                                                                                      <script
                                                                                        type="text/x-mathjax-config">
	MathJax.Hub.Config({
	  tex2jax: {
		skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
		inlineMath: [['$','$']]
	  }
	});
</script>
                                                                                      <script
                                                                                        src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML'
                                                                                        async></script>
                                                                                      
<meta name="generator" content="Hexo 6.3.0"></head>

  <body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/projects/">项目</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/android-lvgl-style-border/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/Ditherpunk-The-Art-of-Dithering-2-ESP32/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/"><i
        class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&text=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&title=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon"
      target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&is_video=false&description=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件&body=Check out this article: https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/"><i
        class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&title=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li> -->
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&title=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&title=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&title=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon"
      target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&name=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件&description=&lt;h2 id=&#34;0x00-背景&#34;&gt;&lt;a href=&#34;#0x00-背景&#34; class=&#34;headerlink&#34; title=&#34;0x00 背景&#34;&gt;&lt;/a&gt;0x00 背景&lt;/h2&gt;&lt;p&gt;最近在翻看 &lt;strong&gt;GSC (Google Search Console)&lt;/strong&gt; 的搜索关键词时，发现 &lt;code&gt;esp-idf embed-txtfiles&lt;/code&gt; 这个词的出现频率高得惊人。看来大家在搞 &lt;strong&gt;ESP32&lt;/strong&gt; 开发的时候，都被“如何在固件里优雅地放一个文件”这个问题困扰过。&lt;/p&gt;
&lt;p&gt;在此之前，我为了实现一些功能（比如之前的&lt;a href=&#34;/Make%20A%20Tiny%20Pixel%20Screen/&#34;&gt;那个桌面像素小屏幕&lt;/a&gt;），曾&lt;strong&gt;傻乎乎&lt;/strong&gt;地把图片全转成了巨大的 C 数组（&lt;code&gt;.h&lt;/code&gt; 文件）。结果可想而知：代码文件膨胀到几万行，IDE 索引卡死，每次微调一个像素都要重新编译半天，&lt;strong&gt;简直是灾难&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;不管是 &lt;strong&gt;HTTPS&lt;/strong&gt; 的根证书、前端 &lt;strong&gt;HTML&lt;/strong&gt; 页面，还是简单的配置文件，如果全都写成巨大的 &lt;code&gt;const char[]&lt;/code&gt; 硬编码到代码里，那工程维护简直是自我折磨。今天就拿着我那块&lt;strong&gt;斥 9.9 元巨资&lt;/strong&gt;买回来的 &lt;strong&gt;ESP32-C3&lt;/strong&gt; 演示一下如何用 &lt;strong&gt;ESP-IDF&lt;/strong&gt; 里的这个黑科技优雅地&lt;strong&gt;填坑&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/images/archives/embed_textfiles/embed_textfiles.png&#34; alt=&#34;embed_textfiles&#34;&gt;&lt;/p&gt;"><i
        class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&t=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>
    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">0x00 背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"><span class="toc-number">2.</span> <span class="toc-text">0x01 方案对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-number">3.</span> <span class="toc-text">0x02 快速上手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x00-%E5%87%86%E5%A4%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">3.1.</span> <span class="toc-text">0x00 准备资源文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-%E4%BF%AE%E6%94%B9-CMakeLists-txt"><span class="toc-number">3.2.</span> <span class="toc-text">0x01 修改 CMakeLists.txt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-%E5%9C%A8-C-C-%E4%BB%A3%E7%A0%81%E4%B8%AD%E8%B0%83%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">0x02 在 C&#x2F;C++ 代码中调用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E5%A1%AB%E5%9D%91%EF%BC%9A%E9%82%A3%E4%BA%9B%E8%AE%A9%E6%88%91%E5%B4%A9%E6%BA%83%E7%9A%84%E2%80%9C%E7%BF%BB%E8%BD%A6%E2%80%9D%E6%97%B6%E5%88%BB"><span class="toc-number">4.</span> <span class="toc-text">0x03 填坑：那些让我崩溃的“翻车”时刻</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x00-%E7%BF%BB%E8%BD%A6%E7%8E%B0%E5%9C%BA%EF%BC%9ASymbol-not-found"><span class="toc-number">4.0.1.</span> <span class="toc-text">0x00 翻车现场：Symbol not found</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01-%E4%BF%AE%E6%94%B9%E5%8F%AA%E8%AF%BB%E5%86%85%E5%AD%98%EF%BC%8C%E7%9B%B4%E6%8E%A5%E7%82%B8%E4%BA%86"><span class="toc-number">4.0.2.</span> <span class="toc-text">0x01 修改只读内存，直接炸了</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D%E7%9A%84%E2%80%9C%E7%8E%84%E5%AD%A6%E2%80%9D"><span class="toc-number">4.0.3.</span> <span class="toc-text">0x02 变量命名的“玄学”</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E8%BF%9B%E9%98%B6%EF%BC%9A%E6%88%91%E6%98%AF%E6%80%8E%E4%B9%88%E9%AA%8C%E8%AF%81%E8%BF%99%E4%BA%9B%E2%80%9C%E9%AC%BC%E7%AC%A6%E5%8F%B7%E2%80%9D%E7%9A%84"><span class="toc-number">5.</span> <span class="toc-text">0x04 进阶：我是怎么验证这些“鬼符号”的</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x00-%E5%88%AB%E7%8C%9C%EF%BC%8C%E7%9B%B4%E6%8E%A5%E7%9C%8B%E4%BA%A7%E7%89%A9"><span class="toc-number">5.0.1.</span> <span class="toc-text">0x00 别猜，直接看产物</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01-%E5%AE%9E%E6%88%98%EF%BC%9A%E8%AF%81%E4%B9%A6%E5%A4%84%E7%90%86%E7%9A%84%E2%80%9C%E6%9E%81%E7%AE%80%E4%B8%BB%E4%B9%89%E2%80%9D"><span class="toc-number">5.0.2.</span> <span class="toc-text">0x01 实战：证书处理的“极简主义”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-EMBED-FILES-vs-EMBED-TXTFILES%EF%BC%9A%E6%88%91%E5%BD%93%E5%B9%B4%E5%B0%B1%E6%A0%BD%E5%9C%A8%E8%BF%99%E5%84%BF"><span class="toc-number">5.0.3.</span> <span class="toc-text">0x02 EMBED_FILES vs EMBED_TXTFILES：我当年就栽在这儿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x03-%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99%E7%9A%84%E2%80%9C%E9%AD%94%E6%B3%95%E2%80%9D"><span class="toc-number">5.0.4.</span> <span class="toc-text">0x03 命名规则的“魔法”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%9B%B4%E6%8E%A5%E7%94%A8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%9F"><span class="toc-number">5.0.5.</span> <span class="toc-text">为什么不直接用文件系统？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-%E6%9C%80%E5%90%8E"><span class="toc-number">6.</span> <span class="toc-text">0x05 最后</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-number">7.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    
  </span>
</div>

        
          <div class="content index py4 ">
            
                  <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Chaos Goo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2026-01-04T04:12:44.000Z" class="dt-published" itemprop="datePublished">2026-01-04</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Hardware-IoT/">Hardware & IoT</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/ESP-IDF/" rel="tag">ESP-IDF</a>, <a class="p-category" href="/tags/ESP32/" rel="tag">ESP32</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="0x00-背景"><a href="#0x00-背景" class="headerlink" title="0x00 背景"></a>0x00 背景</h2><p>最近在翻看 <strong>GSC (Google Search Console)</strong> 的搜索关键词时，发现 <code>esp-idf embed-txtfiles</code> 这个词的出现频率高得惊人。看来大家在搞 <strong>ESP32</strong> 开发的时候，都被“如何在固件里优雅地放一个文件”这个问题困扰过。</p>
<p>在此之前，我为了实现一些功能（比如之前的<a href="/Make%20A%20Tiny%20Pixel%20Screen/">那个桌面像素小屏幕</a>），曾<strong>傻乎乎</strong>地把图片全转成了巨大的 C 数组（<code>.h</code> 文件）。结果可想而知：代码文件膨胀到几万行，IDE 索引卡死，每次微调一个像素都要重新编译半天，<strong>简直是灾难</strong>。</p>
<p>不管是 <strong>HTTPS</strong> 的根证书、前端 <strong>HTML</strong> 页面，还是简单的配置文件，如果全都写成巨大的 <code>const char[]</code> 硬编码到代码里，那工程维护简直是自我折磨。今天就拿着我那块<strong>斥 9.9 元巨资</strong>买回来的 <strong>ESP32-C3</strong> 演示一下如何用 <strong>ESP-IDF</strong> 里的这个黑科技优雅地<strong>填坑</strong>。</p>
<p><img src="/images/archives/embed_textfiles/embed_textfiles.png" alt="embed_textfiles"></p>
<span id="more"></span>
<h2 id="0x01-方案对比"><a href="#0x01-方案对比" class="headerlink" title="0x01 方案对比"></a>0x01 方案对比</h2><p>为什么推荐使用 <code>embed_txtfiles</code>？我们可以先看一张直观的对比表：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>方案</th>
<th>优点</th>
<th>缺点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>C 数组 (.h)</strong></td>
<td>零环境要求，哪里都能编</td>
<td>破坏代码整洁，编译极慢</td>
<td>极小的资源（如 8x8 字体）</td>
</tr>
<tr>
<td><strong>文件系统 (SPIFFS)</strong></td>
<td>动态读写，空间大</td>
<td>需手工配置分区表，访问繁琐</td>
<td>大量图片、用户日志</td>
</tr>
<tr>
<td><strong>embed_txtfiles</strong></td>
<td><strong>原生格式，访问极快，零配置</strong></td>
<td>固件只读，增加 Bin 体积</td>
<td><strong>CA证书、网页模板、默认配置</strong></td>
</tr>
</tbody>
</table>
</div>
<h2 id="0x02-快速上手"><a href="#0x02-快速上手" class="headerlink" title="0x02 快速上手"></a>0x02 快速上手</h2><p><strong>ESP-IDF</strong> 构建系统（基于 <strong>CMake</strong>）允许你直接把磁盘上的二进制文件或文本文件，在编译阶段自动转换并“缝合”进你的 <strong>.bin</strong> 固件中。</p>
<h3 id="0x00-准备资源文件"><a href="#0x00-准备资源文件" class="headerlink" title="0x00 准备资源文件"></a>0x00 准备资源文件</h3><p>在你的项目或组件目录下创建一个文件夹（例如 <code>assets</code>），把你的文本文件（比如 <code>hello.txt</code>）放进去。</p>
<h3 id="0x01-修改-CMakeLists-txt"><a href="#0x01-修改-CMakeLists-txt" class="headerlink" title="0x01 修改 CMakeLists.txt"></a>0x01 修改 CMakeLists.txt</h3><p>在组件目录下的 <code>CMakeLists.txt</code> 里，只需要在 <code>idf_component_register</code> 函数里通过 <code>EMBED_TXTFILES</code> 参数指定路径：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## main/CMakeLists.txt</span></span><br><span class="line">idf_component_register(SRCS <span class="string">&quot;main.c&quot;</span></span><br><span class="line">                    INCLUDE_DIRS <span class="string">&quot;.&quot;</span></span><br><span class="line">                    EMBED_TXTFILES <span class="string">&quot;assets/hello.txt&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="0x02-在-C-C-代码中调用"><a href="#0x02-在-C-C-代码中调用" class="headerlink" title="0x02 在 C/C++ 代码中调用"></a>0x02 在 C/C++ 代码中调用</h3><p>编译系统自动生成了三个全局符号。它们的命名规则是：<code>_binary_[文件名]_[扩展名]_start</code> 和 <code>_binary_[文件名]_[扩展名]_end</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line">#<span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 0x01. 声明外部资源变量</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> <span class="type">uint8_t</span> hello_txt_start[] <span class="keyword">asm</span>(<span class="string">&quot;_binary_hello_txt_start&quot;</span>);</span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> <span class="type">uint8_t</span> hello_txt_end[]   <span class="keyword">asm</span>(<span class="string">&quot;_binary_hello_txt_end&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 0x02. 获取资源长度</span></span><br><span class="line">    <span class="type">size_t</span> size = hello_txt_end - hello_txt_start;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 因为是 txtfiles，所以末尾自带 \0，可以直接作为字符串处理</span></span><br><span class="line">    ESP_LOGI(<span class="string">&quot;APP&quot;</span>, <span class="string">&quot;Embedded file content: %s&quot;</span>, (<span class="type">char</span> *)hello_txt_start);</span><br><span class="line">    ESP_LOGI(<span class="string">&quot;APP&quot;</span>, <span class="string">&quot;File Size: %d bytes&quot;</span>, size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Tips：</strong> 如果你使用的是 <strong>.cpp</strong> 文件，请务必给声明加上 <code>extern &quot;C&quot;</code>，否则会因为 <strong>Name Mangling</strong> 导致链接找不到符号。</p>
</blockquote>
<h2 id="0x03-填坑：那些让我崩溃的“翻车”时刻"><a href="#0x03-填坑：那些让我崩溃的“翻车”时刻" class="headerlink" title="0x03 填坑：那些让我崩溃的“翻车”时刻"></a>0x03 填坑：那些让我崩溃的“翻车”时刻</h2><p>虽然这招用起来很爽，但第一次上手的兄弟大概率会像我当年一样，在几个莫名的坑里反复横跳。这里分享几个我亲身经历的“翻车”现场：</p>
<h4 id="0x00-翻车现场：Symbol-not-found"><a href="#0x00-翻车现场：Symbol-not-found" class="headerlink" title="0x00 翻车现场：Symbol not found"></a>0x00 翻车现场：Symbol not found</h4><p>这是最搞心态的报错。通常是因为我<strong>傻乎乎</strong>地写了个绝对路径，或者路径算错了。</p>
<ul>
<li><strong>血泪教训：</strong> <code>EMBED_TXTFILES</code> 里的路径必须是相对于当前 <code>CMakeLists.txt</code> 的。如果你在 <code>main</code> 目录下嵌入文件，却想在其他自定义组件里调用，链接器分分钟教你做人。我当时的解决办法是：<strong>哪个组件要用，就把资源老老实实塞到哪个组件的文件夹里。</strong></li>
</ul>
<h4 id="0x01-修改只读内存，直接炸了"><a href="#0x01-修改只读内存，直接炸了" class="headerlink" title="0x01 修改只读内存，直接炸了"></a>0x01 修改只读内存，直接炸了</h4><p>由于 <code>EMBED_TXTFILES</code> 贴心地帮我们加了 <code>\0</code>，我第一次用的时候，居然想用 <code>strtok</code> 去切割这段文本。结果呢？ESP32 <strong>直接炸了</strong>（LoadProhibited），不停地循环重启。</p>
<ul>
<li><strong>填坑总结：</strong> 别忘了这东西是存在 <strong>Flash</strong> 里的，它是只读的！你要是想修改，得先用 <code>malloc</code> 开辟一块战场，再用 <code>memcpy</code> 把数据导过去。</li>
</ul>
<h4 id="0x02-变量命名的“玄学”"><a href="#0x02-变量命名的“玄学”" class="headerlink" title="0x02 变量命名的“玄学”"></a>0x02 变量命名的“玄学”</h4><p>文件名里的减号、点号全变下划线，有时候规则复杂到我怀疑人生。比如我的文件名叫 <code>my-config.v1.json</code>，生成的符号名会变成 <code>_binary_my_config_v1_json_start</code>。</p>
<ul>
<li><strong>验证大法：</strong> 别在那瞎猜了，这太要命了。直接去 <code>build</code> 目录下，祭出 <code>nm</code> 大法查看生成的符号。</li>
</ul>
<h2 id="0x04-进阶：我是怎么验证这些“鬼符号”的"><a href="#0x04-进阶：我是怎么验证这些“鬼符号”的" class="headerlink" title="0x04 进阶：我是怎么验证这些“鬼符号”的"></a>0x04 进阶：我是怎么验证这些“鬼符号”的</h2><h4 id="0x00-别猜，直接看产物"><a href="#0x00-别猜，直接看产物" class="headerlink" title="0x00 别猜，直接看产物"></a>0x00 别猜，直接看产物</h4><p>作为一个硬核（折腾型）开发者，实在没底的时候，我会直接翻看生成的 <code>.elf</code> 文件。在你的工程目录下运行这行命令，比搜半天文档管用得多：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nm -gC build/*.elf | grep _binary</span><br></pre></td></tr></table></figure><br>如果列表里能看到预期的 <code>start</code>/<code>end</code> 地址，那心态就稳了。</p>
<h4 id="0x01-实战：证书处理的“极简主义”"><a href="#0x01-实战：证书处理的“极简主义”" class="headerlink" title="0x01 实战：证书处理的“极简主义”"></a>0x01 实战：证书处理的“极简主义”</h4><p>在折腾 <strong>HTTPS</strong> 或者 <strong>MQTTS</strong> 的时候，证书处理简直是灾难。我以前也是老老实实写文件系统驱动，现在直接在代码里这么搞：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.c</span></span><br><span class="line"><span class="comment">// 这里的 asm 名称就是通过上面 nm 命令确定的</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> <span class="type">uint8_t</span> mqtt_ca_pem_start[] <span class="keyword">asm</span>(<span class="string">&quot;_binary_mqtt_ca_pem_start&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">esp_mqtt_client_config_t</span> mqtt_cfg = &#123;</span><br><span class="line">    .broker.address.uri = <span class="string">&quot;mqtts://your-iot-server.com&quot;</span>,</span><br><span class="line">    .broker.verification.certificate = (<span class="type">const</span> <span class="type">char</span> *)mqtt_ca_pem_start,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>直接把起始指针丢进去，连长度都不用写（因为 <code>TXTFILES</code> 自带终止符），这种感觉只能用<strong>“丝滑”</strong>来形容。</p>
<h4 id="0x02-EMBED-FILES-vs-EMBED-TXTFILES：我当年就栽在这儿"><a href="#0x02-EMBED-FILES-vs-EMBED-TXTFILES：我当年就栽在这儿" class="headerlink" title="0x02 EMBED_FILES vs EMBED_TXTFILES：我当年就栽在这儿"></a>0x02 EMBED_FILES vs EMBED_TXTFILES：我当年就栽在这儿</h4><p>这是很多新手最容易“踩坑”的地方，我当年就栽在这儿。<strong>ESP-IDF</strong> 提供了两个类似的参数，区别很关键：</p>
<ul>
<li><strong><code>EMBED_FILES</code></strong>: 纯二进制嵌入。它原封不动地把文件塞进固件。适用于图片、字体、压缩包等非文本资源。</li>
<li><strong><code>EMBED_TXTFILES</code></strong>: 专门针对文本。它会在嵌入资源的末尾<strong>自动追加一个空终止符 <code>\0</code></strong>。</li>
</ul>
<p>如果你错用了 <code>EMBED_FILES</code> 来嵌入证书，你会发现代码运行到最后会莫名其妙地读取到内存后面的垃圾数据，导致 <strong>TLS</strong> 校验失败。<strong>实战建议：HTTPS 证书 (PEM 格式) 或 HTML 请务必使用 <code>EMBED_TXTFILES</code>。</strong></p>
<h4 id="0x03-命名规则的“魔法”"><a href="#0x03-命名规则的“魔法”" class="headerlink" title="0x03 命名规则的“魔法”"></a>0x03 命名规则的“魔法”</h4><p>名字是怎么生成的？规则很简单：<strong>文件名中的所有非字母数字字符（如 <code>.</code>、<code>-</code>）都会被替换成下划线 <code>_</code>。</strong></p>
<p>例如：</p>
<ul>
<li>文件路径：<code>certs/ca.pem</code> -&gt; 变量名：<code>_binary_ca_pem_start</code></li>
<li>C 语言声明时：<code>asm(&quot;_binary_ca_pem_start&quot;)</code></li>
</ul>
<p><em>提示：建议始终使用相对于 <code>CMakeLists.txt</code> 的相对路径，否则变量名可能会变得非常长且难以预料。</em></p>
<h4 id="为什么不直接用文件系统？"><a href="#为什么不直接用文件系统？" class="headerlink" title="为什么不直接用文件系统？"></a>为什么不直接用文件系统？</h4><p>虽然 <strong>SPIFFS</strong> 或 <strong>LittleFS</strong> 也很方便，但在以下场景 <code>embed_txtfiles</code> 是最优解：</p>
<ol>
<li><strong>安全性</strong>：证书放在固件里不易因文件系统损坏而丢失，OTA 更新固件也就是更新了证书。</li>
<li><strong>极简方案</strong>：避免专门为了几百字节去折腾分区表镜像。</li>
<li><strong>读取速度</strong>：数据通过 <strong>MMU</strong> 直接映射到指令总线，读取速度和读代码一样快，没有文件系统的寻址开销。</li>
</ol>
<h2 id="0x05-最后"><a href="#0x05-最后" class="headerlink" title="0x05 最后"></a>0x05 最后</h2><p>从笨重的 <strong>C 数组</strong>转换到优雅的 <code>embed_txtfiles</code>，本质上是让资源回归其原本的格式，把生成的苦活交给构建系统。正如我之前在<a href="/Claude-Code初体验/">Claude Code初体验</a>中感受到的，现代开发的魅力就在于不断利用工具去解开那些重复而低效的死结。</p>
<p>这次填坑心得就分享到这，希望能帮到在被资源路径折磨的你。下个坑见，收工！</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Framework: ESP-IDF v5.x</span><br><span class="line">Target: ESP32 / S2 / S3 / C3 (RISC-V)</span><br><span class="line">Language: C / C++</span><br><span class="line">Build System: CMake</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/build-system.html#embedding-binary-data">ESP-IDF 编程指南 - 指南文档：嵌入二进制数据</a></li>
</ul>

  </div>
</article>



                    
                      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a href="/projects/">项目</a></li>
        
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">0x00 背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"><span class="toc-number">2.</span> <span class="toc-text">0x01 方案对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-number">3.</span> <span class="toc-text">0x02 快速上手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x00-%E5%87%86%E5%A4%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">3.1.</span> <span class="toc-text">0x00 准备资源文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-%E4%BF%AE%E6%94%B9-CMakeLists-txt"><span class="toc-number">3.2.</span> <span class="toc-text">0x01 修改 CMakeLists.txt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-%E5%9C%A8-C-C-%E4%BB%A3%E7%A0%81%E4%B8%AD%E8%B0%83%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">0x02 在 C&#x2F;C++ 代码中调用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E5%A1%AB%E5%9D%91%EF%BC%9A%E9%82%A3%E4%BA%9B%E8%AE%A9%E6%88%91%E5%B4%A9%E6%BA%83%E7%9A%84%E2%80%9C%E7%BF%BB%E8%BD%A6%E2%80%9D%E6%97%B6%E5%88%BB"><span class="toc-number">4.</span> <span class="toc-text">0x03 填坑：那些让我崩溃的“翻车”时刻</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x00-%E7%BF%BB%E8%BD%A6%E7%8E%B0%E5%9C%BA%EF%BC%9ASymbol-not-found"><span class="toc-number">4.0.1.</span> <span class="toc-text">0x00 翻车现场：Symbol not found</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01-%E4%BF%AE%E6%94%B9%E5%8F%AA%E8%AF%BB%E5%86%85%E5%AD%98%EF%BC%8C%E7%9B%B4%E6%8E%A5%E7%82%B8%E4%BA%86"><span class="toc-number">4.0.2.</span> <span class="toc-text">0x01 修改只读内存，直接炸了</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D%E7%9A%84%E2%80%9C%E7%8E%84%E5%AD%A6%E2%80%9D"><span class="toc-number">4.0.3.</span> <span class="toc-text">0x02 变量命名的“玄学”</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E8%BF%9B%E9%98%B6%EF%BC%9A%E6%88%91%E6%98%AF%E6%80%8E%E4%B9%88%E9%AA%8C%E8%AF%81%E8%BF%99%E4%BA%9B%E2%80%9C%E9%AC%BC%E7%AC%A6%E5%8F%B7%E2%80%9D%E7%9A%84"><span class="toc-number">5.</span> <span class="toc-text">0x04 进阶：我是怎么验证这些“鬼符号”的</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x00-%E5%88%AB%E7%8C%9C%EF%BC%8C%E7%9B%B4%E6%8E%A5%E7%9C%8B%E4%BA%A7%E7%89%A9"><span class="toc-number">5.0.1.</span> <span class="toc-text">0x00 别猜，直接看产物</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01-%E5%AE%9E%E6%88%98%EF%BC%9A%E8%AF%81%E4%B9%A6%E5%A4%84%E7%90%86%E7%9A%84%E2%80%9C%E6%9E%81%E7%AE%80%E4%B8%BB%E4%B9%89%E2%80%9D"><span class="toc-number">5.0.2.</span> <span class="toc-text">0x01 实战：证书处理的“极简主义”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-EMBED-FILES-vs-EMBED-TXTFILES%EF%BC%9A%E6%88%91%E5%BD%93%E5%B9%B4%E5%B0%B1%E6%A0%BD%E5%9C%A8%E8%BF%99%E5%84%BF"><span class="toc-number">5.0.3.</span> <span class="toc-text">0x02 EMBED_FILES vs EMBED_TXTFILES：我当年就栽在这儿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x03-%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99%E7%9A%84%E2%80%9C%E9%AD%94%E6%B3%95%E2%80%9D"><span class="toc-number">5.0.4.</span> <span class="toc-text">0x03 命名规则的“魔法”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%9B%B4%E6%8E%A5%E7%94%A8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%9F"><span class="toc-number">5.0.5.</span> <span class="toc-text">为什么不直接用文件系统？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-%E6%9C%80%E5%90%8E"><span class="toc-number">6.</span> <span class="toc-text">0x05 最后</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-number">7.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/"><i
        class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&text=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&title=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon"
      target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&is_video=false&description=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件&body=Check out this article: https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/"><i
        class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&title=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li> -->
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&title=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&title=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&title=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon"
      target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&name=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件&description=&lt;h2 id=&#34;0x00-背景&#34;&gt;&lt;a href=&#34;#0x00-背景&#34; class=&#34;headerlink&#34; title=&#34;0x00 背景&#34;&gt;&lt;/a&gt;0x00 背景&lt;/h2&gt;&lt;p&gt;最近在翻看 &lt;strong&gt;GSC (Google Search Console)&lt;/strong&gt; 的搜索关键词时，发现 &lt;code&gt;esp-idf embed-txtfiles&lt;/code&gt; 这个词的出现频率高得惊人。看来大家在搞 &lt;strong&gt;ESP32&lt;/strong&gt; 开发的时候，都被“如何在固件里优雅地放一个文件”这个问题困扰过。&lt;/p&gt;
&lt;p&gt;在此之前，我为了实现一些功能（比如之前的&lt;a href=&#34;/Make%20A%20Tiny%20Pixel%20Screen/&#34;&gt;那个桌面像素小屏幕&lt;/a&gt;），曾&lt;strong&gt;傻乎乎&lt;/strong&gt;地把图片全转成了巨大的 C 数组（&lt;code&gt;.h&lt;/code&gt; 文件）。结果可想而知：代码文件膨胀到几万行，IDE 索引卡死，每次微调一个像素都要重新编译半天，&lt;strong&gt;简直是灾难&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;不管是 &lt;strong&gt;HTTPS&lt;/strong&gt; 的根证书、前端 &lt;strong&gt;HTML&lt;/strong&gt; 页面，还是简单的配置文件，如果全都写成巨大的 &lt;code&gt;const char[]&lt;/code&gt; 硬编码到代码里，那工程维护简直是自我折磨。今天就拿着我那块&lt;strong&gt;斥 9.9 元巨资&lt;/strong&gt;买回来的 &lt;strong&gt;ESP32-C3&lt;/strong&gt; 演示一下如何用 &lt;strong&gt;ESP-IDF&lt;/strong&gt; 里的这个黑科技优雅地&lt;strong&gt;填坑&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/images/archives/embed_textfiles/embed_textfiles.png&#34; alt=&#34;embed_textfiles&#34;&gt;&lt;/p&gt;"><i
        class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://chaosgoo.com/ESP-IDF-embed-txtfiles-tricks/&t=ESP-IDF 插件：用 embed_txtfiles 优雅地在固件里“塞”文件"><i
        class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>
    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

                        
                          <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
      
        
          2016-2026
            Chaos Goo
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       -->
          
            <li><a href="/privacy-policy/">
                隐私政策
              </a></li><!--
     -->
            <!--
       -->
          
            <li><a href="/terms/">
                使用条款
              </a></li><!--
     -->
            <!--
       -->
          
            <li><a href="/disclaimer/">
                免责声明
              </a></li><!--
     -->
            <!--
       -->
          
            <li><a href="/contact/">
                联系我们
              </a></li><!--
     -->
            
      </ul>
    </nav>
  </div>
</footer>
          </div>
          <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>
    

          

                        <!-- clipboard -->
                        
                          
                            <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
                              
                                    <script type="text/javascript">
                                      $(function () {
                                        // copy-btn HTML
                                        var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
                                        btn += '<i class="fa-regular fa-clone"></i>';
                                        btn += '</span>';
                                        // mount it!
                                        $(".highlight table").before(btn);
                                        var clip = new ClipboardJS('.btn-copy', {
                                          text: function (trigger) {
                                            return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str, it) => str + it.innerText + '\n', '')
                                          }
                                        });
                                        clip.on('success', function (e) {
                                          e.trigger.setAttribute('aria-label', "复制成功！");
                                          e.clearSelection();
                                        })
                                      })
                                    </script>
                                    
                                      
<script src="/js/main.js"></script>

                                        <!-- search -->
                                        
                                              <!-- Baidu Analytics -->
                                              
                                                  <!-- Cloudflare Analytics -->
                                                  
                                                      <!-- Disqus Comments -->
                                                      
                                                          <!-- utterances Comments -->
                                                          
  </body>

</html>